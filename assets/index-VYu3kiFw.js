(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let zp,Jp;function Wp(){return{geminiUrl:zp,vertexUrl:Jp}}function Kp(n,e,t,i){var o,s;if(!(n!=null&&n.baseUrl)){const l=Wp();return e?(o=l.vertexUrl)!==null&&o!==void 0?o:t:(s=l.geminiUrl)!==null&&s!==void 0?s:i}return n.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Kt{}function O(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(i,o)=>{if(Object.prototype.hasOwnProperty.call(e,o)){const s=e[o];return s!=null?String(s):""}else throw new Error(`Key '${o}' not found in valueMap.`)})}function a(n,e,t){for(let s=0;s<e.length-1;s++){const l=e[s];if(l.endsWith("[]")){const u=l.slice(0,-2);if(!(u in n))if(Array.isArray(t))n[u]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${l}`);if(Array.isArray(n[u])){const f=n[u];if(Array.isArray(t))for(let d=0;d<f.length;d++){const h=f[d];a(h,e.slice(s+1),t[d])}else for(const d of f)a(d,e.slice(s+1),t)}return}else if(l.endsWith("[0]")){const u=l.slice(0,-3);u in n||(n[u]=[{}]);const f=n[u];a(f[0],e.slice(s+1),t);return}(!n[l]||typeof n[l]!="object")&&(n[l]={}),n=n[l]}const i=e[e.length-1],o=n[i];if(o!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===o)return;if(typeof o=="object"&&typeof t=="object"&&o!==null&&t!==null)Object.assign(o,t);else throw new Error(`Cannot set value for an existing key. Key: ${i}`)}else i==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(n,t):n[i]=t}function r(n,e){try{if(e.length===1&&e[0]==="_self")return n;for(let t=0;t<e.length;t++){if(typeof n!="object"||n===null)return;const i=e[t];if(i.endsWith("[]")){const o=i.slice(0,-2);if(o in n){const s=n[o];return Array.isArray(s)?s.map(l=>r(l,e.slice(t+1))):void 0}else return}else n=n[i]}return n}catch(t){if(t instanceof TypeError)return;throw t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Sr(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Yp(n){const e={},t=r(n,["operationName"]);t!=null&&a(e,["_url","operationName"],t);const i=r(n,["config"]);return i!=null&&a(e,["config"],i),e}function Qp(n){const e={},t=r(n,["operationName"]);t!=null&&a(e,["operationName"],t);const i=r(n,["resourceName"]);i!=null&&a(e,["_url","resourceName"],i);const o=r(n,["config"]);return o!=null&&a(e,["config"],o),e}function Xp(n){const e={},t=r(n,["operationName"]);t!=null&&a(e,["_url","operationName"],t);const i=r(n,["config"]);return i!=null&&a(e,["config"],i),e}function Zp(n){const e={},t=r(n,["video","uri"]);t!=null&&a(e,["uri"],t);const i=r(n,["video","encodedVideo"]);i!=null&&a(e,["videoBytes"],Sr(i));const o=r(n,["encoding"]);return o!=null&&a(e,["mimeType"],o),e}function jp(n){const e={},t=r(n,["_self"]);return t!=null&&a(e,["video"],Zp(t)),e}function em(n){const e={},t=r(n,["generatedSamples"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(l=>jp(l))),a(e,["generatedVideos"],s)}const i=r(n,["raiMediaFilteredCount"]);i!=null&&a(e,["raiMediaFilteredCount"],i);const o=r(n,["raiMediaFilteredReasons"]);return o!=null&&a(e,["raiMediaFilteredReasons"],o),e}function tm(n){const e={},t=r(n,["name"]);t!=null&&a(e,["name"],t);const i=r(n,["metadata"]);i!=null&&a(e,["metadata"],i);const o=r(n,["done"]);o!=null&&a(e,["done"],o);const s=r(n,["error"]);s!=null&&a(e,["error"],s);const l=r(n,["response","generateVideoResponse"]);return l!=null&&a(e,["response"],em(l)),e}function nm(n){const e={},t=r(n,["gcsUri"]);t!=null&&a(e,["uri"],t);const i=r(n,["bytesBase64Encoded"]);i!=null&&a(e,["videoBytes"],Sr(i));const o=r(n,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function im(n){const e={},t=r(n,["_self"]);return t!=null&&a(e,["video"],nm(t)),e}function om(n){const e={},t=r(n,["videos"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(l=>im(l))),a(e,["generatedVideos"],s)}const i=r(n,["raiMediaFilteredCount"]);i!=null&&a(e,["raiMediaFilteredCount"],i);const o=r(n,["raiMediaFilteredReasons"]);return o!=null&&a(e,["raiMediaFilteredReasons"],o),e}function sm(n){const e={},t=r(n,["name"]);t!=null&&a(e,["name"],t);const i=r(n,["metadata"]);i!=null&&a(e,["metadata"],i);const o=r(n,["done"]);o!=null&&a(e,["done"],o);const s=r(n,["error"]);s!=null&&a(e,["error"],s);const l=r(n,["response"]);return l!=null&&a(e,["response"],om(l)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Il;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Il||(Il={}));var Cl;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(Cl||(Cl={}));var Y;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(Y||(Y={}));var Sl;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",n.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",n.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",n.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",n.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT"})(Sl||(Sl={}));var Al;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(Al||(Al={}));var wl;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(wl||(wl={}));var Rl;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(Rl||(Rl={}));var Pl;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(Pl||(Pl={}));var Ml;(function(n){n.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",n.SIMPLE_SEARCH="SIMPLE_SEARCH",n.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Ml||(Ml={}));var Dl;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",n.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",n.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Dl||(Dl={}));var Nl;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"})(Nl||(Nl={}));var kl;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(kl||(kl={}));var xl;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(xl||(xl={}));var Vl;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.IMAGE_SAFETY="IMAGE_SAFETY"})(Vl||(Vl={}));var Ll;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Ll||(Ll={}));var mo;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(mo||(mo={}));var bl;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(bl||(bl={}));var Hs;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Hs||(Hs={}));var Ul;(function(n){n.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",n.TUNING_MODE_FULL="TUNING_MODE_FULL",n.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Ul||(Ul={}));var Fl;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Fl||(Fl={}));var Bl;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(Bl||(Bl={}));var Ol;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(Ol||(Ol={}));var ql;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(ql||(ql={}));var Gl;(function(n){n.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",n.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Gl||(Gl={}));var $l;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE",n.VALIDATED="VALIDATED"})($l||($l={}));var Hl;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(Hl||(Hl={}));var zl;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(zl||(zl={}));var Jl;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi",n.zh="zh",n.pt="pt",n.es="es"})(Jl||(Jl={}));var Wl;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Wl||(Wl={}));var Kl;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Kl||(Kl={}));var Yl;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Yl||(Yl={}));var Ql;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Ql||(Ql={}));var Xl;(function(n){n.FOREGROUND="FOREGROUND",n.BACKGROUND="BACKGROUND",n.PROMPT="PROMPT",n.SEMANTIC="SEMANTIC",n.INTERACTIVE="INTERACTIVE"})(Xl||(Xl={}));var Zl;(function(n){n.ASSET="ASSET",n.STYLE="STYLE"})(Zl||(Zl={}));var jl;(function(n){n.INSERT="INSERT",n.REMOVE="REMOVE",n.REMOVE_STATIC="REMOVE_STATIC",n.OUTPAINT="OUTPAINT"})(jl||(jl={}));var eu;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(eu||(eu={}));var tu;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(tu||(tu={}));var nu;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(nu||(nu={}));var iu;(function(n){n.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.RESPONSE_REJECTED="RESPONSE_REJECTED",n.NEED_MORE_INPUT="NEED_MORE_INPUT"})(iu||(iu={}));var ou;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(ou||(ou={}));var su;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(su||(su={}));var ru;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(ru||(ru={}));var au;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(au||(au={}));var lu;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(lu||(lu={}));var uu;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(uu||(uu={}));var cu;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(cu||(cu={}));var du;(function(n){n.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",n.QUALITY="QUALITY",n.DIVERSITY="DIVERSITY",n.VOCALIZATION="VOCALIZATION"})(du||(du={}));var un;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(un||(un={}));class zs{constructor(e){const t={};for(const i of e.headers.entries())t[i[0]]=i[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class jn{get text(){var e,t,i,o,s,l,u,f;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",h=!1;const m=[];for(const g of(f=(u=(l=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)!==null&&f!==void 0?f:[]){for(const[T,w]of Object.entries(g))T!=="text"&&T!=="thought"&&(w!==null||w!==void 0)&&m.push(T);if(typeof g.text=="string"){if(typeof g.thought=="boolean"&&g.thought)continue;h=!0,d+=g.text}}return m.length>0&&console.warn(`there are non-text parts ${m} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?d:void 0}get data(){var e,t,i,o,s,l,u,f;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const h=[];for(const m of(f=(u=(l=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)!==null&&f!==void 0?f:[]){for(const[g,T]of Object.entries(m))g!=="inlineData"&&(T!==null||T!==void 0)&&h.push(g);m.inlineData&&typeof m.inlineData.data=="string"&&(d+=atob(m.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var e,t,i,o,s,l,u,f;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(f=(u=(l=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var e,t,i,o,s,l,u,f,d;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const h=(f=(u=(l=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(m=>m.executableCode).map(m=>m.executableCode).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,t,i,o,s,l,u,f,d;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const h=(f=(u=(l=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(m=>m.codeExecutionResult).map(m=>m.codeExecutionResult).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.output}}class fu{}class hu{}class rm{}class am{}class lm{}class um{}class pu{}class mu{}class gu{}class cm{}class go{_fromAPIResponse({apiResponse:e,isVertexAI:t}){const i=new go;let o;const s=e;return t?o=sm(s):o=tm(s),Object.assign(i,o),i}}class yu{}class _u{}class Tu{}class dm{}class fm{}class hm{}class Eu{}class pm{get text(){var e,t,i;let o="",s=!1;const l=[];for(const u of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(const[f,d]of Object.entries(u))f!=="text"&&f!=="thought"&&d!==null&&l.push(f);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;s=!0,o+=u.text}}return l.length>0&&console.warn(`there are non-text parts ${l} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),s?o:void 0}get data(){var e,t,i;let o="";const s=[];for(const l of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(const[u,f]of Object.entries(l))u!=="inlineData"&&f!==null&&s.push(u);l.inlineData&&typeof l.inlineData.data=="string"&&(o+=atob(l.inlineData.data))}return s.length>0&&console.warn(`there are non-data parts ${s} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),o.length>0?btoa(o):void 0}}class mm{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function te(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function md(n,e){const t=te(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function gd(n){return Array.isArray(n)?n.map(e=>yo(e)):[yo(n)]}function yo(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function yd(n){const e=yo(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function _d(n){const e=yo(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function vu(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function Td(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>vu(e)):[vu(n)]}function Js(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function Iu(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function Cu(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function Pe(n){if(n==null)throw new Error("ContentUnion is required");return Js(n)?n:{role:"user",parts:Td(n)}}function Ar(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const i=Pe(t);return i.parts&&i.parts.length>0&&i.parts[0].text!==void 0?[i.parts[0].text]:[]});if(n.isVertexAI()){const t=Pe(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>Pe(t)):[Pe(e)]}function be(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(Iu(n)||Cu(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Pe(n)]}const e=[],t=[],i=Js(n[0]);for(const o of n){const s=Js(o);if(s!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(s)e.push(o);else{if(Iu(o)||Cu(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(o)}}return i||e.push({role:"user",parts:Td(t)}),e}function gm(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(i=>i!=="null");if(t.length===1)e.type=Object.values(Y).includes(t[0].toUpperCase())?t[0].toUpperCase():Y.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const i of t)e.anyOf.push({type:Object.values(Y).includes(i.toUpperCase())?i.toUpperCase():Y.TYPE_UNSPECIFIED})}}function cn(n){const e={},t=["items"],i=["anyOf"],o=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const s=n.anyOf;s!=null&&s.length==2&&(s[0].type==="null"?(e.nullable=!0,n=s[1]):s[1].type==="null"&&(e.nullable=!0,n=s[0])),n.type instanceof Array&&gm(n.type,e);for(const[l,u]of Object.entries(n))if(u!=null)if(l=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.values(Y).includes(u.toUpperCase())?u.toUpperCase():Y.TYPE_UNSPECIFIED}else if(t.includes(l))e[l]=cn(u);else if(i.includes(l)){const f=[];for(const d of u){if(d.type=="null"){e.nullable=!0;continue}f.push(cn(d))}e[l]=f}else if(o.includes(l)){const f={};for(const[d,h]of Object.entries(u))f[d]=cn(h);e[l]=f}else{if(l==="additionalProperties")continue;e[l]=u}return e}function wr(n){return cn(n)}function Rr(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function Pr(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function An(n){if(n.functionDeclarations)for(const e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=cn(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=cn(e.response));return n}function wn(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of n)e.push(t);return e}function ym(n,e,t,i=1){const o=!e.startsWith(`${t}/`)&&e.split("/").length===i;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:o?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:o?`${t}/${e}`:e}function lt(n,e){if(typeof e!="string")throw new Error("name must be a string");return ym(n,e,"cachedContents")}function Ed(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function Yt(n){return Sr(n)}function _m(n){return n!=null&&typeof n=="object"&&"name"in n}function Tm(n){return n!=null&&typeof n=="object"&&"video"in n}function Em(n){return n!=null&&typeof n=="object"&&"uri"in n}function vd(n){var e;let t;if(_m(n)&&(t=n.name),!(Em(n)&&(t=n.uri,t===void 0))&&!(Tm(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const o=t.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${t}`);t=o[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function Id(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function Cd(n){for(const e of["models","tunedModels","publisherModels"])if(vm(n,e))return n[e];return[]}function vm(n,e){return n!==null&&typeof n=="object"&&e in n}function Im(n,e={}){const t=n,i={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(i.responseJsonSchema=t.outputSchema),e.behavior&&(i.behavior=e.behavior),{functionDeclarations:[i]}}function Cm(n,e={}){const t=[],i=new Set;for(const o of n){const s=o.name;if(i.has(s))throw new Error(`Duplicate function name ${s} found in MCP tools. Please ensure function names are unique.`);i.add(s);const l=Im(o,e);l.functionDeclarations&&t.push(...l.functionDeclarations)}return{functionDeclarations:t}}function Sd(n,e){let t;if(typeof e=="string")if(n.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(n.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;const i=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,o=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(n.isVertexAI()){if(o>0||i!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(i>0||o!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function Sm(n){if(typeof n!="string")return n;const e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function Ad(n){if(typeof n!="object"||n===null)return{};const e=n,t=e.inlinedResponses;if(typeof t!="object"||t===null)return n;const o=t.inlinedResponses;if(!Array.isArray(o)||o.length===0)return n;let s=!1;for(const l of o){if(typeof l!="object"||l===null)continue;const f=l.response;if(typeof f!="object"||f===null)continue;if(f.embedding!==void 0){s=!0;break}}return s&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),n}function Rn(n,e){const t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function wd(n){const e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Am(n){const e={},t=r(n,["fps"]);t!=null&&a(e,["fps"],t);const i=r(n,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=r(n,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function wm(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["data"]);t!=null&&a(e,["data"],t);const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Rm(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["fileUri"]);t!=null&&a(e,["fileUri"],t);const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Pm(n){const e={},t=r(n,["id"]);t!=null&&a(e,["id"],t);const i=r(n,["args"]);i!=null&&a(e,["args"],i);const o=r(n,["name"]);return o!=null&&a(e,["name"],o),e}function Mm(n){const e={},t=r(n,["videoMetadata"]);t!=null&&a(e,["videoMetadata"],Am(t));const i=r(n,["thought"]);i!=null&&a(e,["thought"],i);const o=r(n,["inlineData"]);o!=null&&a(e,["inlineData"],wm(o));const s=r(n,["fileData"]);s!=null&&a(e,["fileData"],Rm(s));const l=r(n,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=r(n,["functionCall"]);u!=null&&a(e,["functionCall"],Pm(u));const f=r(n,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const d=r(n,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=r(n,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const m=r(n,["text"]);return m!=null&&a(e,["text"],m),e}function Rd(n){const e={},t=r(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>Mm(s))),a(e,["parts"],o)}const i=r(n,["role"]);return i!=null&&a(e,["role"],i),e}function Dm(n){const e={},t=r(n,["anyOf"]);t!=null&&a(e,["anyOf"],t);const i=r(n,["default"]);i!=null&&a(e,["default"],i);const o=r(n,["description"]);o!=null&&a(e,["description"],o);const s=r(n,["enum"]);s!=null&&a(e,["enum"],s);const l=r(n,["example"]);l!=null&&a(e,["example"],l);const u=r(n,["format"]);u!=null&&a(e,["format"],u);const f=r(n,["items"]);f!=null&&a(e,["items"],f);const d=r(n,["maxItems"]);d!=null&&a(e,["maxItems"],d);const h=r(n,["maxLength"]);h!=null&&a(e,["maxLength"],h);const m=r(n,["maxProperties"]);m!=null&&a(e,["maxProperties"],m);const g=r(n,["maximum"]);g!=null&&a(e,["maximum"],g);const T=r(n,["minItems"]);T!=null&&a(e,["minItems"],T);const w=r(n,["minLength"]);w!=null&&a(e,["minLength"],w);const M=r(n,["minProperties"]);M!=null&&a(e,["minProperties"],M);const N=r(n,["minimum"]);N!=null&&a(e,["minimum"],N);const L=r(n,["nullable"]);L!=null&&a(e,["nullable"],L);const V=r(n,["pattern"]);V!=null&&a(e,["pattern"],V);const b=r(n,["properties"]);b!=null&&a(e,["properties"],b);const B=r(n,["propertyOrdering"]);B!=null&&a(e,["propertyOrdering"],B);const q=r(n,["required"]);q!=null&&a(e,["required"],q);const H=r(n,["title"]);H!=null&&a(e,["title"],H);const S=r(n,["type"]);return S!=null&&a(e,["type"],S),e}function Nm(n){const e={};if(r(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const t=r(n,["category"]);t!=null&&a(e,["category"],t);const i=r(n,["threshold"]);return i!=null&&a(e,["threshold"],i),e}function km(n){const e={},t=r(n,["behavior"]);t!=null&&a(e,["behavior"],t);const i=r(n,["description"]);i!=null&&a(e,["description"],i);const o=r(n,["name"]);o!=null&&a(e,["name"],o);const s=r(n,["parameters"]);s!=null&&a(e,["parameters"],s);const l=r(n,["parametersJsonSchema"]);l!=null&&a(e,["parametersJsonSchema"],l);const u=r(n,["response"]);u!=null&&a(e,["response"],u);const f=r(n,["responseJsonSchema"]);return f!=null&&a(e,["responseJsonSchema"],f),e}function xm(n){const e={},t=r(n,["startTime"]);t!=null&&a(e,["startTime"],t);const i=r(n,["endTime"]);return i!=null&&a(e,["endTime"],i),e}function Vm(n){const e={},t=r(n,["timeRangeFilter"]);if(t!=null&&a(e,["timeRangeFilter"],xm(t)),r(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function Lm(n){const e={},t=r(n,["mode"]);t!=null&&a(e,["mode"],t);const i=r(n,["dynamicThreshold"]);return i!=null&&a(e,["dynamicThreshold"],i),e}function bm(n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&a(e,["dynamicRetrievalConfig"],Lm(t)),e}function Um(){return{}}function Fm(n){const e={},t=r(n,["environment"]);return t!=null&&a(e,["environment"],t),e}function Bm(n){const e={},t=r(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(d=>km(d))),a(e,["functionDeclarations"],f)}if(r(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=r(n,["googleSearch"]);i!=null&&a(e,["googleSearch"],Vm(i));const o=r(n,["googleSearchRetrieval"]);if(o!=null&&a(e,["googleSearchRetrieval"],bm(o)),r(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");r(n,["urlContext"])!=null&&a(e,["urlContext"],Um());const l=r(n,["computerUse"]);l!=null&&a(e,["computerUse"],Fm(l));const u=r(n,["codeExecution"]);return u!=null&&a(e,["codeExecution"],u),e}function Om(n){const e={},t=r(n,["mode"]);t!=null&&a(e,["mode"],t);const i=r(n,["allowedFunctionNames"]);return i!=null&&a(e,["allowedFunctionNames"],i),e}function qm(n){const e={},t=r(n,["latitude"]);t!=null&&a(e,["latitude"],t);const i=r(n,["longitude"]);return i!=null&&a(e,["longitude"],i),e}function Gm(n){const e={},t=r(n,["latLng"]);t!=null&&a(e,["latLng"],qm(t));const i=r(n,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function $m(n){const e={},t=r(n,["functionCallingConfig"]);t!=null&&a(e,["functionCallingConfig"],Om(t));const i=r(n,["retrievalConfig"]);return i!=null&&a(e,["retrievalConfig"],Gm(i)),e}function Hm(n){const e={},t=r(n,["voiceName"]);return t!=null&&a(e,["voiceName"],t),e}function Pd(n){const e={},t=r(n,["prebuiltVoiceConfig"]);return t!=null&&a(e,["prebuiltVoiceConfig"],Hm(t)),e}function zm(n){const e={},t=r(n,["speaker"]);t!=null&&a(e,["speaker"],t);const i=r(n,["voiceConfig"]);return i!=null&&a(e,["voiceConfig"],Pd(i)),e}function Jm(n){const e={},t=r(n,["speakerVoiceConfigs"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>zm(o))),a(e,["speakerVoiceConfigs"],i)}return e}function Wm(n){const e={},t=r(n,["voiceConfig"]);t!=null&&a(e,["voiceConfig"],Pd(t));const i=r(n,["multiSpeakerVoiceConfig"]);i!=null&&a(e,["multiSpeakerVoiceConfig"],Jm(i));const o=r(n,["languageCode"]);return o!=null&&a(e,["languageCode"],o),e}function Km(n){const e={},t=r(n,["includeThoughts"]);t!=null&&a(e,["includeThoughts"],t);const i=r(n,["thinkingBudget"]);return i!=null&&a(e,["thinkingBudget"],i),e}function Ym(n,e,t){const i={},o=r(e,["systemInstruction"]);t!==void 0&&o!=null&&a(t,["systemInstruction"],Rd(Pe(o)));const s=r(e,["temperature"]);s!=null&&a(i,["temperature"],s);const l=r(e,["topP"]);l!=null&&a(i,["topP"],l);const u=r(e,["topK"]);u!=null&&a(i,["topK"],u);const f=r(e,["candidateCount"]);f!=null&&a(i,["candidateCount"],f);const d=r(e,["maxOutputTokens"]);d!=null&&a(i,["maxOutputTokens"],d);const h=r(e,["stopSequences"]);h!=null&&a(i,["stopSequences"],h);const m=r(e,["responseLogprobs"]);m!=null&&a(i,["responseLogprobs"],m);const g=r(e,["logprobs"]);g!=null&&a(i,["logprobs"],g);const T=r(e,["presencePenalty"]);T!=null&&a(i,["presencePenalty"],T);const w=r(e,["frequencyPenalty"]);w!=null&&a(i,["frequencyPenalty"],w);const M=r(e,["seed"]);M!=null&&a(i,["seed"],M);const N=r(e,["responseMimeType"]);N!=null&&a(i,["responseMimeType"],N);const L=r(e,["responseSchema"]);L!=null&&a(i,["responseSchema"],Dm(wr(L)));const V=r(e,["responseJsonSchema"]);if(V!=null&&a(i,["responseJsonSchema"],V),r(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(r(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const b=r(e,["safetySettings"]);if(t!==void 0&&b!=null){let C=b;Array.isArray(C)&&(C=C.map(R=>Nm(R))),a(t,["safetySettings"],C)}const B=r(e,["tools"]);if(t!==void 0&&B!=null){let C=wn(B);Array.isArray(C)&&(C=C.map(R=>Bm(An(R)))),a(t,["tools"],C)}const q=r(e,["toolConfig"]);if(t!==void 0&&q!=null&&a(t,["toolConfig"],$m(q)),r(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const H=r(e,["cachedContent"]);t!==void 0&&H!=null&&a(t,["cachedContent"],lt(n,H));const S=r(e,["responseModalities"]);S!=null&&a(i,["responseModalities"],S);const v=r(e,["mediaResolution"]);v!=null&&a(i,["mediaResolution"],v);const E=r(e,["speechConfig"]);if(E!=null&&a(i,["speechConfig"],Wm(Rr(E))),r(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const A=r(e,["thinkingConfig"]);return A!=null&&a(i,["thinkingConfig"],Km(A)),i}function Qm(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["request","model"],te(n,i));const o=r(e,["contents"]);if(o!=null){let l=be(o);Array.isArray(l)&&(l=l.map(u=>Rd(u))),a(t,["request","contents"],l)}const s=r(e,["config"]);return s!=null&&a(t,["request","generationConfig"],Ym(n,s,t)),t}function Xm(n,e){const t={};if(r(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(r(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(r(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const i=r(e,["fileName"]);i!=null&&a(t,["fileName"],i);const o=r(e,["inlinedRequests"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>Qm(n,l))),a(t,["requests","requests"],s)}return t}function Zm(n,e){const t={},i=r(n,["displayName"]);if(e!==void 0&&i!=null&&a(e,["batch","displayName"],i),r(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function Rs(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["src"]);o!=null&&a(t,["batch","inputConfig"],Xm(n,Sd(n,o)));const s=r(e,["config"]);return s!=null&&a(t,["config"],Zm(s,t)),t}function jm(n,e){const t={},i=r(n,["taskType"]);e!==void 0&&i!=null&&a(e,["requests[]","taskType"],i);const o=r(n,["title"]);e!==void 0&&o!=null&&a(e,["requests[]","title"],o);const s=r(n,["outputDimensionality"]);if(e!==void 0&&s!=null&&a(e,["requests[]","outputDimensionality"],s),r(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(r(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function eg(n,e){const t={},i=r(e,["contents"]);i!=null&&a(t,["requests[]","request","content"],Ar(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],jm(o,t)),t}function tg(n,e){const t={},i=r(e,["fileName"]);i!=null&&a(t,["file_name"],i);const o=r(e,["inlinedRequests"]);return o!=null&&a(t,["requests"],eg(n,o)),t}function ng(n,e){const t={},i=r(n,["displayName"]);return e!==void 0&&i!=null&&a(e,["batch","displayName"],i),t}function Ps(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["src"]);o!=null&&a(t,["batch","inputConfig"],tg(n,o));const s=r(e,["config"]);return s!=null&&a(t,["config"],ng(s,t)),t}function ig(n,e){const t={},i=r(e,["name"]);i!=null&&a(t,["_url","name"],Rn(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],o),t}function og(n,e){const t={},i=r(e,["name"]);i!=null&&a(t,["_url","name"],Rn(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],o),t}function sg(n,e){const t={},i=r(n,["pageSize"]);e!==void 0&&i!=null&&a(e,["_query","pageSize"],i);const o=r(n,["pageToken"]);if(e!==void 0&&o!=null&&a(e,["_query","pageToken"],o),r(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function rg(n){const e={},t=r(n,["config"]);return t!=null&&a(e,["config"],sg(t,e)),e}function ag(n,e){const t={},i=r(e,["name"]);i!=null&&a(t,["_url","name"],Rn(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],o),t}function lg(n){const e={},t=r(n,["format"]);t!=null&&a(e,["instancesFormat"],t);const i=r(n,["gcsUri"]);i!=null&&a(e,["gcsSource","uris"],i);const o=r(n,["bigqueryUri"]);if(o!=null&&a(e,["bigquerySource","inputUri"],o),r(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(r(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function ug(n){const e={},t=r(n,["format"]);t!=null&&a(e,["predictionsFormat"],t);const i=r(n,["gcsUri"]);i!=null&&a(e,["gcsDestination","outputUriPrefix"],i);const o=r(n,["bigqueryUri"]);if(o!=null&&a(e,["bigqueryDestination","outputUri"],o),r(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(r(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(r(n,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function cg(n,e){const t={},i=r(n,["displayName"]);e!==void 0&&i!=null&&a(e,["displayName"],i);const o=r(n,["dest"]);return e!==void 0&&o!=null&&a(e,["outputConfig"],ug(Sm(o))),t}function dg(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["model"],te(n,i));const o=r(e,["src"]);o!=null&&a(t,["inputConfig"],lg(Sd(n,o)));const s=r(e,["config"]);return s!=null&&a(t,["config"],cg(s,t)),t}function fg(n,e){const t={},i=r(e,["name"]);i!=null&&a(t,["_url","name"],Rn(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],o),t}function hg(n,e){const t={},i=r(e,["name"]);i!=null&&a(t,["_url","name"],Rn(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],o),t}function pg(n,e){const t={},i=r(n,["pageSize"]);e!==void 0&&i!=null&&a(e,["_query","pageSize"],i);const o=r(n,["pageToken"]);e!==void 0&&o!=null&&a(e,["_query","pageToken"],o);const s=r(n,["filter"]);return e!==void 0&&s!=null&&a(e,["_query","filter"],s),t}function mg(n){const e={},t=r(n,["config"]);return t!=null&&a(e,["config"],pg(t,e)),e}function gg(n,e){const t={},i=r(e,["name"]);i!=null&&a(t,["_url","name"],Rn(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],o),t}function yg(n){const e={},t=r(n,["fps"]);t!=null&&a(e,["fps"],t);const i=r(n,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=r(n,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function _g(n){const e={},t=r(n,["data"]);t!=null&&a(e,["data"],t);const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Tg(n){const e={},t=r(n,["fileUri"]);t!=null&&a(e,["fileUri"],t);const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Eg(n){const e={},t=r(n,["id"]);t!=null&&a(e,["id"],t);const i=r(n,["args"]);i!=null&&a(e,["args"],i);const o=r(n,["name"]);return o!=null&&a(e,["name"],o),e}function vg(n){const e={},t=r(n,["videoMetadata"]);t!=null&&a(e,["videoMetadata"],yg(t));const i=r(n,["thought"]);i!=null&&a(e,["thought"],i);const o=r(n,["inlineData"]);o!=null&&a(e,["inlineData"],_g(o));const s=r(n,["fileData"]);s!=null&&a(e,["fileData"],Tg(s));const l=r(n,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=r(n,["functionCall"]);u!=null&&a(e,["functionCall"],Eg(u));const f=r(n,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const d=r(n,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=r(n,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const m=r(n,["text"]);return m!=null&&a(e,["text"],m),e}function Ig(n){const e={},t=r(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>vg(s))),a(e,["parts"],o)}const i=r(n,["role"]);return i!=null&&a(e,["role"],i),e}function Cg(n){const e={},t=r(n,["citationSources"]);return t!=null&&a(e,["citations"],t),e}function Sg(n){const e={},t=r(n,["retrievedUrl"]);t!=null&&a(e,["retrievedUrl"],t);const i=r(n,["urlRetrievalStatus"]);return i!=null&&a(e,["urlRetrievalStatus"],i),e}function Ag(n){const e={},t=r(n,["urlMetadata"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>Sg(o))),a(e,["urlMetadata"],i)}return e}function wg(n){const e={},t=r(n,["content"]);t!=null&&a(e,["content"],Ig(t));const i=r(n,["citationMetadata"]);i!=null&&a(e,["citationMetadata"],Cg(i));const o=r(n,["tokenCount"]);o!=null&&a(e,["tokenCount"],o);const s=r(n,["finishReason"]);s!=null&&a(e,["finishReason"],s);const l=r(n,["urlContextMetadata"]);l!=null&&a(e,["urlContextMetadata"],Ag(l));const u=r(n,["avgLogprobs"]);u!=null&&a(e,["avgLogprobs"],u);const f=r(n,["groundingMetadata"]);f!=null&&a(e,["groundingMetadata"],f);const d=r(n,["index"]);d!=null&&a(e,["index"],d);const h=r(n,["logprobsResult"]);h!=null&&a(e,["logprobsResult"],h);const m=r(n,["safetyRatings"]);return m!=null&&a(e,["safetyRatings"],m),e}function Rg(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["candidates"]);if(i!=null){let f=i;Array.isArray(f)&&(f=f.map(d=>wg(d))),a(e,["candidates"],f)}const o=r(n,["modelVersion"]);o!=null&&a(e,["modelVersion"],o);const s=r(n,["promptFeedback"]);s!=null&&a(e,["promptFeedback"],s);const l=r(n,["responseId"]);l!=null&&a(e,["responseId"],l);const u=r(n,["usageMetadata"]);return u!=null&&a(e,["usageMetadata"],u),e}function Mr(n){const e={},t=r(n,["details"]);t!=null&&a(e,["details"],t);const i=r(n,["code"]);i!=null&&a(e,["code"],i);const o=r(n,["message"]);return o!=null&&a(e,["message"],o),e}function Pg(n){const e={},t=r(n,["response"]);t!=null&&a(e,["response"],Rg(t));const i=r(n,["error"]);return i!=null&&a(e,["error"],Mr(i)),e}function Mg(n){const e={},t=r(n,["values"]);return t!=null&&a(e,["values"],t),e}function Dg(n){const e={},t=r(n,["embedding"]);t!=null&&a(e,["embedding"],Mg(t));const i=r(n,["tokenCount"]);return i!=null&&a(e,["tokenCount"],i),e}function Ng(n){const e={},t=r(n,["response"]);t!=null&&a(e,["response"],Dg(t));const i=r(n,["error"]);return i!=null&&a(e,["error"],Mr(i)),e}function kg(n){const e={},t=r(n,["responsesFile"]);t!=null&&a(e,["fileName"],t);const i=r(n,["inlinedResponses","inlinedResponses"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>Pg(l))),a(e,["inlinedResponses"],s)}const o=r(n,["inlinedEmbedContentResponses","inlinedResponses"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>Ng(l))),a(e,["inlinedEmbedContentResponses"],s)}return e}function on(n){const e={},t=r(n,["name"]);t!=null&&a(e,["name"],t);const i=r(n,["metadata","displayName"]);i!=null&&a(e,["displayName"],i);const o=r(n,["metadata","state"]);o!=null&&a(e,["state"],wd(o));const s=r(n,["metadata","createTime"]);s!=null&&a(e,["createTime"],s);const l=r(n,["metadata","endTime"]);l!=null&&a(e,["endTime"],l);const u=r(n,["metadata","updateTime"]);u!=null&&a(e,["updateTime"],u);const f=r(n,["metadata","model"]);f!=null&&a(e,["model"],f);const d=r(n,["metadata","output"]);return d!=null&&a(e,["dest"],kg(Ad(d))),e}function xg(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["nextPageToken"]);i!=null&&a(e,["nextPageToken"],i);const o=r(n,["operations"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>on(l))),a(e,["batchJobs"],s)}return e}function Vg(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["name"]);i!=null&&a(e,["name"],i);const o=r(n,["done"]);o!=null&&a(e,["done"],o);const s=r(n,["error"]);return s!=null&&a(e,["error"],Mr(s)),e}function Md(n){const e={},t=r(n,["details"]);t!=null&&a(e,["details"],t);const i=r(n,["code"]);i!=null&&a(e,["code"],i);const o=r(n,["message"]);return o!=null&&a(e,["message"],o),e}function Lg(n){const e={},t=r(n,["instancesFormat"]);t!=null&&a(e,["format"],t);const i=r(n,["gcsSource","uris"]);i!=null&&a(e,["gcsUri"],i);const o=r(n,["bigquerySource","inputUri"]);return o!=null&&a(e,["bigqueryUri"],o),e}function bg(n){const e={},t=r(n,["predictionsFormat"]);t!=null&&a(e,["format"],t);const i=r(n,["gcsDestination","outputUriPrefix"]);i!=null&&a(e,["gcsUri"],i);const o=r(n,["bigqueryDestination","outputUri"]);return o!=null&&a(e,["bigqueryUri"],o),e}function Ws(n){const e={},t=r(n,["name"]);t!=null&&a(e,["name"],t);const i=r(n,["displayName"]);i!=null&&a(e,["displayName"],i);const o=r(n,["state"]);o!=null&&a(e,["state"],wd(o));const s=r(n,["error"]);s!=null&&a(e,["error"],Md(s));const l=r(n,["createTime"]);l!=null&&a(e,["createTime"],l);const u=r(n,["startTime"]);u!=null&&a(e,["startTime"],u);const f=r(n,["endTime"]);f!=null&&a(e,["endTime"],f);const d=r(n,["updateTime"]);d!=null&&a(e,["updateTime"],d);const h=r(n,["model"]);h!=null&&a(e,["model"],h);const m=r(n,["inputConfig"]);m!=null&&a(e,["src"],Lg(m));const g=r(n,["outputConfig"]);return g!=null&&a(e,["dest"],bg(Ad(g))),e}function Ug(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["nextPageToken"]);i!=null&&a(e,["nextPageToken"],i);const o=r(n,["batchPredictionJobs"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>Ws(l))),a(e,["batchJobs"],s)}return e}function Fg(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["name"]);i!=null&&a(e,["name"],i);const o=r(n,["done"]);o!=null&&a(e,["done"],o);const s=r(n,["error"]);return s!=null&&a(e,["error"],Md(s)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Gt;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(Gt||(Gt={}));class Ii{constructor(e,t,i,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,i,o)}init(e,t,i){var o,s;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t==null?void 0:t.sdkHttpResponse,this.idxInternal=0;let l={config:{}};!i||Object.keys(i).length===0?l={config:{}}:typeof i=="object"?l=Object.assign({},i):l=i,l.config&&(l.config.pageToken=t.nextPageToken),this.paramsInternal=l,this.pageInternalSize=(s=(o=l.config)===null||o===void 0?void 0:o.pageSize)!==null&&s!==void 0?s:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Bg extends Kt{constructor(e){super(),this.apiClient=e,this.create=async t=>{var i,o;if(this.apiClient.isVertexAI())return t.config=this.formatDestination(t.src,t.config),this.createInternal(t);const s=t.src;if(!(Array.isArray(t.src)||s.inlinedRequests!==void 0))return this.createInternal(t);const u=this.createInlinedGenerateContentRequest(t),f=u.path,d=u.body,h=Rs(this.apiClient,t)._query||{};return this.apiClient.request({path:f,queryParams:h,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json()).then(g=>on(g))},this.createEmbeddings=async t=>{var i,o;if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");if(!(t.src.inlinedRequests!==void 0))return this.createEmbeddingsInternal(t);const u=this.createInlinedEmbedContentRequest(t),f=u.path,d=u.body,h=Ps(this.apiClient,t)._query||{};return this.apiClient.request({path:f,queryParams:h,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json()).then(g=>on(g))},this.list=async(t={})=>new Ii(Gt.PAGED_ITEM_BATCH_JOBS,i=>this.listInternal(i),await this.listInternal(t),t)}createInlinedGenerateContentRequest(e){const t=Rs(this.apiClient,e),i=t._url,o=O("{model}:batchGenerateContent",i),u=t.batch.inputConfig.requests,f=u.requests,d=[];for(const h of f){const m=Object.assign({},h);if(m.systemInstruction){const g=m.systemInstruction;delete m.systemInstruction;const T=m.request;T.systemInstruction=g,m.request=T}d.push(m)}return u.requests=d,delete t.config,delete t._url,delete t._query,{path:o,body:t}}createInlinedEmbedContentRequest(e){const t=Ps(this.apiClient,e),i=t._url,o=O("{model}:asyncBatchEmbedContent",i),u=t.batch.inputConfig.requests,f=u.requests,d=[];delete u.config;for(const h of f){const m=Object.assign({},h),g=m.request;for(const T in m)T!=="request"&&(g[T]=m[T],delete m[T]);d.push(m)}return u.requests=d,delete t.config,delete t._url,delete t._query,{path:o,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){const i=t?Object.assign({},t):{},o=Date.now().toString();if(i.displayName||(i.displayName=`genaiBatchJob_${o}`),i.dest===void 0){const s=this.getGcsUri(e),l=this.getBigqueryUri(e);if(s)s.endsWith(".jsonl")?i.dest=`${s.slice(0,-6)}/dest`:i.dest=`${s}_dest_${o}`;else if(l)i.dest=`${l}_dest_${o}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return i}async createInternal(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=dg(this.apiClient,e);return u=O("batchPredictionJobs",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),l.then(h=>Ws(h))}else{const d=Rs(this.apiClient,e);return u=O("{model}:batchGenerateContent",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),l.then(h=>on(h))}}async createEmbeddingsInternal(e){var t,i;let o,s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Ps(this.apiClient,e);return s=O("{model}:asyncBatchEmbedContent",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>on(f))}}async get(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=fg(this.apiClient,e);return u=O("batchPredictionJobs/{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),l.then(h=>Ws(h))}else{const d=ig(this.apiClient,e);return u=O("batches/{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),l.then(h=>on(h))}}async cancel(e){var t,i,o,s;let l="",u={};if(this.apiClient.isVertexAI()){const f=hg(this.apiClient,e);l=O("batchPredictionJobs/{name}:cancel",f._url),u=f._query,delete f.config,delete f._url,delete f._query,await this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}else{const f=og(this.apiClient,e);l=O("batches/{name}:cancel",f._url),u=f._query,delete f.config,delete f._url,delete f._query,await this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=mg(e);return u=O("batchPredictionJobs",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=Ug(h),g=new Eu;return Object.assign(g,m),g})}else{const d=rg(e);return u=O("batches",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=xg(h),g=new Eu;return Object.assign(g,m),g})}}async delete(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=gg(this.apiClient,e);return u=O("batchPredictionJobs/{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>Fg(h))}else{const d=ag(this.apiClient,e);return u=O("batches/{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>Vg(h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Og(n){const e={},t=r(n,["fps"]);t!=null&&a(e,["fps"],t);const i=r(n,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=r(n,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function qg(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["data"]);t!=null&&a(e,["data"],t);const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Gg(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["fileUri"]);t!=null&&a(e,["fileUri"],t);const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function $g(n){const e={},t=r(n,["id"]);t!=null&&a(e,["id"],t);const i=r(n,["args"]);i!=null&&a(e,["args"],i);const o=r(n,["name"]);return o!=null&&a(e,["name"],o),e}function Hg(n){const e={},t=r(n,["videoMetadata"]);t!=null&&a(e,["videoMetadata"],Og(t));const i=r(n,["thought"]);i!=null&&a(e,["thought"],i);const o=r(n,["inlineData"]);o!=null&&a(e,["inlineData"],qg(o));const s=r(n,["fileData"]);s!=null&&a(e,["fileData"],Gg(s));const l=r(n,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=r(n,["functionCall"]);u!=null&&a(e,["functionCall"],$g(u));const f=r(n,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const d=r(n,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=r(n,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const m=r(n,["text"]);return m!=null&&a(e,["text"],m),e}function Su(n){const e={},t=r(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>Hg(s))),a(e,["parts"],o)}const i=r(n,["role"]);return i!=null&&a(e,["role"],i),e}function zg(n){const e={},t=r(n,["behavior"]);t!=null&&a(e,["behavior"],t);const i=r(n,["description"]);i!=null&&a(e,["description"],i);const o=r(n,["name"]);o!=null&&a(e,["name"],o);const s=r(n,["parameters"]);s!=null&&a(e,["parameters"],s);const l=r(n,["parametersJsonSchema"]);l!=null&&a(e,["parametersJsonSchema"],l);const u=r(n,["response"]);u!=null&&a(e,["response"],u);const f=r(n,["responseJsonSchema"]);return f!=null&&a(e,["responseJsonSchema"],f),e}function Jg(n){const e={},t=r(n,["startTime"]);t!=null&&a(e,["startTime"],t);const i=r(n,["endTime"]);return i!=null&&a(e,["endTime"],i),e}function Wg(n){const e={},t=r(n,["timeRangeFilter"]);if(t!=null&&a(e,["timeRangeFilter"],Jg(t)),r(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function Kg(n){const e={},t=r(n,["mode"]);t!=null&&a(e,["mode"],t);const i=r(n,["dynamicThreshold"]);return i!=null&&a(e,["dynamicThreshold"],i),e}function Yg(n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&a(e,["dynamicRetrievalConfig"],Kg(t)),e}function Qg(){return{}}function Xg(n){const e={},t=r(n,["environment"]);return t!=null&&a(e,["environment"],t),e}function Zg(n){const e={},t=r(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(d=>zg(d))),a(e,["functionDeclarations"],f)}if(r(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=r(n,["googleSearch"]);i!=null&&a(e,["googleSearch"],Wg(i));const o=r(n,["googleSearchRetrieval"]);if(o!=null&&a(e,["googleSearchRetrieval"],Yg(o)),r(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");r(n,["urlContext"])!=null&&a(e,["urlContext"],Qg());const l=r(n,["computerUse"]);l!=null&&a(e,["computerUse"],Xg(l));const u=r(n,["codeExecution"]);return u!=null&&a(e,["codeExecution"],u),e}function jg(n){const e={},t=r(n,["mode"]);t!=null&&a(e,["mode"],t);const i=r(n,["allowedFunctionNames"]);return i!=null&&a(e,["allowedFunctionNames"],i),e}function ey(n){const e={},t=r(n,["latitude"]);t!=null&&a(e,["latitude"],t);const i=r(n,["longitude"]);return i!=null&&a(e,["longitude"],i),e}function ty(n){const e={},t=r(n,["latLng"]);t!=null&&a(e,["latLng"],ey(t));const i=r(n,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function ny(n){const e={},t=r(n,["functionCallingConfig"]);t!=null&&a(e,["functionCallingConfig"],jg(t));const i=r(n,["retrievalConfig"]);return i!=null&&a(e,["retrievalConfig"],ty(i)),e}function iy(n,e){const t={},i=r(n,["ttl"]);e!==void 0&&i!=null&&a(e,["ttl"],i);const o=r(n,["expireTime"]);e!==void 0&&o!=null&&a(e,["expireTime"],o);const s=r(n,["displayName"]);e!==void 0&&s!=null&&a(e,["displayName"],s);const l=r(n,["contents"]);if(e!==void 0&&l!=null){let h=be(l);Array.isArray(h)&&(h=h.map(m=>Su(m))),a(e,["contents"],h)}const u=r(n,["systemInstruction"]);e!==void 0&&u!=null&&a(e,["systemInstruction"],Su(Pe(u)));const f=r(n,["tools"]);if(e!==void 0&&f!=null){let h=f;Array.isArray(h)&&(h=h.map(m=>Zg(m))),a(e,["tools"],h)}const d=r(n,["toolConfig"]);if(e!==void 0&&d!=null&&a(e,["toolConfig"],ny(d)),r(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function oy(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["model"],md(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],iy(o,t)),t}function sy(n,e){const t={},i=r(e,["name"]);i!=null&&a(t,["_url","name"],lt(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],o),t}function ry(n,e){const t={},i=r(e,["name"]);i!=null&&a(t,["_url","name"],lt(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],o),t}function ay(n,e){const t={},i=r(n,["ttl"]);e!==void 0&&i!=null&&a(e,["ttl"],i);const o=r(n,["expireTime"]);return e!==void 0&&o!=null&&a(e,["expireTime"],o),t}function ly(n,e){const t={},i=r(e,["name"]);i!=null&&a(t,["_url","name"],lt(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],ay(o,t)),t}function uy(n,e){const t={},i=r(n,["pageSize"]);e!==void 0&&i!=null&&a(e,["_query","pageSize"],i);const o=r(n,["pageToken"]);return e!==void 0&&o!=null&&a(e,["_query","pageToken"],o),t}function cy(n){const e={},t=r(n,["config"]);return t!=null&&a(e,["config"],uy(t,e)),e}function dy(n){const e={},t=r(n,["fps"]);t!=null&&a(e,["fps"],t);const i=r(n,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=r(n,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function fy(n){const e={},t=r(n,["displayName"]);t!=null&&a(e,["displayName"],t);const i=r(n,["data"]);i!=null&&a(e,["data"],i);const o=r(n,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function hy(n){const e={},t=r(n,["displayName"]);t!=null&&a(e,["displayName"],t);const i=r(n,["fileUri"]);i!=null&&a(e,["fileUri"],i);const o=r(n,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function py(n){const e={},t=r(n,["id"]);t!=null&&a(e,["id"],t);const i=r(n,["args"]);i!=null&&a(e,["args"],i);const o=r(n,["name"]);return o!=null&&a(e,["name"],o),e}function my(n){const e={},t=r(n,["videoMetadata"]);t!=null&&a(e,["videoMetadata"],dy(t));const i=r(n,["thought"]);i!=null&&a(e,["thought"],i);const o=r(n,["inlineData"]);o!=null&&a(e,["inlineData"],fy(o));const s=r(n,["fileData"]);s!=null&&a(e,["fileData"],hy(s));const l=r(n,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=r(n,["functionCall"]);u!=null&&a(e,["functionCall"],py(u));const f=r(n,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const d=r(n,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=r(n,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const m=r(n,["text"]);return m!=null&&a(e,["text"],m),e}function Au(n){const e={},t=r(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>my(s))),a(e,["parts"],o)}const i=r(n,["role"]);return i!=null&&a(e,["role"],i),e}function gy(n){const e={};if(r(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=r(n,["description"]);t!=null&&a(e,["description"],t);const i=r(n,["name"]);i!=null&&a(e,["name"],i);const o=r(n,["parameters"]);o!=null&&a(e,["parameters"],o);const s=r(n,["parametersJsonSchema"]);s!=null&&a(e,["parametersJsonSchema"],s);const l=r(n,["response"]);l!=null&&a(e,["response"],l);const u=r(n,["responseJsonSchema"]);return u!=null&&a(e,["responseJsonSchema"],u),e}function yy(n){const e={},t=r(n,["startTime"]);t!=null&&a(e,["startTime"],t);const i=r(n,["endTime"]);return i!=null&&a(e,["endTime"],i),e}function _y(n){const e={},t=r(n,["timeRangeFilter"]);t!=null&&a(e,["timeRangeFilter"],yy(t));const i=r(n,["excludeDomains"]);return i!=null&&a(e,["excludeDomains"],i),e}function Ty(n){const e={},t=r(n,["mode"]);t!=null&&a(e,["mode"],t);const i=r(n,["dynamicThreshold"]);return i!=null&&a(e,["dynamicThreshold"],i),e}function Ey(n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&a(e,["dynamicRetrievalConfig"],Ty(t)),e}function vy(n){const e={},t=r(n,["excludeDomains"]);return t!=null&&a(e,["excludeDomains"],t),e}function Iy(n){const e={},t=r(n,["apiKeyString"]);return t!=null&&a(e,["apiKeyString"],t),e}function Cy(n){const e={},t=r(n,["apiKeyConfig"]);t!=null&&a(e,["apiKeyConfig"],Iy(t));const i=r(n,["authType"]);i!=null&&a(e,["authType"],i);const o=r(n,["googleServiceAccountConfig"]);o!=null&&a(e,["googleServiceAccountConfig"],o);const s=r(n,["httpBasicAuthConfig"]);s!=null&&a(e,["httpBasicAuthConfig"],s);const l=r(n,["oauthConfig"]);l!=null&&a(e,["oauthConfig"],l);const u=r(n,["oidcConfig"]);return u!=null&&a(e,["oidcConfig"],u),e}function Sy(n){const e={},t=r(n,["authConfig"]);return t!=null&&a(e,["authConfig"],Cy(t)),e}function Ay(){return{}}function wy(n){const e={},t=r(n,["environment"]);return t!=null&&a(e,["environment"],t),e}function Ry(n){const e={},t=r(n,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(g=>gy(g))),a(e,["functionDeclarations"],m)}const i=r(n,["retrieval"]);i!=null&&a(e,["retrieval"],i);const o=r(n,["googleSearch"]);o!=null&&a(e,["googleSearch"],_y(o));const s=r(n,["googleSearchRetrieval"]);s!=null&&a(e,["googleSearchRetrieval"],Ey(s));const l=r(n,["enterpriseWebSearch"]);l!=null&&a(e,["enterpriseWebSearch"],vy(l));const u=r(n,["googleMaps"]);u!=null&&a(e,["googleMaps"],Sy(u)),r(n,["urlContext"])!=null&&a(e,["urlContext"],Ay());const d=r(n,["computerUse"]);d!=null&&a(e,["computerUse"],wy(d));const h=r(n,["codeExecution"]);return h!=null&&a(e,["codeExecution"],h),e}function Py(n){const e={},t=r(n,["mode"]);t!=null&&a(e,["mode"],t);const i=r(n,["allowedFunctionNames"]);return i!=null&&a(e,["allowedFunctionNames"],i),e}function My(n){const e={},t=r(n,["latitude"]);t!=null&&a(e,["latitude"],t);const i=r(n,["longitude"]);return i!=null&&a(e,["longitude"],i),e}function Dy(n){const e={},t=r(n,["latLng"]);t!=null&&a(e,["latLng"],My(t));const i=r(n,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function Ny(n){const e={},t=r(n,["functionCallingConfig"]);t!=null&&a(e,["functionCallingConfig"],Py(t));const i=r(n,["retrievalConfig"]);return i!=null&&a(e,["retrievalConfig"],Dy(i)),e}function ky(n,e){const t={},i=r(n,["ttl"]);e!==void 0&&i!=null&&a(e,["ttl"],i);const o=r(n,["expireTime"]);e!==void 0&&o!=null&&a(e,["expireTime"],o);const s=r(n,["displayName"]);e!==void 0&&s!=null&&a(e,["displayName"],s);const l=r(n,["contents"]);if(e!==void 0&&l!=null){let m=be(l);Array.isArray(m)&&(m=m.map(g=>Au(g))),a(e,["contents"],m)}const u=r(n,["systemInstruction"]);e!==void 0&&u!=null&&a(e,["systemInstruction"],Au(Pe(u)));const f=r(n,["tools"]);if(e!==void 0&&f!=null){let m=f;Array.isArray(m)&&(m=m.map(g=>Ry(g))),a(e,["tools"],m)}const d=r(n,["toolConfig"]);e!==void 0&&d!=null&&a(e,["toolConfig"],Ny(d));const h=r(n,["kmsKeyName"]);return e!==void 0&&h!=null&&a(e,["encryption_spec","kmsKeyName"],h),t}function xy(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["model"],md(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],ky(o,t)),t}function Vy(n,e){const t={},i=r(e,["name"]);i!=null&&a(t,["_url","name"],lt(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],o),t}function Ly(n,e){const t={},i=r(e,["name"]);i!=null&&a(t,["_url","name"],lt(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],o),t}function by(n,e){const t={},i=r(n,["ttl"]);e!==void 0&&i!=null&&a(e,["ttl"],i);const o=r(n,["expireTime"]);return e!==void 0&&o!=null&&a(e,["expireTime"],o),t}function Uy(n,e){const t={},i=r(e,["name"]);i!=null&&a(t,["_url","name"],lt(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],by(o,t)),t}function Fy(n,e){const t={},i=r(n,["pageSize"]);e!==void 0&&i!=null&&a(e,["_query","pageSize"],i);const o=r(n,["pageToken"]);return e!==void 0&&o!=null&&a(e,["_query","pageToken"],o),t}function By(n){const e={},t=r(n,["config"]);return t!=null&&a(e,["config"],Fy(t,e)),e}function no(n){const e={},t=r(n,["name"]);t!=null&&a(e,["name"],t);const i=r(n,["displayName"]);i!=null&&a(e,["displayName"],i);const o=r(n,["model"]);o!=null&&a(e,["model"],o);const s=r(n,["createTime"]);s!=null&&a(e,["createTime"],s);const l=r(n,["updateTime"]);l!=null&&a(e,["updateTime"],l);const u=r(n,["expireTime"]);u!=null&&a(e,["expireTime"],u);const f=r(n,["usageMetadata"]);return f!=null&&a(e,["usageMetadata"],f),e}function Oy(n){const e={},t=r(n,["sdkHttpResponse"]);return t!=null&&a(e,["sdkHttpResponse"],t),e}function qy(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["nextPageToken"]);i!=null&&a(e,["nextPageToken"],i);const o=r(n,["cachedContents"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>no(l))),a(e,["cachedContents"],s)}return e}function io(n){const e={},t=r(n,["name"]);t!=null&&a(e,["name"],t);const i=r(n,["displayName"]);i!=null&&a(e,["displayName"],i);const o=r(n,["model"]);o!=null&&a(e,["model"],o);const s=r(n,["createTime"]);s!=null&&a(e,["createTime"],s);const l=r(n,["updateTime"]);l!=null&&a(e,["updateTime"],l);const u=r(n,["expireTime"]);u!=null&&a(e,["expireTime"],u);const f=r(n,["usageMetadata"]);return f!=null&&a(e,["usageMetadata"],f),e}function Gy(n){const e={},t=r(n,["sdkHttpResponse"]);return t!=null&&a(e,["sdkHttpResponse"],t),e}function $y(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["nextPageToken"]);i!=null&&a(e,["nextPageToken"],i);const o=r(n,["cachedContents"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>io(l))),a(e,["cachedContents"],s)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Hy extends Kt{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ii(Gt.PAGED_ITEM_CACHED_CONTENTS,i=>this.listInternal(i),await this.listInternal(t),t)}async create(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=xy(this.apiClient,e);return u=O("cachedContents",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),l.then(h=>io(h))}else{const d=oy(this.apiClient,e);return u=O("cachedContents",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),l.then(h=>no(h))}}async get(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=Vy(this.apiClient,e);return u=O("{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),l.then(h=>io(h))}else{const d=sy(this.apiClient,e);return u=O("{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),l.then(h=>no(h))}}async delete(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=Ly(this.apiClient,e);return u=O("{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=Gy(h),g=new _u;return Object.assign(g,m),g})}else{const d=ry(this.apiClient,e);return u=O("{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=Oy(h),g=new _u;return Object.assign(g,m),g})}}async update(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=Uy(this.apiClient,e);return u=O("{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),l.then(h=>io(h))}else{const d=ly(this.apiClient,e);return u=O("{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),l.then(h=>no(h))}}async listInternal(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=By(e);return u=O("cachedContents",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=$y(h),g=new Tu;return Object.assign(g,m),g})}else{const d=cy(e);return u=O("cachedContents",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=qy(h),g=new Tu;return Object.assign(g,m),g})}}}function wu(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function se(n){return this instanceof se?(this.v=n,this):new se(n)}function dn(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),o,s=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",l),o[Symbol.asyncIterator]=function(){return this},o;function l(T){return function(w){return Promise.resolve(w).then(T,m)}}function u(T,w){i[T]&&(o[T]=function(M){return new Promise(function(N,L){s.push([T,M,N,L])>1||f(T,M)})},w&&(o[T]=w(o[T])))}function f(T,w){try{d(i[T](w))}catch(M){g(s[0][3],M)}}function d(T){T.value instanceof se?Promise.resolve(T.value.v).then(h,m):g(s[0][2],T)}function h(T){f("next",T)}function m(T){f("throw",T)}function g(T,w){T(w),s.shift(),s.length&&f(s[0][0],s[0][1])}}function oi(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof wu=="function"?wu(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(l){return new Promise(function(u,f){l=n[s](l),o(u,f,l.done,l.value)})}}function o(s,l,u,f){Promise.resolve(f).then(function(d){s({value:d,done:u})},l)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zy(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:Dd(t)}function Dd(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function Jy(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Ru(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let i=0;for(;i<t;)if(n[i].role==="user")e.push(n[i]),i++;else{const o=[];let s=!0;for(;i<t&&n[i].role==="model";)o.push(n[i]),s&&!Dd(n[i])&&(s=!1),i++;s?e.push(...o):e.pop()}return e}class Wy{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Ky(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class Ky{constructor(e,t,i,o={},s=[]){this.apiClient=e,this.modelsModule=t,this.model=i,this.config=o,this.history=s,this.sendPromise=Promise.resolve(),Jy(s)}async sendMessage(e){var t;await this.sendPromise;const i=Pe(e.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var s,l,u;const f=await o,d=(l=(s=f.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content,h=f.automaticFunctionCallingHistory,m=this.getHistory(!0).length;let g=[];h!=null&&(g=(u=h.slice(m))!==null&&u!==void 0?u:[]);const T=d?[d]:[];this.recordHistory(i,T,g)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),o}async sendMessageStream(e){var t;await this.sendPromise;const i=Pe(e.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=o.then(()=>{}).catch(()=>{});const s=await o;return this.processStreamResponse(s,i)}getHistory(e=!1){const t=e?Ru(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var i,o;return dn(this,arguments,function*(){var l,u,f,d;const h=[];try{for(var m=!0,g=oi(e),T;T=yield se(g.next()),l=T.done,!l;m=!0){d=T.value,m=!1;const w=d;if(zy(w)){const M=(o=(i=w.candidates)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.content;M!==void 0&&h.push(M)}yield yield se(w)}}catch(w){u={error:w}}finally{try{!m&&!l&&(f=g.return)&&(yield se(f.call(g)))}finally{if(u)throw u.error}}this.recordHistory(t,h)})}recordHistory(e,t,i){let o=[];t.length>0&&t.every(s=>s.role!==void 0)?o=t:o.push({role:"model",parts:[]}),i&&i.length>0?this.history.push(...Ru(i)):this.history.push(e),this.history.push(...o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Fo extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Fo.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Yy(n,e){const t={},i=r(n,["pageSize"]);e!==void 0&&i!=null&&a(e,["_query","pageSize"],i);const o=r(n,["pageToken"]);return e!==void 0&&o!=null&&a(e,["_query","pageToken"],o),t}function Qy(n){const e={},t=r(n,["config"]);return t!=null&&a(e,["config"],Yy(t,e)),e}function Xy(n){const e={},t=r(n,["details"]);t!=null&&a(e,["details"],t);const i=r(n,["message"]);i!=null&&a(e,["message"],i);const o=r(n,["code"]);return o!=null&&a(e,["code"],o),e}function Zy(n){const e={},t=r(n,["name"]);t!=null&&a(e,["name"],t);const i=r(n,["displayName"]);i!=null&&a(e,["displayName"],i);const o=r(n,["mimeType"]);o!=null&&a(e,["mimeType"],o);const s=r(n,["sizeBytes"]);s!=null&&a(e,["sizeBytes"],s);const l=r(n,["createTime"]);l!=null&&a(e,["createTime"],l);const u=r(n,["expirationTime"]);u!=null&&a(e,["expirationTime"],u);const f=r(n,["updateTime"]);f!=null&&a(e,["updateTime"],f);const d=r(n,["sha256Hash"]);d!=null&&a(e,["sha256Hash"],d);const h=r(n,["uri"]);h!=null&&a(e,["uri"],h);const m=r(n,["downloadUri"]);m!=null&&a(e,["downloadUri"],m);const g=r(n,["state"]);g!=null&&a(e,["state"],g);const T=r(n,["source"]);T!=null&&a(e,["source"],T);const w=r(n,["videoMetadata"]);w!=null&&a(e,["videoMetadata"],w);const M=r(n,["error"]);return M!=null&&a(e,["error"],Xy(M)),e}function jy(n){const e={},t=r(n,["file"]);t!=null&&a(e,["file"],Zy(t));const i=r(n,["config"]);return i!=null&&a(e,["config"],i),e}function e_(n){const e={},t=r(n,["name"]);t!=null&&a(e,["_url","file"],vd(t));const i=r(n,["config"]);return i!=null&&a(e,["config"],i),e}function t_(n){const e={},t=r(n,["name"]);t!=null&&a(e,["_url","file"],vd(t));const i=r(n,["config"]);return i!=null&&a(e,["config"],i),e}function n_(n){const e={},t=r(n,["details"]);t!=null&&a(e,["details"],t);const i=r(n,["message"]);i!=null&&a(e,["message"],i);const o=r(n,["code"]);return o!=null&&a(e,["code"],o),e}function Ks(n){const e={},t=r(n,["name"]);t!=null&&a(e,["name"],t);const i=r(n,["displayName"]);i!=null&&a(e,["displayName"],i);const o=r(n,["mimeType"]);o!=null&&a(e,["mimeType"],o);const s=r(n,["sizeBytes"]);s!=null&&a(e,["sizeBytes"],s);const l=r(n,["createTime"]);l!=null&&a(e,["createTime"],l);const u=r(n,["expirationTime"]);u!=null&&a(e,["expirationTime"],u);const f=r(n,["updateTime"]);f!=null&&a(e,["updateTime"],f);const d=r(n,["sha256Hash"]);d!=null&&a(e,["sha256Hash"],d);const h=r(n,["uri"]);h!=null&&a(e,["uri"],h);const m=r(n,["downloadUri"]);m!=null&&a(e,["downloadUri"],m);const g=r(n,["state"]);g!=null&&a(e,["state"],g);const T=r(n,["source"]);T!=null&&a(e,["source"],T);const w=r(n,["videoMetadata"]);w!=null&&a(e,["videoMetadata"],w);const M=r(n,["error"]);return M!=null&&a(e,["error"],n_(M)),e}function i_(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["nextPageToken"]);i!=null&&a(e,["nextPageToken"],i);const o=r(n,["files"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>Ks(l))),a(e,["files"],s)}return e}function o_(n){const e={},t=r(n,["sdkHttpResponse"]);return t!=null&&a(e,["sdkHttpResponse"],t),e}function s_(n){const e={},t=r(n,["sdkHttpResponse"]);return t!=null&&a(e,["sdkHttpResponse"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class r_ extends Kt{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ii(Gt.PAGED_ITEM_FILES,i=>this.listInternal(i),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>Ks(t))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,i;let o,s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Qy(e);return s=O("files",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const d=i_(f),h=new dm;return Object.assign(h,d),h})}}async createInternal(e){var t,i;let o,s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=jy(e);return s=O("upload/v1beta/files",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>{const d=o_(f),h=new fm;return Object.assign(h,d),h})}}async get(e){var t,i;let o,s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=e_(e);return s=O("files/{file}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>Ks(f))}}async delete(e){var t,i;let o,s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=t_(e);return s=O("files/{file}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const d=s_(f),h=new hm;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function a_(n){const e={},t=r(n,["voiceName"]);return t!=null&&a(e,["voiceName"],t),e}function Nd(n){const e={},t=r(n,["prebuiltVoiceConfig"]);return t!=null&&a(e,["prebuiltVoiceConfig"],a_(t)),e}function l_(n){const e={},t=r(n,["speaker"]);t!=null&&a(e,["speaker"],t);const i=r(n,["voiceConfig"]);return i!=null&&a(e,["voiceConfig"],Nd(i)),e}function u_(n){const e={},t=r(n,["speakerVoiceConfigs"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>l_(o))),a(e,["speakerVoiceConfigs"],i)}return e}function c_(n){const e={},t=r(n,["voiceConfig"]);t!=null&&a(e,["voiceConfig"],Nd(t));const i=r(n,["multiSpeakerVoiceConfig"]);i!=null&&a(e,["multiSpeakerVoiceConfig"],u_(i));const o=r(n,["languageCode"]);return o!=null&&a(e,["languageCode"],o),e}function d_(n){const e={},t=r(n,["fps"]);t!=null&&a(e,["fps"],t);const i=r(n,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=r(n,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function f_(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["data"]);t!=null&&a(e,["data"],t);const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function h_(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["fileUri"]);t!=null&&a(e,["fileUri"],t);const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function p_(n){const e={},t=r(n,["id"]);t!=null&&a(e,["id"],t);const i=r(n,["args"]);i!=null&&a(e,["args"],i);const o=r(n,["name"]);return o!=null&&a(e,["name"],o),e}function m_(n){const e={},t=r(n,["videoMetadata"]);t!=null&&a(e,["videoMetadata"],d_(t));const i=r(n,["thought"]);i!=null&&a(e,["thought"],i);const o=r(n,["inlineData"]);o!=null&&a(e,["inlineData"],f_(o));const s=r(n,["fileData"]);s!=null&&a(e,["fileData"],h_(s));const l=r(n,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=r(n,["functionCall"]);u!=null&&a(e,["functionCall"],p_(u));const f=r(n,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const d=r(n,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=r(n,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const m=r(n,["text"]);return m!=null&&a(e,["text"],m),e}function g_(n){const e={},t=r(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>m_(s))),a(e,["parts"],o)}const i=r(n,["role"]);return i!=null&&a(e,["role"],i),e}function y_(n){const e={},t=r(n,["behavior"]);t!=null&&a(e,["behavior"],t);const i=r(n,["description"]);i!=null&&a(e,["description"],i);const o=r(n,["name"]);o!=null&&a(e,["name"],o);const s=r(n,["parameters"]);s!=null&&a(e,["parameters"],s);const l=r(n,["parametersJsonSchema"]);l!=null&&a(e,["parametersJsonSchema"],l);const u=r(n,["response"]);u!=null&&a(e,["response"],u);const f=r(n,["responseJsonSchema"]);return f!=null&&a(e,["responseJsonSchema"],f),e}function __(n){const e={},t=r(n,["startTime"]);t!=null&&a(e,["startTime"],t);const i=r(n,["endTime"]);return i!=null&&a(e,["endTime"],i),e}function T_(n){const e={},t=r(n,["timeRangeFilter"]);if(t!=null&&a(e,["timeRangeFilter"],__(t)),r(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function E_(n){const e={},t=r(n,["mode"]);t!=null&&a(e,["mode"],t);const i=r(n,["dynamicThreshold"]);return i!=null&&a(e,["dynamicThreshold"],i),e}function v_(n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&a(e,["dynamicRetrievalConfig"],E_(t)),e}function I_(){return{}}function C_(n){const e={},t=r(n,["environment"]);return t!=null&&a(e,["environment"],t),e}function S_(n){const e={},t=r(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(d=>y_(d))),a(e,["functionDeclarations"],f)}if(r(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=r(n,["googleSearch"]);i!=null&&a(e,["googleSearch"],T_(i));const o=r(n,["googleSearchRetrieval"]);if(o!=null&&a(e,["googleSearchRetrieval"],v_(o)),r(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");r(n,["urlContext"])!=null&&a(e,["urlContext"],I_());const l=r(n,["computerUse"]);l!=null&&a(e,["computerUse"],C_(l));const u=r(n,["codeExecution"]);return u!=null&&a(e,["codeExecution"],u),e}function A_(n){const e={},t=r(n,["handle"]);if(t!=null&&a(e,["handle"],t),r(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Pu(){return{}}function w_(n){const e={},t=r(n,["disabled"]);t!=null&&a(e,["disabled"],t);const i=r(n,["startOfSpeechSensitivity"]);i!=null&&a(e,["startOfSpeechSensitivity"],i);const o=r(n,["endOfSpeechSensitivity"]);o!=null&&a(e,["endOfSpeechSensitivity"],o);const s=r(n,["prefixPaddingMs"]);s!=null&&a(e,["prefixPaddingMs"],s);const l=r(n,["silenceDurationMs"]);return l!=null&&a(e,["silenceDurationMs"],l),e}function R_(n){const e={},t=r(n,["automaticActivityDetection"]);t!=null&&a(e,["automaticActivityDetection"],w_(t));const i=r(n,["activityHandling"]);i!=null&&a(e,["activityHandling"],i);const o=r(n,["turnCoverage"]);return o!=null&&a(e,["turnCoverage"],o),e}function P_(n){const e={},t=r(n,["targetTokens"]);return t!=null&&a(e,["targetTokens"],t),e}function M_(n){const e={},t=r(n,["triggerTokens"]);t!=null&&a(e,["triggerTokens"],t);const i=r(n,["slidingWindow"]);return i!=null&&a(e,["slidingWindow"],P_(i)),e}function D_(n){const e={},t=r(n,["proactiveAudio"]);return t!=null&&a(e,["proactiveAudio"],t),e}function N_(n,e){const t={},i=r(n,["generationConfig"]);e!==void 0&&i!=null&&a(e,["setup","generationConfig"],i);const o=r(n,["responseModalities"]);e!==void 0&&o!=null&&a(e,["setup","generationConfig","responseModalities"],o);const s=r(n,["temperature"]);e!==void 0&&s!=null&&a(e,["setup","generationConfig","temperature"],s);const l=r(n,["topP"]);e!==void 0&&l!=null&&a(e,["setup","generationConfig","topP"],l);const u=r(n,["topK"]);e!==void 0&&u!=null&&a(e,["setup","generationConfig","topK"],u);const f=r(n,["maxOutputTokens"]);e!==void 0&&f!=null&&a(e,["setup","generationConfig","maxOutputTokens"],f);const d=r(n,["mediaResolution"]);e!==void 0&&d!=null&&a(e,["setup","generationConfig","mediaResolution"],d);const h=r(n,["seed"]);e!==void 0&&h!=null&&a(e,["setup","generationConfig","seed"],h);const m=r(n,["speechConfig"]);e!==void 0&&m!=null&&a(e,["setup","generationConfig","speechConfig"],c_(Pr(m)));const g=r(n,["enableAffectiveDialog"]);e!==void 0&&g!=null&&a(e,["setup","generationConfig","enableAffectiveDialog"],g);const T=r(n,["systemInstruction"]);e!==void 0&&T!=null&&a(e,["setup","systemInstruction"],g_(Pe(T)));const w=r(n,["tools"]);if(e!==void 0&&w!=null){let q=wn(w);Array.isArray(q)&&(q=q.map(H=>S_(An(H)))),a(e,["setup","tools"],q)}const M=r(n,["sessionResumption"]);e!==void 0&&M!=null&&a(e,["setup","sessionResumption"],A_(M));const N=r(n,["inputAudioTranscription"]);e!==void 0&&N!=null&&a(e,["setup","inputAudioTranscription"],Pu());const L=r(n,["outputAudioTranscription"]);e!==void 0&&L!=null&&a(e,["setup","outputAudioTranscription"],Pu());const V=r(n,["realtimeInputConfig"]);e!==void 0&&V!=null&&a(e,["setup","realtimeInputConfig"],R_(V));const b=r(n,["contextWindowCompression"]);e!==void 0&&b!=null&&a(e,["setup","contextWindowCompression"],M_(b));const B=r(n,["proactivity"]);return e!==void 0&&B!=null&&a(e,["setup","proactivity"],D_(B)),t}function k_(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["setup","model"],te(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],N_(o,t)),t}function x_(){return{}}function V_(){return{}}function L_(n){const e={},t=r(n,["media"]);t!=null&&a(e,["mediaChunks"],gd(t));const i=r(n,["audio"]);i!=null&&a(e,["audio"],_d(i));const o=r(n,["audioStreamEnd"]);o!=null&&a(e,["audioStreamEnd"],o);const s=r(n,["video"]);s!=null&&a(e,["video"],yd(s));const l=r(n,["text"]);return l!=null&&a(e,["text"],l),r(n,["activityStart"])!=null&&a(e,["activityStart"],x_()),r(n,["activityEnd"])!=null&&a(e,["activityEnd"],V_()),e}function kd(n){const e={},t=r(n,["text"]);t!=null&&a(e,["text"],t);const i=r(n,["weight"]);return i!=null&&a(e,["weight"],i),e}function b_(n){const e={},t=r(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>kd(o))),a(e,["weightedPrompts"],i)}return e}function xd(n){const e={},t=r(n,["temperature"]);t!=null&&a(e,["temperature"],t);const i=r(n,["topK"]);i!=null&&a(e,["topK"],i);const o=r(n,["seed"]);o!=null&&a(e,["seed"],o);const s=r(n,["guidance"]);s!=null&&a(e,["guidance"],s);const l=r(n,["bpm"]);l!=null&&a(e,["bpm"],l);const u=r(n,["density"]);u!=null&&a(e,["density"],u);const f=r(n,["brightness"]);f!=null&&a(e,["brightness"],f);const d=r(n,["scale"]);d!=null&&a(e,["scale"],d);const h=r(n,["muteBass"]);h!=null&&a(e,["muteBass"],h);const m=r(n,["muteDrums"]);m!=null&&a(e,["muteDrums"],m);const g=r(n,["onlyBassAndDrums"]);g!=null&&a(e,["onlyBassAndDrums"],g);const T=r(n,["musicGenerationMode"]);return T!=null&&a(e,["musicGenerationMode"],T),e}function U_(n){const e={},t=r(n,["musicGenerationConfig"]);return t!=null&&a(e,["musicGenerationConfig"],xd(t)),e}function Vd(n){const e={},t=r(n,["model"]);return t!=null&&a(e,["model"],t),e}function Ld(n){const e={},t=r(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>kd(o))),a(e,["weightedPrompts"],i)}return e}function Ys(n){const e={},t=r(n,["setup"]);t!=null&&a(e,["setup"],Vd(t));const i=r(n,["clientContent"]);i!=null&&a(e,["clientContent"],Ld(i));const o=r(n,["musicGenerationConfig"]);o!=null&&a(e,["musicGenerationConfig"],xd(o));const s=r(n,["playbackControl"]);return s!=null&&a(e,["playbackControl"],s),e}function F_(n){const e={},t=r(n,["voiceName"]);return t!=null&&a(e,["voiceName"],t),e}function B_(n){const e={},t=r(n,["prebuiltVoiceConfig"]);return t!=null&&a(e,["prebuiltVoiceConfig"],F_(t)),e}function O_(n){const e={},t=r(n,["voiceConfig"]);if(t!=null&&a(e,["voiceConfig"],B_(t)),r(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const i=r(n,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function q_(n){const e={},t=r(n,["fps"]);t!=null&&a(e,["fps"],t);const i=r(n,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=r(n,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function G_(n){const e={},t=r(n,["displayName"]);t!=null&&a(e,["displayName"],t);const i=r(n,["data"]);i!=null&&a(e,["data"],i);const o=r(n,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function $_(n){const e={},t=r(n,["displayName"]);t!=null&&a(e,["displayName"],t);const i=r(n,["fileUri"]);i!=null&&a(e,["fileUri"],i);const o=r(n,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function H_(n){const e={},t=r(n,["id"]);t!=null&&a(e,["id"],t);const i=r(n,["args"]);i!=null&&a(e,["args"],i);const o=r(n,["name"]);return o!=null&&a(e,["name"],o),e}function z_(n){const e={},t=r(n,["videoMetadata"]);t!=null&&a(e,["videoMetadata"],q_(t));const i=r(n,["thought"]);i!=null&&a(e,["thought"],i);const o=r(n,["inlineData"]);o!=null&&a(e,["inlineData"],G_(o));const s=r(n,["fileData"]);s!=null&&a(e,["fileData"],$_(s));const l=r(n,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=r(n,["functionCall"]);u!=null&&a(e,["functionCall"],H_(u));const f=r(n,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const d=r(n,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=r(n,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const m=r(n,["text"]);return m!=null&&a(e,["text"],m),e}function J_(n){const e={},t=r(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>z_(s))),a(e,["parts"],o)}const i=r(n,["role"]);return i!=null&&a(e,["role"],i),e}function W_(n){const e={};if(r(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=r(n,["description"]);t!=null&&a(e,["description"],t);const i=r(n,["name"]);i!=null&&a(e,["name"],i);const o=r(n,["parameters"]);o!=null&&a(e,["parameters"],o);const s=r(n,["parametersJsonSchema"]);s!=null&&a(e,["parametersJsonSchema"],s);const l=r(n,["response"]);l!=null&&a(e,["response"],l);const u=r(n,["responseJsonSchema"]);return u!=null&&a(e,["responseJsonSchema"],u),e}function K_(n){const e={},t=r(n,["startTime"]);t!=null&&a(e,["startTime"],t);const i=r(n,["endTime"]);return i!=null&&a(e,["endTime"],i),e}function Y_(n){const e={},t=r(n,["timeRangeFilter"]);t!=null&&a(e,["timeRangeFilter"],K_(t));const i=r(n,["excludeDomains"]);return i!=null&&a(e,["excludeDomains"],i),e}function Q_(n){const e={},t=r(n,["mode"]);t!=null&&a(e,["mode"],t);const i=r(n,["dynamicThreshold"]);return i!=null&&a(e,["dynamicThreshold"],i),e}function X_(n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&a(e,["dynamicRetrievalConfig"],Q_(t)),e}function Z_(n){const e={},t=r(n,["excludeDomains"]);return t!=null&&a(e,["excludeDomains"],t),e}function j_(n){const e={},t=r(n,["apiKeyString"]);return t!=null&&a(e,["apiKeyString"],t),e}function eT(n){const e={},t=r(n,["apiKeyConfig"]);t!=null&&a(e,["apiKeyConfig"],j_(t));const i=r(n,["authType"]);i!=null&&a(e,["authType"],i);const o=r(n,["googleServiceAccountConfig"]);o!=null&&a(e,["googleServiceAccountConfig"],o);const s=r(n,["httpBasicAuthConfig"]);s!=null&&a(e,["httpBasicAuthConfig"],s);const l=r(n,["oauthConfig"]);l!=null&&a(e,["oauthConfig"],l);const u=r(n,["oidcConfig"]);return u!=null&&a(e,["oidcConfig"],u),e}function tT(n){const e={},t=r(n,["authConfig"]);return t!=null&&a(e,["authConfig"],eT(t)),e}function nT(){return{}}function iT(n){const e={},t=r(n,["environment"]);return t!=null&&a(e,["environment"],t),e}function oT(n){const e={},t=r(n,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(g=>W_(g))),a(e,["functionDeclarations"],m)}const i=r(n,["retrieval"]);i!=null&&a(e,["retrieval"],i);const o=r(n,["googleSearch"]);o!=null&&a(e,["googleSearch"],Y_(o));const s=r(n,["googleSearchRetrieval"]);s!=null&&a(e,["googleSearchRetrieval"],X_(s));const l=r(n,["enterpriseWebSearch"]);l!=null&&a(e,["enterpriseWebSearch"],Z_(l));const u=r(n,["googleMaps"]);u!=null&&a(e,["googleMaps"],tT(u)),r(n,["urlContext"])!=null&&a(e,["urlContext"],nT());const d=r(n,["computerUse"]);d!=null&&a(e,["computerUse"],iT(d));const h=r(n,["codeExecution"]);return h!=null&&a(e,["codeExecution"],h),e}function sT(n){const e={},t=r(n,["handle"]);t!=null&&a(e,["handle"],t);const i=r(n,["transparent"]);return i!=null&&a(e,["transparent"],i),e}function Mu(){return{}}function rT(n){const e={},t=r(n,["disabled"]);t!=null&&a(e,["disabled"],t);const i=r(n,["startOfSpeechSensitivity"]);i!=null&&a(e,["startOfSpeechSensitivity"],i);const o=r(n,["endOfSpeechSensitivity"]);o!=null&&a(e,["endOfSpeechSensitivity"],o);const s=r(n,["prefixPaddingMs"]);s!=null&&a(e,["prefixPaddingMs"],s);const l=r(n,["silenceDurationMs"]);return l!=null&&a(e,["silenceDurationMs"],l),e}function aT(n){const e={},t=r(n,["automaticActivityDetection"]);t!=null&&a(e,["automaticActivityDetection"],rT(t));const i=r(n,["activityHandling"]);i!=null&&a(e,["activityHandling"],i);const o=r(n,["turnCoverage"]);return o!=null&&a(e,["turnCoverage"],o),e}function lT(n){const e={},t=r(n,["targetTokens"]);return t!=null&&a(e,["targetTokens"],t),e}function uT(n){const e={},t=r(n,["triggerTokens"]);t!=null&&a(e,["triggerTokens"],t);const i=r(n,["slidingWindow"]);return i!=null&&a(e,["slidingWindow"],lT(i)),e}function cT(n){const e={},t=r(n,["proactiveAudio"]);return t!=null&&a(e,["proactiveAudio"],t),e}function dT(n,e){const t={},i=r(n,["generationConfig"]);e!==void 0&&i!=null&&a(e,["setup","generationConfig"],i);const o=r(n,["responseModalities"]);e!==void 0&&o!=null&&a(e,["setup","generationConfig","responseModalities"],o);const s=r(n,["temperature"]);e!==void 0&&s!=null&&a(e,["setup","generationConfig","temperature"],s);const l=r(n,["topP"]);e!==void 0&&l!=null&&a(e,["setup","generationConfig","topP"],l);const u=r(n,["topK"]);e!==void 0&&u!=null&&a(e,["setup","generationConfig","topK"],u);const f=r(n,["maxOutputTokens"]);e!==void 0&&f!=null&&a(e,["setup","generationConfig","maxOutputTokens"],f);const d=r(n,["mediaResolution"]);e!==void 0&&d!=null&&a(e,["setup","generationConfig","mediaResolution"],d);const h=r(n,["seed"]);e!==void 0&&h!=null&&a(e,["setup","generationConfig","seed"],h);const m=r(n,["speechConfig"]);e!==void 0&&m!=null&&a(e,["setup","generationConfig","speechConfig"],O_(Pr(m)));const g=r(n,["enableAffectiveDialog"]);e!==void 0&&g!=null&&a(e,["setup","generationConfig","enableAffectiveDialog"],g);const T=r(n,["systemInstruction"]);e!==void 0&&T!=null&&a(e,["setup","systemInstruction"],J_(Pe(T)));const w=r(n,["tools"]);if(e!==void 0&&w!=null){let q=wn(w);Array.isArray(q)&&(q=q.map(H=>oT(An(H)))),a(e,["setup","tools"],q)}const M=r(n,["sessionResumption"]);e!==void 0&&M!=null&&a(e,["setup","sessionResumption"],sT(M));const N=r(n,["inputAudioTranscription"]);e!==void 0&&N!=null&&a(e,["setup","inputAudioTranscription"],Mu());const L=r(n,["outputAudioTranscription"]);e!==void 0&&L!=null&&a(e,["setup","outputAudioTranscription"],Mu());const V=r(n,["realtimeInputConfig"]);e!==void 0&&V!=null&&a(e,["setup","realtimeInputConfig"],aT(V));const b=r(n,["contextWindowCompression"]);e!==void 0&&b!=null&&a(e,["setup","contextWindowCompression"],uT(b));const B=r(n,["proactivity"]);return e!==void 0&&B!=null&&a(e,["setup","proactivity"],cT(B)),t}function fT(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["setup","model"],te(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],dT(o,t)),t}function hT(){return{}}function pT(){return{}}function mT(n){const e={},t=r(n,["media"]);t!=null&&a(e,["mediaChunks"],gd(t));const i=r(n,["audio"]);i!=null&&a(e,["audio"],_d(i));const o=r(n,["audioStreamEnd"]);o!=null&&a(e,["audioStreamEnd"],o);const s=r(n,["video"]);s!=null&&a(e,["video"],yd(s));const l=r(n,["text"]);return l!=null&&a(e,["text"],l),r(n,["activityStart"])!=null&&a(e,["activityStart"],hT()),r(n,["activityEnd"])!=null&&a(e,["activityEnd"],pT()),e}function gT(){return{}}function yT(n){const e={},t=r(n,["fps"]);t!=null&&a(e,["fps"],t);const i=r(n,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=r(n,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function _T(n){const e={},t=r(n,["data"]);t!=null&&a(e,["data"],t);const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function TT(n){const e={},t=r(n,["fileUri"]);t!=null&&a(e,["fileUri"],t);const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function bd(n){const e={},t=r(n,["id"]);t!=null&&a(e,["id"],t);const i=r(n,["args"]);i!=null&&a(e,["args"],i);const o=r(n,["name"]);return o!=null&&a(e,["name"],o),e}function ET(n){const e={},t=r(n,["videoMetadata"]);t!=null&&a(e,["videoMetadata"],yT(t));const i=r(n,["thought"]);i!=null&&a(e,["thought"],i);const o=r(n,["inlineData"]);o!=null&&a(e,["inlineData"],_T(o));const s=r(n,["fileData"]);s!=null&&a(e,["fileData"],TT(s));const l=r(n,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=r(n,["functionCall"]);u!=null&&a(e,["functionCall"],bd(u));const f=r(n,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const d=r(n,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=r(n,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const m=r(n,["text"]);return m!=null&&a(e,["text"],m),e}function vT(n){const e={},t=r(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>ET(s))),a(e,["parts"],o)}const i=r(n,["role"]);return i!=null&&a(e,["role"],i),e}function Du(n){const e={},t=r(n,["text"]);t!=null&&a(e,["text"],t);const i=r(n,["finished"]);return i!=null&&a(e,["finished"],i),e}function IT(n){const e={},t=r(n,["retrievedUrl"]);t!=null&&a(e,["retrievedUrl"],t);const i=r(n,["urlRetrievalStatus"]);return i!=null&&a(e,["urlRetrievalStatus"],i),e}function CT(n){const e={},t=r(n,["urlMetadata"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>IT(o))),a(e,["urlMetadata"],i)}return e}function ST(n){const e={},t=r(n,["modelTurn"]);t!=null&&a(e,["modelTurn"],vT(t));const i=r(n,["turnComplete"]);i!=null&&a(e,["turnComplete"],i);const o=r(n,["interrupted"]);o!=null&&a(e,["interrupted"],o);const s=r(n,["groundingMetadata"]);s!=null&&a(e,["groundingMetadata"],s);const l=r(n,["generationComplete"]);l!=null&&a(e,["generationComplete"],l);const u=r(n,["inputTranscription"]);u!=null&&a(e,["inputTranscription"],Du(u));const f=r(n,["outputTranscription"]);f!=null&&a(e,["outputTranscription"],Du(f));const d=r(n,["urlContextMetadata"]);d!=null&&a(e,["urlContextMetadata"],CT(d));const h=r(n,["turnCompleteReason"]);h!=null&&a(e,["turnCompleteReason"],h);const m=r(n,["waitingForInput"]);return m!=null&&a(e,["waitingForInput"],m),e}function AT(n){const e={},t=r(n,["functionCalls"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>bd(o))),a(e,["functionCalls"],i)}return e}function wT(n){const e={},t=r(n,["ids"]);return t!=null&&a(e,["ids"],t),e}function Ki(n){const e={},t=r(n,["modality"]);t!=null&&a(e,["modality"],t);const i=r(n,["tokenCount"]);return i!=null&&a(e,["tokenCount"],i),e}function RT(n){const e={},t=r(n,["promptTokenCount"]);t!=null&&a(e,["promptTokenCount"],t);const i=r(n,["cachedContentTokenCount"]);i!=null&&a(e,["cachedContentTokenCount"],i);const o=r(n,["responseTokenCount"]);o!=null&&a(e,["responseTokenCount"],o);const s=r(n,["toolUsePromptTokenCount"]);s!=null&&a(e,["toolUsePromptTokenCount"],s);const l=r(n,["thoughtsTokenCount"]);l!=null&&a(e,["thoughtsTokenCount"],l);const u=r(n,["totalTokenCount"]);u!=null&&a(e,["totalTokenCount"],u);const f=r(n,["promptTokensDetails"]);if(f!=null){let g=f;Array.isArray(g)&&(g=g.map(T=>Ki(T))),a(e,["promptTokensDetails"],g)}const d=r(n,["cacheTokensDetails"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(T=>Ki(T))),a(e,["cacheTokensDetails"],g)}const h=r(n,["responseTokensDetails"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(T=>Ki(T))),a(e,["responseTokensDetails"],g)}const m=r(n,["toolUsePromptTokensDetails"]);if(m!=null){let g=m;Array.isArray(g)&&(g=g.map(T=>Ki(T))),a(e,["toolUsePromptTokensDetails"],g)}return e}function PT(n){const e={},t=r(n,["timeLeft"]);return t!=null&&a(e,["timeLeft"],t),e}function MT(n){const e={},t=r(n,["newHandle"]);t!=null&&a(e,["newHandle"],t);const i=r(n,["resumable"]);i!=null&&a(e,["resumable"],i);const o=r(n,["lastConsumedClientMessageIndex"]);return o!=null&&a(e,["lastConsumedClientMessageIndex"],o),e}function DT(n){const e={};r(n,["setupComplete"])!=null&&a(e,["setupComplete"],gT());const i=r(n,["serverContent"]);i!=null&&a(e,["serverContent"],ST(i));const o=r(n,["toolCall"]);o!=null&&a(e,["toolCall"],AT(o));const s=r(n,["toolCallCancellation"]);s!=null&&a(e,["toolCallCancellation"],wT(s));const l=r(n,["usageMetadata"]);l!=null&&a(e,["usageMetadata"],RT(l));const u=r(n,["goAway"]);u!=null&&a(e,["goAway"],PT(u));const f=r(n,["sessionResumptionUpdate"]);return f!=null&&a(e,["sessionResumptionUpdate"],MT(f)),e}function NT(){return{}}function kT(n){const e={},t=r(n,["text"]);t!=null&&a(e,["text"],t);const i=r(n,["weight"]);return i!=null&&a(e,["weight"],i),e}function xT(n){const e={},t=r(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>kT(o))),a(e,["weightedPrompts"],i)}return e}function VT(n){const e={},t=r(n,["temperature"]);t!=null&&a(e,["temperature"],t);const i=r(n,["topK"]);i!=null&&a(e,["topK"],i);const o=r(n,["seed"]);o!=null&&a(e,["seed"],o);const s=r(n,["guidance"]);s!=null&&a(e,["guidance"],s);const l=r(n,["bpm"]);l!=null&&a(e,["bpm"],l);const u=r(n,["density"]);u!=null&&a(e,["density"],u);const f=r(n,["brightness"]);f!=null&&a(e,["brightness"],f);const d=r(n,["scale"]);d!=null&&a(e,["scale"],d);const h=r(n,["muteBass"]);h!=null&&a(e,["muteBass"],h);const m=r(n,["muteDrums"]);m!=null&&a(e,["muteDrums"],m);const g=r(n,["onlyBassAndDrums"]);g!=null&&a(e,["onlyBassAndDrums"],g);const T=r(n,["musicGenerationMode"]);return T!=null&&a(e,["musicGenerationMode"],T),e}function LT(n){const e={},t=r(n,["clientContent"]);t!=null&&a(e,["clientContent"],xT(t));const i=r(n,["musicGenerationConfig"]);return i!=null&&a(e,["musicGenerationConfig"],VT(i)),e}function bT(n){const e={},t=r(n,["data"]);t!=null&&a(e,["data"],t);const i=r(n,["mimeType"]);i!=null&&a(e,["mimeType"],i);const o=r(n,["sourceMetadata"]);return o!=null&&a(e,["sourceMetadata"],LT(o)),e}function UT(n){const e={},t=r(n,["audioChunks"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>bT(o))),a(e,["audioChunks"],i)}return e}function FT(n){const e={},t=r(n,["text"]);t!=null&&a(e,["text"],t);const i=r(n,["filteredReason"]);return i!=null&&a(e,["filteredReason"],i),e}function BT(n){const e={};r(n,["setupComplete"])!=null&&a(e,["setupComplete"],NT());const i=r(n,["serverContent"]);i!=null&&a(e,["serverContent"],UT(i));const o=r(n,["filteredPrompt"]);return o!=null&&a(e,["filteredPrompt"],FT(o)),e}function OT(n){const e={},t=r(n,["sessionId"]);return t!=null&&a(e,["sessionId"],t),e}function qT(n){const e={},t=r(n,["fps"]);t!=null&&a(e,["fps"],t);const i=r(n,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=r(n,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function GT(n){const e={},t=r(n,["displayName"]);t!=null&&a(e,["displayName"],t);const i=r(n,["data"]);i!=null&&a(e,["data"],i);const o=r(n,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function $T(n){const e={},t=r(n,["displayName"]);t!=null&&a(e,["displayName"],t);const i=r(n,["fileUri"]);i!=null&&a(e,["fileUri"],i);const o=r(n,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function Ud(n){const e={},t=r(n,["id"]);t!=null&&a(e,["id"],t);const i=r(n,["args"]);i!=null&&a(e,["args"],i);const o=r(n,["name"]);return o!=null&&a(e,["name"],o),e}function HT(n){const e={},t=r(n,["videoMetadata"]);t!=null&&a(e,["videoMetadata"],qT(t));const i=r(n,["thought"]);i!=null&&a(e,["thought"],i);const o=r(n,["inlineData"]);o!=null&&a(e,["inlineData"],GT(o));const s=r(n,["fileData"]);s!=null&&a(e,["fileData"],$T(s));const l=r(n,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=r(n,["functionCall"]);u!=null&&a(e,["functionCall"],Ud(u));const f=r(n,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const d=r(n,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=r(n,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const m=r(n,["text"]);return m!=null&&a(e,["text"],m),e}function zT(n){const e={},t=r(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>HT(s))),a(e,["parts"],o)}const i=r(n,["role"]);return i!=null&&a(e,["role"],i),e}function Nu(n){const e={},t=r(n,["text"]);t!=null&&a(e,["text"],t);const i=r(n,["finished"]);return i!=null&&a(e,["finished"],i),e}function JT(n){const e={},t=r(n,["modelTurn"]);t!=null&&a(e,["modelTurn"],zT(t));const i=r(n,["turnComplete"]);i!=null&&a(e,["turnComplete"],i);const o=r(n,["interrupted"]);o!=null&&a(e,["interrupted"],o);const s=r(n,["groundingMetadata"]);s!=null&&a(e,["groundingMetadata"],s);const l=r(n,["generationComplete"]);l!=null&&a(e,["generationComplete"],l);const u=r(n,["inputTranscription"]);u!=null&&a(e,["inputTranscription"],Nu(u));const f=r(n,["outputTranscription"]);f!=null&&a(e,["outputTranscription"],Nu(f));const d=r(n,["turnCompleteReason"]);d!=null&&a(e,["turnCompleteReason"],d);const h=r(n,["waitingForInput"]);return h!=null&&a(e,["waitingForInput"],h),e}function WT(n){const e={},t=r(n,["functionCalls"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>Ud(o))),a(e,["functionCalls"],i)}return e}function KT(n){const e={},t=r(n,["ids"]);return t!=null&&a(e,["ids"],t),e}function Yi(n){const e={},t=r(n,["modality"]);t!=null&&a(e,["modality"],t);const i=r(n,["tokenCount"]);return i!=null&&a(e,["tokenCount"],i),e}function YT(n){const e={},t=r(n,["promptTokenCount"]);t!=null&&a(e,["promptTokenCount"],t);const i=r(n,["cachedContentTokenCount"]);i!=null&&a(e,["cachedContentTokenCount"],i);const o=r(n,["candidatesTokenCount"]);o!=null&&a(e,["responseTokenCount"],o);const s=r(n,["toolUsePromptTokenCount"]);s!=null&&a(e,["toolUsePromptTokenCount"],s);const l=r(n,["thoughtsTokenCount"]);l!=null&&a(e,["thoughtsTokenCount"],l);const u=r(n,["totalTokenCount"]);u!=null&&a(e,["totalTokenCount"],u);const f=r(n,["promptTokensDetails"]);if(f!=null){let T=f;Array.isArray(T)&&(T=T.map(w=>Yi(w))),a(e,["promptTokensDetails"],T)}const d=r(n,["cacheTokensDetails"]);if(d!=null){let T=d;Array.isArray(T)&&(T=T.map(w=>Yi(w))),a(e,["cacheTokensDetails"],T)}const h=r(n,["candidatesTokensDetails"]);if(h!=null){let T=h;Array.isArray(T)&&(T=T.map(w=>Yi(w))),a(e,["responseTokensDetails"],T)}const m=r(n,["toolUsePromptTokensDetails"]);if(m!=null){let T=m;Array.isArray(T)&&(T=T.map(w=>Yi(w))),a(e,["toolUsePromptTokensDetails"],T)}const g=r(n,["trafficType"]);return g!=null&&a(e,["trafficType"],g),e}function QT(n){const e={},t=r(n,["timeLeft"]);return t!=null&&a(e,["timeLeft"],t),e}function XT(n){const e={},t=r(n,["newHandle"]);t!=null&&a(e,["newHandle"],t);const i=r(n,["resumable"]);i!=null&&a(e,["resumable"],i);const o=r(n,["lastConsumedClientMessageIndex"]);return o!=null&&a(e,["lastConsumedClientMessageIndex"],o),e}function ZT(n){const e={},t=r(n,["setupComplete"]);t!=null&&a(e,["setupComplete"],OT(t));const i=r(n,["serverContent"]);i!=null&&a(e,["serverContent"],JT(i));const o=r(n,["toolCall"]);o!=null&&a(e,["toolCall"],WT(o));const s=r(n,["toolCallCancellation"]);s!=null&&a(e,["toolCallCancellation"],KT(s));const l=r(n,["usageMetadata"]);l!=null&&a(e,["usageMetadata"],YT(l));const u=r(n,["goAway"]);u!=null&&a(e,["goAway"],QT(u));const f=r(n,["sessionResumptionUpdate"]);return f!=null&&a(e,["sessionResumptionUpdate"],XT(f)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jT(n){const e={},t=r(n,["fps"]);t!=null&&a(e,["fps"],t);const i=r(n,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=r(n,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function eE(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["data"]);t!=null&&a(e,["data"],t);const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function tE(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["fileUri"]);t!=null&&a(e,["fileUri"],t);const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function nE(n){const e={},t=r(n,["id"]);t!=null&&a(e,["id"],t);const i=r(n,["args"]);i!=null&&a(e,["args"],i);const o=r(n,["name"]);return o!=null&&a(e,["name"],o),e}function iE(n){const e={},t=r(n,["videoMetadata"]);t!=null&&a(e,["videoMetadata"],jT(t));const i=r(n,["thought"]);i!=null&&a(e,["thought"],i);const o=r(n,["inlineData"]);o!=null&&a(e,["inlineData"],eE(o));const s=r(n,["fileData"]);s!=null&&a(e,["fileData"],tE(s));const l=r(n,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=r(n,["functionCall"]);u!=null&&a(e,["functionCall"],nE(u));const f=r(n,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const d=r(n,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=r(n,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const m=r(n,["text"]);return m!=null&&a(e,["text"],m),e}function Bo(n){const e={},t=r(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>iE(s))),a(e,["parts"],o)}const i=r(n,["role"]);return i!=null&&a(e,["role"],i),e}function oE(n){const e={},t=r(n,["anyOf"]);t!=null&&a(e,["anyOf"],t);const i=r(n,["default"]);i!=null&&a(e,["default"],i);const o=r(n,["description"]);o!=null&&a(e,["description"],o);const s=r(n,["enum"]);s!=null&&a(e,["enum"],s);const l=r(n,["example"]);l!=null&&a(e,["example"],l);const u=r(n,["format"]);u!=null&&a(e,["format"],u);const f=r(n,["items"]);f!=null&&a(e,["items"],f);const d=r(n,["maxItems"]);d!=null&&a(e,["maxItems"],d);const h=r(n,["maxLength"]);h!=null&&a(e,["maxLength"],h);const m=r(n,["maxProperties"]);m!=null&&a(e,["maxProperties"],m);const g=r(n,["maximum"]);g!=null&&a(e,["maximum"],g);const T=r(n,["minItems"]);T!=null&&a(e,["minItems"],T);const w=r(n,["minLength"]);w!=null&&a(e,["minLength"],w);const M=r(n,["minProperties"]);M!=null&&a(e,["minProperties"],M);const N=r(n,["minimum"]);N!=null&&a(e,["minimum"],N);const L=r(n,["nullable"]);L!=null&&a(e,["nullable"],L);const V=r(n,["pattern"]);V!=null&&a(e,["pattern"],V);const b=r(n,["properties"]);b!=null&&a(e,["properties"],b);const B=r(n,["propertyOrdering"]);B!=null&&a(e,["propertyOrdering"],B);const q=r(n,["required"]);q!=null&&a(e,["required"],q);const H=r(n,["title"]);H!=null&&a(e,["title"],H);const S=r(n,["type"]);return S!=null&&a(e,["type"],S),e}function sE(n){const e={};if(r(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const t=r(n,["category"]);t!=null&&a(e,["category"],t);const i=r(n,["threshold"]);return i!=null&&a(e,["threshold"],i),e}function rE(n){const e={},t=r(n,["behavior"]);t!=null&&a(e,["behavior"],t);const i=r(n,["description"]);i!=null&&a(e,["description"],i);const o=r(n,["name"]);o!=null&&a(e,["name"],o);const s=r(n,["parameters"]);s!=null&&a(e,["parameters"],s);const l=r(n,["parametersJsonSchema"]);l!=null&&a(e,["parametersJsonSchema"],l);const u=r(n,["response"]);u!=null&&a(e,["response"],u);const f=r(n,["responseJsonSchema"]);return f!=null&&a(e,["responseJsonSchema"],f),e}function aE(n){const e={},t=r(n,["startTime"]);t!=null&&a(e,["startTime"],t);const i=r(n,["endTime"]);return i!=null&&a(e,["endTime"],i),e}function lE(n){const e={},t=r(n,["timeRangeFilter"]);if(t!=null&&a(e,["timeRangeFilter"],aE(t)),r(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function uE(n){const e={},t=r(n,["mode"]);t!=null&&a(e,["mode"],t);const i=r(n,["dynamicThreshold"]);return i!=null&&a(e,["dynamicThreshold"],i),e}function cE(n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&a(e,["dynamicRetrievalConfig"],uE(t)),e}function dE(){return{}}function fE(n){const e={},t=r(n,["environment"]);return t!=null&&a(e,["environment"],t),e}function hE(n){const e={},t=r(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(d=>rE(d))),a(e,["functionDeclarations"],f)}if(r(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=r(n,["googleSearch"]);i!=null&&a(e,["googleSearch"],lE(i));const o=r(n,["googleSearchRetrieval"]);if(o!=null&&a(e,["googleSearchRetrieval"],cE(o)),r(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");r(n,["urlContext"])!=null&&a(e,["urlContext"],dE());const l=r(n,["computerUse"]);l!=null&&a(e,["computerUse"],fE(l));const u=r(n,["codeExecution"]);return u!=null&&a(e,["codeExecution"],u),e}function pE(n){const e={},t=r(n,["mode"]);t!=null&&a(e,["mode"],t);const i=r(n,["allowedFunctionNames"]);return i!=null&&a(e,["allowedFunctionNames"],i),e}function mE(n){const e={},t=r(n,["latitude"]);t!=null&&a(e,["latitude"],t);const i=r(n,["longitude"]);return i!=null&&a(e,["longitude"],i),e}function gE(n){const e={},t=r(n,["latLng"]);t!=null&&a(e,["latLng"],mE(t));const i=r(n,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function yE(n){const e={},t=r(n,["functionCallingConfig"]);t!=null&&a(e,["functionCallingConfig"],pE(t));const i=r(n,["retrievalConfig"]);return i!=null&&a(e,["retrievalConfig"],gE(i)),e}function _E(n){const e={},t=r(n,["voiceName"]);return t!=null&&a(e,["voiceName"],t),e}function Fd(n){const e={},t=r(n,["prebuiltVoiceConfig"]);return t!=null&&a(e,["prebuiltVoiceConfig"],_E(t)),e}function TE(n){const e={},t=r(n,["speaker"]);t!=null&&a(e,["speaker"],t);const i=r(n,["voiceConfig"]);return i!=null&&a(e,["voiceConfig"],Fd(i)),e}function EE(n){const e={},t=r(n,["speakerVoiceConfigs"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>TE(o))),a(e,["speakerVoiceConfigs"],i)}return e}function vE(n){const e={},t=r(n,["voiceConfig"]);t!=null&&a(e,["voiceConfig"],Fd(t));const i=r(n,["multiSpeakerVoiceConfig"]);i!=null&&a(e,["multiSpeakerVoiceConfig"],EE(i));const o=r(n,["languageCode"]);return o!=null&&a(e,["languageCode"],o),e}function IE(n){const e={},t=r(n,["includeThoughts"]);t!=null&&a(e,["includeThoughts"],t);const i=r(n,["thinkingBudget"]);return i!=null&&a(e,["thinkingBudget"],i),e}function CE(n,e,t){const i={},o=r(e,["systemInstruction"]);t!==void 0&&o!=null&&a(t,["systemInstruction"],Bo(Pe(o)));const s=r(e,["temperature"]);s!=null&&a(i,["temperature"],s);const l=r(e,["topP"]);l!=null&&a(i,["topP"],l);const u=r(e,["topK"]);u!=null&&a(i,["topK"],u);const f=r(e,["candidateCount"]);f!=null&&a(i,["candidateCount"],f);const d=r(e,["maxOutputTokens"]);d!=null&&a(i,["maxOutputTokens"],d);const h=r(e,["stopSequences"]);h!=null&&a(i,["stopSequences"],h);const m=r(e,["responseLogprobs"]);m!=null&&a(i,["responseLogprobs"],m);const g=r(e,["logprobs"]);g!=null&&a(i,["logprobs"],g);const T=r(e,["presencePenalty"]);T!=null&&a(i,["presencePenalty"],T);const w=r(e,["frequencyPenalty"]);w!=null&&a(i,["frequencyPenalty"],w);const M=r(e,["seed"]);M!=null&&a(i,["seed"],M);const N=r(e,["responseMimeType"]);N!=null&&a(i,["responseMimeType"],N);const L=r(e,["responseSchema"]);L!=null&&a(i,["responseSchema"],oE(wr(L)));const V=r(e,["responseJsonSchema"]);if(V!=null&&a(i,["responseJsonSchema"],V),r(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(r(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const b=r(e,["safetySettings"]);if(t!==void 0&&b!=null){let C=b;Array.isArray(C)&&(C=C.map(R=>sE(R))),a(t,["safetySettings"],C)}const B=r(e,["tools"]);if(t!==void 0&&B!=null){let C=wn(B);Array.isArray(C)&&(C=C.map(R=>hE(An(R)))),a(t,["tools"],C)}const q=r(e,["toolConfig"]);if(t!==void 0&&q!=null&&a(t,["toolConfig"],yE(q)),r(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const H=r(e,["cachedContent"]);t!==void 0&&H!=null&&a(t,["cachedContent"],lt(n,H));const S=r(e,["responseModalities"]);S!=null&&a(i,["responseModalities"],S);const v=r(e,["mediaResolution"]);v!=null&&a(i,["mediaResolution"],v);const E=r(e,["speechConfig"]);if(E!=null&&a(i,["speechConfig"],vE(Rr(E))),r(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const A=r(e,["thinkingConfig"]);return A!=null&&a(i,["thinkingConfig"],IE(A)),i}function ku(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["contents"]);if(o!=null){let l=be(o);Array.isArray(l)&&(l=l.map(u=>Bo(u))),a(t,["contents"],l)}const s=r(e,["config"]);return s!=null&&a(t,["generationConfig"],CE(n,s,t)),t}function SE(n,e){const t={},i=r(n,["taskType"]);e!==void 0&&i!=null&&a(e,["requests[]","taskType"],i);const o=r(n,["title"]);e!==void 0&&o!=null&&a(e,["requests[]","title"],o);const s=r(n,["outputDimensionality"]);if(e!==void 0&&s!=null&&a(e,["requests[]","outputDimensionality"],s),r(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(r(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function AE(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["contents"]);o!=null&&a(t,["requests[]","content"],Ar(n,o));const s=r(e,["config"]);s!=null&&a(t,["config"],SE(s,t));const l=r(e,["model"]);return l!==void 0&&a(t,["requests[]","model"],te(n,l)),t}function wE(n,e){const t={};if(r(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=r(n,["numberOfImages"]);e!==void 0&&i!=null&&a(e,["parameters","sampleCount"],i);const o=r(n,["aspectRatio"]);e!==void 0&&o!=null&&a(e,["parameters","aspectRatio"],o);const s=r(n,["guidanceScale"]);if(e!==void 0&&s!=null&&a(e,["parameters","guidanceScale"],s),r(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=r(n,["safetyFilterLevel"]);e!==void 0&&l!=null&&a(e,["parameters","safetySetting"],l);const u=r(n,["personGeneration"]);e!==void 0&&u!=null&&a(e,["parameters","personGeneration"],u);const f=r(n,["includeSafetyAttributes"]);e!==void 0&&f!=null&&a(e,["parameters","includeSafetyAttributes"],f);const d=r(n,["includeRaiReason"]);e!==void 0&&d!=null&&a(e,["parameters","includeRaiReason"],d);const h=r(n,["language"]);e!==void 0&&h!=null&&a(e,["parameters","language"],h);const m=r(n,["outputMimeType"]);e!==void 0&&m!=null&&a(e,["parameters","outputOptions","mimeType"],m);const g=r(n,["outputCompressionQuality"]);if(e!==void 0&&g!=null&&a(e,["parameters","outputOptions","compressionQuality"],g),r(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");const T=r(n,["imageSize"]);if(e!==void 0&&T!=null&&a(e,["parameters","sampleImageSize"],T),r(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function RE(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["prompt"]);o!=null&&a(t,["instances[0]","prompt"],o);const s=r(e,["config"]);return s!=null&&a(t,["config"],wE(s,t)),t}function PE(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","name"],te(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],o),t}function ME(n,e,t){const i={},o=r(e,["pageSize"]);t!==void 0&&o!=null&&a(t,["_query","pageSize"],o);const s=r(e,["pageToken"]);t!==void 0&&s!=null&&a(t,["_query","pageToken"],s);const l=r(e,["filter"]);t!==void 0&&l!=null&&a(t,["_query","filter"],l);const u=r(e,["queryBase"]);return t!==void 0&&u!=null&&a(t,["_url","models_url"],Id(n,u)),i}function DE(n,e){const t={},i=r(e,["config"]);return i!=null&&a(t,["config"],ME(n,i,t)),t}function NE(n,e){const t={},i=r(n,["displayName"]);e!==void 0&&i!=null&&a(e,["displayName"],i);const o=r(n,["description"]);e!==void 0&&o!=null&&a(e,["description"],o);const s=r(n,["defaultCheckpointId"]);return e!==void 0&&s!=null&&a(e,["defaultCheckpointId"],s),t}function kE(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","name"],te(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],NE(o,t)),t}function xE(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","name"],te(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],o),t}function VE(n){const e={};if(r(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(r(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(r(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function LE(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["contents"]);if(o!=null){let l=be(o);Array.isArray(l)&&(l=l.map(u=>Bo(u))),a(t,["contents"],l)}const s=r(e,["config"]);return s!=null&&a(t,["config"],VE(s)),t}function Bd(n){const e={};if(r(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=r(n,["imageBytes"]);t!=null&&a(e,["bytesBase64Encoded"],Yt(t));const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function bE(n,e){const t={},i=r(n,["prompt"]);e!==void 0&&i!=null&&a(e,["instances[0]","prompt"],i);const o=r(n,["image"]);if(e!==void 0&&o!=null&&a(e,["instances[0]","image"],Bd(o)),r(n,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");return t}function UE(n,e){const t={},i=r(n,["numberOfVideos"]);if(e!==void 0&&i!=null&&a(e,["parameters","sampleCount"],i),r(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const o=r(n,["durationSeconds"]);if(e!==void 0&&o!=null&&a(e,["parameters","durationSeconds"],o),r(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const s=r(n,["aspectRatio"]);e!==void 0&&s!=null&&a(e,["parameters","aspectRatio"],s);const l=r(n,["resolution"]);e!==void 0&&l!=null&&a(e,["parameters","resolution"],l);const u=r(n,["personGeneration"]);if(e!==void 0&&u!=null&&a(e,["parameters","personGeneration"],u),r(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const f=r(n,["negativePrompt"]);e!==void 0&&f!=null&&a(e,["parameters","negativePrompt"],f);const d=r(n,["enhancePrompt"]);if(e!==void 0&&d!=null&&a(e,["parameters","enhancePrompt"],d),r(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");if(r(n,["lastFrame"])!==void 0)throw new Error("lastFrame parameter is not supported in Gemini API.");if(r(n,["referenceImages"])!==void 0)throw new Error("referenceImages parameter is not supported in Gemini API.");if(r(n,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(r(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function FE(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["prompt"]);o!=null&&a(t,["instances[0]","prompt"],o);const s=r(e,["image"]);if(s!=null&&a(t,["instances[0]","image"],Bd(s)),r(e,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");const l=r(e,["source"]);l!=null&&a(t,["config"],bE(l,t));const u=r(e,["config"]);return u!=null&&a(t,["config"],UE(u,t)),t}function BE(n){const e={},t=r(n,["fps"]);t!=null&&a(e,["fps"],t);const i=r(n,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=r(n,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function OE(n){const e={},t=r(n,["displayName"]);t!=null&&a(e,["displayName"],t);const i=r(n,["data"]);i!=null&&a(e,["data"],i);const o=r(n,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function qE(n){const e={},t=r(n,["displayName"]);t!=null&&a(e,["displayName"],t);const i=r(n,["fileUri"]);i!=null&&a(e,["fileUri"],i);const o=r(n,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function GE(n){const e={},t=r(n,["id"]);t!=null&&a(e,["id"],t);const i=r(n,["args"]);i!=null&&a(e,["args"],i);const o=r(n,["name"]);return o!=null&&a(e,["name"],o),e}function $E(n){const e={},t=r(n,["videoMetadata"]);t!=null&&a(e,["videoMetadata"],BE(t));const i=r(n,["thought"]);i!=null&&a(e,["thought"],i);const o=r(n,["inlineData"]);o!=null&&a(e,["inlineData"],OE(o));const s=r(n,["fileData"]);s!=null&&a(e,["fileData"],qE(s));const l=r(n,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=r(n,["functionCall"]);u!=null&&a(e,["functionCall"],GE(u));const f=r(n,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const d=r(n,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=r(n,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const m=r(n,["text"]);return m!=null&&a(e,["text"],m),e}function Pn(n){const e={},t=r(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>$E(s))),a(e,["parts"],o)}const i=r(n,["role"]);return i!=null&&a(e,["role"],i),e}function HE(n){const e={},t=r(n,["anyOf"]);t!=null&&a(e,["anyOf"],t);const i=r(n,["default"]);i!=null&&a(e,["default"],i);const o=r(n,["description"]);o!=null&&a(e,["description"],o);const s=r(n,["enum"]);s!=null&&a(e,["enum"],s);const l=r(n,["example"]);l!=null&&a(e,["example"],l);const u=r(n,["format"]);u!=null&&a(e,["format"],u);const f=r(n,["items"]);f!=null&&a(e,["items"],f);const d=r(n,["maxItems"]);d!=null&&a(e,["maxItems"],d);const h=r(n,["maxLength"]);h!=null&&a(e,["maxLength"],h);const m=r(n,["maxProperties"]);m!=null&&a(e,["maxProperties"],m);const g=r(n,["maximum"]);g!=null&&a(e,["maximum"],g);const T=r(n,["minItems"]);T!=null&&a(e,["minItems"],T);const w=r(n,["minLength"]);w!=null&&a(e,["minLength"],w);const M=r(n,["minProperties"]);M!=null&&a(e,["minProperties"],M);const N=r(n,["minimum"]);N!=null&&a(e,["minimum"],N);const L=r(n,["nullable"]);L!=null&&a(e,["nullable"],L);const V=r(n,["pattern"]);V!=null&&a(e,["pattern"],V);const b=r(n,["properties"]);b!=null&&a(e,["properties"],b);const B=r(n,["propertyOrdering"]);B!=null&&a(e,["propertyOrdering"],B);const q=r(n,["required"]);q!=null&&a(e,["required"],q);const H=r(n,["title"]);H!=null&&a(e,["title"],H);const S=r(n,["type"]);return S!=null&&a(e,["type"],S),e}function zE(n){const e={},t=r(n,["featureSelectionPreference"]);return t!=null&&a(e,["featureSelectionPreference"],t),e}function JE(n){const e={},t=r(n,["method"]);t!=null&&a(e,["method"],t);const i=r(n,["category"]);i!=null&&a(e,["category"],i);const o=r(n,["threshold"]);return o!=null&&a(e,["threshold"],o),e}function WE(n){const e={};if(r(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=r(n,["description"]);t!=null&&a(e,["description"],t);const i=r(n,["name"]);i!=null&&a(e,["name"],i);const o=r(n,["parameters"]);o!=null&&a(e,["parameters"],o);const s=r(n,["parametersJsonSchema"]);s!=null&&a(e,["parametersJsonSchema"],s);const l=r(n,["response"]);l!=null&&a(e,["response"],l);const u=r(n,["responseJsonSchema"]);return u!=null&&a(e,["responseJsonSchema"],u),e}function KE(n){const e={},t=r(n,["startTime"]);t!=null&&a(e,["startTime"],t);const i=r(n,["endTime"]);return i!=null&&a(e,["endTime"],i),e}function YE(n){const e={},t=r(n,["timeRangeFilter"]);t!=null&&a(e,["timeRangeFilter"],KE(t));const i=r(n,["excludeDomains"]);return i!=null&&a(e,["excludeDomains"],i),e}function QE(n){const e={},t=r(n,["mode"]);t!=null&&a(e,["mode"],t);const i=r(n,["dynamicThreshold"]);return i!=null&&a(e,["dynamicThreshold"],i),e}function XE(n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&a(e,["dynamicRetrievalConfig"],QE(t)),e}function ZE(n){const e={},t=r(n,["excludeDomains"]);return t!=null&&a(e,["excludeDomains"],t),e}function jE(n){const e={},t=r(n,["apiKeyString"]);return t!=null&&a(e,["apiKeyString"],t),e}function ev(n){const e={},t=r(n,["apiKeyConfig"]);t!=null&&a(e,["apiKeyConfig"],jE(t));const i=r(n,["authType"]);i!=null&&a(e,["authType"],i);const o=r(n,["googleServiceAccountConfig"]);o!=null&&a(e,["googleServiceAccountConfig"],o);const s=r(n,["httpBasicAuthConfig"]);s!=null&&a(e,["httpBasicAuthConfig"],s);const l=r(n,["oauthConfig"]);l!=null&&a(e,["oauthConfig"],l);const u=r(n,["oidcConfig"]);return u!=null&&a(e,["oidcConfig"],u),e}function tv(n){const e={},t=r(n,["authConfig"]);return t!=null&&a(e,["authConfig"],ev(t)),e}function nv(){return{}}function iv(n){const e={},t=r(n,["environment"]);return t!=null&&a(e,["environment"],t),e}function Od(n){const e={},t=r(n,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(g=>WE(g))),a(e,["functionDeclarations"],m)}const i=r(n,["retrieval"]);i!=null&&a(e,["retrieval"],i);const o=r(n,["googleSearch"]);o!=null&&a(e,["googleSearch"],YE(o));const s=r(n,["googleSearchRetrieval"]);s!=null&&a(e,["googleSearchRetrieval"],XE(s));const l=r(n,["enterpriseWebSearch"]);l!=null&&a(e,["enterpriseWebSearch"],ZE(l));const u=r(n,["googleMaps"]);u!=null&&a(e,["googleMaps"],tv(u)),r(n,["urlContext"])!=null&&a(e,["urlContext"],nv());const d=r(n,["computerUse"]);d!=null&&a(e,["computerUse"],iv(d));const h=r(n,["codeExecution"]);return h!=null&&a(e,["codeExecution"],h),e}function ov(n){const e={},t=r(n,["mode"]);t!=null&&a(e,["mode"],t);const i=r(n,["allowedFunctionNames"]);return i!=null&&a(e,["allowedFunctionNames"],i),e}function sv(n){const e={},t=r(n,["latitude"]);t!=null&&a(e,["latitude"],t);const i=r(n,["longitude"]);return i!=null&&a(e,["longitude"],i),e}function rv(n){const e={},t=r(n,["latLng"]);t!=null&&a(e,["latLng"],sv(t));const i=r(n,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function av(n){const e={},t=r(n,["functionCallingConfig"]);t!=null&&a(e,["functionCallingConfig"],ov(t));const i=r(n,["retrievalConfig"]);return i!=null&&a(e,["retrievalConfig"],rv(i)),e}function lv(n){const e={},t=r(n,["voiceName"]);return t!=null&&a(e,["voiceName"],t),e}function uv(n){const e={},t=r(n,["prebuiltVoiceConfig"]);return t!=null&&a(e,["prebuiltVoiceConfig"],lv(t)),e}function cv(n){const e={},t=r(n,["voiceConfig"]);if(t!=null&&a(e,["voiceConfig"],uv(t)),r(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const i=r(n,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function dv(n){const e={},t=r(n,["includeThoughts"]);t!=null&&a(e,["includeThoughts"],t);const i=r(n,["thinkingBudget"]);return i!=null&&a(e,["thinkingBudget"],i),e}function fv(n,e,t){const i={},o=r(e,["systemInstruction"]);t!==void 0&&o!=null&&a(t,["systemInstruction"],Pn(Pe(o)));const s=r(e,["temperature"]);s!=null&&a(i,["temperature"],s);const l=r(e,["topP"]);l!=null&&a(i,["topP"],l);const u=r(e,["topK"]);u!=null&&a(i,["topK"],u);const f=r(e,["candidateCount"]);f!=null&&a(i,["candidateCount"],f);const d=r(e,["maxOutputTokens"]);d!=null&&a(i,["maxOutputTokens"],d);const h=r(e,["stopSequences"]);h!=null&&a(i,["stopSequences"],h);const m=r(e,["responseLogprobs"]);m!=null&&a(i,["responseLogprobs"],m);const g=r(e,["logprobs"]);g!=null&&a(i,["logprobs"],g);const T=r(e,["presencePenalty"]);T!=null&&a(i,["presencePenalty"],T);const w=r(e,["frequencyPenalty"]);w!=null&&a(i,["frequencyPenalty"],w);const M=r(e,["seed"]);M!=null&&a(i,["seed"],M);const N=r(e,["responseMimeType"]);N!=null&&a(i,["responseMimeType"],N);const L=r(e,["responseSchema"]);L!=null&&a(i,["responseSchema"],HE(wr(L)));const V=r(e,["responseJsonSchema"]);V!=null&&a(i,["responseJsonSchema"],V);const b=r(e,["routingConfig"]);b!=null&&a(i,["routingConfig"],b);const B=r(e,["modelSelectionConfig"]);B!=null&&a(i,["modelConfig"],zE(B));const q=r(e,["safetySettings"]);if(t!==void 0&&q!=null){let Ee=q;Array.isArray(Ee)&&(Ee=Ee.map(bn=>JE(bn))),a(t,["safetySettings"],Ee)}const H=r(e,["tools"]);if(t!==void 0&&H!=null){let Ee=wn(H);Array.isArray(Ee)&&(Ee=Ee.map(bn=>Od(An(bn)))),a(t,["tools"],Ee)}const S=r(e,["toolConfig"]);t!==void 0&&S!=null&&a(t,["toolConfig"],av(S));const v=r(e,["labels"]);t!==void 0&&v!=null&&a(t,["labels"],v);const E=r(e,["cachedContent"]);t!==void 0&&E!=null&&a(t,["cachedContent"],lt(n,E));const A=r(e,["responseModalities"]);A!=null&&a(i,["responseModalities"],A);const C=r(e,["mediaResolution"]);C!=null&&a(i,["mediaResolution"],C);const R=r(e,["speechConfig"]);R!=null&&a(i,["speechConfig"],cv(Rr(R)));const I=r(e,["audioTimestamp"]);I!=null&&a(i,["audioTimestamp"],I);const Te=r(e,["thinkingConfig"]);return Te!=null&&a(i,["thinkingConfig"],dv(Te)),i}function xu(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["contents"]);if(o!=null){let l=be(o);Array.isArray(l)&&(l=l.map(u=>Pn(u))),a(t,["contents"],l)}const s=r(e,["config"]);return s!=null&&a(t,["generationConfig"],fv(n,s,t)),t}function hv(n,e){const t={},i=r(n,["taskType"]);e!==void 0&&i!=null&&a(e,["instances[]","task_type"],i);const o=r(n,["title"]);e!==void 0&&o!=null&&a(e,["instances[]","title"],o);const s=r(n,["outputDimensionality"]);e!==void 0&&s!=null&&a(e,["parameters","outputDimensionality"],s);const l=r(n,["mimeType"]);e!==void 0&&l!=null&&a(e,["instances[]","mimeType"],l);const u=r(n,["autoTruncate"]);return e!==void 0&&u!=null&&a(e,["parameters","autoTruncate"],u),t}function pv(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["contents"]);o!=null&&a(t,["instances[]","content"],Ar(n,o));const s=r(e,["config"]);return s!=null&&a(t,["config"],hv(s,t)),t}function mv(n,e){const t={},i=r(n,["outputGcsUri"]);e!==void 0&&i!=null&&a(e,["parameters","storageUri"],i);const o=r(n,["negativePrompt"]);e!==void 0&&o!=null&&a(e,["parameters","negativePrompt"],o);const s=r(n,["numberOfImages"]);e!==void 0&&s!=null&&a(e,["parameters","sampleCount"],s);const l=r(n,["aspectRatio"]);e!==void 0&&l!=null&&a(e,["parameters","aspectRatio"],l);const u=r(n,["guidanceScale"]);e!==void 0&&u!=null&&a(e,["parameters","guidanceScale"],u);const f=r(n,["seed"]);e!==void 0&&f!=null&&a(e,["parameters","seed"],f);const d=r(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&a(e,["parameters","safetySetting"],d);const h=r(n,["personGeneration"]);e!==void 0&&h!=null&&a(e,["parameters","personGeneration"],h);const m=r(n,["includeSafetyAttributes"]);e!==void 0&&m!=null&&a(e,["parameters","includeSafetyAttributes"],m);const g=r(n,["includeRaiReason"]);e!==void 0&&g!=null&&a(e,["parameters","includeRaiReason"],g);const T=r(n,["language"]);e!==void 0&&T!=null&&a(e,["parameters","language"],T);const w=r(n,["outputMimeType"]);e!==void 0&&w!=null&&a(e,["parameters","outputOptions","mimeType"],w);const M=r(n,["outputCompressionQuality"]);e!==void 0&&M!=null&&a(e,["parameters","outputOptions","compressionQuality"],M);const N=r(n,["addWatermark"]);e!==void 0&&N!=null&&a(e,["parameters","addWatermark"],N);const L=r(n,["imageSize"]);e!==void 0&&L!=null&&a(e,["parameters","sampleImageSize"],L);const V=r(n,["enhancePrompt"]);return e!==void 0&&V!=null&&a(e,["parameters","enhancePrompt"],V),t}function gv(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["prompt"]);o!=null&&a(t,["instances[0]","prompt"],o);const s=r(e,["config"]);return s!=null&&a(t,["config"],mv(s,t)),t}function Ge(n){const e={},t=r(n,["gcsUri"]);t!=null&&a(e,["gcsUri"],t);const i=r(n,["imageBytes"]);i!=null&&a(e,["bytesBase64Encoded"],Yt(i));const o=r(n,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function yv(n){const e={},t=r(n,["maskMode"]);t!=null&&a(e,["maskMode"],t);const i=r(n,["segmentationClasses"]);i!=null&&a(e,["maskClasses"],i);const o=r(n,["maskDilation"]);return o!=null&&a(e,["dilation"],o),e}function _v(n){const e={},t=r(n,["controlType"]);t!=null&&a(e,["controlType"],t);const i=r(n,["enableControlImageComputation"]);return i!=null&&a(e,["computeControl"],i),e}function Tv(n){const e={},t=r(n,["styleDescription"]);return t!=null&&a(e,["styleDescription"],t),e}function Ev(n){const e={},t=r(n,["subjectType"]);t!=null&&a(e,["subjectType"],t);const i=r(n,["subjectDescription"]);return i!=null&&a(e,["subjectDescription"],i),e}function vv(n){const e={},t=r(n,["referenceImage"]);t!=null&&a(e,["referenceImage"],Ge(t));const i=r(n,["referenceId"]);i!=null&&a(e,["referenceId"],i);const o=r(n,["referenceType"]);o!=null&&a(e,["referenceType"],o);const s=r(n,["maskImageConfig"]);s!=null&&a(e,["maskImageConfig"],yv(s));const l=r(n,["controlImageConfig"]);l!=null&&a(e,["controlImageConfig"],_v(l));const u=r(n,["styleImageConfig"]);u!=null&&a(e,["styleImageConfig"],Tv(u));const f=r(n,["subjectImageConfig"]);return f!=null&&a(e,["subjectImageConfig"],Ev(f)),e}function Iv(n,e){const t={},i=r(n,["outputGcsUri"]);e!==void 0&&i!=null&&a(e,["parameters","storageUri"],i);const o=r(n,["negativePrompt"]);e!==void 0&&o!=null&&a(e,["parameters","negativePrompt"],o);const s=r(n,["numberOfImages"]);e!==void 0&&s!=null&&a(e,["parameters","sampleCount"],s);const l=r(n,["aspectRatio"]);e!==void 0&&l!=null&&a(e,["parameters","aspectRatio"],l);const u=r(n,["guidanceScale"]);e!==void 0&&u!=null&&a(e,["parameters","guidanceScale"],u);const f=r(n,["seed"]);e!==void 0&&f!=null&&a(e,["parameters","seed"],f);const d=r(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&a(e,["parameters","safetySetting"],d);const h=r(n,["personGeneration"]);e!==void 0&&h!=null&&a(e,["parameters","personGeneration"],h);const m=r(n,["includeSafetyAttributes"]);e!==void 0&&m!=null&&a(e,["parameters","includeSafetyAttributes"],m);const g=r(n,["includeRaiReason"]);e!==void 0&&g!=null&&a(e,["parameters","includeRaiReason"],g);const T=r(n,["language"]);e!==void 0&&T!=null&&a(e,["parameters","language"],T);const w=r(n,["outputMimeType"]);e!==void 0&&w!=null&&a(e,["parameters","outputOptions","mimeType"],w);const M=r(n,["outputCompressionQuality"]);e!==void 0&&M!=null&&a(e,["parameters","outputOptions","compressionQuality"],M);const N=r(n,["addWatermark"]);e!==void 0&&N!=null&&a(e,["parameters","addWatermark"],N);const L=r(n,["editMode"]);e!==void 0&&L!=null&&a(e,["parameters","editMode"],L);const V=r(n,["baseSteps"]);return e!==void 0&&V!=null&&a(e,["parameters","editConfig","baseSteps"],V),t}function Cv(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["prompt"]);o!=null&&a(t,["instances[0]","prompt"],o);const s=r(e,["referenceImages"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(f=>vv(f))),a(t,["instances[0]","referenceImages"],u)}const l=r(e,["config"]);return l!=null&&a(t,["config"],Iv(l,t)),t}function Sv(n,e){const t={},i=r(n,["outputGcsUri"]);e!==void 0&&i!=null&&a(e,["parameters","storageUri"],i);const o=r(n,["includeRaiReason"]);e!==void 0&&o!=null&&a(e,["parameters","includeRaiReason"],o);const s=r(n,["outputMimeType"]);e!==void 0&&s!=null&&a(e,["parameters","outputOptions","mimeType"],s);const l=r(n,["outputCompressionQuality"]);e!==void 0&&l!=null&&a(e,["parameters","outputOptions","compressionQuality"],l);const u=r(n,["enhanceInputImage"]);e!==void 0&&u!=null&&a(e,["parameters","upscaleConfig","enhanceInputImage"],u);const f=r(n,["imagePreservationFactor"]);e!==void 0&&f!=null&&a(e,["parameters","upscaleConfig","imagePreservationFactor"],f);const d=r(n,["numberOfImages"]);e!==void 0&&d!=null&&a(e,["parameters","sampleCount"],d);const h=r(n,["mode"]);return e!==void 0&&h!=null&&a(e,["parameters","mode"],h),t}function Av(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["image"]);o!=null&&a(t,["instances[0]","image"],Ge(o));const s=r(e,["upscaleFactor"]);s!=null&&a(t,["parameters","upscaleConfig","upscaleFactor"],s);const l=r(e,["config"]);return l!=null&&a(t,["config"],Sv(l,t)),t}function wv(n){const e={},t=r(n,["productImage"]);return t!=null&&a(e,["image"],Ge(t)),e}function Rv(n,e){const t={},i=r(n,["prompt"]);e!==void 0&&i!=null&&a(e,["instances[0]","prompt"],i);const o=r(n,["personImage"]);e!==void 0&&o!=null&&a(e,["instances[0]","personImage","image"],Ge(o));const s=r(n,["productImages"]);if(e!==void 0&&s!=null){let l=s;Array.isArray(l)&&(l=l.map(u=>wv(u))),a(e,["instances[0]","productImages"],l)}return t}function Pv(n,e){const t={},i=r(n,["numberOfImages"]);e!==void 0&&i!=null&&a(e,["parameters","sampleCount"],i);const o=r(n,["baseSteps"]);e!==void 0&&o!=null&&a(e,["parameters","editConfig","baseSteps"],o);const s=r(n,["outputGcsUri"]);e!==void 0&&s!=null&&a(e,["parameters","storageUri"],s);const l=r(n,["seed"]);e!==void 0&&l!=null&&a(e,["parameters","seed"],l);const u=r(n,["safetyFilterLevel"]);e!==void 0&&u!=null&&a(e,["parameters","safetySetting"],u);const f=r(n,["personGeneration"]);e!==void 0&&f!=null&&a(e,["parameters","personGeneration"],f);const d=r(n,["addWatermark"]);e!==void 0&&d!=null&&a(e,["parameters","addWatermark"],d);const h=r(n,["outputMimeType"]);e!==void 0&&h!=null&&a(e,["parameters","outputOptions","mimeType"],h);const m=r(n,["outputCompressionQuality"]);e!==void 0&&m!=null&&a(e,["parameters","outputOptions","compressionQuality"],m);const g=r(n,["enhancePrompt"]);return e!==void 0&&g!=null&&a(e,["parameters","enhancePrompt"],g),t}function Mv(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["source"]);o!=null&&a(t,["config"],Rv(o,t));const s=r(e,["config"]);return s!=null&&a(t,["config"],Pv(s,t)),t}function Dv(n){const e={},t=r(n,["image"]);return t!=null&&a(e,["image"],Ge(t)),e}function Nv(n,e){const t={},i=r(n,["prompt"]);e!==void 0&&i!=null&&a(e,["instances[0]","prompt"],i);const o=r(n,["image"]);e!==void 0&&o!=null&&a(e,["instances[0]","image"],Ge(o));const s=r(n,["scribbleImage"]);return e!==void 0&&s!=null&&a(e,["instances[0]","scribble"],Dv(s)),t}function kv(n,e){const t={},i=r(n,["mode"]);e!==void 0&&i!=null&&a(e,["parameters","mode"],i);const o=r(n,["maxPredictions"]);e!==void 0&&o!=null&&a(e,["parameters","maxPredictions"],o);const s=r(n,["confidenceThreshold"]);e!==void 0&&s!=null&&a(e,["parameters","confidenceThreshold"],s);const l=r(n,["maskDilation"]);e!==void 0&&l!=null&&a(e,["parameters","maskDilation"],l);const u=r(n,["binaryColorThreshold"]);return e!==void 0&&u!=null&&a(e,["parameters","binaryColorThreshold"],u),t}function xv(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["source"]);o!=null&&a(t,["config"],Nv(o,t));const s=r(e,["config"]);return s!=null&&a(t,["config"],kv(s,t)),t}function Vv(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","name"],te(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],o),t}function Lv(n,e,t){const i={},o=r(e,["pageSize"]);t!==void 0&&o!=null&&a(t,["_query","pageSize"],o);const s=r(e,["pageToken"]);t!==void 0&&s!=null&&a(t,["_query","pageToken"],s);const l=r(e,["filter"]);t!==void 0&&l!=null&&a(t,["_query","filter"],l);const u=r(e,["queryBase"]);return t!==void 0&&u!=null&&a(t,["_url","models_url"],Id(n,u)),i}function bv(n,e){const t={},i=r(e,["config"]);return i!=null&&a(t,["config"],Lv(n,i,t)),t}function Uv(n,e){const t={},i=r(n,["displayName"]);e!==void 0&&i!=null&&a(e,["displayName"],i);const o=r(n,["description"]);e!==void 0&&o!=null&&a(e,["description"],o);const s=r(n,["defaultCheckpointId"]);return e!==void 0&&s!=null&&a(e,["defaultCheckpointId"],s),t}function Fv(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],Uv(o,t)),t}function Bv(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","name"],te(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],o),t}function Ov(n,e){const t={},i=r(n,["systemInstruction"]);e!==void 0&&i!=null&&a(e,["systemInstruction"],Pn(Pe(i)));const o=r(n,["tools"]);if(e!==void 0&&o!=null){let l=o;Array.isArray(l)&&(l=l.map(u=>Od(u))),a(e,["tools"],l)}const s=r(n,["generationConfig"]);return e!==void 0&&s!=null&&a(e,["generationConfig"],s),t}function qv(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["contents"]);if(o!=null){let l=be(o);Array.isArray(l)&&(l=l.map(u=>Pn(u))),a(t,["contents"],l)}const s=r(e,["config"]);return s!=null&&a(t,["config"],Ov(s,t)),t}function Gv(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["contents"]);if(o!=null){let l=be(o);Array.isArray(l)&&(l=l.map(u=>Pn(u))),a(t,["contents"],l)}const s=r(e,["config"]);return s!=null&&a(t,["config"],s),t}function qd(n){const e={},t=r(n,["uri"]);t!=null&&a(e,["gcsUri"],t);const i=r(n,["videoBytes"]);i!=null&&a(e,["bytesBase64Encoded"],Yt(i));const o=r(n,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function $v(n,e){const t={},i=r(n,["prompt"]);e!==void 0&&i!=null&&a(e,["instances[0]","prompt"],i);const o=r(n,["image"]);e!==void 0&&o!=null&&a(e,["instances[0]","image"],Ge(o));const s=r(n,["video"]);return e!==void 0&&s!=null&&a(e,["instances[0]","video"],qd(s)),t}function Hv(n){const e={},t=r(n,["image"]);t!=null&&a(e,["image"],Ge(t));const i=r(n,["referenceType"]);return i!=null&&a(e,["referenceType"],i),e}function zv(n){const e={},t=r(n,["image"]);t!=null&&a(e,["_self"],Ge(t));const i=r(n,["maskMode"]);return i!=null&&a(e,["maskMode"],i),e}function Jv(n,e){const t={},i=r(n,["numberOfVideos"]);e!==void 0&&i!=null&&a(e,["parameters","sampleCount"],i);const o=r(n,["outputGcsUri"]);e!==void 0&&o!=null&&a(e,["parameters","storageUri"],o);const s=r(n,["fps"]);e!==void 0&&s!=null&&a(e,["parameters","fps"],s);const l=r(n,["durationSeconds"]);e!==void 0&&l!=null&&a(e,["parameters","durationSeconds"],l);const u=r(n,["seed"]);e!==void 0&&u!=null&&a(e,["parameters","seed"],u);const f=r(n,["aspectRatio"]);e!==void 0&&f!=null&&a(e,["parameters","aspectRatio"],f);const d=r(n,["resolution"]);e!==void 0&&d!=null&&a(e,["parameters","resolution"],d);const h=r(n,["personGeneration"]);e!==void 0&&h!=null&&a(e,["parameters","personGeneration"],h);const m=r(n,["pubsubTopic"]);e!==void 0&&m!=null&&a(e,["parameters","pubsubTopic"],m);const g=r(n,["negativePrompt"]);e!==void 0&&g!=null&&a(e,["parameters","negativePrompt"],g);const T=r(n,["enhancePrompt"]);e!==void 0&&T!=null&&a(e,["parameters","enhancePrompt"],T);const w=r(n,["generateAudio"]);e!==void 0&&w!=null&&a(e,["parameters","generateAudio"],w);const M=r(n,["lastFrame"]);e!==void 0&&M!=null&&a(e,["instances[0]","lastFrame"],Ge(M));const N=r(n,["referenceImages"]);if(e!==void 0&&N!=null){let b=N;Array.isArray(b)&&(b=b.map(B=>Hv(B))),a(e,["instances[0]","referenceImages"],b)}const L=r(n,["mask"]);e!==void 0&&L!=null&&a(e,["instances[0]","mask"],zv(L));const V=r(n,["compressionQuality"]);return e!==void 0&&V!=null&&a(e,["parameters","compressionQuality"],V),t}function Wv(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["_url","model"],te(n,i));const o=r(e,["prompt"]);o!=null&&a(t,["instances[0]","prompt"],o);const s=r(e,["image"]);s!=null&&a(t,["instances[0]","image"],Ge(s));const l=r(e,["video"]);l!=null&&a(t,["instances[0]","video"],qd(l));const u=r(e,["source"]);u!=null&&a(t,["config"],$v(u,t));const f=r(e,["config"]);return f!=null&&a(t,["config"],Jv(f,t)),t}function Kv(n){const e={},t=r(n,["fps"]);t!=null&&a(e,["fps"],t);const i=r(n,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=r(n,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function Yv(n){const e={},t=r(n,["data"]);t!=null&&a(e,["data"],t);const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Qv(n){const e={},t=r(n,["fileUri"]);t!=null&&a(e,["fileUri"],t);const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Xv(n){const e={},t=r(n,["id"]);t!=null&&a(e,["id"],t);const i=r(n,["args"]);i!=null&&a(e,["args"],i);const o=r(n,["name"]);return o!=null&&a(e,["name"],o),e}function Zv(n){const e={},t=r(n,["videoMetadata"]);t!=null&&a(e,["videoMetadata"],Kv(t));const i=r(n,["thought"]);i!=null&&a(e,["thought"],i);const o=r(n,["inlineData"]);o!=null&&a(e,["inlineData"],Yv(o));const s=r(n,["fileData"]);s!=null&&a(e,["fileData"],Qv(s));const l=r(n,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=r(n,["functionCall"]);u!=null&&a(e,["functionCall"],Xv(u));const f=r(n,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const d=r(n,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=r(n,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const m=r(n,["text"]);return m!=null&&a(e,["text"],m),e}function jv(n){const e={},t=r(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>Zv(s))),a(e,["parts"],o)}const i=r(n,["role"]);return i!=null&&a(e,["role"],i),e}function eI(n){const e={},t=r(n,["citationSources"]);return t!=null&&a(e,["citations"],t),e}function tI(n){const e={},t=r(n,["retrievedUrl"]);t!=null&&a(e,["retrievedUrl"],t);const i=r(n,["urlRetrievalStatus"]);return i!=null&&a(e,["urlRetrievalStatus"],i),e}function nI(n){const e={},t=r(n,["urlMetadata"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>tI(o))),a(e,["urlMetadata"],i)}return e}function iI(n){const e={},t=r(n,["content"]);t!=null&&a(e,["content"],jv(t));const i=r(n,["citationMetadata"]);i!=null&&a(e,["citationMetadata"],eI(i));const o=r(n,["tokenCount"]);o!=null&&a(e,["tokenCount"],o);const s=r(n,["finishReason"]);s!=null&&a(e,["finishReason"],s);const l=r(n,["urlContextMetadata"]);l!=null&&a(e,["urlContextMetadata"],nI(l));const u=r(n,["avgLogprobs"]);u!=null&&a(e,["avgLogprobs"],u);const f=r(n,["groundingMetadata"]);f!=null&&a(e,["groundingMetadata"],f);const d=r(n,["index"]);d!=null&&a(e,["index"],d);const h=r(n,["logprobsResult"]);h!=null&&a(e,["logprobsResult"],h);const m=r(n,["safetyRatings"]);return m!=null&&a(e,["safetyRatings"],m),e}function Vu(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["candidates"]);if(i!=null){let f=i;Array.isArray(f)&&(f=f.map(d=>iI(d))),a(e,["candidates"],f)}const o=r(n,["modelVersion"]);o!=null&&a(e,["modelVersion"],o);const s=r(n,["promptFeedback"]);s!=null&&a(e,["promptFeedback"],s);const l=r(n,["responseId"]);l!=null&&a(e,["responseId"],l);const u=r(n,["usageMetadata"]);return u!=null&&a(e,["usageMetadata"],u),e}function oI(n){const e={},t=r(n,["values"]);return t!=null&&a(e,["values"],t),e}function sI(){return{}}function rI(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["embeddings"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>oI(l))),a(e,["embeddings"],s)}return r(n,["metadata"])!=null&&a(e,["metadata"],sI()),e}function aI(n){const e={},t=r(n,["bytesBase64Encoded"]);t!=null&&a(e,["imageBytes"],Yt(t));const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Gd(n){const e={},t=r(n,["safetyAttributes","categories"]);t!=null&&a(e,["categories"],t);const i=r(n,["safetyAttributes","scores"]);i!=null&&a(e,["scores"],i);const o=r(n,["contentType"]);return o!=null&&a(e,["contentType"],o),e}function lI(n){const e={},t=r(n,["_self"]);t!=null&&a(e,["image"],aI(t));const i=r(n,["raiFilteredReason"]);i!=null&&a(e,["raiFilteredReason"],i);const o=r(n,["_self"]);return o!=null&&a(e,["safetyAttributes"],Gd(o)),e}function uI(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["predictions"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>lI(l))),a(e,["generatedImages"],s)}const o=r(n,["positivePromptSafetyAttributes"]);return o!=null&&a(e,["positivePromptSafetyAttributes"],Gd(o)),e}function cI(n){const e={},t=r(n,["baseModel"]);t!=null&&a(e,["baseModel"],t);const i=r(n,["createTime"]);i!=null&&a(e,["createTime"],i);const o=r(n,["updateTime"]);return o!=null&&a(e,["updateTime"],o),e}function Qs(n){const e={},t=r(n,["name"]);t!=null&&a(e,["name"],t);const i=r(n,["displayName"]);i!=null&&a(e,["displayName"],i);const o=r(n,["description"]);o!=null&&a(e,["description"],o);const s=r(n,["version"]);s!=null&&a(e,["version"],s);const l=r(n,["_self"]);l!=null&&a(e,["tunedModelInfo"],cI(l));const u=r(n,["inputTokenLimit"]);u!=null&&a(e,["inputTokenLimit"],u);const f=r(n,["outputTokenLimit"]);f!=null&&a(e,["outputTokenLimit"],f);const d=r(n,["supportedGenerationMethods"]);return d!=null&&a(e,["supportedActions"],d),e}function dI(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["nextPageToken"]);i!=null&&a(e,["nextPageToken"],i);const o=r(n,["_self"]);if(o!=null){let s=Cd(o);Array.isArray(s)&&(s=s.map(l=>Qs(l))),a(e,["models"],s)}return e}function fI(n){const e={},t=r(n,["sdkHttpResponse"]);return t!=null&&a(e,["sdkHttpResponse"],t),e}function hI(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["totalTokens"]);i!=null&&a(e,["totalTokens"],i);const o=r(n,["cachedContentTokenCount"]);return o!=null&&a(e,["cachedContentTokenCount"],o),e}function pI(n){const e={},t=r(n,["video","uri"]);t!=null&&a(e,["uri"],t);const i=r(n,["video","encodedVideo"]);i!=null&&a(e,["videoBytes"],Yt(i));const o=r(n,["encoding"]);return o!=null&&a(e,["mimeType"],o),e}function mI(n){const e={},t=r(n,["_self"]);return t!=null&&a(e,["video"],pI(t)),e}function gI(n){const e={},t=r(n,["generatedSamples"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(l=>mI(l))),a(e,["generatedVideos"],s)}const i=r(n,["raiMediaFilteredCount"]);i!=null&&a(e,["raiMediaFilteredCount"],i);const o=r(n,["raiMediaFilteredReasons"]);return o!=null&&a(e,["raiMediaFilteredReasons"],o),e}function yI(n){const e={},t=r(n,["name"]);t!=null&&a(e,["name"],t);const i=r(n,["metadata"]);i!=null&&a(e,["metadata"],i);const o=r(n,["done"]);o!=null&&a(e,["done"],o);const s=r(n,["error"]);s!=null&&a(e,["error"],s);const l=r(n,["response","generateVideoResponse"]);return l!=null&&a(e,["response"],gI(l)),e}function _I(n){const e={},t=r(n,["fps"]);t!=null&&a(e,["fps"],t);const i=r(n,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=r(n,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function TI(n){const e={},t=r(n,["displayName"]);t!=null&&a(e,["displayName"],t);const i=r(n,["data"]);i!=null&&a(e,["data"],i);const o=r(n,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function EI(n){const e={},t=r(n,["displayName"]);t!=null&&a(e,["displayName"],t);const i=r(n,["fileUri"]);i!=null&&a(e,["fileUri"],i);const o=r(n,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function vI(n){const e={},t=r(n,["id"]);t!=null&&a(e,["id"],t);const i=r(n,["args"]);i!=null&&a(e,["args"],i);const o=r(n,["name"]);return o!=null&&a(e,["name"],o),e}function II(n){const e={},t=r(n,["videoMetadata"]);t!=null&&a(e,["videoMetadata"],_I(t));const i=r(n,["thought"]);i!=null&&a(e,["thought"],i);const o=r(n,["inlineData"]);o!=null&&a(e,["inlineData"],TI(o));const s=r(n,["fileData"]);s!=null&&a(e,["fileData"],EI(s));const l=r(n,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=r(n,["functionCall"]);u!=null&&a(e,["functionCall"],vI(u));const f=r(n,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const d=r(n,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=r(n,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const m=r(n,["text"]);return m!=null&&a(e,["text"],m),e}function CI(n){const e={},t=r(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>II(s))),a(e,["parts"],o)}const i=r(n,["role"]);return i!=null&&a(e,["role"],i),e}function SI(n){const e={},t=r(n,["citations"]);return t!=null&&a(e,["citations"],t),e}function AI(n){const e={},t=r(n,["retrievedUrl"]);t!=null&&a(e,["retrievedUrl"],t);const i=r(n,["urlRetrievalStatus"]);return i!=null&&a(e,["urlRetrievalStatus"],i),e}function wI(n){const e={},t=r(n,["urlMetadata"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>AI(o))),a(e,["urlMetadata"],i)}return e}function RI(n){const e={},t=r(n,["content"]);t!=null&&a(e,["content"],CI(t));const i=r(n,["citationMetadata"]);i!=null&&a(e,["citationMetadata"],SI(i));const o=r(n,["finishMessage"]);o!=null&&a(e,["finishMessage"],o);const s=r(n,["finishReason"]);s!=null&&a(e,["finishReason"],s);const l=r(n,["urlContextMetadata"]);l!=null&&a(e,["urlContextMetadata"],wI(l));const u=r(n,["avgLogprobs"]);u!=null&&a(e,["avgLogprobs"],u);const f=r(n,["groundingMetadata"]);f!=null&&a(e,["groundingMetadata"],f);const d=r(n,["index"]);d!=null&&a(e,["index"],d);const h=r(n,["logprobsResult"]);h!=null&&a(e,["logprobsResult"],h);const m=r(n,["safetyRatings"]);return m!=null&&a(e,["safetyRatings"],m),e}function Lu(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["candidates"]);if(i!=null){let d=i;Array.isArray(d)&&(d=d.map(h=>RI(h))),a(e,["candidates"],d)}const o=r(n,["createTime"]);o!=null&&a(e,["createTime"],o);const s=r(n,["modelVersion"]);s!=null&&a(e,["modelVersion"],s);const l=r(n,["promptFeedback"]);l!=null&&a(e,["promptFeedback"],l);const u=r(n,["responseId"]);u!=null&&a(e,["responseId"],u);const f=r(n,["usageMetadata"]);return f!=null&&a(e,["usageMetadata"],f),e}function PI(n){const e={},t=r(n,["truncated"]);t!=null&&a(e,["truncated"],t);const i=r(n,["token_count"]);return i!=null&&a(e,["tokenCount"],i),e}function MI(n){const e={},t=r(n,["values"]);t!=null&&a(e,["values"],t);const i=r(n,["statistics"]);return i!=null&&a(e,["statistics"],PI(i)),e}function DI(n){const e={},t=r(n,["billableCharacterCount"]);return t!=null&&a(e,["billableCharacterCount"],t),e}function NI(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["predictions[]","embeddings"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>MI(l))),a(e,["embeddings"],s)}const o=r(n,["metadata"]);return o!=null&&a(e,["metadata"],DI(o)),e}function $d(n){const e={},t=r(n,["gcsUri"]);t!=null&&a(e,["gcsUri"],t);const i=r(n,["bytesBase64Encoded"]);i!=null&&a(e,["imageBytes"],Yt(i));const o=r(n,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function Hd(n){const e={},t=r(n,["safetyAttributes","categories"]);t!=null&&a(e,["categories"],t);const i=r(n,["safetyAttributes","scores"]);i!=null&&a(e,["scores"],i);const o=r(n,["contentType"]);return o!=null&&a(e,["contentType"],o),e}function Oo(n){const e={},t=r(n,["_self"]);t!=null&&a(e,["image"],$d(t));const i=r(n,["raiFilteredReason"]);i!=null&&a(e,["raiFilteredReason"],i);const o=r(n,["_self"]);o!=null&&a(e,["safetyAttributes"],Hd(o));const s=r(n,["prompt"]);return s!=null&&a(e,["enhancedPrompt"],s),e}function kI(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["predictions"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>Oo(l))),a(e,["generatedImages"],s)}const o=r(n,["positivePromptSafetyAttributes"]);return o!=null&&a(e,["positivePromptSafetyAttributes"],Hd(o)),e}function xI(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["predictions"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>Oo(s))),a(e,["generatedImages"],o)}return e}function VI(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["predictions"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>Oo(s))),a(e,["generatedImages"],o)}return e}function LI(n){const e={},t=r(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>Oo(o))),a(e,["generatedImages"],i)}return e}function bI(n){const e={},t=r(n,["label"]);t!=null&&a(e,["label"],t);const i=r(n,["score"]);return i!=null&&a(e,["score"],i),e}function UI(n){const e={},t=r(n,["_self"]);t!=null&&a(e,["mask"],$d(t));const i=r(n,["labels"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>bI(s))),a(e,["labels"],o)}return e}function FI(n){const e={},t=r(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>UI(o))),a(e,["generatedMasks"],i)}return e}function BI(n){const e={},t=r(n,["endpoint"]);t!=null&&a(e,["name"],t);const i=r(n,["deployedModelId"]);return i!=null&&a(e,["deployedModelId"],i),e}function OI(n){const e={},t=r(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&a(e,["baseModel"],t);const i=r(n,["createTime"]);i!=null&&a(e,["createTime"],i);const o=r(n,["updateTime"]);return o!=null&&a(e,["updateTime"],o),e}function qI(n){const e={},t=r(n,["checkpointId"]);t!=null&&a(e,["checkpointId"],t);const i=r(n,["epoch"]);i!=null&&a(e,["epoch"],i);const o=r(n,["step"]);return o!=null&&a(e,["step"],o),e}function Xs(n){const e={},t=r(n,["name"]);t!=null&&a(e,["name"],t);const i=r(n,["displayName"]);i!=null&&a(e,["displayName"],i);const o=r(n,["description"]);o!=null&&a(e,["description"],o);const s=r(n,["versionId"]);s!=null&&a(e,["version"],s);const l=r(n,["deployedModels"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(g=>BI(g))),a(e,["endpoints"],m)}const u=r(n,["labels"]);u!=null&&a(e,["labels"],u);const f=r(n,["_self"]);f!=null&&a(e,["tunedModelInfo"],OI(f));const d=r(n,["defaultCheckpointId"]);d!=null&&a(e,["defaultCheckpointId"],d);const h=r(n,["checkpoints"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(g=>qI(g))),a(e,["checkpoints"],m)}return e}function GI(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["nextPageToken"]);i!=null&&a(e,["nextPageToken"],i);const o=r(n,["_self"]);if(o!=null){let s=Cd(o);Array.isArray(s)&&(s=s.map(l=>Xs(l))),a(e,["models"],s)}return e}function $I(n){const e={},t=r(n,["sdkHttpResponse"]);return t!=null&&a(e,["sdkHttpResponse"],t),e}function HI(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["totalTokens"]);return i!=null&&a(e,["totalTokens"],i),e}function zI(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["tokensInfo"]);return i!=null&&a(e,["tokensInfo"],i),e}function JI(n){const e={},t=r(n,["gcsUri"]);t!=null&&a(e,["uri"],t);const i=r(n,["bytesBase64Encoded"]);i!=null&&a(e,["videoBytes"],Yt(i));const o=r(n,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function WI(n){const e={},t=r(n,["_self"]);return t!=null&&a(e,["video"],JI(t)),e}function KI(n){const e={},t=r(n,["videos"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(l=>WI(l))),a(e,["generatedVideos"],s)}const i=r(n,["raiMediaFilteredCount"]);i!=null&&a(e,["raiMediaFilteredCount"],i);const o=r(n,["raiMediaFilteredReasons"]);return o!=null&&a(e,["raiMediaFilteredReasons"],o),e}function YI(n){const e={},t=r(n,["name"]);t!=null&&a(e,["name"],t);const i=r(n,["metadata"]);i!=null&&a(e,["metadata"],i);const o=r(n,["done"]);o!=null&&a(e,["done"],o);const s=r(n,["error"]);s!=null&&a(e,["error"],s);const l=r(n,["response"]);return l!=null&&a(e,["response"],KI(l)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const QI="Content-Type",XI="X-Server-Timeout",ZI="User-Agent",Zs="x-goog-api-client",jI="1.20.0",eC=`google-genai-sdk/${jI}`,tC="v1beta1",nC="v1beta",bu=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class iC{constructor(e){var t,i;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const o={};this.clientOptions.vertexai?(o.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:tC,o.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(o.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:nC,o.baseUrl="https://generativelanguage.googleapis.com/"),o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const i=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&i.push(e.apiVersion),i.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,i){const o=[this.getRequestUrlInternal(t)];return i&&o.push(this.getBaseResourcePath()),e!==""&&o.push(e),new URL(`${o.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,t,i);if(e.queryParams)for(const[l,u]of Object.entries(e.queryParams))o.searchParams.append(l,String(u));let s={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else s.body=e.body;return s=await this.includeExtraHttpOptionsToRequestInit(s,t,e.abortSignal),this.unaryApiCall(o,s,e.httpMethod)}patchHttpOptions(e,t){const i=JSON.parse(JSON.stringify(e));for(const[o,s]of Object.entries(t))typeof s=="object"?i[o]=Object.assign(Object.assign({},i[o]),s):s!==void 0&&(i[o]=s);return i}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,t,i);(!o.searchParams.has("alt")||o.searchParams.get("alt")!=="sse")&&o.searchParams.set("alt","sse");let s={};return s.body=e.body,s=await this.includeExtraHttpOptionsToRequestInit(s,t,e.abortSignal),this.streamApiCall(o,s,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,i){if(t&&t.timeout||i){const o=new AbortController,s=o.signal;if(t.timeout&&(t==null?void 0:t.timeout)>0){const l=setTimeout(()=>o.abort(),t.timeout);l&&typeof l.unref=="function"&&l.unref()}i&&i.addEventListener("abort",()=>{o.abort()}),e.signal=s}return t&&t.extraBody!==null&&oC(e,t.extraBody),e.headers=await this.getHeadersInternal(t),e}async unaryApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async o=>(await Uu(o),new zs(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}async streamApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async o=>(await Uu(o),this.processStreamResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}processStreamResponse(e){var t;return dn(this,arguments,function*(){const o=(t=e==null?void 0:e.body)===null||t===void 0?void 0:t.getReader(),s=new TextDecoder("utf-8");if(!o)throw new Error("Response body is empty");try{let l="";for(;;){const{done:u,value:f}=yield se(o.read());if(u){if(l.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const d=s.decode(f,{stream:!0});try{const m=JSON.parse(d);if("error"in m){const g=JSON.parse(JSON.stringify(m.error)),T=g.status,w=g.code,M=`got status: ${T}. ${JSON.stringify(m)}`;if(w>=400&&w<600)throw new Fo({message:M,status:w})}}catch(m){if(m.name==="ApiError")throw m}l+=d;let h=l.match(bu);for(;h;){const m=h[1];try{const g=new Response(m,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield se(new zs(g)),l=l.slice(h[0].length),h=l.match(bu)}catch(g){throw new Error(`exception parsing stream chunk ${m}. ${g}`)}}}}finally{o.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(i=>{throw new Error(`exception ${i} sending request`)})}getDefaultHeaders(){const e={},t=eC+" "+this.clientOptions.userAgentExtra;return e[ZI]=t,e[Zs]=t,e[QI]="application/json",e}async getHeadersInternal(e){const t=new Headers;if(e&&e.headers){for(const[i,o]of Object.entries(e.headers))t.append(i,o);e.timeout&&e.timeout>0&&t.append(XI,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(t),t}async uploadFile(e,t){var i;const o={};t!=null&&(o.mimeType=t.mimeType,o.name=t.name,o.displayName=t.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);const s=this.clientOptions.uploader,l=await s.stat(e);o.sizeBytes=String(l.size);const u=(i=t==null?void 0:t.mimeType)!==null&&i!==void 0?i:l.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=u;const f=await this.fetchUploadUrl(o,t);return s.upload(e,f,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t){var i;let o={};t!=null&&t.httpOptions?o=t.httpOptions:o={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const s={file:e},l=await this.request({path:O("upload/v1beta/files",s._url),body:JSON.stringify(s),httpMethod:"POST",httpOptions:o});if(!l||!(l!=null&&l.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const u=(i=l==null?void 0:l.headers)===null||i===void 0?void 0:i["x-goog-upload-url"];if(u===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function Uu(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){const t=n.status;let i;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?i=await n.json():i={error:{message:await n.text(),code:n.status,status:n.statusText}};const o=JSON.stringify(i);throw t>=400&&t<600?new Fo({message:o,status:t}):new Error(o)}}function oC(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{const s=JSON.parse(n.body);if(typeof s=="object"&&s!==null&&!Array.isArray(s))t=s;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function i(s,l){const u=Object.assign({},s);for(const f in l)if(Object.prototype.hasOwnProperty.call(l,f)){const d=l[f],h=u[f];d&&typeof d=="object"&&!Array.isArray(d)&&h&&typeof h=="object"&&!Array.isArray(h)?u[f]=i(h,d):(h&&d&&typeof h!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${f}". Original type: ${typeof h}, New type: ${typeof d}. Overwriting.`),u[f]=d)}return u}const o=i(t,e);n.body=JSON.stringify(o)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const sC="mcp_used/unknown";let rC=!1;function zd(n){for(const e of n)if(aC(e)||typeof e=="object"&&"inputSchema"in e)return!0;return rC}function Jd(n){var e;const t=(e=n[Zs])!==null&&e!==void 0?e:"";n[Zs]=(t+` ${sC}`).trimStart()}function aC(n){return n!==null&&typeof n=="object"&&n instanceof Dr}function lC(n,e=100){return dn(this,arguments,function*(){let i,o=0;for(;o<e;){const s=yield se(n.listTools({cursor:i}));for(const l of s.tools)yield yield se(l),o++;if(!s.nextCursor)break;i=s.nextCursor}})}class Dr{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new Dr(e,t)}async initialize(){var e,t,i,o;if(this.mcpTools.length>0)return;const s={},l=[];for(const h of this.mcpClients)try{for(var u=!0,f=(t=void 0,oi(lC(h))),d;d=await f.next(),e=d.done,!e;u=!0){o=d.value,u=!1;const m=o;l.push(m);const g=m.name;if(s[g])throw new Error(`Duplicate function name ${g} found in MCP tools. Please ensure function names are unique.`);s[g]=h}}catch(m){t={error:m}}finally{try{!u&&!e&&(i=f.return)&&await i.call(f)}finally{if(t)throw t.error}}this.mcpTools=l,this.functionNameToMcpClient=s}async tool(){return await this.initialize(),Cm(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const i of e)if(i.name in this.functionNameToMcpClient){const o=this.functionNameToMcpClient[i.name];let s;this.config.timeout&&(s={timeout:this.config.timeout});const l=await o.callTool({name:i.name,arguments:i.args},void 0,s);t.push({functionResponse:{name:i.name,response:l.isError?{error:l}:l}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function uC(n,e,t){const i=new mm;let o;t.data instanceof Blob?o=JSON.parse(await t.data.text()):o=JSON.parse(t.data);const s=BT(o);Object.assign(i,s),e(i)}class cC{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i}async connect(e){var t,i;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const o=this.apiClient.getWebsocketBaseUrl(),s=this.apiClient.getApiVersion(),l=hC(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),f=`${o}/ws/google.ai.generativelanguage.${s}.GenerativeService.BidiGenerateMusic?key=${u}`;let d=()=>{};const h=new Promise(b=>{d=b}),m=e.callbacks,g=function(){d({})},T=this.apiClient,w={onopen:g,onmessage:b=>{uC(T,m.onmessage,b)},onerror:(t=m==null?void 0:m.onerror)!==null&&t!==void 0?t:function(b){},onclose:(i=m==null?void 0:m.onclose)!==null&&i!==void 0?i:function(b){}},M=this.webSocketFactory.create(f,fC(l),w);M.connect(),await h;const N=te(this.apiClient,e.model),L=Vd({model:N}),V=Ys({setup:L});return M.send(JSON.stringify(V)),new dC(M,this.apiClient)}}class dC{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=b_(e),i=Ld(t);this.conn.send(JSON.stringify({clientContent:i}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=U_(e),i=Ys(t);this.conn.send(JSON.stringify(i))}sendPlaybackControl(e){const t=Ys({playbackControl:e});this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(un.PLAY)}pause(){this.sendPlaybackControl(un.PAUSE)}stop(){this.sendPlaybackControl(un.STOP)}resetContext(){this.sendPlaybackControl(un.RESET_CONTEXT)}close(){this.conn.close()}}function fC(n){const e={};return n.forEach((t,i)=>{e[i]=t}),e}function hC(n){const e=new Headers;for(const[t,i]of Object.entries(n))e.append(t,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const pC="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function mC(n,e,t){const i=new pm;let o;t.data instanceof Blob?o=await t.data.text():t.data instanceof ArrayBuffer?o=new TextDecoder().decode(t.data):o=t.data;const s=JSON.parse(o);if(n.isVertexAI()){const l=ZT(s);Object.assign(i,l)}else{const l=DT(s);Object.assign(i,l)}e(i)}class gC{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i,this.music=new cC(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,i,o,s,l,u;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const f=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let h;const m=this.apiClient.getHeaders();e.config&&e.config.tools&&zd(e.config.tools)&&Jd(m);const g=EC(m);if(this.apiClient.isVertexAI())h=`${f}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(g);else{const E=this.apiClient.getApiKey();let A="BidiGenerateContent",C="key";E!=null&&E.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),A="BidiGenerateContentConstrained",C="access_token"),h=`${f}/ws/google.ai.generativelanguage.${d}.GenerativeService.${A}?${C}=${E}`}let T=()=>{};const w=new Promise(E=>{T=E}),M=e.callbacks,N=function(){var E;(E=M==null?void 0:M.onopen)===null||E===void 0||E.call(M),T({})},L=this.apiClient,V={onopen:N,onmessage:E=>{mC(L,M.onmessage,E)},onerror:(t=M==null?void 0:M.onerror)!==null&&t!==void 0?t:function(E){},onclose:(i=M==null?void 0:M.onclose)!==null&&i!==void 0?i:function(E){}},b=this.webSocketFactory.create(h,TC(g),V);b.connect(),await w;let B=te(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&B.startsWith("publishers/")){const E=this.apiClient.getProject(),A=this.apiClient.getLocation();B=`projects/${E}/locations/${A}/`+B}let q={};this.apiClient.isVertexAI()&&((o=e.config)===null||o===void 0?void 0:o.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[mo.AUDIO]}:e.config.responseModalities=[mo.AUDIO]),!((s=e.config)===null||s===void 0)&&s.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const H=(u=(l=e.config)===null||l===void 0?void 0:l.tools)!==null&&u!==void 0?u:[],S=[];for(const E of H)if(this.isCallableTool(E)){const A=E;S.push(await A.tool())}else S.push(E);S.length>0&&(e.config.tools=S);const v={model:B,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?q=fT(this.apiClient,v):q=k_(this.apiClient,v),delete q.config,b.send(JSON.stringify(q)),new _C(b,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const yC={turnComplete:!0};class _C{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let i=[];try{i=be(t.turns),e.isVertexAI()?i=i.map(o=>Pn(o)):i=i.map(o=>Bo(o))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:i,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let i=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?i=t.functionResponses:i=[t.functionResponses],i.length===0)throw new Error("functionResponses is required.");for(const s of i){if(typeof s!="object"||s===null||!("name"in s)||!("response"in s))throw new Error(`Could not parse function response, type '${typeof s}'.`);if(!e.isVertexAI()&&!("id"in s))throw new Error(pC)}return{toolResponse:{functionResponses:i}}}sendClientContent(e){e=Object.assign(Object.assign({},yC),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:mT(e)}:t={realtimeInput:L_(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function TC(n){const e={};return n.forEach((t,i)=>{e[i]=t}),e}function EC(n){const e=new Headers;for(const[t,i]of Object.entries(n))e.append(t,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Fu=10;function Bu(n){var e,t,i;if(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let o=!1;for(const l of(t=n==null?void 0:n.tools)!==null&&t!==void 0?t:[])if(fn(l)){o=!0;break}if(!o)return!0;const s=(i=n==null?void 0:n.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls;return s&&(s<0||!Number.isInteger(s))||s==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",s),!0):!1}function fn(n){return"callTool"in n&&typeof n.callTool=="function"}function vC(n){var e,t,i;return(i=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(o=>fn(o)))!==null&&i!==void 0?i:!1}function IC(n){var e,t,i;return(i=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(o=>!fn(o)))!==null&&i!==void 0?i:!1}function Ou(n){var e;return!(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class CC extends Kt{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var i,o,s,l,u;const f=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!vC(t)||Bu(t.config))return await this.generateContentInternal(f);if(IC(t))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let d,h;const m=be(f.contents),g=(s=(o=(i=f.config)===null||i===void 0?void 0:i.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&s!==void 0?s:Fu;let T=0;for(;T<g&&(d=await this.generateContentInternal(f),!(!d.functionCalls||d.functionCalls.length===0));){const w=d.candidates[0].content,M=[];for(const N of(u=(l=t.config)===null||l===void 0?void 0:l.tools)!==null&&u!==void 0?u:[])if(fn(N)){const V=await N.callTool(d.functionCalls);M.push(...V)}T++,h={role:"user",parts:M},f.contents=be(f.contents),f.contents.push(w),f.contents.push(h),Ou(f.config)&&(m.push(w),m.push(h))}return Ou(f.config)&&(d.automaticFunctionCallingHistory=m),d},this.generateContentStream=async t=>{if(this.maybeMoveToResponseJsonSchem(t),Bu(t.config)){const i=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(i)}else return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(i=>{var o;let s;const l=[];if(i!=null&&i.generatedImages)for(const f of i.generatedImages)f&&(f!=null&&f.safetyAttributes)&&((o=f==null?void 0:f.safetyAttributes)===null||o===void 0?void 0:o.contentType)==="Positive Prompt"?s=f==null?void 0:f.safetyAttributes:l.push(f);let u;return s?u={generatedImages:l,positivePromptSafetyAttributes:s,sdkHttpResponse:i.sdkHttpResponse}:u={generatedImages:l,sdkHttpResponse:i.sdkHttpResponse},u}),this.list=async t=>{var i;const l={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!l.config.queryBase){if(!((i=l.config)===null||i===void 0)&&i.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");l.config.filter="labels.tune-type:*"}return new Ii(Gt.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(l),l)},this.editImage=async t=>{const i={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(i.referenceImages=t.referenceImages.map(o=>o.toReferenceImageAPI())),await this.editImageInternal(i)},this.upscaleImage=async t=>{let i={numberOfImages:1,mode:"upscale"};t.config&&(i=Object.assign(Object.assign({},i),t.config));const o={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:i};return await this.upscaleImageInternal(o)},this.generateVideos=async t=>{if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,i,o;const s=(t=e.config)===null||t===void 0?void 0:t.tools;if(!s)return e;const l=await Promise.all(s.map(async f=>fn(f)?await f.tool():f)),u={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:l})};if(u.config.tools=l,e.config&&e.config.tools&&zd(e.config.tools)){const f=(o=(i=e.config.httpOptions)===null||i===void 0?void 0:i.headers)!==null&&o!==void 0?o:{};let d=Object.assign({},f);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),Jd(d),u.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:d})}return u}async initAfcToolsMap(e){var t,i,o;const s=new Map;for(const l of(i=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&i!==void 0?i:[])if(fn(l)){const u=l,f=await u.tool();for(const d of(o=f.functionDeclarations)!==null&&o!==void 0?o:[]){if(!d.name)throw new Error("Function declaration name is required.");if(s.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);s.set(d.name,u)}}return s}async processAfcStream(e){var t,i,o;const s=(o=(i=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&o!==void 0?o:Fu;let l=!1,u=0;const f=await this.initAfcToolsMap(e);return(function(d,h,m){var g,T;return dn(this,arguments,function*(){for(var w,M,N,L;u<s;){l&&(u++,l=!1);const q=yield se(d.processParamsMaybeAddMcpUsage(m)),H=yield se(d.generateContentStreamInternal(q)),S=[],v=[];try{for(var V=!0,b=(M=void 0,oi(H)),B;B=yield se(b.next()),w=B.done,!w;V=!0){L=B.value,V=!1;const E=L;if(yield yield se(E),E.candidates&&(!((g=E.candidates[0])===null||g===void 0)&&g.content)){v.push(E.candidates[0].content);for(const A of(T=E.candidates[0].content.parts)!==null&&T!==void 0?T:[])if(u<s&&A.functionCall){if(!A.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(A.functionCall.name)){const C=yield se(h.get(A.functionCall.name).callTool([A.functionCall]));S.push(...C)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${A.functionCall.name}`)}}}}catch(E){M={error:E}}finally{try{!V&&!w&&(N=b.return)&&(yield se(N.call(b)))}finally{if(M)throw M.error}}if(S.length>0){l=!0;const E=new jn;E.candidates=[{content:{role:"user",parts:S}}],yield yield se(E);const A=[];A.push(...v),A.push({role:"user",parts:S});const C=be(m.contents).concat(A);m.contents=C}else break}})})(this,f,e)}async generateContentInternal(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=xu(this.apiClient,e);return u=O("{model}:generateContent",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=Lu(h),g=new jn;return Object.assign(g,m),g})}else{const d=ku(this.apiClient,e);return u=O("{model}:generateContent",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=Vu(h),g=new jn;return Object.assign(g,m),g})}}async generateContentStreamInternal(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=xu(this.apiClient,e);return u=O("{model}:streamGenerateContent?alt=sse",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.requestStream({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),l.then(function(m){return dn(this,arguments,function*(){var g,T,w,M;try{for(var N=!0,L=oi(m),V;V=yield se(L.next()),g=V.done,!g;N=!0){M=V.value,N=!1;const b=M,B=Lu(yield se(b.json()));B.sdkHttpResponse={headers:b.headers};const q=new jn;Object.assign(q,B),yield yield se(q)}}catch(b){T={error:b}}finally{try{!N&&!g&&(w=L.return)&&(yield se(w.call(L)))}finally{if(T)throw T.error}}})})}else{const d=ku(this.apiClient,e);return u=O("{model}:streamGenerateContent?alt=sse",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.requestStream({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),l.then(function(m){return dn(this,arguments,function*(){var g,T,w,M;try{for(var N=!0,L=oi(m),V;V=yield se(L.next()),g=V.done,!g;N=!0){M=V.value,N=!1;const b=M,B=Vu(yield se(b.json()));B.sdkHttpResponse={headers:b.headers};const q=new jn;Object.assign(q,B),yield yield se(q)}}catch(b){T={error:b}}finally{try{!N&&!g&&(w=L.return)&&(yield se(w.call(L)))}finally{if(T)throw T.error}}})})}}async embedContent(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=pv(this.apiClient,e);return u=O("{model}:predict",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=NI(h),g=new fu;return Object.assign(g,m),g})}else{const d=AE(this.apiClient,e);return u=O("{model}:batchEmbedContents",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=rI(h),g=new fu;return Object.assign(g,m),g})}}async generateImagesInternal(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=gv(this.apiClient,e);return u=O("{model}:predict",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=kI(h),g=new hu;return Object.assign(g,m),g})}else{const d=RE(this.apiClient,e);return u=O("{model}:predict",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=uI(h),g=new hu;return Object.assign(g,m),g})}}async editImageInternal(e){var t,i;let o,s="",l={};if(this.apiClient.isVertexAI()){const u=Cv(this.apiClient,e);return s=O("{model}:predict",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const d=xI(f),h=new rm;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,i;let o,s="",l={};if(this.apiClient.isVertexAI()){const u=Av(this.apiClient,e);return s=O("{model}:predict",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const d=VI(f),h=new am;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,i;let o,s="",l={};if(this.apiClient.isVertexAI()){const u=Mv(this.apiClient,e);return s=O("{model}:predict",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>{const d=LI(f),h=new lm;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,i;let o,s="",l={};if(this.apiClient.isVertexAI()){const u=xv(this.apiClient,e);return s=O("{model}:predict",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>{const d=FI(f),h=new um;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=Vv(this.apiClient,e);return u=O("{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),l.then(h=>Xs(h))}else{const d=PE(this.apiClient,e);return u=O("{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),l.then(h=>Qs(h))}}async listInternal(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=bv(this.apiClient,e);return u=O("{models_url}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=GI(h),g=new pu;return Object.assign(g,m),g})}else{const d=DE(this.apiClient,e);return u=O("{models_url}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=dI(h),g=new pu;return Object.assign(g,m),g})}}async update(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=Fv(this.apiClient,e);return u=O("{model}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),l.then(h=>Xs(h))}else{const d=kE(this.apiClient,e);return u=O("{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),l.then(h=>Qs(h))}}async delete(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=Bv(this.apiClient,e);return u=O("{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=$I(h),g=new mu;return Object.assign(g,m),g})}else{const d=xE(this.apiClient,e);return u=O("{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=fI(h),g=new mu;return Object.assign(g,m),g})}}async countTokens(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=qv(this.apiClient,e);return u=O("{model}:countTokens",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=HI(h),g=new gu;return Object.assign(g,m),g})}else{const d=LE(this.apiClient,e);return u=O("{model}:countTokens",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=hI(h),g=new gu;return Object.assign(g,m),g})}}async computeTokens(e){var t,i;let o,s="",l={};if(this.apiClient.isVertexAI()){const u=Gv(this.apiClient,e);return s=O("{model}:computeTokens",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const d=zI(f),h=new cm;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=Wv(this.apiClient,e);return u=O("{model}:predictLongRunning",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),l.then(h=>{const m=YI(h),g=new go;return Object.assign(g,m),g})}else{const d=FE(this.apiClient,e);return u=O("{model}:predictLongRunning",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),l.then(h=>{const m=yI(h),g=new go;return Object.assign(g,m),g})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class SC extends Kt{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=t.name.split("/operations/")[0];let s;i&&"httpOptions"in i&&(s=i.httpOptions);const l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:o,config:{httpOptions:s}});return t._fromAPIResponse({apiResponse:l,isVertexAI:!0})}else{const o=await this.getVideosOperationInternal({operationName:t.name,config:i});return t._fromAPIResponse({apiResponse:o,isVertexAI:!1})}}async get(e){const t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=t.name.split("/operations/")[0];let s;i&&"httpOptions"in i&&(s=i.httpOptions);const l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:o,config:{httpOptions:s}});return t._fromAPIResponse({apiResponse:l,isVertexAI:!0})}else{const o=await this.getVideosOperationInternal({operationName:t.name,config:i});return t._fromAPIResponse({apiResponse:o,isVertexAI:!1})}}async getVideosOperationInternal(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=Xp(e);return u=O("{operationName}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),l}else{const d=Yp(e);return u=O("{operationName}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),l}}async fetchPredictVideosOperationInternal(e){var t,i;let o,s="",l={};if(this.apiClient.isVertexAI()){const u=Qp(e);return s=O("{resourceName}:fetchPredictOperation",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function AC(n){const e={},t=r(n,["voiceName"]);return t!=null&&a(e,["voiceName"],t),e}function Wd(n){const e={},t=r(n,["prebuiltVoiceConfig"]);return t!=null&&a(e,["prebuiltVoiceConfig"],AC(t)),e}function wC(n){const e={},t=r(n,["speaker"]);t!=null&&a(e,["speaker"],t);const i=r(n,["voiceConfig"]);return i!=null&&a(e,["voiceConfig"],Wd(i)),e}function RC(n){const e={},t=r(n,["speakerVoiceConfigs"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>wC(o))),a(e,["speakerVoiceConfigs"],i)}return e}function PC(n){const e={},t=r(n,["voiceConfig"]);t!=null&&a(e,["voiceConfig"],Wd(t));const i=r(n,["multiSpeakerVoiceConfig"]);i!=null&&a(e,["multiSpeakerVoiceConfig"],RC(i));const o=r(n,["languageCode"]);return o!=null&&a(e,["languageCode"],o),e}function MC(n){const e={},t=r(n,["fps"]);t!=null&&a(e,["fps"],t);const i=r(n,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=r(n,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function DC(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["data"]);t!=null&&a(e,["data"],t);const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function NC(n){const e={};if(r(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=r(n,["fileUri"]);t!=null&&a(e,["fileUri"],t);const i=r(n,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function kC(n){const e={},t=r(n,["id"]);t!=null&&a(e,["id"],t);const i=r(n,["args"]);i!=null&&a(e,["args"],i);const o=r(n,["name"]);return o!=null&&a(e,["name"],o),e}function xC(n){const e={},t=r(n,["videoMetadata"]);t!=null&&a(e,["videoMetadata"],MC(t));const i=r(n,["thought"]);i!=null&&a(e,["thought"],i);const o=r(n,["inlineData"]);o!=null&&a(e,["inlineData"],DC(o));const s=r(n,["fileData"]);s!=null&&a(e,["fileData"],NC(s));const l=r(n,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=r(n,["functionCall"]);u!=null&&a(e,["functionCall"],kC(u));const f=r(n,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const d=r(n,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=r(n,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const m=r(n,["text"]);return m!=null&&a(e,["text"],m),e}function VC(n){const e={},t=r(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>xC(s))),a(e,["parts"],o)}const i=r(n,["role"]);return i!=null&&a(e,["role"],i),e}function LC(n){const e={},t=r(n,["behavior"]);t!=null&&a(e,["behavior"],t);const i=r(n,["description"]);i!=null&&a(e,["description"],i);const o=r(n,["name"]);o!=null&&a(e,["name"],o);const s=r(n,["parameters"]);s!=null&&a(e,["parameters"],s);const l=r(n,["parametersJsonSchema"]);l!=null&&a(e,["parametersJsonSchema"],l);const u=r(n,["response"]);u!=null&&a(e,["response"],u);const f=r(n,["responseJsonSchema"]);return f!=null&&a(e,["responseJsonSchema"],f),e}function bC(n){const e={},t=r(n,["startTime"]);t!=null&&a(e,["startTime"],t);const i=r(n,["endTime"]);return i!=null&&a(e,["endTime"],i),e}function UC(n){const e={},t=r(n,["timeRangeFilter"]);if(t!=null&&a(e,["timeRangeFilter"],bC(t)),r(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function FC(n){const e={},t=r(n,["mode"]);t!=null&&a(e,["mode"],t);const i=r(n,["dynamicThreshold"]);return i!=null&&a(e,["dynamicThreshold"],i),e}function BC(n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&a(e,["dynamicRetrievalConfig"],FC(t)),e}function OC(){return{}}function qC(n){const e={},t=r(n,["environment"]);return t!=null&&a(e,["environment"],t),e}function GC(n){const e={},t=r(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(d=>LC(d))),a(e,["functionDeclarations"],f)}if(r(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=r(n,["googleSearch"]);i!=null&&a(e,["googleSearch"],UC(i));const o=r(n,["googleSearchRetrieval"]);if(o!=null&&a(e,["googleSearchRetrieval"],BC(o)),r(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");r(n,["urlContext"])!=null&&a(e,["urlContext"],OC());const l=r(n,["computerUse"]);l!=null&&a(e,["computerUse"],qC(l));const u=r(n,["codeExecution"]);return u!=null&&a(e,["codeExecution"],u),e}function $C(n){const e={},t=r(n,["handle"]);if(t!=null&&a(e,["handle"],t),r(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function qu(){return{}}function HC(n){const e={},t=r(n,["disabled"]);t!=null&&a(e,["disabled"],t);const i=r(n,["startOfSpeechSensitivity"]);i!=null&&a(e,["startOfSpeechSensitivity"],i);const o=r(n,["endOfSpeechSensitivity"]);o!=null&&a(e,["endOfSpeechSensitivity"],o);const s=r(n,["prefixPaddingMs"]);s!=null&&a(e,["prefixPaddingMs"],s);const l=r(n,["silenceDurationMs"]);return l!=null&&a(e,["silenceDurationMs"],l),e}function zC(n){const e={},t=r(n,["automaticActivityDetection"]);t!=null&&a(e,["automaticActivityDetection"],HC(t));const i=r(n,["activityHandling"]);i!=null&&a(e,["activityHandling"],i);const o=r(n,["turnCoverage"]);return o!=null&&a(e,["turnCoverage"],o),e}function JC(n){const e={},t=r(n,["targetTokens"]);return t!=null&&a(e,["targetTokens"],t),e}function WC(n){const e={},t=r(n,["triggerTokens"]);t!=null&&a(e,["triggerTokens"],t);const i=r(n,["slidingWindow"]);return i!=null&&a(e,["slidingWindow"],JC(i)),e}function KC(n){const e={},t=r(n,["proactiveAudio"]);return t!=null&&a(e,["proactiveAudio"],t),e}function YC(n,e){const t={},i=r(n,["generationConfig"]);e!==void 0&&i!=null&&a(e,["setup","generationConfig"],i);const o=r(n,["responseModalities"]);e!==void 0&&o!=null&&a(e,["setup","generationConfig","responseModalities"],o);const s=r(n,["temperature"]);e!==void 0&&s!=null&&a(e,["setup","generationConfig","temperature"],s);const l=r(n,["topP"]);e!==void 0&&l!=null&&a(e,["setup","generationConfig","topP"],l);const u=r(n,["topK"]);e!==void 0&&u!=null&&a(e,["setup","generationConfig","topK"],u);const f=r(n,["maxOutputTokens"]);e!==void 0&&f!=null&&a(e,["setup","generationConfig","maxOutputTokens"],f);const d=r(n,["mediaResolution"]);e!==void 0&&d!=null&&a(e,["setup","generationConfig","mediaResolution"],d);const h=r(n,["seed"]);e!==void 0&&h!=null&&a(e,["setup","generationConfig","seed"],h);const m=r(n,["speechConfig"]);e!==void 0&&m!=null&&a(e,["setup","generationConfig","speechConfig"],PC(Pr(m)));const g=r(n,["enableAffectiveDialog"]);e!==void 0&&g!=null&&a(e,["setup","generationConfig","enableAffectiveDialog"],g);const T=r(n,["systemInstruction"]);e!==void 0&&T!=null&&a(e,["setup","systemInstruction"],VC(Pe(T)));const w=r(n,["tools"]);if(e!==void 0&&w!=null){let q=wn(w);Array.isArray(q)&&(q=q.map(H=>GC(An(H)))),a(e,["setup","tools"],q)}const M=r(n,["sessionResumption"]);e!==void 0&&M!=null&&a(e,["setup","sessionResumption"],$C(M));const N=r(n,["inputAudioTranscription"]);e!==void 0&&N!=null&&a(e,["setup","inputAudioTranscription"],qu());const L=r(n,["outputAudioTranscription"]);e!==void 0&&L!=null&&a(e,["setup","outputAudioTranscription"],qu());const V=r(n,["realtimeInputConfig"]);e!==void 0&&V!=null&&a(e,["setup","realtimeInputConfig"],zC(V));const b=r(n,["contextWindowCompression"]);e!==void 0&&b!=null&&a(e,["setup","contextWindowCompression"],WC(b));const B=r(n,["proactivity"]);return e!==void 0&&B!=null&&a(e,["setup","proactivity"],KC(B)),t}function QC(n,e){const t={},i=r(e,["model"]);i!=null&&a(t,["setup","model"],te(n,i));const o=r(e,["config"]);return o!=null&&a(t,["config"],YC(o,t)),t}function XC(n,e,t){const i={},o=r(e,["expireTime"]);t!==void 0&&o!=null&&a(t,["expireTime"],o);const s=r(e,["newSessionExpireTime"]);t!==void 0&&s!=null&&a(t,["newSessionExpireTime"],s);const l=r(e,["uses"]);t!==void 0&&l!=null&&a(t,["uses"],l);const u=r(e,["liveConnectConstraints"]);t!==void 0&&u!=null&&a(t,["bidiGenerateContentSetup"],QC(n,u));const f=r(e,["lockAdditionalFields"]);return t!==void 0&&f!=null&&a(t,["fieldMask"],f),i}function ZC(n,e){const t={},i=r(e,["config"]);return i!=null&&a(t,["config"],XC(n,i,t)),t}function jC(n){const e={},t=r(n,["name"]);return t!=null&&a(e,["name"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function eS(n){const e=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const i=n[t];if(typeof i=="object"&&i!=null&&Object.keys(i).length>0){const o=Object.keys(i).map(s=>`${t}.${s}`);e.push(...o)}else e.push(t)}return e.join(",")}function tS(n,e){let t=null;const i=n.bidiGenerateContentSetup;if(typeof i=="object"&&i!==null&&"setup"in i){const s=i.setup;typeof s=="object"&&s!==null?(n.bidiGenerateContentSetup=s,t=s):delete n.bidiGenerateContentSetup}else i!==void 0&&delete n.bidiGenerateContentSetup;const o=n.fieldMask;if(t){const s=eS(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)s?n.fieldMask=s:delete n.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&o!==null&&Array.isArray(o)&&o.length>0){const l=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let u=[];o.length>0&&(u=o.map(d=>l.includes(d)?`generationConfig.${d}`:d));const f=[];s&&f.push(s),u.length>0&&f.push(...u),f.length>0?n.fieldMask=f.join(","):delete n.fieldMask}else delete n.fieldMask}else o!==null&&Array.isArray(o)&&o.length>0?n.fieldMask=o.join(","):delete n.fieldMask;return n}class nS extends Kt{constructor(e){super(),this.apiClient=e}async create(e){var t,i;let o,s="",l={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const u=ZC(this.apiClient,e);s=O("auth_tokens",u._url),l=u._query,delete u.config,delete u._url,delete u._query;const f=tS(u,e.config);return o=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>jC(d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function iS(n){const e={},t=r(n,["name"]);t!=null&&a(e,["_url","name"],t);const i=r(n,["config"]);return i!=null&&a(e,["config"],i),e}function oS(n,e){const t={},i=r(n,["pageSize"]);e!==void 0&&i!=null&&a(e,["_query","pageSize"],i);const o=r(n,["pageToken"]);e!==void 0&&o!=null&&a(e,["_query","pageToken"],o);const s=r(n,["filter"]);return e!==void 0&&s!=null&&a(e,["_query","filter"],s),t}function sS(n){const e={},t=r(n,["config"]);return t!=null&&a(e,["config"],oS(t,e)),e}function rS(n){const e={},t=r(n,["name"]);t!=null&&a(e,["_url","name"],t);const i=r(n,["config"]);return i!=null&&a(e,["config"],i),e}function aS(n){const e={},t=r(n,["textInput"]);t!=null&&a(e,["textInput"],t);const i=r(n,["output"]);return i!=null&&a(e,["output"],i),e}function lS(n){const e={};if(r(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(r(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const t=r(n,["examples"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>aS(o))),a(e,["examples","examples"],i)}return e}function uS(n,e){const t={};if(r(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=r(n,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&a(e,["displayName"],i),r(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=r(n,["epochCount"]);e!==void 0&&o!=null&&a(e,["tuningTask","hyperparameters","epochCount"],o);const s=r(n,["learningRateMultiplier"]);if(s!=null&&a(t,["tuningTask","hyperparameters","learningRateMultiplier"],s),r(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(r(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(r(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const l=r(n,["batchSize"]);e!==void 0&&l!=null&&a(e,["tuningTask","hyperparameters","batchSize"],l);const u=r(n,["learningRate"]);if(e!==void 0&&u!=null&&a(e,["tuningTask","hyperparameters","learningRate"],u),r(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");return t}function cS(n){const e={},t=r(n,["baseModel"]);t!=null&&a(e,["baseModel"],t);const i=r(n,["preTunedModel"]);i!=null&&a(e,["preTunedModel"],i);const o=r(n,["trainingDataset"]);o!=null&&a(e,["tuningTask","trainingData"],lS(o));const s=r(n,["config"]);return s!=null&&a(e,["config"],uS(s,e)),e}function dS(n){const e={},t=r(n,["name"]);t!=null&&a(e,["_url","name"],t);const i=r(n,["config"]);return i!=null&&a(e,["config"],i),e}function fS(n,e){const t={},i=r(n,["pageSize"]);e!==void 0&&i!=null&&a(e,["_query","pageSize"],i);const o=r(n,["pageToken"]);e!==void 0&&o!=null&&a(e,["_query","pageToken"],o);const s=r(n,["filter"]);return e!==void 0&&s!=null&&a(e,["_query","filter"],s),t}function hS(n){const e={},t=r(n,["config"]);return t!=null&&a(e,["config"],fS(t,e)),e}function pS(n){const e={},t=r(n,["name"]);t!=null&&a(e,["_url","name"],t);const i=r(n,["config"]);return i!=null&&a(e,["config"],i),e}function mS(n,e){const t={},i=r(n,["gcsUri"]);e!==void 0&&i!=null&&a(e,["supervisedTuningSpec","trainingDatasetUri"],i);const o=r(n,["vertexDatasetResource"]);if(e!==void 0&&o!=null&&a(e,["supervisedTuningSpec","trainingDatasetUri"],o),r(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return t}function gS(n,e){const t={},i=r(n,["gcsUri"]);i!=null&&a(t,["validationDatasetUri"],i);const o=r(n,["vertexDatasetResource"]);return e!==void 0&&o!=null&&a(e,["supervisedTuningSpec","trainingDatasetUri"],o),t}function yS(n,e){const t={},i=r(n,["validationDataset"]);e!==void 0&&i!=null&&a(e,["supervisedTuningSpec"],gS(i,t));const o=r(n,["tunedModelDisplayName"]);e!==void 0&&o!=null&&a(e,["tunedModelDisplayName"],o);const s=r(n,["description"]);e!==void 0&&s!=null&&a(e,["description"],s);const l=r(n,["epochCount"]);e!==void 0&&l!=null&&a(e,["supervisedTuningSpec","hyperParameters","epochCount"],l);const u=r(n,["learningRateMultiplier"]);e!==void 0&&u!=null&&a(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],u);const f=r(n,["exportLastCheckpointOnly"]);e!==void 0&&f!=null&&a(e,["supervisedTuningSpec","exportLastCheckpointOnly"],f);const d=r(n,["preTunedModelCheckpointId"]);d!=null&&a(t,["preTunedModel","checkpointId"],d);const h=r(n,["adapterSize"]);if(e!==void 0&&h!=null&&a(e,["supervisedTuningSpec","hyperParameters","adapterSize"],h),r(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(r(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const m=r(n,["labels"]);return e!==void 0&&m!=null&&a(e,["labels"],m),t}function _S(n){const e={},t=r(n,["baseModel"]);t!=null&&a(e,["baseModel"],t);const i=r(n,["preTunedModel"]);i!=null&&a(e,["preTunedModel"],i);const o=r(n,["trainingDataset"]);o!=null&&a(e,["supervisedTuningSpec","trainingDatasetUri"],mS(o,e));const s=r(n,["config"]);return s!=null&&a(e,["config"],yS(s,e)),e}function TS(n){const e={},t=r(n,["name"]);t!=null&&a(e,["model"],t);const i=r(n,["name"]);return i!=null&&a(e,["endpoint"],i),e}function Kd(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["name"]);i!=null&&a(e,["name"],i);const o=r(n,["state"]);o!=null&&a(e,["state"],Ed(o));const s=r(n,["createTime"]);s!=null&&a(e,["createTime"],s);const l=r(n,["tuningTask","startTime"]);l!=null&&a(e,["startTime"],l);const u=r(n,["tuningTask","completeTime"]);u!=null&&a(e,["endTime"],u);const f=r(n,["updateTime"]);f!=null&&a(e,["updateTime"],f);const d=r(n,["description"]);d!=null&&a(e,["description"],d);const h=r(n,["baseModel"]);h!=null&&a(e,["baseModel"],h);const m=r(n,["_self"]);m!=null&&a(e,["tunedModel"],TS(m));const g=r(n,["customBaseModel"]);g!=null&&a(e,["customBaseModel"],g);const T=r(n,["experiment"]);T!=null&&a(e,["experiment"],T);const w=r(n,["labels"]);w!=null&&a(e,["labels"],w);const M=r(n,["outputUri"]);M!=null&&a(e,["outputUri"],M);const N=r(n,["pipelineJob"]);N!=null&&a(e,["pipelineJob"],N);const L=r(n,["serviceAccount"]);L!=null&&a(e,["serviceAccount"],L);const V=r(n,["tunedModelDisplayName"]);return V!=null&&a(e,["tunedModelDisplayName"],V),e}function ES(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["nextPageToken"]);i!=null&&a(e,["nextPageToken"],i);const o=r(n,["tunedModels"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>Kd(l))),a(e,["tuningJobs"],s)}return e}function vS(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["name"]);i!=null&&a(e,["name"],i);const o=r(n,["metadata"]);o!=null&&a(e,["metadata"],o);const s=r(n,["done"]);s!=null&&a(e,["done"],s);const l=r(n,["error"]);return l!=null&&a(e,["error"],l),e}function IS(n){const e={},t=r(n,["checkpointId"]);t!=null&&a(e,["checkpointId"],t);const i=r(n,["epoch"]);i!=null&&a(e,["epoch"],i);const o=r(n,["step"]);o!=null&&a(e,["step"],o);const s=r(n,["endpoint"]);return s!=null&&a(e,["endpoint"],s),e}function CS(n){const e={},t=r(n,["model"]);t!=null&&a(e,["model"],t);const i=r(n,["endpoint"]);i!=null&&a(e,["endpoint"],i);const o=r(n,["checkpoints"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>IS(l))),a(e,["checkpoints"],s)}return e}function js(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["name"]);i!=null&&a(e,["name"],i);const o=r(n,["state"]);o!=null&&a(e,["state"],Ed(o));const s=r(n,["createTime"]);s!=null&&a(e,["createTime"],s);const l=r(n,["startTime"]);l!=null&&a(e,["startTime"],l);const u=r(n,["endTime"]);u!=null&&a(e,["endTime"],u);const f=r(n,["updateTime"]);f!=null&&a(e,["updateTime"],f);const d=r(n,["error"]);d!=null&&a(e,["error"],d);const h=r(n,["description"]);h!=null&&a(e,["description"],h);const m=r(n,["baseModel"]);m!=null&&a(e,["baseModel"],m);const g=r(n,["tunedModel"]);g!=null&&a(e,["tunedModel"],CS(g));const T=r(n,["preTunedModel"]);T!=null&&a(e,["preTunedModel"],T);const w=r(n,["supervisedTuningSpec"]);w!=null&&a(e,["supervisedTuningSpec"],w);const M=r(n,["tuningDataStats"]);M!=null&&a(e,["tuningDataStats"],M);const N=r(n,["encryptionSpec"]);N!=null&&a(e,["encryptionSpec"],N);const L=r(n,["partnerModelTuningSpec"]);L!=null&&a(e,["partnerModelTuningSpec"],L);const V=r(n,["customBaseModel"]);V!=null&&a(e,["customBaseModel"],V);const b=r(n,["experiment"]);b!=null&&a(e,["experiment"],b);const B=r(n,["labels"]);B!=null&&a(e,["labels"],B);const q=r(n,["outputUri"]);q!=null&&a(e,["outputUri"],q);const H=r(n,["pipelineJob"]);H!=null&&a(e,["pipelineJob"],H);const S=r(n,["serviceAccount"]);S!=null&&a(e,["serviceAccount"],S);const v=r(n,["tunedModelDisplayName"]);return v!=null&&a(e,["tunedModelDisplayName"],v),e}function SS(n){const e={},t=r(n,["sdkHttpResponse"]);t!=null&&a(e,["sdkHttpResponse"],t);const i=r(n,["nextPageToken"]);i!=null&&a(e,["nextPageToken"],i);const o=r(n,["tuningJobs"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>js(l))),a(e,["tuningJobs"],s)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class AS extends Kt{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new Ii(Gt.PAGED_ITEM_TUNING_JOBS,i=>this.listInternal(i),await this.listInternal(t),t),this.tune=async t=>{if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){const i={tunedModelName:t.baseModel},o=Object.assign(Object.assign({},t),{preTunedModel:i});return o.baseModel=void 0,await this.tuneInternal(o)}else{const i=Object.assign({},t);return await this.tuneInternal(i)}else{const i=Object.assign({},t),o=await this.tuneMldevInternal(i);let s="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?s=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(s=o.name.split("/operations/")[0]),{name:s,state:Hs.JOB_STATE_QUEUED}}}}async getInternal(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=dS(e);return u=O("{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>js(h))}else{const d=iS(e);return u=O("{name}",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>Kd(h))}}async listInternal(e){var t,i,o,s;let l,u="",f={};if(this.apiClient.isVertexAI()){const d=hS(e);return u=O("tuningJobs",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=SS(h),g=new yu;return Object.assign(g,m),g})}else{const d=sS(e);return u=O("tunedModels",d._url),f=d._query,delete d.config,delete d._url,delete d._query,l=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),l.then(h=>{const m=ES(h),g=new yu;return Object.assign(g,m),g})}}async cancel(e){var t,i,o,s;let l="",u={};if(this.apiClient.isVertexAI()){const f=pS(e);l=O("{name}:cancel",f._url),u=f._query,delete f.config,delete f._url,delete f._query,await this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}else{const f=rS(e);l=O("{name}:cancel",f._url),u=f._query,delete f.config,delete f._url,delete f._query,await this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async tuneInternal(e){var t,i;let o,s="",l={};if(this.apiClient.isVertexAI()){const u=_S(e);return s=O("tuningJobs",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>js(f))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,i;let o,s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=cS(e);return s=O("tunedModels",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>vS(f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class wS{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const RS=1024*1024*8,PS=3,MS=1e3,DS=2,Ms="x-goog-upload-status";async function NS(n,e,t){var i,o,s;let l=0,u=0,f=new zs(new Response),d="upload";for(l=n.size;u<l;){const m=Math.min(RS,l-u),g=n.slice(u,u+m);u+m>=l&&(d+=", finalize");let T=0,w=MS;for(;T<PS&&(f=await t.request({path:"",body:g,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(u),"Content-Length":String(m)}}}),!(!((i=f==null?void 0:f.headers)===null||i===void 0)&&i[Ms]));)T++,await xS(w),w=w*DS;if(u+=m,((o=f==null?void 0:f.headers)===null||o===void 0?void 0:o[Ms])!=="active")break;if(l<=u)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const h=await(f==null?void 0:f.json());if(((s=f==null?void 0:f.headers)===null||s===void 0?void 0:s[Ms])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return h.file}async function kS(n){return{size:n.size,type:n.type}}function xS(n){return new Promise(e=>setTimeout(e,n))}class VS{async upload(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await NS(e,t,i)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await kS(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class LS{create(e,t,i){return new bS(e,t,i)}}class bS{constructor(e,t,i){this.url=e,this.headers=t,this.callbacks=i}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Gu="x-goog-api-key";class US{constructor(e){this.apiKey=e}async addAuthHeaders(e){if(e.get(Gu)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(Gu,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const FS="gl-node/";class $u{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const i=Kp(e.httpOptions,e.vertexai,void 0,void 0);i&&(e.httpOptions?e.httpOptions.baseUrl=i:e.httpOptions={baseUrl:i}),this.apiVersion=e.apiVersion;const o=new US(this.apiKey);this.apiClient=new iC({auth:o,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:FS+"web",uploader:new VS,downloader:new wS}),this.models=new CC(this.apiClient),this.live=new gC(this.apiClient,o,new LS),this.batches=new Bg(this.apiClient),this.chats=new Wy(this.models,this.apiClient),this.caches=new Hy(this.apiClient),this.files=new r_(this.apiClient),this.operations=new SC(this.apiClient),this.authTokens=new nS(this.apiClient),this.tunings=new AS(this.apiClient)}}const BS=()=>{};var Hu={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yd=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let o=n.charCodeAt(i);o<128?e[t++]=o:o<2048?(e[t++]=o>>6|192,e[t++]=o&63|128):(o&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(o=65536+((o&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=o>>18|240,e[t++]=o>>12&63|128,e[t++]=o>>6&63|128,e[t++]=o&63|128):(e[t++]=o>>12|224,e[t++]=o>>6&63|128,e[t++]=o&63|128)}return e},OS=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const o=n[t++];if(o<128)e[i++]=String.fromCharCode(o);else if(o>191&&o<224){const s=n[t++];e[i++]=String.fromCharCode((o&31)<<6|s&63)}else if(o>239&&o<365){const s=n[t++],l=n[t++],u=n[t++],f=((o&7)<<18|(s&63)<<12|(l&63)<<6|u&63)-65536;e[i++]=String.fromCharCode(55296+(f>>10)),e[i++]=String.fromCharCode(56320+(f&1023))}else{const s=n[t++],l=n[t++];e[i++]=String.fromCharCode((o&15)<<12|(s&63)<<6|l&63)}}return e.join("")},Qd={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let o=0;o<n.length;o+=3){const s=n[o],l=o+1<n.length,u=l?n[o+1]:0,f=o+2<n.length,d=f?n[o+2]:0,h=s>>2,m=(s&3)<<4|u>>4;let g=(u&15)<<2|d>>6,T=d&63;f||(T=64,l||(g=64)),i.push(t[h],t[m],t[g],t[T])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Yd(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):OS(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let o=0;o<n.length;){const s=t[n.charAt(o++)],u=o<n.length?t[n.charAt(o)]:0;++o;const d=o<n.length?t[n.charAt(o)]:64;++o;const m=o<n.length?t[n.charAt(o)]:64;if(++o,s==null||u==null||d==null||m==null)throw new qS;const g=s<<2|u>>4;if(i.push(g),d!==64){const T=u<<4&240|d>>2;if(i.push(T),m!==64){const w=d<<6&192|m;i.push(w)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class qS extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const GS=function(n){const e=Yd(n);return Qd.encodeByteArray(e,!0)},_o=function(n){return GS(n).replace(/\./g,"")},Xd=function(n){try{return Qd.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $S(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HS=()=>$S().__FIREBASE_DEFAULTS__,zS=()=>{if(typeof process>"u"||typeof Hu>"u")return;const n=Hu.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},JS=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Xd(n[1]);return e&&JSON.parse(e)},qo=()=>{try{return BS()||HS()||zS()||JS()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Zd=n=>{var e,t;return(t=(e=qo())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},WS=n=>{const e=Zd(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},jd=()=>{var n;return(n=qo())==null?void 0:n.config},ef=n=>{var e;return(e=qo())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KS{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function tf(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YS(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",o=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${i}`,aud:i,iat:o,exp:o+3600,auth_time:o,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...n};return[_o(JSON.stringify(t)),_o(JSON.stringify(l)),""].join(".")}const si={};function QS(){const n={prod:[],emulator:[]};for(const e of Object.keys(si))si[e]?n.emulator.push(e):n.prod.push(e);return n}function XS(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let zu=!1;function nf(n,e){if(typeof window>"u"||typeof document>"u"||!Mn(window.location.host)||si[n]===e||si[n]||zu)return;si[n]=e;function t(g){return`__firebase__banner__${g}`}const i="__firebase__banner",s=QS().prod.length>0;function l(){const g=document.getElementById(i);g&&g.remove()}function u(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function f(g,T){g.setAttribute("width","24"),g.setAttribute("id",T),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function d(){const g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{zu=!0,l()},g}function h(g,T){g.setAttribute("id",T),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function m(){const g=XS(i),T=t("text"),w=document.getElementById(T)||document.createElement("span"),M=t("learnmore"),N=document.getElementById(M)||document.createElement("a"),L=t("preprendIcon"),V=document.getElementById(L)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){const b=g.element;u(b),h(N,M);const B=d();f(V,L),b.append(V,w,N,B),document.body.appendChild(b)}s?(w.innerText="Preview backend disconnected.",V.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(V.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,w.innerText="Preview backend running in this workspace."),w.setAttribute("id",T)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Me(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ZS(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Me())}function jS(){var e;const n=(e=qo())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function eA(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function tA(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function nA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function iA(){const n=Me();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function oA(){return!jS()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function sA(){try{return typeof indexedDB=="object"}catch{return!1}}function rA(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",o=self.indexedDB.open(i);o.onsuccess=()=>{o.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},o.onupgradeneeded=()=>{t=!1},o.onerror=()=>{var s;e(((s=o.error)==null?void 0:s.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aA="FirebaseError";class ut extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=aA,Object.setPrototypeOf(this,ut.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ci.prototype.create)}}class Ci{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},o=`${this.service}/${e}`,s=this.errors[e],l=s?lA(s,i):"Error",u=`${this.serviceName}: ${l} (${o}).`;return new ut(o,u,i)}}function lA(n,e){return n.replace(uA,(t,i)=>{const o=e[i];return o!=null?String(o):`<${i}?>`})}const uA=/\{\$([^}]+)}/g;function cA(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function $t(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const o of t){if(!i.includes(o))return!1;const s=n[o],l=e[o];if(Ju(s)&&Ju(l)){if(!$t(s,l))return!1}else if(s!==l)return!1}for(const o of i)if(!t.includes(o))return!1;return!0}function Ju(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Si(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(o=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(o))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function dA(n,e){const t=new fA(n,e);return t.subscribe.bind(t)}class fA{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let o;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");hA(e,["next","error","complete"])?o=e:o={next:e,error:t,complete:i},o.next===void 0&&(o.next=Ds),o.error===void 0&&(o.error=Ds),o.complete===void 0&&(o.complete=Ds);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?o.error(this.finalError):o.complete()}catch{}}),this.observers.push(o),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function hA(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Ds(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ue(n){return n&&n._delegate?n._delegate:n}class Ht{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ut="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pA{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new KS;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const o=this.getOrInitializeService({instanceIdentifier:t});o&&i.resolve(o)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(o){if(i)return null;throw o}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(gA(e))try{this.getOrInitializeService({instanceIdentifier:Ut})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:o});i.resolve(s)}catch{}}}}clearInstance(e=Ut){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ut){return this.instances.has(e)}getOptions(e=Ut){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const o=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[s,l]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(s);i===u&&l.resolve(o)}return o}onInit(e,t){const i=this.normalizeInstanceIdentifier(t),o=this.onInitCallbacks.get(i)??new Set;o.add(e),this.onInitCallbacks.set(i,o);const s=this.instances.get(i);return s&&e(s,i),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const o of i)try{o(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:mA(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Ut){return this.component?this.component.multipleInstances?e:Ut:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function mA(n){return n===Ut?void 0:n}function gA(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yA{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new pA(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var X;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(X||(X={}));const _A={debug:X.DEBUG,verbose:X.VERBOSE,info:X.INFO,warn:X.WARN,error:X.ERROR,silent:X.SILENT},TA=X.INFO,EA={[X.DEBUG]:"log",[X.VERBOSE]:"log",[X.INFO]:"info",[X.WARN]:"warn",[X.ERROR]:"error"},vA=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),o=EA[e];if(o)console[o](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Nr{constructor(e){this.name=e,this._logLevel=TA,this._logHandler=vA,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in X))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?_A[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,X.DEBUG,...e),this._logHandler(this,X.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,X.VERBOSE,...e),this._logHandler(this,X.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,X.INFO,...e),this._logHandler(this,X.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,X.WARN,...e),this._logHandler(this,X.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,X.ERROR,...e),this._logHandler(this,X.ERROR,...e)}}const IA=(n,e)=>e.some(t=>n instanceof t);let Wu,Ku;function CA(){return Wu||(Wu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function SA(){return Ku||(Ku=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const of=new WeakMap,er=new WeakMap,sf=new WeakMap,Ns=new WeakMap,kr=new WeakMap;function AA(n){const e=new Promise((t,i)=>{const o=()=>{n.removeEventListener("success",s),n.removeEventListener("error",l)},s=()=>{t(vt(n.result)),o()},l=()=>{i(n.error),o()};n.addEventListener("success",s),n.addEventListener("error",l)});return e.then(t=>{t instanceof IDBCursor&&of.set(t,n)}).catch(()=>{}),kr.set(e,n),e}function wA(n){if(er.has(n))return;const e=new Promise((t,i)=>{const o=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",l),n.removeEventListener("abort",l)},s=()=>{t(),o()},l=()=>{i(n.error||new DOMException("AbortError","AbortError")),o()};n.addEventListener("complete",s),n.addEventListener("error",l),n.addEventListener("abort",l)});er.set(n,e)}let tr={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return er.get(n);if(e==="objectStoreNames")return n.objectStoreNames||sf.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return vt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function RA(n){tr=n(tr)}function PA(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(ks(this),e,...t);return sf.set(i,e.sort?e.sort():[e]),vt(i)}:SA().includes(n)?function(...e){return n.apply(ks(this),e),vt(of.get(this))}:function(...e){return vt(n.apply(ks(this),e))}}function MA(n){return typeof n=="function"?PA(n):(n instanceof IDBTransaction&&wA(n),IA(n,CA())?new Proxy(n,tr):n)}function vt(n){if(n instanceof IDBRequest)return AA(n);if(Ns.has(n))return Ns.get(n);const e=MA(n);return e!==n&&(Ns.set(n,e),kr.set(e,n)),e}const ks=n=>kr.get(n);function DA(n,e,{blocked:t,upgrade:i,blocking:o,terminated:s}={}){const l=indexedDB.open(n,e),u=vt(l);return i&&l.addEventListener("upgradeneeded",f=>{i(vt(l.result),f.oldVersion,f.newVersion,vt(l.transaction),f)}),t&&l.addEventListener("blocked",f=>t(f.oldVersion,f.newVersion,f)),u.then(f=>{s&&f.addEventListener("close",()=>s()),o&&f.addEventListener("versionchange",d=>o(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}const NA=["get","getKey","getAll","getAllKeys","count"],kA=["put","add","delete","clear"],xs=new Map;function Yu(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(xs.get(e))return xs.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,o=kA.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(o||NA.includes(t)))return;const s=async function(l,...u){const f=this.transaction(l,o?"readwrite":"readonly");let d=f.store;return i&&(d=d.index(u.shift())),(await Promise.all([d[t](...u),o&&f.done]))[0]};return xs.set(e,s),s}RA(n=>({...n,get:(e,t,i)=>Yu(e,t)||n.get(e,t,i),has:(e,t)=>!!Yu(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xA{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(VA(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function VA(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const nr="@firebase/app",Qu="0.14.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ot=new Nr("@firebase/app"),LA="@firebase/app-compat",bA="@firebase/analytics-compat",UA="@firebase/analytics",FA="@firebase/app-check-compat",BA="@firebase/app-check",OA="@firebase/auth",qA="@firebase/auth-compat",GA="@firebase/database",$A="@firebase/data-connect",HA="@firebase/database-compat",zA="@firebase/functions",JA="@firebase/functions-compat",WA="@firebase/installations",KA="@firebase/installations-compat",YA="@firebase/messaging",QA="@firebase/messaging-compat",XA="@firebase/performance",ZA="@firebase/performance-compat",jA="@firebase/remote-config",ew="@firebase/remote-config-compat",tw="@firebase/storage",nw="@firebase/storage-compat",iw="@firebase/firestore",ow="@firebase/ai",sw="@firebase/firestore-compat",rw="firebase",aw="12.3.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ir="[DEFAULT]",lw={[nr]:"fire-core",[LA]:"fire-core-compat",[UA]:"fire-analytics",[bA]:"fire-analytics-compat",[BA]:"fire-app-check",[FA]:"fire-app-check-compat",[OA]:"fire-auth",[qA]:"fire-auth-compat",[GA]:"fire-rtdb",[$A]:"fire-data-connect",[HA]:"fire-rtdb-compat",[zA]:"fire-fn",[JA]:"fire-fn-compat",[WA]:"fire-iid",[KA]:"fire-iid-compat",[YA]:"fire-fcm",[QA]:"fire-fcm-compat",[XA]:"fire-perf",[ZA]:"fire-perf-compat",[jA]:"fire-rc",[ew]:"fire-rc-compat",[tw]:"fire-gcs",[nw]:"fire-gcs-compat",[iw]:"fire-fst",[sw]:"fire-fst-compat",[ow]:"fire-vertex","fire-js":"fire-js",[rw]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const To=new Map,uw=new Map,or=new Map;function Xu(n,e){try{n.container.addComponent(e)}catch(t){ot.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function yn(n){const e=n.name;if(or.has(e))return ot.debug(`There were multiple attempts to register component ${e}.`),!1;or.set(e,n);for(const t of To.values())Xu(t,n);for(const t of uw.values())Xu(t,n);return!0}function xr(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Fe(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cw={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},It=new Ci("app","Firebase",cw);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dw{constructor(e,t,i){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Ht("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw It.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dn=aw;function rf(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i={name:ir,automaticDataCollectionEnabled:!0,...e},o=i.name;if(typeof o!="string"||!o)throw It.create("bad-app-name",{appName:String(o)});if(t||(t=jd()),!t)throw It.create("no-options");const s=To.get(o);if(s){if($t(t,s.options)&&$t(i,s.config))return s;throw It.create("duplicate-app",{appName:o})}const l=new yA(o);for(const f of or.values())l.addComponent(f);const u=new dw(t,i,l);return To.set(o,u),u}function af(n=ir){const e=To.get(n);if(!e&&n===ir&&jd())return rf();if(!e)throw It.create("no-app",{appName:n});return e}function Ct(n,e,t){let i=lw[n]??n;t&&(i+=`-${t}`);const o=i.match(/\s|\//),s=e.match(/\s|\//);if(o||s){const l=[`Unable to register library "${i}" with version "${e}":`];o&&l.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&s&&l.push("and"),s&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ot.warn(l.join(" "));return}yn(new Ht(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fw="firebase-heartbeat-database",hw=1,fi="firebase-heartbeat-store";let Vs=null;function lf(){return Vs||(Vs=DA(fw,hw,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(fi)}catch(t){console.warn(t)}}}}).catch(n=>{throw It.create("idb-open",{originalErrorMessage:n.message})})),Vs}async function pw(n){try{const t=(await lf()).transaction(fi),i=await t.objectStore(fi).get(uf(n));return await t.done,i}catch(e){if(e instanceof ut)ot.warn(e.message);else{const t=It.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ot.warn(t.message)}}}async function Zu(n,e){try{const i=(await lf()).transaction(fi,"readwrite");await i.objectStore(fi).put(e,uf(n)),await i.done}catch(t){if(t instanceof ut)ot.warn(t.message);else{const i=It.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});ot.warn(i.message)}}}function uf(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mw=1024,gw=30;class yw{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Tw(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const o=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=ju();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(l=>l.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:o}),this._heartbeatsCache.heartbeats.length>gw){const l=Ew(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(l,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){ot.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=ju(),{heartbeatsToSend:i,unsentEntries:o}=_w(this._heartbeatsCache.heartbeats),s=_o(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,o.length>0?(this._heartbeatsCache.heartbeats=o,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return ot.warn(t),""}}}function ju(){return new Date().toISOString().substring(0,10)}function _w(n,e=mw){const t=[];let i=n.slice();for(const o of n){const s=t.find(l=>l.agent===o.agent);if(s){if(s.dates.push(o.date),ec(t)>e){s.dates.pop();break}}else if(t.push({agent:o.agent,dates:[o.date]}),ec(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class Tw{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return sA()?rA().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await pw(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return Zu(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return Zu(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function ec(n){return _o(JSON.stringify({version:2,heartbeats:n})).length}function Ew(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vw(n){yn(new Ht("platform-logger",e=>new xA(e),"PRIVATE")),yn(new Ht("heartbeat",e=>new yw(e),"PRIVATE")),Ct(nr,Qu,n),Ct(nr,Qu,"esm2020"),Ct("fire-js","")}vw("");var Iw="firebase",Cw="12.3.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ct(Iw,Cw,"app");var tc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var St,cf;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(S,v){function E(){}E.prototype=v.prototype,S.F=v.prototype,S.prototype=new E,S.prototype.constructor=S,S.D=function(A,C,R){for(var I=Array(arguments.length-2),Te=2;Te<arguments.length;Te++)I[Te-2]=arguments[Te];return v.prototype[C].apply(A,I)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(i,t),i.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function o(S,v,E){E||(E=0);const A=Array(16);if(typeof v=="string")for(var C=0;C<16;++C)A[C]=v.charCodeAt(E++)|v.charCodeAt(E++)<<8|v.charCodeAt(E++)<<16|v.charCodeAt(E++)<<24;else for(C=0;C<16;++C)A[C]=v[E++]|v[E++]<<8|v[E++]<<16|v[E++]<<24;v=S.g[0],E=S.g[1],C=S.g[2];let R=S.g[3],I;I=v+(R^E&(C^R))+A[0]+3614090360&4294967295,v=E+(I<<7&4294967295|I>>>25),I=R+(C^v&(E^C))+A[1]+3905402710&4294967295,R=v+(I<<12&4294967295|I>>>20),I=C+(E^R&(v^E))+A[2]+606105819&4294967295,C=R+(I<<17&4294967295|I>>>15),I=E+(v^C&(R^v))+A[3]+3250441966&4294967295,E=C+(I<<22&4294967295|I>>>10),I=v+(R^E&(C^R))+A[4]+4118548399&4294967295,v=E+(I<<7&4294967295|I>>>25),I=R+(C^v&(E^C))+A[5]+1200080426&4294967295,R=v+(I<<12&4294967295|I>>>20),I=C+(E^R&(v^E))+A[6]+2821735955&4294967295,C=R+(I<<17&4294967295|I>>>15),I=E+(v^C&(R^v))+A[7]+4249261313&4294967295,E=C+(I<<22&4294967295|I>>>10),I=v+(R^E&(C^R))+A[8]+1770035416&4294967295,v=E+(I<<7&4294967295|I>>>25),I=R+(C^v&(E^C))+A[9]+2336552879&4294967295,R=v+(I<<12&4294967295|I>>>20),I=C+(E^R&(v^E))+A[10]+4294925233&4294967295,C=R+(I<<17&4294967295|I>>>15),I=E+(v^C&(R^v))+A[11]+2304563134&4294967295,E=C+(I<<22&4294967295|I>>>10),I=v+(R^E&(C^R))+A[12]+1804603682&4294967295,v=E+(I<<7&4294967295|I>>>25),I=R+(C^v&(E^C))+A[13]+4254626195&4294967295,R=v+(I<<12&4294967295|I>>>20),I=C+(E^R&(v^E))+A[14]+2792965006&4294967295,C=R+(I<<17&4294967295|I>>>15),I=E+(v^C&(R^v))+A[15]+1236535329&4294967295,E=C+(I<<22&4294967295|I>>>10),I=v+(C^R&(E^C))+A[1]+4129170786&4294967295,v=E+(I<<5&4294967295|I>>>27),I=R+(E^C&(v^E))+A[6]+3225465664&4294967295,R=v+(I<<9&4294967295|I>>>23),I=C+(v^E&(R^v))+A[11]+643717713&4294967295,C=R+(I<<14&4294967295|I>>>18),I=E+(R^v&(C^R))+A[0]+3921069994&4294967295,E=C+(I<<20&4294967295|I>>>12),I=v+(C^R&(E^C))+A[5]+3593408605&4294967295,v=E+(I<<5&4294967295|I>>>27),I=R+(E^C&(v^E))+A[10]+38016083&4294967295,R=v+(I<<9&4294967295|I>>>23),I=C+(v^E&(R^v))+A[15]+3634488961&4294967295,C=R+(I<<14&4294967295|I>>>18),I=E+(R^v&(C^R))+A[4]+3889429448&4294967295,E=C+(I<<20&4294967295|I>>>12),I=v+(C^R&(E^C))+A[9]+568446438&4294967295,v=E+(I<<5&4294967295|I>>>27),I=R+(E^C&(v^E))+A[14]+3275163606&4294967295,R=v+(I<<9&4294967295|I>>>23),I=C+(v^E&(R^v))+A[3]+4107603335&4294967295,C=R+(I<<14&4294967295|I>>>18),I=E+(R^v&(C^R))+A[8]+1163531501&4294967295,E=C+(I<<20&4294967295|I>>>12),I=v+(C^R&(E^C))+A[13]+2850285829&4294967295,v=E+(I<<5&4294967295|I>>>27),I=R+(E^C&(v^E))+A[2]+4243563512&4294967295,R=v+(I<<9&4294967295|I>>>23),I=C+(v^E&(R^v))+A[7]+1735328473&4294967295,C=R+(I<<14&4294967295|I>>>18),I=E+(R^v&(C^R))+A[12]+2368359562&4294967295,E=C+(I<<20&4294967295|I>>>12),I=v+(E^C^R)+A[5]+4294588738&4294967295,v=E+(I<<4&4294967295|I>>>28),I=R+(v^E^C)+A[8]+2272392833&4294967295,R=v+(I<<11&4294967295|I>>>21),I=C+(R^v^E)+A[11]+1839030562&4294967295,C=R+(I<<16&4294967295|I>>>16),I=E+(C^R^v)+A[14]+4259657740&4294967295,E=C+(I<<23&4294967295|I>>>9),I=v+(E^C^R)+A[1]+2763975236&4294967295,v=E+(I<<4&4294967295|I>>>28),I=R+(v^E^C)+A[4]+1272893353&4294967295,R=v+(I<<11&4294967295|I>>>21),I=C+(R^v^E)+A[7]+4139469664&4294967295,C=R+(I<<16&4294967295|I>>>16),I=E+(C^R^v)+A[10]+3200236656&4294967295,E=C+(I<<23&4294967295|I>>>9),I=v+(E^C^R)+A[13]+681279174&4294967295,v=E+(I<<4&4294967295|I>>>28),I=R+(v^E^C)+A[0]+3936430074&4294967295,R=v+(I<<11&4294967295|I>>>21),I=C+(R^v^E)+A[3]+3572445317&4294967295,C=R+(I<<16&4294967295|I>>>16),I=E+(C^R^v)+A[6]+76029189&4294967295,E=C+(I<<23&4294967295|I>>>9),I=v+(E^C^R)+A[9]+3654602809&4294967295,v=E+(I<<4&4294967295|I>>>28),I=R+(v^E^C)+A[12]+3873151461&4294967295,R=v+(I<<11&4294967295|I>>>21),I=C+(R^v^E)+A[15]+530742520&4294967295,C=R+(I<<16&4294967295|I>>>16),I=E+(C^R^v)+A[2]+3299628645&4294967295,E=C+(I<<23&4294967295|I>>>9),I=v+(C^(E|~R))+A[0]+4096336452&4294967295,v=E+(I<<6&4294967295|I>>>26),I=R+(E^(v|~C))+A[7]+1126891415&4294967295,R=v+(I<<10&4294967295|I>>>22),I=C+(v^(R|~E))+A[14]+2878612391&4294967295,C=R+(I<<15&4294967295|I>>>17),I=E+(R^(C|~v))+A[5]+4237533241&4294967295,E=C+(I<<21&4294967295|I>>>11),I=v+(C^(E|~R))+A[12]+1700485571&4294967295,v=E+(I<<6&4294967295|I>>>26),I=R+(E^(v|~C))+A[3]+2399980690&4294967295,R=v+(I<<10&4294967295|I>>>22),I=C+(v^(R|~E))+A[10]+4293915773&4294967295,C=R+(I<<15&4294967295|I>>>17),I=E+(R^(C|~v))+A[1]+2240044497&4294967295,E=C+(I<<21&4294967295|I>>>11),I=v+(C^(E|~R))+A[8]+1873313359&4294967295,v=E+(I<<6&4294967295|I>>>26),I=R+(E^(v|~C))+A[15]+4264355552&4294967295,R=v+(I<<10&4294967295|I>>>22),I=C+(v^(R|~E))+A[6]+2734768916&4294967295,C=R+(I<<15&4294967295|I>>>17),I=E+(R^(C|~v))+A[13]+1309151649&4294967295,E=C+(I<<21&4294967295|I>>>11),I=v+(C^(E|~R))+A[4]+4149444226&4294967295,v=E+(I<<6&4294967295|I>>>26),I=R+(E^(v|~C))+A[11]+3174756917&4294967295,R=v+(I<<10&4294967295|I>>>22),I=C+(v^(R|~E))+A[2]+718787259&4294967295,C=R+(I<<15&4294967295|I>>>17),I=E+(R^(C|~v))+A[9]+3951481745&4294967295,S.g[0]=S.g[0]+v&4294967295,S.g[1]=S.g[1]+(C+(I<<21&4294967295|I>>>11))&4294967295,S.g[2]=S.g[2]+C&4294967295,S.g[3]=S.g[3]+R&4294967295}i.prototype.v=function(S,v){v===void 0&&(v=S.length);const E=v-this.blockSize,A=this.C;let C=this.h,R=0;for(;R<v;){if(C==0)for(;R<=E;)o(this,S,R),R+=this.blockSize;if(typeof S=="string"){for(;R<v;)if(A[C++]=S.charCodeAt(R++),C==this.blockSize){o(this,A),C=0;break}}else for(;R<v;)if(A[C++]=S[R++],C==this.blockSize){o(this,A),C=0;break}}this.h=C,this.o+=v},i.prototype.A=function(){var S=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);S[0]=128;for(var v=1;v<S.length-8;++v)S[v]=0;v=this.o*8;for(var E=S.length-8;E<S.length;++E)S[E]=v&255,v/=256;for(this.v(S),S=Array(16),v=0,E=0;E<4;++E)for(let A=0;A<32;A+=8)S[v++]=this.g[E]>>>A&255;return S};function s(S,v){var E=u;return Object.prototype.hasOwnProperty.call(E,S)?E[S]:E[S]=v(S)}function l(S,v){this.h=v;const E=[];let A=!0;for(let C=S.length-1;C>=0;C--){const R=S[C]|0;A&&R==v||(E[C]=R,A=!1)}this.g=E}var u={};function f(S){return-128<=S&&S<128?s(S,function(v){return new l([v|0],v<0?-1:0)}):new l([S|0],S<0?-1:0)}function d(S){if(isNaN(S)||!isFinite(S))return m;if(S<0)return N(d(-S));const v=[];let E=1;for(let A=0;S>=E;A++)v[A]=S/E|0,E*=4294967296;return new l(v,0)}function h(S,v){if(S.length==0)throw Error("number format error: empty string");if(v=v||10,v<2||36<v)throw Error("radix out of range: "+v);if(S.charAt(0)=="-")return N(h(S.substring(1),v));if(S.indexOf("-")>=0)throw Error('number format error: interior "-" character');const E=d(Math.pow(v,8));let A=m;for(let R=0;R<S.length;R+=8){var C=Math.min(8,S.length-R);const I=parseInt(S.substring(R,R+C),v);C<8?(C=d(Math.pow(v,C)),A=A.j(C).add(d(I))):(A=A.j(E),A=A.add(d(I)))}return A}var m=f(0),g=f(1),T=f(16777216);n=l.prototype,n.m=function(){if(M(this))return-N(this).m();let S=0,v=1;for(let E=0;E<this.g.length;E++){const A=this.i(E);S+=(A>=0?A:4294967296+A)*v,v*=4294967296}return S},n.toString=function(S){if(S=S||10,S<2||36<S)throw Error("radix out of range: "+S);if(w(this))return"0";if(M(this))return"-"+N(this).toString(S);const v=d(Math.pow(S,6));var E=this;let A="";for(;;){const C=B(E,v).g;E=L(E,C.j(v));let R=((E.g.length>0?E.g[0]:E.h)>>>0).toString(S);if(E=C,w(E))return R+A;for(;R.length<6;)R="0"+R;A=R+A}},n.i=function(S){return S<0?0:S<this.g.length?this.g[S]:this.h};function w(S){if(S.h!=0)return!1;for(let v=0;v<S.g.length;v++)if(S.g[v]!=0)return!1;return!0}function M(S){return S.h==-1}n.l=function(S){return S=L(this,S),M(S)?-1:w(S)?0:1};function N(S){const v=S.g.length,E=[];for(let A=0;A<v;A++)E[A]=~S.g[A];return new l(E,~S.h).add(g)}n.abs=function(){return M(this)?N(this):this},n.add=function(S){const v=Math.max(this.g.length,S.g.length),E=[];let A=0;for(let C=0;C<=v;C++){let R=A+(this.i(C)&65535)+(S.i(C)&65535),I=(R>>>16)+(this.i(C)>>>16)+(S.i(C)>>>16);A=I>>>16,R&=65535,I&=65535,E[C]=I<<16|R}return new l(E,E[E.length-1]&-2147483648?-1:0)};function L(S,v){return S.add(N(v))}n.j=function(S){if(w(this)||w(S))return m;if(M(this))return M(S)?N(this).j(N(S)):N(N(this).j(S));if(M(S))return N(this.j(N(S)));if(this.l(T)<0&&S.l(T)<0)return d(this.m()*S.m());const v=this.g.length+S.g.length,E=[];for(var A=0;A<2*v;A++)E[A]=0;for(A=0;A<this.g.length;A++)for(let C=0;C<S.g.length;C++){const R=this.i(A)>>>16,I=this.i(A)&65535,Te=S.i(C)>>>16,Ee=S.i(C)&65535;E[2*A+2*C]+=I*Ee,V(E,2*A+2*C),E[2*A+2*C+1]+=R*Ee,V(E,2*A+2*C+1),E[2*A+2*C+1]+=I*Te,V(E,2*A+2*C+1),E[2*A+2*C+2]+=R*Te,V(E,2*A+2*C+2)}for(S=0;S<v;S++)E[S]=E[2*S+1]<<16|E[2*S];for(S=v;S<2*v;S++)E[S]=0;return new l(E,0)};function V(S,v){for(;(S[v]&65535)!=S[v];)S[v+1]+=S[v]>>>16,S[v]&=65535,v++}function b(S,v){this.g=S,this.h=v}function B(S,v){if(w(v))throw Error("division by zero");if(w(S))return new b(m,m);if(M(S))return v=B(N(S),v),new b(N(v.g),N(v.h));if(M(v))return v=B(S,N(v)),new b(N(v.g),v.h);if(S.g.length>30){if(M(S)||M(v))throw Error("slowDivide_ only works with positive integers.");for(var E=g,A=v;A.l(S)<=0;)E=q(E),A=q(A);var C=H(E,1),R=H(A,1);for(A=H(A,2),E=H(E,2);!w(A);){var I=R.add(A);I.l(S)<=0&&(C=C.add(E),R=I),A=H(A,1),E=H(E,1)}return v=L(S,C.j(v)),new b(C,v)}for(C=m;S.l(v)>=0;){for(E=Math.max(1,Math.floor(S.m()/v.m())),A=Math.ceil(Math.log(E)/Math.LN2),A=A<=48?1:Math.pow(2,A-48),R=d(E),I=R.j(v);M(I)||I.l(S)>0;)E-=A,R=d(E),I=R.j(v);w(R)&&(R=g),C=C.add(R),S=L(S,I)}return new b(C,S)}n.B=function(S){return B(this,S).h},n.and=function(S){const v=Math.max(this.g.length,S.g.length),E=[];for(let A=0;A<v;A++)E[A]=this.i(A)&S.i(A);return new l(E,this.h&S.h)},n.or=function(S){const v=Math.max(this.g.length,S.g.length),E=[];for(let A=0;A<v;A++)E[A]=this.i(A)|S.i(A);return new l(E,this.h|S.h)},n.xor=function(S){const v=Math.max(this.g.length,S.g.length),E=[];for(let A=0;A<v;A++)E[A]=this.i(A)^S.i(A);return new l(E,this.h^S.h)};function q(S){const v=S.g.length+1,E=[];for(let A=0;A<v;A++)E[A]=S.i(A)<<1|S.i(A-1)>>>31;return new l(E,S.h)}function H(S,v){const E=v>>5;v%=32;const A=S.g.length-E,C=[];for(let R=0;R<A;R++)C[R]=v>0?S.i(R+E)>>>v|S.i(R+E+1)<<32-v:S.i(R+E);return new l(C,S.h)}i.prototype.digest=i.prototype.A,i.prototype.reset=i.prototype.u,i.prototype.update=i.prototype.v,cf=i,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=d,l.fromString=h,St=l}).apply(typeof tc<"u"?tc:typeof self<"u"?self:typeof window<"u"?window:{});var Qi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var df,ei,ff,oo,sr,hf,pf,mf;(function(){var n,e=Object.defineProperty;function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof Qi=="object"&&Qi];for(var p=0;p<c.length;++p){var y=c[p];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var i=t(this);function o(c,p){if(p)e:{var y=i;c=c.split(".");for(var _=0;_<c.length-1;_++){var P=c[_];if(!(P in y))break e;y=y[P]}c=c[c.length-1],_=y[c],p=p(_),p!=_&&p!=null&&e(y,c,{configurable:!0,writable:!0,value:p})}}o("Symbol.dispose",function(c){return c||Symbol("Symbol.dispose")}),o("Array.prototype.values",function(c){return c||function(){return this[Symbol.iterator]()}}),o("Object.entries",function(c){return c||function(p){var y=[],_;for(_ in p)Object.prototype.hasOwnProperty.call(p,_)&&y.push([_,p[_]]);return y}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var s=s||{},l=this||self;function u(c){var p=typeof c;return p=="object"&&c!=null||p=="function"}function f(c,p,y){return c.call.apply(c.bind,arguments)}function d(c,p,y){return d=f,d.apply(null,arguments)}function h(c,p){var y=Array.prototype.slice.call(arguments,1);return function(){var _=y.slice();return _.push.apply(_,arguments),c.apply(this,_)}}function m(c,p){function y(){}y.prototype=p.prototype,c.Z=p.prototype,c.prototype=new y,c.prototype.constructor=c,c.Ob=function(_,P,D){for(var U=Array(arguments.length-2),Q=2;Q<arguments.length;Q++)U[Q-2]=arguments[Q];return p.prototype[P].apply(_,U)}}var g=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?c=>c&&AsyncContext.Snapshot.wrap(c):c=>c;function T(c){const p=c.length;if(p>0){const y=Array(p);for(let _=0;_<p;_++)y[_]=c[_];return y}return[]}function w(c,p){for(let _=1;_<arguments.length;_++){const P=arguments[_];var y=typeof P;if(y=y!="object"?y:P?Array.isArray(P)?"array":y:"null",y=="array"||y=="object"&&typeof P.length=="number"){y=c.length||0;const D=P.length||0;c.length=y+D;for(let U=0;U<D;U++)c[y+U]=P[U]}else c.push(P)}}class M{constructor(p,y){this.i=p,this.j=y,this.h=0,this.g=null}get(){let p;return this.h>0?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function N(c){l.setTimeout(()=>{throw c},0)}function L(){var c=S;let p=null;return c.g&&(p=c.g,c.g=c.g.next,c.g||(c.h=null),p.next=null),p}class V{constructor(){this.h=this.g=null}add(p,y){const _=b.get();_.set(p,y),this.h?this.h.next=_:this.g=_,this.h=_}}var b=new M(()=>new B,c=>c.reset());class B{constructor(){this.next=this.g=this.h=null}set(p,y){this.h=p,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let q,H=!1,S=new V,v=()=>{const c=Promise.resolve(void 0);q=()=>{c.then(E)}};function E(){for(var c;c=L();){try{c.h.call(c.g)}catch(y){N(y)}var p=b;p.j(c),p.h<100&&(p.h++,c.next=p.g,p.g=c)}H=!1}function A(){this.u=this.u,this.C=this.C}A.prototype.u=!1,A.prototype.dispose=function(){this.u||(this.u=!0,this.N())},A.prototype[Symbol.dispose]=function(){this.dispose()},A.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function C(c,p){this.type=c,this.g=this.target=p,this.defaultPrevented=!1}C.prototype.h=function(){this.defaultPrevented=!0};var R=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var c=!1,p=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const y=()=>{};l.addEventListener("test",y,p),l.removeEventListener("test",y,p)}catch{}return c})();function I(c){return/^[\s\xa0]*$/.test(c)}function Te(c,p){C.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c&&this.init(c,p)}m(Te,C),Te.prototype.init=function(c,p){const y=this.type=c.type,_=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;this.target=c.target||c.srcElement,this.g=p,p=c.relatedTarget,p||(y=="mouseover"?p=c.fromElement:y=="mouseout"&&(p=c.toElement)),this.relatedTarget=p,_?(this.clientX=_.clientX!==void 0?_.clientX:_.pageX,this.clientY=_.clientY!==void 0?_.clientY:_.pageY,this.screenX=_.screenX||0,this.screenY=_.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=c.pointerType,this.state=c.state,this.i=c,c.defaultPrevented&&Te.Z.h.call(this)},Te.prototype.h=function(){Te.Z.h.call(this);const c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var Ee="closure_listenable_"+(Math.random()*1e6|0),bn=0;function pp(c,p,y,_,P){this.listener=c,this.proxy=null,this.src=p,this.type=y,this.capture=!!_,this.ha=P,this.key=++bn,this.da=this.fa=!1}function xi(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function Vi(c,p,y){for(const _ in c)p.call(y,c[_],_,c)}function mp(c,p){for(const y in c)p.call(void 0,c[y],y,c)}function va(c){const p={};for(const y in c)p[y]=c[y];return p}const Ia="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ca(c,p){let y,_;for(let P=1;P<arguments.length;P++){_=arguments[P];for(y in _)c[y]=_[y];for(let D=0;D<Ia.length;D++)y=Ia[D],Object.prototype.hasOwnProperty.call(_,y)&&(c[y]=_[y])}}function Li(c){this.src=c,this.g={},this.h=0}Li.prototype.add=function(c,p,y,_,P){const D=c.toString();c=this.g[D],c||(c=this.g[D]=[],this.h++);const U=os(c,p,_,P);return U>-1?(p=c[U],y||(p.fa=!1)):(p=new pp(p,this.src,D,!!_,P),p.fa=y,c.push(p)),p};function is(c,p){const y=p.type;if(y in c.g){var _=c.g[y],P=Array.prototype.indexOf.call(_,p,void 0),D;(D=P>=0)&&Array.prototype.splice.call(_,P,1),D&&(xi(p),c.g[y].length==0&&(delete c.g[y],c.h--))}}function os(c,p,y,_){for(let P=0;P<c.length;++P){const D=c[P];if(!D.da&&D.listener==p&&D.capture==!!y&&D.ha==_)return P}return-1}var ss="closure_lm_"+(Math.random()*1e6|0),rs={};function Sa(c,p,y,_,P){if(Array.isArray(p)){for(let D=0;D<p.length;D++)Sa(c,p[D],y,_,P);return null}return y=Ra(y),c&&c[Ee]?c.J(p,y,u(_)?!!_.capture:!1,P):gp(c,p,y,!1,_,P)}function gp(c,p,y,_,P,D){if(!p)throw Error("Invalid event type");const U=u(P)?!!P.capture:!!P;let Q=ls(c);if(Q||(c[ss]=Q=new Li(c)),y=Q.add(p,y,_,U,D),y.proxy)return y;if(_=yp(),y.proxy=_,_.src=c,_.listener=y,c.addEventListener)R||(P=U),P===void 0&&(P=!1),c.addEventListener(p.toString(),_,P);else if(c.attachEvent)c.attachEvent(wa(p.toString()),_);else if(c.addListener&&c.removeListener)c.addListener(_);else throw Error("addEventListener and attachEvent are unavailable.");return y}function yp(){function c(y){return p.call(c.src,c.listener,y)}const p=_p;return c}function Aa(c,p,y,_,P){if(Array.isArray(p))for(var D=0;D<p.length;D++)Aa(c,p[D],y,_,P);else _=u(_)?!!_.capture:!!_,y=Ra(y),c&&c[Ee]?(c=c.i,D=String(p).toString(),D in c.g&&(p=c.g[D],y=os(p,y,_,P),y>-1&&(xi(p[y]),Array.prototype.splice.call(p,y,1),p.length==0&&(delete c.g[D],c.h--)))):c&&(c=ls(c))&&(p=c.g[p.toString()],c=-1,p&&(c=os(p,y,_,P)),(y=c>-1?p[c]:null)&&as(y))}function as(c){if(typeof c!="number"&&c&&!c.da){var p=c.src;if(p&&p[Ee])is(p.i,c);else{var y=c.type,_=c.proxy;p.removeEventListener?p.removeEventListener(y,_,c.capture):p.detachEvent?p.detachEvent(wa(y),_):p.addListener&&p.removeListener&&p.removeListener(_),(y=ls(p))?(is(y,c),y.h==0&&(y.src=null,p[ss]=null)):xi(c)}}}function wa(c){return c in rs?rs[c]:rs[c]="on"+c}function _p(c,p){if(c.da)c=!0;else{p=new Te(p,this);const y=c.listener,_=c.ha||c.src;c.fa&&as(c),c=y.call(_,p)}return c}function ls(c){return c=c[ss],c instanceof Li?c:null}var us="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ra(c){return typeof c=="function"?c:(c[us]||(c[us]=function(p){return c.handleEvent(p)}),c[us])}function Se(){A.call(this),this.i=new Li(this),this.M=this,this.G=null}m(Se,A),Se.prototype[Ee]=!0,Se.prototype.removeEventListener=function(c,p,y,_){Aa(this,c,p,y,_)};function De(c,p){var y,_=c.G;if(_)for(y=[];_;_=_.G)y.push(_);if(c=c.M,_=p.type||p,typeof p=="string")p=new C(p,c);else if(p instanceof C)p.target=p.target||c;else{var P=p;p=new C(_,c),Ca(p,P)}P=!0;let D,U;if(y)for(U=y.length-1;U>=0;U--)D=p.g=y[U],P=bi(D,_,!0,p)&&P;if(D=p.g=c,P=bi(D,_,!0,p)&&P,P=bi(D,_,!1,p)&&P,y)for(U=0;U<y.length;U++)D=p.g=y[U],P=bi(D,_,!1,p)&&P}Se.prototype.N=function(){if(Se.Z.N.call(this),this.i){var c=this.i;for(const p in c.g){const y=c.g[p];for(let _=0;_<y.length;_++)xi(y[_]);delete c.g[p],c.h--}}this.G=null},Se.prototype.J=function(c,p,y,_){return this.i.add(String(c),p,!1,y,_)},Se.prototype.K=function(c,p,y,_){return this.i.add(String(c),p,!0,y,_)};function bi(c,p,y,_){if(p=c.i.g[String(p)],!p)return!0;p=p.concat();let P=!0;for(let D=0;D<p.length;++D){const U=p[D];if(U&&!U.da&&U.capture==y){const Q=U.listener,he=U.ha||U.src;U.fa&&is(c.i,U),P=Q.call(he,_)!==!1&&P}}return P&&!_.defaultPrevented}function Tp(c,p){if(typeof c!="function")if(c&&typeof c.handleEvent=="function")c=d(c.handleEvent,c);else throw Error("Invalid listener argument");return Number(p)>2147483647?-1:l.setTimeout(c,p||0)}function Pa(c){c.g=Tp(()=>{c.g=null,c.i&&(c.i=!1,Pa(c))},c.l);const p=c.h;c.h=null,c.m.apply(null,p)}class Ep extends A{constructor(p,y){super(),this.m=p,this.l=y,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Pa(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Un(c){A.call(this),this.h=c,this.g={}}m(Un,A);var Ma=[];function Da(c){Vi(c.g,function(p,y){this.g.hasOwnProperty(y)&&as(p)},c),c.g={}}Un.prototype.N=function(){Un.Z.N.call(this),Da(this)},Un.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var cs=l.JSON.stringify,vp=l.JSON.parse,Ip=class{stringify(c){return l.JSON.stringify(c,void 0)}parse(c){return l.JSON.parse(c,void 0)}};function Na(){}function ka(){}var Fn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ds(){C.call(this,"d")}m(ds,C);function fs(){C.call(this,"c")}m(fs,C);var kt={},xa=null;function Ui(){return xa=xa||new Se}kt.Ia="serverreachability";function Va(c){C.call(this,kt.Ia,c)}m(Va,C);function Bn(c){const p=Ui();De(p,new Va(p))}kt.STAT_EVENT="statevent";function La(c,p){C.call(this,kt.STAT_EVENT,c),this.stat=p}m(La,C);function Ne(c){const p=Ui();De(p,new La(p,c))}kt.Ja="timingevent";function ba(c,p){C.call(this,kt.Ja,c),this.size=p}m(ba,C);function On(c,p){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){c()},p)}function qn(){this.g=!0}qn.prototype.ua=function(){this.g=!1};function Cp(c,p,y,_,P,D){c.info(function(){if(c.g)if(D){var U="",Q=D.split("&");for(let ie=0;ie<Q.length;ie++){var he=Q[ie].split("=");if(he.length>1){const ge=he[0];he=he[1];const He=ge.split("_");U=He.length>=2&&He[1]=="type"?U+(ge+"="+he+"&"):U+(ge+"=redacted&")}}}else U=null;else U=D;return"XMLHTTP REQ ("+_+") [attempt "+P+"]: "+p+`
`+y+`
`+U})}function Sp(c,p,y,_,P,D,U){c.info(function(){return"XMLHTTP RESP ("+_+") [ attempt "+P+"]: "+p+`
`+y+`
`+D+" "+U})}function en(c,p,y,_){c.info(function(){return"XMLHTTP TEXT ("+p+"): "+wp(c,y)+(_?" "+_:"")})}function Ap(c,p){c.info(function(){return"TIMEOUT: "+p})}qn.prototype.info=function(){};function wp(c,p){if(!c.g)return p;if(!p)return null;try{const D=JSON.parse(p);if(D){for(c=0;c<D.length;c++)if(Array.isArray(D[c])){var y=D[c];if(!(y.length<2)){var _=y[1];if(Array.isArray(_)&&!(_.length<1)){var P=_[0];if(P!="noop"&&P!="stop"&&P!="close")for(let U=1;U<_.length;U++)_[U]=""}}}}return cs(D)}catch{return p}}var Fi={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ua={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Fa;function hs(){}m(hs,Na),hs.prototype.g=function(){return new XMLHttpRequest},Fa=new hs;function Gn(c){return encodeURIComponent(String(c))}function Rp(c){var p=1;c=c.split(":");const y=[];for(;p>0&&c.length;)y.push(c.shift()),p--;return c.length&&y.push(c.join(":")),y}function ct(c,p,y,_){this.j=c,this.i=p,this.l=y,this.S=_||1,this.V=new Un(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ba}function Ba(){this.i=null,this.g="",this.h=!1}var Oa={},ps={};function ms(c,p,y){c.M=1,c.A=Oi($e(p)),c.u=y,c.R=!0,qa(c,null)}function qa(c,p){c.F=Date.now(),Bi(c),c.B=$e(c.A);var y=c.B,_=c.S;Array.isArray(_)||(_=[String(_)]),el(y.i,"t",_),c.C=0,y=c.j.L,c.h=new Ba,c.g=_l(c.j,y?p:null,!c.u),c.P>0&&(c.O=new Ep(d(c.Y,c,c.g),c.P)),p=c.V,y=c.g,_=c.ba;var P="readystatechange";Array.isArray(P)||(P&&(Ma[0]=P.toString()),P=Ma);for(let D=0;D<P.length;D++){const U=Sa(y,P[D],_||p.handleEvent,!1,p.h||p);if(!U)break;p.g[U.key]=U}p=c.J?va(c.J):{},c.u?(c.v||(c.v="POST"),p["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.B,c.v,c.u,p)):(c.v="GET",c.g.ea(c.B,c.v,null,p)),Bn(),Cp(c.i,c.v,c.B,c.l,c.S,c.u)}ct.prototype.ba=function(c){c=c.target;const p=this.O;p&&ht(c)==3?p.j():this.Y(c)},ct.prototype.Y=function(c){try{if(c==this.g)e:{const Q=ht(this.g),he=this.g.ya(),ie=this.g.ca();if(!(Q<3)&&(Q!=3||this.g&&(this.h.h||this.g.la()||al(this.g)))){this.K||Q!=4||he==7||(he==8||ie<=0?Bn(3):Bn(2)),gs(this);var p=this.g.ca();this.X=p;var y=Pp(this);if(this.o=p==200,Sp(this.i,this.v,this.B,this.l,this.S,Q,p),this.o){if(this.U&&!this.L){t:{if(this.g){var _,P=this.g;if((_=P.g?P.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(_)){var D=_;break t}}D=null}if(c=D)en(this.i,this.l,c,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ys(this,c);else{this.o=!1,this.m=3,Ne(12),xt(this),$n(this);break e}}if(this.R){c=!0;let ge;for(;!this.K&&this.C<y.length;)if(ge=Mp(this,y),ge==ps){Q==4&&(this.m=4,Ne(14),c=!1),en(this.i,this.l,null,"[Incomplete Response]");break}else if(ge==Oa){this.m=4,Ne(15),en(this.i,this.l,y,"[Invalid Chunk]"),c=!1;break}else en(this.i,this.l,ge,null),ys(this,ge);if(Ga(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Q!=4||y.length!=0||this.h.h||(this.m=1,Ne(16),c=!1),this.o=this.o&&c,!c)en(this.i,this.l,y,"[Invalid Chunked Response]"),xt(this),$n(this);else if(y.length>0&&!this.W){this.W=!0;var U=this.j;U.g==this&&U.aa&&!U.P&&(U.j.info("Great, no buffering proxy detected. Bytes received: "+y.length),As(U),U.P=!0,Ne(11))}}else en(this.i,this.l,y,null),ys(this,y);Q==4&&xt(this),this.o&&!this.K&&(Q==4?pl(this.j,this):(this.o=!1,Bi(this)))}else $p(this.g),p==400&&y.indexOf("Unknown SID")>0?(this.m=3,Ne(12)):(this.m=0,Ne(13)),xt(this),$n(this)}}}catch{}finally{}};function Pp(c){if(!Ga(c))return c.g.la();const p=al(c.g);if(p==="")return"";let y="";const _=p.length,P=ht(c.g)==4;if(!c.h.i){if(typeof TextDecoder>"u")return xt(c),$n(c),"";c.h.i=new l.TextDecoder}for(let D=0;D<_;D++)c.h.h=!0,y+=c.h.i.decode(p[D],{stream:!(P&&D==_-1)});return p.length=0,c.h.g+=y,c.C=0,c.h.g}function Ga(c){return c.g?c.v=="GET"&&c.M!=2&&c.j.Aa:!1}function Mp(c,p){var y=c.C,_=p.indexOf(`
`,y);return _==-1?ps:(y=Number(p.substring(y,_)),isNaN(y)?Oa:(_+=1,_+y>p.length?ps:(p=p.slice(_,_+y),c.C=_+y,p)))}ct.prototype.cancel=function(){this.K=!0,xt(this)};function Bi(c){c.T=Date.now()+c.H,$a(c,c.H)}function $a(c,p){if(c.D!=null)throw Error("WatchDog timer not null");c.D=On(d(c.aa,c),p)}function gs(c){c.D&&(l.clearTimeout(c.D),c.D=null)}ct.prototype.aa=function(){this.D=null;const c=Date.now();c-this.T>=0?(Ap(this.i,this.B),this.M!=2&&(Bn(),Ne(17)),xt(this),this.m=2,$n(this)):$a(this,this.T-c)};function $n(c){c.j.I==0||c.K||pl(c.j,c)}function xt(c){gs(c);var p=c.O;p&&typeof p.dispose=="function"&&p.dispose(),c.O=null,Da(c.V),c.g&&(p=c.g,c.g=null,p.abort(),p.dispose())}function ys(c,p){try{var y=c.j;if(y.I!=0&&(y.g==c||_s(y.h,c))){if(!c.L&&_s(y.h,c)&&y.I==3){try{var _=y.Ba.g.parse(p)}catch{_=null}if(Array.isArray(_)&&_.length==3){var P=_;if(P[0]==0){e:if(!y.v){if(y.g)if(y.g.F+3e3<c.F)zi(y),$i(y);else break e;Ss(y),Ne(18)}}else y.xa=P[1],0<y.xa-y.K&&P[2]<37500&&y.F&&y.A==0&&!y.C&&(y.C=On(d(y.Va,y),6e3));Ja(y.h)<=1&&y.ta&&(y.ta=void 0)}else Lt(y,11)}else if((c.L||y.g==c)&&zi(y),!I(p))for(P=y.Ba.g.parse(p),p=0;p<P.length;p++){let ie=P[p];const ge=ie[0];if(!(ge<=y.K))if(y.K=ge,ie=ie[1],y.I==2)if(ie[0]=="c"){y.M=ie[1],y.ba=ie[2];const He=ie[3];He!=null&&(y.ka=He,y.j.info("VER="+y.ka));const bt=ie[4];bt!=null&&(y.za=bt,y.j.info("SVER="+y.za));const pt=ie[5];pt!=null&&typeof pt=="number"&&pt>0&&(_=1.5*pt,y.O=_,y.j.info("backChannelRequestTimeoutMs_="+_)),_=y;const mt=c.g;if(mt){const Wi=mt.g?mt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Wi){var D=_.h;D.g||Wi.indexOf("spdy")==-1&&Wi.indexOf("quic")==-1&&Wi.indexOf("h2")==-1||(D.j=D.l,D.g=new Set,D.h&&(Ts(D,D.h),D.h=null))}if(_.G){const ws=mt.g?mt.g.getResponseHeader("X-HTTP-Session-Id"):null;ws&&(_.wa=ws,oe(_.J,_.G,ws))}}y.I=3,y.l&&y.l.ra(),y.aa&&(y.T=Date.now()-c.F,y.j.info("Handshake RTT: "+y.T+"ms")),_=y;var U=c;if(_.na=yl(_,_.L?_.ba:null,_.W),U.L){Wa(_.h,U);var Q=U,he=_.O;he&&(Q.H=he),Q.D&&(gs(Q),Bi(Q)),_.g=U}else fl(_);y.i.length>0&&Hi(y)}else ie[0]!="stop"&&ie[0]!="close"||Lt(y,7);else y.I==3&&(ie[0]=="stop"||ie[0]=="close"?ie[0]=="stop"?Lt(y,7):Cs(y):ie[0]!="noop"&&y.l&&y.l.qa(ie),y.A=0)}}Bn(4)}catch{}}var Dp=class{constructor(c,p){this.g=c,this.map=p}};function Ha(c){this.l=c||10,l.PerformanceNavigationTiming?(c=l.performance.getEntriesByType("navigation"),c=c.length>0&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function za(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Ja(c){return c.h?1:c.g?c.g.size:0}function _s(c,p){return c.h?c.h==p:c.g?c.g.has(p):!1}function Ts(c,p){c.g?c.g.add(p):c.h=p}function Wa(c,p){c.h&&c.h==p?c.h=null:c.g&&c.g.has(p)&&c.g.delete(p)}Ha.prototype.cancel=function(){if(this.i=Ka(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function Ka(c){if(c.h!=null)return c.i.concat(c.h.G);if(c.g!=null&&c.g.size!==0){let p=c.i;for(const y of c.g.values())p=p.concat(y.G);return p}return T(c.i)}var Ya=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Np(c,p){if(c){c=c.split("&");for(let y=0;y<c.length;y++){const _=c[y].indexOf("=");let P,D=null;_>=0?(P=c[y].substring(0,_),D=c[y].substring(_+1)):P=c[y],p(P,D?decodeURIComponent(D.replace(/\+/g," ")):"")}}}function dt(c){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let p;c instanceof dt?(this.l=c.l,Hn(this,c.j),this.o=c.o,this.g=c.g,zn(this,c.u),this.h=c.h,Es(this,tl(c.i)),this.m=c.m):c&&(p=String(c).match(Ya))?(this.l=!1,Hn(this,p[1]||"",!0),this.o=Jn(p[2]||""),this.g=Jn(p[3]||"",!0),zn(this,p[4]),this.h=Jn(p[5]||"",!0),Es(this,p[6]||"",!0),this.m=Jn(p[7]||"")):(this.l=!1,this.i=new Kn(null,this.l))}dt.prototype.toString=function(){const c=[];var p=this.j;p&&c.push(Wn(p,Qa,!0),":");var y=this.g;return(y||p=="file")&&(c.push("//"),(p=this.o)&&c.push(Wn(p,Qa,!0),"@"),c.push(Gn(y).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.u,y!=null&&c.push(":",String(y))),(y=this.h)&&(this.g&&y.charAt(0)!="/"&&c.push("/"),c.push(Wn(y,y.charAt(0)=="/"?Vp:xp,!0))),(y=this.i.toString())&&c.push("?",y),(y=this.m)&&c.push("#",Wn(y,bp)),c.join("")},dt.prototype.resolve=function(c){const p=$e(this);let y=!!c.j;y?Hn(p,c.j):y=!!c.o,y?p.o=c.o:y=!!c.g,y?p.g=c.g:y=c.u!=null;var _=c.h;if(y)zn(p,c.u);else if(y=!!c.h){if(_.charAt(0)!="/")if(this.g&&!this.h)_="/"+_;else{var P=p.h.lastIndexOf("/");P!=-1&&(_=p.h.slice(0,P+1)+_)}if(P=_,P==".."||P==".")_="";else if(P.indexOf("./")!=-1||P.indexOf("/.")!=-1){_=P.lastIndexOf("/",0)==0,P=P.split("/");const D=[];for(let U=0;U<P.length;){const Q=P[U++];Q=="."?_&&U==P.length&&D.push(""):Q==".."?((D.length>1||D.length==1&&D[0]!="")&&D.pop(),_&&U==P.length&&D.push("")):(D.push(Q),_=!0)}_=D.join("/")}else _=P}return y?p.h=_:y=c.i.toString()!=="",y?Es(p,tl(c.i)):y=!!c.m,y&&(p.m=c.m),p};function $e(c){return new dt(c)}function Hn(c,p,y){c.j=y?Jn(p,!0):p,c.j&&(c.j=c.j.replace(/:$/,""))}function zn(c,p){if(p){if(p=Number(p),isNaN(p)||p<0)throw Error("Bad port number "+p);c.u=p}else c.u=null}function Es(c,p,y){p instanceof Kn?(c.i=p,Up(c.i,c.l)):(y||(p=Wn(p,Lp)),c.i=new Kn(p,c.l))}function oe(c,p,y){c.i.set(p,y)}function Oi(c){return oe(c,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),c}function Jn(c,p){return c?p?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function Wn(c,p,y){return typeof c=="string"?(c=encodeURI(c).replace(p,kp),y&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function kp(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var Qa=/[#\/\?@]/g,xp=/[#\?:]/g,Vp=/[#\?]/g,Lp=/[#\?@]/g,bp=/#/g;function Kn(c,p){this.h=this.g=null,this.i=c||null,this.j=!!p}function Vt(c){c.g||(c.g=new Map,c.h=0,c.i&&Np(c.i,function(p,y){c.add(decodeURIComponent(p.replace(/\+/g," ")),y)}))}n=Kn.prototype,n.add=function(c,p){Vt(this),this.i=null,c=tn(this,c);let y=this.g.get(c);return y||this.g.set(c,y=[]),y.push(p),this.h+=1,this};function Xa(c,p){Vt(c),p=tn(c,p),c.g.has(p)&&(c.i=null,c.h-=c.g.get(p).length,c.g.delete(p))}function Za(c,p){return Vt(c),p=tn(c,p),c.g.has(p)}n.forEach=function(c,p){Vt(this),this.g.forEach(function(y,_){y.forEach(function(P){c.call(p,P,_,this)},this)},this)};function ja(c,p){Vt(c);let y=[];if(typeof p=="string")Za(c,p)&&(y=y.concat(c.g.get(tn(c,p))));else for(c=Array.from(c.g.values()),p=0;p<c.length;p++)y=y.concat(c[p]);return y}n.set=function(c,p){return Vt(this),this.i=null,c=tn(this,c),Za(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[p]),this.h+=1,this},n.get=function(c,p){return c?(c=ja(this,c),c.length>0?String(c[0]):p):p};function el(c,p,y){Xa(c,p),y.length>0&&(c.i=null,c.g.set(tn(c,p),T(y)),c.h+=y.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],p=Array.from(this.g.keys());for(let _=0;_<p.length;_++){var y=p[_];const P=Gn(y);y=ja(this,y);for(let D=0;D<y.length;D++){let U=P;y[D]!==""&&(U+="="+Gn(y[D])),c.push(U)}}return this.i=c.join("&")};function tl(c){const p=new Kn;return p.i=c.i,c.g&&(p.g=new Map(c.g),p.h=c.h),p}function tn(c,p){return p=String(p),c.j&&(p=p.toLowerCase()),p}function Up(c,p){p&&!c.j&&(Vt(c),c.i=null,c.g.forEach(function(y,_){const P=_.toLowerCase();_!=P&&(Xa(this,_),el(this,P,y))},c)),c.j=p}function Fp(c,p){const y=new qn;if(l.Image){const _=new Image;_.onload=h(ft,y,"TestLoadImage: loaded",!0,p,_),_.onerror=h(ft,y,"TestLoadImage: error",!1,p,_),_.onabort=h(ft,y,"TestLoadImage: abort",!1,p,_),_.ontimeout=h(ft,y,"TestLoadImage: timeout",!1,p,_),l.setTimeout(function(){_.ontimeout&&_.ontimeout()},1e4),_.src=c}else p(!1)}function Bp(c,p){const y=new qn,_=new AbortController,P=setTimeout(()=>{_.abort(),ft(y,"TestPingServer: timeout",!1,p)},1e4);fetch(c,{signal:_.signal}).then(D=>{clearTimeout(P),D.ok?ft(y,"TestPingServer: ok",!0,p):ft(y,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(P),ft(y,"TestPingServer: error",!1,p)})}function ft(c,p,y,_,P){try{P&&(P.onload=null,P.onerror=null,P.onabort=null,P.ontimeout=null),_(y)}catch{}}function Op(){this.g=new Ip}function vs(c){this.i=c.Sb||null,this.h=c.ab||!1}m(vs,Na),vs.prototype.g=function(){return new qi(this.i,this.h)};function qi(c,p){Se.call(this),this.H=c,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(qi,Se),n=qi.prototype,n.open=function(c,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=c,this.D=p,this.readyState=1,Qn(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const p={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};c&&(p.body=c),(this.H||l).fetch(new Request(this.D,p)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Yn(this)),this.readyState=0},n.Pa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,Qn(this)),this.g&&(this.readyState=3,Qn(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;nl(this)}else c.text().then(this.Oa.bind(this),this.ga.bind(this))};function nl(c){c.j.read().then(c.Ma.bind(c)).catch(c.ga.bind(c))}n.Ma=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var p=c.value?c.value:new Uint8Array(0);(p=this.B.decode(p,{stream:!c.done}))&&(this.response=this.responseText+=p)}c.done?Yn(this):Qn(this),this.readyState==3&&nl(this)}},n.Oa=function(c){this.g&&(this.response=this.responseText=c,Yn(this))},n.Na=function(c){this.g&&(this.response=c,Yn(this))},n.ga=function(){this.g&&Yn(this)};function Yn(c){c.readyState=4,c.l=null,c.j=null,c.B=null,Qn(c)}n.setRequestHeader=function(c,p){this.A.append(c,p)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],p=this.h.entries();for(var y=p.next();!y.done;)y=y.value,c.push(y[0]+": "+y[1]),y=p.next();return c.join(`\r
`)};function Qn(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(qi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function il(c){let p="";return Vi(c,function(y,_){p+=_,p+=":",p+=y,p+=`\r
`}),p}function Is(c,p,y){e:{for(_ in y){var _=!1;break e}_=!0}_||(y=il(y),typeof c=="string"?y!=null&&Gn(y):oe(c,p,y))}function ue(c){Se.call(this),this.headers=new Map,this.L=c||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(ue,Se);var qp=/^https?$/i,Gp=["POST","PUT"];n=ue.prototype,n.Fa=function(c){this.H=c},n.ea=function(c,p,y,_){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);p=p?p.toUpperCase():"GET",this.D=c,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Fa.g(),this.g.onreadystatechange=g(d(this.Ca,this));try{this.B=!0,this.g.open(p,String(c),!0),this.B=!1}catch(D){ol(this,D);return}if(c=y||"",y=new Map(this.headers),_)if(Object.getPrototypeOf(_)===Object.prototype)for(var P in _)y.set(P,_[P]);else if(typeof _.keys=="function"&&typeof _.get=="function")for(const D of _.keys())y.set(D,_.get(D));else throw Error("Unknown input type for opt_headers: "+String(_));_=Array.from(y.keys()).find(D=>D.toLowerCase()=="content-type"),P=l.FormData&&c instanceof l.FormData,!(Array.prototype.indexOf.call(Gp,p,void 0)>=0)||_||P||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[D,U]of y)this.g.setRequestHeader(D,U);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(c),this.v=!1}catch(D){ol(this,D)}};function ol(c,p){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=p,c.o=5,sl(c),Gi(c)}function sl(c){c.A||(c.A=!0,De(c,"complete"),De(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=c||7,De(this,"complete"),De(this,"abort"),Gi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Gi(this,!0)),ue.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?rl(this):this.Xa())},n.Xa=function(){rl(this)};function rl(c){if(c.h&&typeof s<"u"){if(c.v&&ht(c)==4)setTimeout(c.Ca.bind(c),0);else if(De(c,"readystatechange"),ht(c)==4){c.h=!1;try{const D=c.ca();e:switch(D){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var y;if(!(y=p)){var _;if(_=D===0){let U=String(c.D).match(Ya)[1]||null;!U&&l.self&&l.self.location&&(U=l.self.location.protocol.slice(0,-1)),_=!qp.test(U?U.toLowerCase():"")}y=_}if(y)De(c,"complete"),De(c,"success");else{c.o=6;try{var P=ht(c)>2?c.g.statusText:""}catch{P=""}c.l=P+" ["+c.ca()+"]",sl(c)}}finally{Gi(c)}}}}function Gi(c,p){if(c.g){c.m&&(clearTimeout(c.m),c.m=null);const y=c.g;c.g=null,p||De(c,"ready");try{y.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function ht(c){return c.g?c.g.readyState:0}n.ca=function(){try{return ht(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(c){if(this.g){var p=this.g.responseText;return c&&p.indexOf(c)==0&&(p=p.substring(c.length)),vp(p)}};function al(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.F){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function $p(c){const p={};c=(c.g&&ht(c)>=2&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let _=0;_<c.length;_++){if(I(c[_]))continue;var y=Rp(c[_]);const P=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const D=p[P]||[];p[P]=D,D.push(y)}mp(p,function(_){return _.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Xn(c,p,y){return y&&y.internalChannelParams&&y.internalChannelParams[c]||p}function ll(c){this.za=0,this.i=[],this.j=new qn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Xn("failFast",!1,c),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Xn("baseRetryDelayMs",5e3,c),this.Za=Xn("retryDelaySeedMs",1e4,c),this.Ta=Xn("forwardChannelMaxRetries",2,c),this.va=Xn("forwardChannelRequestTimeoutMs",2e4,c),this.ma=c&&c.xmlHttpFactory||void 0,this.Ua=c&&c.Rb||void 0,this.Aa=c&&c.useFetchStreams||!1,this.O=void 0,this.L=c&&c.supportsCrossDomainXhr||!1,this.M="",this.h=new Ha(c&&c.concurrentRequestLimit),this.Ba=new Op,this.S=c&&c.fastHandshake||!1,this.R=c&&c.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=c&&c.Pb||!1,c&&c.ua&&this.j.ua(),c&&c.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&c&&c.detectBufferingProxy||!1,this.ia=void 0,c&&c.longPollingTimeout&&c.longPollingTimeout>0&&(this.ia=c.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=ll.prototype,n.ka=8,n.I=1,n.connect=function(c,p,y,_){Ne(0),this.W=c,this.H=p||{},y&&_!==void 0&&(this.H.OSID=y,this.H.OAID=_),this.F=this.X,this.J=yl(this,null,this.W),Hi(this)};function Cs(c){if(ul(c),c.I==3){var p=c.V++,y=$e(c.J);if(oe(y,"SID",c.M),oe(y,"RID",p),oe(y,"TYPE","terminate"),Zn(c,y),p=new ct(c,c.j,p),p.M=2,p.A=Oi($e(y)),y=!1,l.navigator&&l.navigator.sendBeacon)try{y=l.navigator.sendBeacon(p.A.toString(),"")}catch{}!y&&l.Image&&(new Image().src=p.A,y=!0),y||(p.g=_l(p.j,null),p.g.ea(p.A)),p.F=Date.now(),Bi(p)}gl(c)}function $i(c){c.g&&(As(c),c.g.cancel(),c.g=null)}function ul(c){$i(c),c.v&&(l.clearTimeout(c.v),c.v=null),zi(c),c.h.cancel(),c.m&&(typeof c.m=="number"&&l.clearTimeout(c.m),c.m=null)}function Hi(c){if(!za(c.h)&&!c.m){c.m=!0;var p=c.Ea;q||v(),H||(q(),H=!0),S.add(p,c),c.D=0}}function Hp(c,p){return Ja(c.h)>=c.h.j-(c.m?1:0)?!1:c.m?(c.i=p.G.concat(c.i),!0):c.I==1||c.I==2||c.D>=(c.Sa?0:c.Ta)?!1:(c.m=On(d(c.Ea,c,p),ml(c,c.D)),c.D++,!0)}n.Ea=function(c){if(this.m)if(this.m=null,this.I==1){if(!c){this.V=Math.floor(Math.random()*1e5),c=this.V++;const P=new ct(this,this.j,c);let D=this.o;if(this.U&&(D?(D=va(D),Ca(D,this.U)):D=this.U),this.u!==null||this.R||(P.J=D,D=null),this.S)e:{for(var p=0,y=0;y<this.i.length;y++){t:{var _=this.i[y];if("__data__"in _.map&&(_=_.map.__data__,typeof _=="string")){_=_.length;break t}_=void 0}if(_===void 0)break;if(p+=_,p>4096){p=y;break e}if(p===4096||y===this.i.length-1){p=y+1;break e}}p=1e3}else p=1e3;p=dl(this,P,p),y=$e(this.J),oe(y,"RID",c),oe(y,"CVER",22),this.G&&oe(y,"X-HTTP-Session-Id",this.G),Zn(this,y),D&&(this.R?p="headers="+Gn(il(D))+"&"+p:this.u&&Is(y,this.u,D)),Ts(this.h,P),this.Ra&&oe(y,"TYPE","init"),this.S?(oe(y,"$req",p),oe(y,"SID","null"),P.U=!0,ms(P,y,null)):ms(P,y,p),this.I=2}}else this.I==3&&(c?cl(this,c):this.i.length==0||za(this.h)||cl(this))};function cl(c,p){var y;p?y=p.l:y=c.V++;const _=$e(c.J);oe(_,"SID",c.M),oe(_,"RID",y),oe(_,"AID",c.K),Zn(c,_),c.u&&c.o&&Is(_,c.u,c.o),y=new ct(c,c.j,y,c.D+1),c.u===null&&(y.J=c.o),p&&(c.i=p.G.concat(c.i)),p=dl(c,y,1e3),y.H=Math.round(c.va*.5)+Math.round(c.va*.5*Math.random()),Ts(c.h,y),ms(y,_,p)}function Zn(c,p){c.H&&Vi(c.H,function(y,_){oe(p,_,y)}),c.l&&Vi({},function(y,_){oe(p,_,y)})}function dl(c,p,y){y=Math.min(c.i.length,y);const _=c.l?d(c.l.Ka,c.l,c):null;e:{var P=c.i;let Q=-1;for(;;){const he=["count="+y];Q==-1?y>0?(Q=P[0].g,he.push("ofs="+Q)):Q=0:he.push("ofs="+Q);let ie=!0;for(let ge=0;ge<y;ge++){var D=P[ge].g;const He=P[ge].map;if(D-=Q,D<0)Q=Math.max(0,P[ge].g-100),ie=!1;else try{D="req"+D+"_"||"";try{var U=He instanceof Map?He:Object.entries(He);for(const[bt,pt]of U){let mt=pt;u(pt)&&(mt=cs(pt)),he.push(D+bt+"="+encodeURIComponent(mt))}}catch(bt){throw he.push(D+"type="+encodeURIComponent("_badmap")),bt}}catch{_&&_(He)}}if(ie){U=he.join("&");break e}}U=void 0}return c=c.i.splice(0,y),p.G=c,U}function fl(c){if(!c.g&&!c.v){c.Y=1;var p=c.Da;q||v(),H||(q(),H=!0),S.add(p,c),c.A=0}}function Ss(c){return c.g||c.v||c.A>=3?!1:(c.Y++,c.v=On(d(c.Da,c),ml(c,c.A)),c.A++,!0)}n.Da=function(){if(this.v=null,hl(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var c=4*this.T;this.j.info("BP detection timer enabled: "+c),this.B=On(d(this.Wa,this),c)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ne(10),$i(this),hl(this))};function As(c){c.B!=null&&(l.clearTimeout(c.B),c.B=null)}function hl(c){c.g=new ct(c,c.j,"rpc",c.Y),c.u===null&&(c.g.J=c.o),c.g.P=0;var p=$e(c.na);oe(p,"RID","rpc"),oe(p,"SID",c.M),oe(p,"AID",c.K),oe(p,"CI",c.F?"0":"1"),!c.F&&c.ia&&oe(p,"TO",c.ia),oe(p,"TYPE","xmlhttp"),Zn(c,p),c.u&&c.o&&Is(p,c.u,c.o),c.O&&(c.g.H=c.O);var y=c.g;c=c.ba,y.M=1,y.A=Oi($e(p)),y.u=null,y.R=!0,qa(y,c)}n.Va=function(){this.C!=null&&(this.C=null,$i(this),Ss(this),Ne(19))};function zi(c){c.C!=null&&(l.clearTimeout(c.C),c.C=null)}function pl(c,p){var y=null;if(c.g==p){zi(c),As(c),c.g=null;var _=2}else if(_s(c.h,p))y=p.G,Wa(c.h,p),_=1;else return;if(c.I!=0){if(p.o)if(_==1){y=p.u?p.u.length:0,p=Date.now()-p.F;var P=c.D;_=Ui(),De(_,new ba(_,y)),Hi(c)}else fl(c);else if(P=p.m,P==3||P==0&&p.X>0||!(_==1&&Hp(c,p)||_==2&&Ss(c)))switch(y&&y.length>0&&(p=c.h,p.i=p.i.concat(y)),P){case 1:Lt(c,5);break;case 4:Lt(c,10);break;case 3:Lt(c,6);break;default:Lt(c,2)}}}function ml(c,p){let y=c.Qa+Math.floor(Math.random()*c.Za);return c.isActive()||(y*=2),y*p}function Lt(c,p){if(c.j.info("Error code "+p),p==2){var y=d(c.bb,c),_=c.Ua;const P=!_;_=new dt(_||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Hn(_,"https"),Oi(_),P?Fp(_.toString(),y):Bp(_.toString(),y)}else Ne(2);c.I=0,c.l&&c.l.pa(p),gl(c),ul(c)}n.bb=function(c){c?(this.j.info("Successfully pinged google.com"),Ne(2)):(this.j.info("Failed to ping google.com"),Ne(1))};function gl(c){if(c.I=0,c.ja=[],c.l){const p=Ka(c.h);(p.length!=0||c.i.length!=0)&&(w(c.ja,p),w(c.ja,c.i),c.h.i.length=0,T(c.i),c.i.length=0),c.l.oa()}}function yl(c,p,y){var _=y instanceof dt?$e(y):new dt(y);if(_.g!="")p&&(_.g=p+"."+_.g),zn(_,_.u);else{var P=l.location;_=P.protocol,p=p?p+"."+P.hostname:P.hostname,P=+P.port;const D=new dt(null);_&&Hn(D,_),p&&(D.g=p),P&&zn(D,P),y&&(D.h=y),_=D}return y=c.G,p=c.wa,y&&p&&oe(_,y,p),oe(_,"VER",c.ka),Zn(c,_),_}function _l(c,p,y){if(p&&!c.L)throw Error("Can't create secondary domain capable XhrIo object.");return p=c.Aa&&!c.ma?new ue(new vs({ab:y})):new ue(c.ma),p.Fa(c.L),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Tl(){}n=Tl.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Ji(){}Ji.prototype.g=function(c,p){return new xe(c,p)};function xe(c,p){Se.call(this),this.g=new ll(p),this.l=c,this.h=p&&p.messageUrlParams||null,c=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(c?c["X-WebChannel-Content-Type"]=p.messageContentType:c={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.sa&&(c?c["X-WebChannel-Client-Profile"]=p.sa:c={"X-WebChannel-Client-Profile":p.sa}),this.g.U=c,(c=p&&p.Qb)&&!I(c)&&(this.g.u=c),this.A=p&&p.supportsCrossDomainXhr||!1,this.v=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!I(p)&&(this.g.G=p,c=this.h,c!==null&&p in c&&(c=this.h,p in c&&delete c[p])),this.j=new nn(this)}m(xe,Se),xe.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},xe.prototype.close=function(){Cs(this.g)},xe.prototype.o=function(c){var p=this.g;if(typeof c=="string"){var y={};y.__data__=c,c=y}else this.v&&(y={},y.__data__=cs(c),c=y);p.i.push(new Dp(p.Ya++,c)),p.I==3&&Hi(p)},xe.prototype.N=function(){this.g.l=null,delete this.j,Cs(this.g),delete this.g,xe.Z.N.call(this)};function El(c){ds.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var p=c.__sm__;if(p){e:{for(const y in p){c=y;break e}c=void 0}(this.i=c)&&(c=this.i,p=p!==null&&c in p?p[c]:void 0),this.data=p}else this.data=c}m(El,ds);function vl(){fs.call(this),this.status=1}m(vl,fs);function nn(c){this.g=c}m(nn,Tl),nn.prototype.ra=function(){De(this.g,"a")},nn.prototype.qa=function(c){De(this.g,new El(c))},nn.prototype.pa=function(c){De(this.g,new vl)},nn.prototype.oa=function(){De(this.g,"b")},Ji.prototype.createWebChannel=Ji.prototype.g,xe.prototype.send=xe.prototype.o,xe.prototype.open=xe.prototype.m,xe.prototype.close=xe.prototype.close,mf=function(){return new Ji},pf=function(){return Ui()},hf=kt,sr={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Fi.NO_ERROR=0,Fi.TIMEOUT=8,Fi.HTTP_ERROR=6,oo=Fi,Ua.COMPLETE="complete",ff=Ua,ka.EventType=Fn,Fn.OPEN="a",Fn.CLOSE="b",Fn.ERROR="c",Fn.MESSAGE="d",Se.prototype.listen=Se.prototype.J,ei=ka,ue.prototype.listenOnce=ue.prototype.K,ue.prototype.getLastError=ue.prototype.Ha,ue.prototype.getLastErrorCode=ue.prototype.ya,ue.prototype.getStatus=ue.prototype.ca,ue.prototype.getResponseJson=ue.prototype.La,ue.prototype.getResponseText=ue.prototype.la,ue.prototype.send=ue.prototype.ea,ue.prototype.setWithCredentials=ue.prototype.Fa,df=ue}).apply(typeof Qi<"u"?Qi:typeof self<"u"?self:typeof window<"u"?window:{});const nc="@firebase/firestore",ic="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class we{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}we.UNAUTHENTICATED=new we(null),we.GOOGLE_CREDENTIALS=new we("google-credentials-uid"),we.FIRST_PARTY=new we("first-party-uid"),we.MOCK_USER=new we("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nn="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zt=new Nr("@firebase/firestore");function sn(){return zt.logLevel}function F(n,...e){if(zt.logLevel<=X.DEBUG){const t=e.map(Vr);zt.debug(`Firestore (${Nn}): ${n}`,...t)}}function st(n,...e){if(zt.logLevel<=X.ERROR){const t=e.map(Vr);zt.error(`Firestore (${Nn}): ${n}`,...t)}}function _n(n,...e){if(zt.logLevel<=X.WARN){const t=e.map(Vr);zt.warn(`Firestore (${Nn}): ${n}`,...t)}}function Vr(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z(n,e,t){let i="Unexpected state";typeof e=="string"?i=e:t=e,gf(n,i,t)}function gf(n,e,t){let i=`FIRESTORE (${Nn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{i+=" CONTEXT: "+JSON.stringify(t)}catch{i+=" CONTEXT: "+t}throw st(i),new Error(i)}function ne(n,e,t,i){let o="Unexpected state";typeof t=="string"?o=t:i=t,n||gf(e,o,i)}function K(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class G extends ut{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class At{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yf{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Sw{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(we.UNAUTHENTICATED)))}shutdown(){}}class Aw{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class ww{constructor(e){this.t=e,this.currentUser=we.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ne(this.o===void 0,42304);let i=this.i;const o=f=>this.i!==i?(i=this.i,t(f)):Promise.resolve();let s=new At;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new At,e.enqueueRetryable((()=>o(this.currentUser)))};const l=()=>{const f=s;e.enqueueRetryable((async()=>{await f.promise,await o(this.currentUser)}))},u=f=>{F("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((f=>u(f))),setTimeout((()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?u(f):(F("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new At)}}),0),l()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((i=>this.i!==e?(F("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(ne(typeof i.accessToken=="string",31837,{l:i}),new yf(i.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ne(e===null||typeof e=="string",2055,{h:e}),new we(e)}}class Rw{constructor(e,t,i){this.P=e,this.T=t,this.I=i,this.type="FirstParty",this.user=we.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Pw{constructor(e,t,i){this.P=e,this.T=t,this.I=i}getToken(){return Promise.resolve(new Rw(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(we.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class oc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Mw{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Fe(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ne(this.o===void 0,3512);const i=s=>{s.error!=null&&F("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const l=s.token!==this.m;return this.m=s.token,F("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable((()=>i(s)))};const o=s=>{F("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((s=>o(s))),setTimeout((()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?o(s):F("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new oc(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ne(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new oc(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dw(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lr{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const o=Dw(40);for(let s=0;s<o.length;++s)i.length<20&&o[s]<t&&(i+=e.charAt(o[s]%62))}return i}}function Z(n,e){return n<e?-1:n>e?1:0}function rr(n,e){const t=Math.min(n.length,e.length);for(let i=0;i<t;i++){const o=n.charAt(i),s=e.charAt(i);if(o!==s)return Ls(o)===Ls(s)?Z(o,s):Ls(o)?1:-1}return Z(n.length,e.length)}const Nw=55296,kw=57343;function Ls(n){const e=n.charCodeAt(0);return e>=Nw&&e<=kw}function Tn(n,e,t){return n.length===e.length&&n.every(((i,o)=>t(i,e[o])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sc="__name__";class ze{constructor(e,t,i){t===void 0?t=0:t>e.length&&z(637,{offset:t,range:e.length}),i===void 0?i=e.length-t:i>e.length-t&&z(1746,{length:i,range:e.length-t}),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return ze.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ze?e.forEach((i=>{t.push(i)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let o=0;o<i;o++){const s=ze.compareSegments(e.get(o),t.get(o));if(s!==0)return s}return Z(e.length,t.length)}static compareSegments(e,t){const i=ze.isNumericId(e),o=ze.isNumericId(t);return i&&!o?-1:!i&&o?1:i&&o?ze.extractNumericId(e).compare(ze.extractNumericId(t)):rr(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return St.fromString(e.substring(4,e.length-2))}}class ae extends ze{construct(e,t,i){return new ae(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new G(x.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter((o=>o.length>0)))}return new ae(t)}static emptyPath(){return new ae([])}}const xw=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ie extends ze{construct(e,t,i){return new Ie(e,t,i)}static isValidIdentifier(e){return xw.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ie.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===sc}static keyField(){return new Ie([sc])}static fromServerFormat(e){const t=[];let i="",o=0;const s=()=>{if(i.length===0)throw new G(x.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let l=!1;for(;o<e.length;){const u=e[o];if(u==="\\"){if(o+1===e.length)throw new G(x.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[o+1];if(f!=="\\"&&f!=="."&&f!=="`")throw new G(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=f,o+=2}else u==="`"?(l=!l,o++):u!=="."||l?(i+=u,o++):(s(),o++)}if(s(),l)throw new G(x.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ie(t)}static emptyPath(){return new Ie([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ${constructor(e){this.path=e}static fromPath(e){return new $(ae.fromString(e))}static fromName(e){return new $(ae.fromString(e).popFirst(5))}static empty(){return new $(ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ae.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ae.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new $(new ae(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vw(n,e,t){if(!t)throw new G(x.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Lw(n,e,t,i){if(e===!0&&i===!0)throw new G(x.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function rc(n){if(!$.isDocumentKey(n))throw new G(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function _f(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function br(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(i){return i.constructor?i.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":z(12329,{type:typeof n})}function hi(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new G(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=br(n);throw new G(x.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fe(n,e){const t={typeString:n};return e&&(t.value=e),t}function Ai(n,e){if(!_f(n))throw new G(x.INVALID_ARGUMENT,"JSON must be an object");let t;for(const i in e)if(e[i]){const o=e[i].typeString,s="value"in e[i]?{value:e[i].value}:void 0;if(!(i in n)){t=`JSON missing required field: '${i}'`;break}const l=n[i];if(o&&typeof l!==o){t=`JSON field '${i}' must be a ${o}.`;break}if(s!==void 0&&l!==s.value){t=`Expected '${i}' field to equal '${s.value}'`;break}}if(t)throw new G(x.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ac=-62135596800,lc=1e6;class re{static now(){return re.fromMillis(Date.now())}static fromDate(e){return re.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor((e-1e3*t)*lc);return new re(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new G(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new G(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ac)throw new G(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new G(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/lc}_compareTo(e){return this.seconds===e.seconds?Z(this.nanoseconds,e.nanoseconds):Z(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:re._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ai(e,re._jsonSchema))return new re(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-ac;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}re._jsonSchemaVersion="firestore/timestamp/1.0",re._jsonSchema={type:fe("string",re._jsonSchemaVersion),seconds:fe("number"),nanoseconds:fe("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W{static fromTimestamp(e){return new W(e)}static min(){return new W(new re(0,0))}static max(){return new W(new re(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pi=-1;function bw(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,o=W.fromTimestamp(i===1e9?new re(t+1,0):new re(t,i));return new wt(o,$.empty(),e)}function Uw(n){return new wt(n.readTime,n.key,pi)}class wt{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new wt(W.min(),$.empty(),pi)}static max(){return new wt(W.max(),$.empty(),pi)}}function Fw(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=$.comparator(n.documentKey,e.documentKey),t!==0?t:Z(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ow{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kn(n){if(n.code!==x.FAILED_PRECONDITION||n.message!==Bw)throw n;F("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&z(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new k(((i,o)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,o)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,o)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof k?t:k.resolve(t)}catch(t){return k.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):k.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):k.reject(t)}static resolve(e){return new k(((t,i)=>{t(e)}))}static reject(e){return new k(((t,i)=>{i(e)}))}static waitFor(e){return new k(((t,i)=>{let o=0,s=0,l=!1;e.forEach((u=>{++o,u.next((()=>{++s,l&&s===o&&t()}),(f=>i(f)))})),l=!0,s===o&&t()}))}static or(e){let t=k.resolve(!1);for(const i of e)t=t.next((o=>o?k.resolve(o):i()));return t}static forEach(e,t){const i=[];return e.forEach(((o,s)=>{i.push(t.call(this,o,s))})),this.waitFor(i)}static mapArray(e,t){return new k(((i,o)=>{const s=e.length,l=new Array(s);let u=0;for(let f=0;f<s;f++){const d=f;t(e[d]).next((h=>{l[d]=h,++u,u===s&&i(l)}),(h=>o(h)))}}))}static doWhile(e,t){return new k(((i,o)=>{const s=()=>{e()===!0?t().next((()=>{s()}),o):i()};s()}))}}function qw(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function xn(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Go{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>t.writeSequenceNumber(i))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Go.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ur=-1;function $o(n){return n==null}function Eo(n){return n===0&&1/n==-1/0}function Gw(n){return typeof n=="number"&&Number.isInteger(n)&&!Eo(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tf="";function $w(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=uc(e)),e=Hw(n.get(t),e);return uc(e)}function Hw(n,e){let t=e;const i=n.length;for(let o=0;o<i;o++){const s=n.charAt(o);switch(s){case"\0":t+="";break;case Tf:t+="";break;default:t+=s}}return t}function uc(n){return n+Tf+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cc(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Qt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Ef(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class le{constructor(e,t){this.comparator=e,this.root=t||ve.EMPTY}insert(e,t){return new le(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ve.BLACK,null,null))}remove(e){return new le(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ve.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const o=this.comparator(e,i.key);if(o===0)return t+i.left.size;o<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,i)=>(e(t,i),!1)))}toString(){const e=[];return this.inorderTraversal(((t,i)=>(e.push(`${t}:${i}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Xi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Xi(this.root,e,this.comparator,!1)}getReverseIterator(){return new Xi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Xi(this.root,e,this.comparator,!0)}}class Xi{constructor(e,t,i,o){this.isReverse=o,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&o&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ve{constructor(e,t,i,o,s){this.key=e,this.value=t,this.color=i??ve.RED,this.left=o??ve.EMPTY,this.right=s??ve.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,o,s){return new ve(e??this.key,t??this.value,i??this.color,o??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let o=this;const s=i(e,o.key);return o=s<0?o.copy(null,null,null,o.left.insert(e,t,i),null):s===0?o.copy(null,t,null,null,null):o.copy(null,null,null,null,o.right.insert(e,t,i)),o.fixUp()}removeMin(){if(this.left.isEmpty())return ve.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,o=this;if(t(e,o.key)<0)o.left.isEmpty()||o.left.isRed()||o.left.left.isRed()||(o=o.moveRedLeft()),o=o.copy(null,null,null,o.left.remove(e,t),null);else{if(o.left.isRed()&&(o=o.rotateRight()),o.right.isEmpty()||o.right.isRed()||o.right.left.isRed()||(o=o.moveRedRight()),t(e,o.key)===0){if(o.right.isEmpty())return ve.EMPTY;i=o.right.min(),o=o.copy(i.key,i.value,null,null,o.right.removeMin())}o=o.copy(null,null,null,null,o.right.remove(e,t))}return o.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ve.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ve.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw z(43730,{key:this.key,value:this.value});if(this.right.isRed())throw z(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw z(27949);return e+(this.isRed()?0:1)}}ve.EMPTY=null,ve.RED=!0,ve.BLACK=!1;ve.EMPTY=new class{constructor(){this.size=0}get key(){throw z(57766)}get value(){throw z(16141)}get color(){throw z(16727)}get left(){throw z(29726)}get right(){throw z(36894)}copy(e,t,i,o,s){return this}insert(e,t,i){return new ve(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class me{constructor(e){this.comparator=e,this.data=new le(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,i)=>(e(t),!1)))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const o=i.getNext();if(this.comparator(o.key,e[1])>=0)return;t(o.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new dc(this.data.getIterator())}getIteratorFrom(e){return new dc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((i=>{t=t.add(i)})),t}isEqual(e){if(!(e instanceof me)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const o=t.getNext().key,s=i.getNext().key;if(this.comparator(o,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new me(this.comparator);return t.data=e,t}}class dc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Be{constructor(e){this.fields=e,e.sort(Ie.comparator)}static empty(){return new Be([])}unionWith(e){let t=new me(Ie.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new Be(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Tn(this.fields,e.fields,((t,i)=>t.isEqual(i)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vf extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ce{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(o){try{return atob(o)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new vf("Invalid base64 string: "+s):s}})(e);return new Ce(t)}static fromUint8Array(e){const t=(function(o){let s="";for(let l=0;l<o.length;++l)s+=String.fromCharCode(o[l]);return s})(e);return new Ce(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const i=new Uint8Array(t.length);for(let o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return i})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Z(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ce.EMPTY_BYTE_STRING=new Ce("");const zw=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Rt(n){if(ne(!!n,39018),typeof n=="string"){let e=0;const t=zw.exec(n);if(ne(!!t,46558,{timestamp:n}),t[1]){let o=t[1];o=(o+"000000000").substr(0,9),e=Number(o)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ce(n.seconds),nanos:ce(n.nanos)}}function ce(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Pt(n){return typeof n=="string"?Ce.fromBase64String(n):Ce.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const If="server_timestamp",Cf="__type__",Sf="__previous_value__",Af="__local_write_time__";function Fr(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Cf])==null?void 0:i.stringValue)===If}function Ho(n){const e=n.mapValue.fields[Sf];return Fr(e)?Ho(e):e}function mi(n){const e=Rt(n.mapValue.fields[Af].timestampValue);return new re(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jw{constructor(e,t,i,o,s,l,u,f,d,h){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=o,this.ssl=s,this.forceLongPolling=l,this.autoDetectLongPolling=u,this.longPollingOptions=f,this.useFetchStreams=d,this.isUsingEmulator=h}}const vo="(default)";class gi{constructor(e,t){this.projectId=e,this.database=t||vo}static empty(){return new gi("","")}get isDefaultDatabase(){return this.database===vo}isEqual(e){return e instanceof gi&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wf="__type__",Ww="__max__",Zi={mapValue:{}},Rf="__vector__",Io="value";function Mt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Fr(n)?4:Yw(n)?9007199254740991:Kw(n)?10:11:z(28295,{value:n})}function Xe(n,e){if(n===e)return!0;const t=Mt(n);if(t!==Mt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return mi(n).isEqual(mi(e));case 3:return(function(o,s){if(typeof o.timestampValue=="string"&&typeof s.timestampValue=="string"&&o.timestampValue.length===s.timestampValue.length)return o.timestampValue===s.timestampValue;const l=Rt(o.timestampValue),u=Rt(s.timestampValue);return l.seconds===u.seconds&&l.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(o,s){return Pt(o.bytesValue).isEqual(Pt(s.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(o,s){return ce(o.geoPointValue.latitude)===ce(s.geoPointValue.latitude)&&ce(o.geoPointValue.longitude)===ce(s.geoPointValue.longitude)})(n,e);case 2:return(function(o,s){if("integerValue"in o&&"integerValue"in s)return ce(o.integerValue)===ce(s.integerValue);if("doubleValue"in o&&"doubleValue"in s){const l=ce(o.doubleValue),u=ce(s.doubleValue);return l===u?Eo(l)===Eo(u):isNaN(l)&&isNaN(u)}return!1})(n,e);case 9:return Tn(n.arrayValue.values||[],e.arrayValue.values||[],Xe);case 10:case 11:return(function(o,s){const l=o.mapValue.fields||{},u=s.mapValue.fields||{};if(cc(l)!==cc(u))return!1;for(const f in l)if(l.hasOwnProperty(f)&&(u[f]===void 0||!Xe(l[f],u[f])))return!1;return!0})(n,e);default:return z(52216,{left:n})}}function yi(n,e){return(n.values||[]).find((t=>Xe(t,e)))!==void 0}function En(n,e){if(n===e)return 0;const t=Mt(n),i=Mt(e);if(t!==i)return Z(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return Z(n.booleanValue,e.booleanValue);case 2:return(function(s,l){const u=ce(s.integerValue||s.doubleValue),f=ce(l.integerValue||l.doubleValue);return u<f?-1:u>f?1:u===f?0:isNaN(u)?isNaN(f)?0:-1:1})(n,e);case 3:return fc(n.timestampValue,e.timestampValue);case 4:return fc(mi(n),mi(e));case 5:return rr(n.stringValue,e.stringValue);case 6:return(function(s,l){const u=Pt(s),f=Pt(l);return u.compareTo(f)})(n.bytesValue,e.bytesValue);case 7:return(function(s,l){const u=s.split("/"),f=l.split("/");for(let d=0;d<u.length&&d<f.length;d++){const h=Z(u[d],f[d]);if(h!==0)return h}return Z(u.length,f.length)})(n.referenceValue,e.referenceValue);case 8:return(function(s,l){const u=Z(ce(s.latitude),ce(l.latitude));return u!==0?u:Z(ce(s.longitude),ce(l.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return hc(n.arrayValue,e.arrayValue);case 10:return(function(s,l){var g,T,w,M;const u=s.fields||{},f=l.fields||{},d=(g=u[Io])==null?void 0:g.arrayValue,h=(T=f[Io])==null?void 0:T.arrayValue,m=Z(((w=d==null?void 0:d.values)==null?void 0:w.length)||0,((M=h==null?void 0:h.values)==null?void 0:M.length)||0);return m!==0?m:hc(d,h)})(n.mapValue,e.mapValue);case 11:return(function(s,l){if(s===Zi.mapValue&&l===Zi.mapValue)return 0;if(s===Zi.mapValue)return 1;if(l===Zi.mapValue)return-1;const u=s.fields||{},f=Object.keys(u),d=l.fields||{},h=Object.keys(d);f.sort(),h.sort();for(let m=0;m<f.length&&m<h.length;++m){const g=rr(f[m],h[m]);if(g!==0)return g;const T=En(u[f[m]],d[h[m]]);if(T!==0)return T}return Z(f.length,h.length)})(n.mapValue,e.mapValue);default:throw z(23264,{he:t})}}function fc(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Z(n,e);const t=Rt(n),i=Rt(e),o=Z(t.seconds,i.seconds);return o!==0?o:Z(t.nanos,i.nanos)}function hc(n,e){const t=n.values||[],i=e.values||[];for(let o=0;o<t.length&&o<i.length;++o){const s=En(t[o],i[o]);if(s)return s}return Z(t.length,i.length)}function vn(n){return ar(n)}function ar(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const i=Rt(t);return`time(${i.seconds},${i.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Pt(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return $.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let i="[",o=!0;for(const s of t.values||[])o?o=!1:i+=",",i+=ar(s);return i+"]"})(n.arrayValue):"mapValue"in n?(function(t){const i=Object.keys(t.fields||{}).sort();let o="{",s=!0;for(const l of i)s?s=!1:o+=",",o+=`${l}:${ar(t.fields[l])}`;return o+"}"})(n.mapValue):z(61005,{value:n})}function so(n){switch(Mt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ho(n);return e?16+so(e):16;case 5:return 2*n.stringValue.length;case 6:return Pt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(i){return(i.values||[]).reduce(((o,s)=>o+so(s)),0)})(n.arrayValue);case 10:case 11:return(function(i){let o=0;return Qt(i.fields,((s,l)=>{o+=s.length+so(l)})),o})(n.mapValue);default:throw z(13486,{value:n})}}function lr(n){return!!n&&"integerValue"in n}function Br(n){return!!n&&"arrayValue"in n}function pc(n){return!!n&&"nullValue"in n}function mc(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ro(n){return!!n&&"mapValue"in n}function Kw(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[wf])==null?void 0:i.stringValue)===Rf}function ri(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Qt(n.mapValue.fields,((t,i)=>e.mapValue.fields[t]=ri(i))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ri(n.arrayValue.values[t]);return e}return{...n}}function Yw(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Ww}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ve{constructor(e){this.value=e}static empty(){return new Ve({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!ro(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ri(t)}setAll(e){let t=Ie.emptyPath(),i={},o=[];e.forEach(((l,u)=>{if(!t.isImmediateParentOf(u)){const f=this.getFieldsMap(t);this.applyChanges(f,i,o),i={},o=[],t=u.popLast()}l?i[u.lastSegment()]=ri(l):o.push(u.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,i,o)}delete(e){const t=this.field(e.popLast());ro(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Xe(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let o=t.mapValue.fields[e.get(i)];ro(o)&&o.mapValue.fields||(o={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=o),t=o}return t.mapValue.fields}applyChanges(e,t,i){Qt(t,((o,s)=>e[o]=s));for(const o of i)delete e[o]}clone(){return new Ve(ri(this.value))}}function Pf(n){const e=[];return Qt(n.fields,((t,i)=>{const o=new Ie([t]);if(ro(i)){const s=Pf(i.mapValue).fields;if(s.length===0)e.push(o);else for(const l of s)e.push(o.child(l))}else e.push(o)})),new Be(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e,t,i,o,s,l,u){this.key=e,this.documentType=t,this.version=i,this.readTime=o,this.createTime=s,this.data=l,this.documentState=u}static newInvalidDocument(e){return new Re(e,0,W.min(),W.min(),W.min(),Ve.empty(),0)}static newFoundDocument(e,t,i,o){return new Re(e,1,t,W.min(),i,o,0)}static newNoDocument(e,t){return new Re(e,2,t,W.min(),W.min(),Ve.empty(),0)}static newUnknownDocument(e,t){return new Re(e,3,t,W.min(),W.min(),Ve.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(W.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ve.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ve.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=W.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Re&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Re(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Co{constructor(e,t){this.position=e,this.inclusive=t}}function gc(n,e,t){let i=0;for(let o=0;o<n.position.length;o++){const s=e[o],l=n.position[o];if(s.field.isKeyField()?i=$.comparator($.fromName(l.referenceValue),t.key):i=En(l,t.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function yc(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Xe(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class So{constructor(e,t="asc"){this.field=e,this.dir=t}}function Qw(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mf{}class pe extends Mf{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new Zw(e,t,i):t==="array-contains"?new tR(e,i):t==="in"?new nR(e,i):t==="not-in"?new iR(e,i):t==="array-contains-any"?new oR(e,i):new pe(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new jw(e,i):new eR(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(En(t,this.value)):t!==null&&Mt(this.value)===Mt(t)&&this.matchesComparison(En(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return z(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ze extends Mf{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ze(e,t)}matches(e){return Df(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Df(n){return n.op==="and"}function Nf(n){return Xw(n)&&Df(n)}function Xw(n){for(const e of n.filters)if(e instanceof Ze)return!1;return!0}function ur(n){if(n instanceof pe)return n.field.canonicalString()+n.op.toString()+vn(n.value);if(Nf(n))return n.filters.map((e=>ur(e))).join(",");{const e=n.filters.map((t=>ur(t))).join(",");return`${n.op}(${e})`}}function kf(n,e){return n instanceof pe?(function(i,o){return o instanceof pe&&i.op===o.op&&i.field.isEqual(o.field)&&Xe(i.value,o.value)})(n,e):n instanceof Ze?(function(i,o){return o instanceof Ze&&i.op===o.op&&i.filters.length===o.filters.length?i.filters.reduce(((s,l,u)=>s&&kf(l,o.filters[u])),!0):!1})(n,e):void z(19439)}function xf(n){return n instanceof pe?(function(t){return`${t.field.canonicalString()} ${t.op} ${vn(t.value)}`})(n):n instanceof Ze?(function(t){return t.op.toString()+" {"+t.getFilters().map(xf).join(" ,")+"}"})(n):"Filter"}class Zw extends pe{constructor(e,t,i){super(e,t,i),this.key=$.fromName(i.referenceValue)}matches(e){const t=$.comparator(e.key,this.key);return this.matchesComparison(t)}}class jw extends pe{constructor(e,t){super(e,"in",t),this.keys=Vf("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class eR extends pe{constructor(e,t){super(e,"not-in",t),this.keys=Vf("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Vf(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map((i=>$.fromName(i.referenceValue)))}class tR extends pe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Br(t)&&yi(t.arrayValue,this.value)}}class nR extends pe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&yi(this.value.arrayValue,t)}}class iR extends pe{constructor(e,t){super(e,"not-in",t)}matches(e){if(yi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!yi(this.value.arrayValue,t)}}class oR extends pe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Br(t)||!t.arrayValue.values)&&t.arrayValue.values.some((i=>yi(this.value.arrayValue,i)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sR{constructor(e,t=null,i=[],o=[],s=null,l=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=o,this.limit=s,this.startAt=l,this.endAt=u,this.Te=null}}function _c(n,e=null,t=[],i=[],o=null,s=null,l=null){return new sR(n,e,t,i,o,s,l)}function Or(n){const e=K(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((i=>ur(i))).join(","),t+="|ob:",t+=e.orderBy.map((i=>(function(s){return s.field.canonicalString()+s.dir})(i))).join(","),$o(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((i=>vn(i))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((i=>vn(i))).join(",")),e.Te=t}return e.Te}function qr(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Qw(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!kf(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!yc(n.startAt,e.startAt)&&yc(n.endAt,e.endAt)}function cr(n){return $.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zo{constructor(e,t=null,i=[],o=[],s=null,l="F",u=null,f=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=o,this.limit=s,this.limitType=l,this.startAt=u,this.endAt=f,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function rR(n,e,t,i,o,s,l,u){return new zo(n,e,t,i,o,s,l,u)}function Gr(n){return new zo(n)}function Tc(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function aR(n){return n.collectionGroup!==null}function ai(n){const e=K(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let u=new me(Ie.comparator);return l.filters.forEach((f=>{f.getFlattenedFilters().forEach((d=>{d.isInequality()&&(u=u.add(d.field))}))})),u})(e).forEach((s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new So(s,i))})),t.has(Ie.keyField().canonicalString())||e.Ie.push(new So(Ie.keyField(),i))}return e.Ie}function Je(n){const e=K(n);return e.Ee||(e.Ee=lR(e,ai(n))),e.Ee}function lR(n,e){if(n.limitType==="F")return _c(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((o=>{const s=o.dir==="desc"?"asc":"desc";return new So(o.field,s)}));const t=n.endAt?new Co(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new Co(n.startAt.position,n.startAt.inclusive):null;return _c(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function dr(n,e,t){return new zo(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Jo(n,e){return qr(Je(n),Je(e))&&n.limitType===e.limitType}function Lf(n){return`${Or(Je(n))}|lt:${n.limitType}`}function rn(n){return`Query(target=${(function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map((o=>xf(o))).join(", ")}]`),$o(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map((o=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(o))).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map((o=>vn(o))).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map((o=>vn(o))).join(",")),`Target(${i})`})(Je(n))}; limitType=${n.limitType})`}function Wo(n,e){return e.isFoundDocument()&&(function(i,o){const s=o.key.path;return i.collectionGroup!==null?o.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):$.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)})(n,e)&&(function(i,o){for(const s of ai(i))if(!s.field.isKeyField()&&o.data.field(s.field)===null)return!1;return!0})(n,e)&&(function(i,o){for(const s of i.filters)if(!s.matches(o))return!1;return!0})(n,e)&&(function(i,o){return!(i.startAt&&!(function(l,u,f){const d=gc(l,u,f);return l.inclusive?d<=0:d<0})(i.startAt,ai(i),o)||i.endAt&&!(function(l,u,f){const d=gc(l,u,f);return l.inclusive?d>=0:d>0})(i.endAt,ai(i),o))})(n,e)}function uR(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function bf(n){return(e,t)=>{let i=!1;for(const o of ai(n)){const s=cR(o,e,t);if(s!==0)return s;i=i||o.field.isKeyField()}return 0}}function cR(n,e,t){const i=n.field.isKeyField()?$.comparator(e.key,t.key):(function(s,l,u){const f=l.data.field(s),d=u.data.field(s);return f!==null&&d!==null?En(f,d):z(42886)})(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return z(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[o,s]of i)if(this.equalsFn(o,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),o=this.inner[i];if(o===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<o.length;s++)if(this.equalsFn(o[s][0],e))return void(o[s]=[e,t]);o.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return i.length===1?delete this.inner[t]:i.splice(o,1),this.innerSize--,!0;return!1}forEach(e){Qt(this.inner,((t,i)=>{for(const[o,s]of i)e(o,s)}))}isEmpty(){return Ef(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dR=new le($.comparator);function rt(){return dR}const Uf=new le($.comparator);function ti(...n){let e=Uf;for(const t of n)e=e.insert(t.key,t);return e}function Ff(n){let e=Uf;return n.forEach(((t,i)=>e=e.insert(t,i.overlayedDocument))),e}function Ft(){return li()}function Bf(){return li()}function li(){return new Xt((n=>n.toString()),((n,e)=>n.isEqual(e)))}const fR=new le($.comparator),hR=new me($.comparator);function j(...n){let e=hR;for(const t of n)e=e.add(t);return e}const pR=new me(Z);function mR(){return pR}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $r(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Eo(e)?"-0":e}}function Of(n){return{integerValue:""+n}}function gR(n,e){return Gw(e)?Of(e):$r(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ko{constructor(){this._=void 0}}function yR(n,e,t){return n instanceof Ao?(function(o,s){const l={fields:{[Cf]:{stringValue:If},[Af]:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return s&&Fr(s)&&(s=Ho(s)),s&&(l.fields[Sf]=s),{mapValue:l}})(t,e):n instanceof _i?Gf(n,e):n instanceof Ti?$f(n,e):(function(o,s){const l=qf(o,s),u=Ec(l)+Ec(o.Ae);return lr(l)&&lr(o.Ae)?Of(u):$r(o.serializer,u)})(n,e)}function _R(n,e,t){return n instanceof _i?Gf(n,e):n instanceof Ti?$f(n,e):t}function qf(n,e){return n instanceof wo?(function(i){return lr(i)||(function(s){return!!s&&"doubleValue"in s})(i)})(e)?e:{integerValue:0}:null}class Ao extends Ko{}class _i extends Ko{constructor(e){super(),this.elements=e}}function Gf(n,e){const t=Hf(e);for(const i of n.elements)t.some((o=>Xe(o,i)))||t.push(i);return{arrayValue:{values:t}}}class Ti extends Ko{constructor(e){super(),this.elements=e}}function $f(n,e){let t=Hf(e);for(const i of n.elements)t=t.filter((o=>!Xe(o,i)));return{arrayValue:{values:t}}}class wo extends Ko{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Ec(n){return ce(n.integerValue||n.doubleValue)}function Hf(n){return Br(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function TR(n,e){return n.field.isEqual(e.field)&&(function(i,o){return i instanceof _i&&o instanceof _i||i instanceof Ti&&o instanceof Ti?Tn(i.elements,o.elements,Xe):i instanceof wo&&o instanceof wo?Xe(i.Ae,o.Ae):i instanceof Ao&&o instanceof Ao})(n.transform,e.transform)}class ER{constructor(e,t){this.version=e,this.transformResults=t}}class it{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new it}static exists(e){return new it(void 0,e)}static updateTime(e){return new it(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ao(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Yo{}function zf(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Wf(n.key,it.none()):new wi(n.key,n.data,it.none());{const t=n.data,i=Ve.empty();let o=new me(Ie.comparator);for(let s of e.fields)if(!o.has(s)){let l=t.field(s);l===null&&s.length>1&&(s=s.popLast(),l=t.field(s)),l===null?i.delete(s):i.set(s,l),o=o.add(s)}return new Zt(n.key,i,new Be(o.toArray()),it.none())}}function vR(n,e,t){n instanceof wi?(function(o,s,l){const u=o.value.clone(),f=Ic(o.fieldTransforms,s,l.transformResults);u.setAll(f),s.convertToFoundDocument(l.version,u).setHasCommittedMutations()})(n,e,t):n instanceof Zt?(function(o,s,l){if(!ao(o.precondition,s))return void s.convertToUnknownDocument(l.version);const u=Ic(o.fieldTransforms,s,l.transformResults),f=s.data;f.setAll(Jf(o)),f.setAll(u),s.convertToFoundDocument(l.version,f).setHasCommittedMutations()})(n,e,t):(function(o,s,l){s.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,t)}function ui(n,e,t,i){return n instanceof wi?(function(s,l,u,f){if(!ao(s.precondition,l))return u;const d=s.value.clone(),h=Cc(s.fieldTransforms,f,l);return d.setAll(h),l.convertToFoundDocument(l.version,d).setHasLocalMutations(),null})(n,e,t,i):n instanceof Zt?(function(s,l,u,f){if(!ao(s.precondition,l))return u;const d=Cc(s.fieldTransforms,f,l),h=l.data;return h.setAll(Jf(s)),h.setAll(d),l.convertToFoundDocument(l.version,h).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map((m=>m.field)))})(n,e,t,i):(function(s,l,u){return ao(s.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):u})(n,e,t)}function IR(n,e){let t=null;for(const i of n.fieldTransforms){const o=e.data.field(i.field),s=qf(i.transform,o||null);s!=null&&(t===null&&(t=Ve.empty()),t.set(i.field,s))}return t||null}function vc(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(i,o){return i===void 0&&o===void 0||!(!i||!o)&&Tn(i,o,((s,l)=>TR(s,l)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class wi extends Yo{constructor(e,t,i,o=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=o,this.type=0}getFieldMask(){return null}}class Zt extends Yo{constructor(e,t,i,o,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=o,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Jf(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}})),e}function Ic(n,e,t){const i=new Map;ne(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let o=0;o<t.length;o++){const s=n[o],l=s.transform,u=e.data.field(s.field);i.set(s.field,_R(l,u,t[o]))}return i}function Cc(n,e,t){const i=new Map;for(const o of n){const s=o.transform,l=t.data.field(o.field);i.set(o.field,yR(s,l,e))}return i}class Wf extends Yo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class CR extends Yo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(e,t,i,o){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=o}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let o=0;o<this.mutations.length;o++){const s=this.mutations[o];s.key.isEqual(e.key)&&vR(s,e,i[o])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=ui(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=ui(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=Bf();return this.mutations.forEach((o=>{const s=e.get(o.key),l=s.overlayedDocument;let u=this.applyToLocalView(l,s.mutatedFields);u=t.has(o.key)?null:u;const f=zf(l,u);f!==null&&i.set(o.key,f),l.isValidDocument()||l.convertToNoDocument(W.min())})),i}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),j())}isEqual(e){return this.batchId===e.batchId&&Tn(this.mutations,e.mutations,((t,i)=>vc(t,i)))&&Tn(this.baseMutations,e.baseMutations,((t,i)=>vc(t,i)))}}class Hr{constructor(e,t,i,o){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=o}static from(e,t,i){ne(e.mutations.length===i.length,58842,{me:e.mutations.length,fe:i.length});let o=(function(){return fR})();const s=e.mutations;for(let l=0;l<s.length;l++)o=o.insert(s[l].key,i[l].version);return new Hr(e,t,i,o)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AR{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var de,ee;function RR(n){switch(n){case x.OK:return z(64938);case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return!1;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return!0;default:return z(15467,{code:n})}}function Kf(n){if(n===void 0)return st("GRPC error has no .code"),x.UNKNOWN;switch(n){case de.OK:return x.OK;case de.CANCELLED:return x.CANCELLED;case de.UNKNOWN:return x.UNKNOWN;case de.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case de.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case de.INTERNAL:return x.INTERNAL;case de.UNAVAILABLE:return x.UNAVAILABLE;case de.UNAUTHENTICATED:return x.UNAUTHENTICATED;case de.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case de.NOT_FOUND:return x.NOT_FOUND;case de.ALREADY_EXISTS:return x.ALREADY_EXISTS;case de.PERMISSION_DENIED:return x.PERMISSION_DENIED;case de.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case de.ABORTED:return x.ABORTED;case de.OUT_OF_RANGE:return x.OUT_OF_RANGE;case de.UNIMPLEMENTED:return x.UNIMPLEMENTED;case de.DATA_LOSS:return x.DATA_LOSS;default:return z(39323,{code:n})}}(ee=de||(de={}))[ee.OK=0]="OK",ee[ee.CANCELLED=1]="CANCELLED",ee[ee.UNKNOWN=2]="UNKNOWN",ee[ee.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ee[ee.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ee[ee.NOT_FOUND=5]="NOT_FOUND",ee[ee.ALREADY_EXISTS=6]="ALREADY_EXISTS",ee[ee.PERMISSION_DENIED=7]="PERMISSION_DENIED",ee[ee.UNAUTHENTICATED=16]="UNAUTHENTICATED",ee[ee.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ee[ee.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ee[ee.ABORTED=10]="ABORTED",ee[ee.OUT_OF_RANGE=11]="OUT_OF_RANGE",ee[ee.UNIMPLEMENTED=12]="UNIMPLEMENTED",ee[ee.INTERNAL=13]="INTERNAL",ee[ee.UNAVAILABLE=14]="UNAVAILABLE",ee[ee.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PR(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MR=new St([4294967295,4294967295],0);function Sc(n){const e=PR().encode(n),t=new cf;return t.update(e),new Uint8Array(t.digest())}function Ac(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),o=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new St([t,i],0),new St([o,s],0)]}class zr{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new ni(`Invalid padding: ${t}`);if(i<0)throw new ni(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new ni(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new ni(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=St.fromNumber(this.ge)}ye(e,t,i){let o=e.add(t.multiply(St.fromNumber(i)));return o.compare(MR)===1&&(o=new St([o.getBits(0),o.getBits(1)],0)),o.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Sc(e),[i,o]=Ac(t);for(let s=0;s<this.hashCount;s++){const l=this.ye(i,o,s);if(!this.we(l))return!1}return!0}static create(e,t,i){const o=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),l=new zr(s,o,t);return i.forEach((u=>l.insert(u))),l}insert(e){if(this.ge===0)return;const t=Sc(e),[i,o]=Ac(t);for(let s=0;s<this.hashCount;s++){const l=this.ye(i,o,s);this.Se(l)}}Se(e){const t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}}class ni extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qo{constructor(e,t,i,o,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=o,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const o=new Map;return o.set(e,Ri.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new Qo(W.min(),o,new le(Z),rt(),j())}}class Ri{constructor(e,t,i,o,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=o,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new Ri(i,t,j(),j(),j())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo{constructor(e,t,i,o){this.be=e,this.removedTargetIds=t,this.key=i,this.De=o}}class Yf{constructor(e,t){this.targetId=e,this.Ce=t}}class Qf{constructor(e,t,i=Ce.EMPTY_BYTE_STRING,o=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=o}}class wc{constructor(){this.ve=0,this.Fe=Rc(),this.Me=Ce.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=j(),t=j(),i=j();return this.Fe.forEach(((o,s)=>{switch(s){case 0:e=e.add(o);break;case 2:t=t.add(o);break;case 1:i=i.add(o);break;default:z(38017,{changeType:s})}})),new Ri(this.Me,this.xe,e,t,i)}qe(){this.Oe=!1,this.Fe=Rc()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ne(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class DR{constructor(e){this.Ge=e,this.ze=new Map,this.je=rt(),this.Je=ji(),this.He=ji(),this.Ye=new le(Z)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const i=this.nt(t);switch(e.state){case 0:this.rt(t)&&i.Le(e.resumeToken);break;case 1:i.Ke(),i.Ne||i.qe(),i.Le(e.resumeToken);break;case 2:i.Ke(),i.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(i.We(),i.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),i.Le(e.resumeToken));break;default:z(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((i,o)=>{this.rt(o)&&t(o)}))}st(e){const t=e.targetId,i=e.Ce.count,o=this.ot(t);if(o){const s=o.target;if(cr(s))if(i===0){const l=new $(s.path);this.et(t,l,Re.newNoDocument(l,W.min()))}else ne(i===1,20013,{expectedCount:i});else{const l=this._t(t);if(l!==i){const u=this.ut(e),f=u?this.ct(u,e,l):1;if(f!==0){this.it(t);const d=f===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:i="",padding:o=0},hashCount:s=0}=t;let l,u;try{l=Pt(i).toUint8Array()}catch(f){if(f instanceof vf)return _n("Decoding the base64 bloom filter in existence filter failed ("+f.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw f}try{u=new zr(l,o,s)}catch(f){return _n(f instanceof ni?"BloomFilter error: ":"Applying bloom filter failed: ",f),null}return u.ge===0?null:u}ct(e,t,i){return t.Ce.count===i-this.Pt(e,t.targetId)?0:2}Pt(e,t){const i=this.Ge.getRemoteKeysForTarget(t);let o=0;return i.forEach((s=>{const l=this.Ge.ht(),u=`projects/${l.projectId}/databases/${l.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.et(t,s,null),o++)})),o}Tt(e){const t=new Map;this.ze.forEach(((s,l)=>{const u=this.ot(l);if(u){if(s.current&&cr(u.target)){const f=new $(u.target.path);this.It(f).has(l)||this.Et(l,f)||this.et(l,f,Re.newNoDocument(f,e))}s.Be&&(t.set(l,s.ke()),s.qe())}}));let i=j();this.He.forEach(((s,l)=>{let u=!0;l.forEachWhile((f=>{const d=this.ot(f);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(i=i.add(s))})),this.je.forEach(((s,l)=>l.setReadTime(e)));const o=new Qo(e,t,this.Ye,this.je,i);return this.je=rt(),this.Je=ji(),this.He=ji(),this.Ye=new le(Z),o}Xe(e,t){if(!this.rt(e))return;const i=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,i),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,i){if(!this.rt(e))return;const o=this.nt(e);this.Et(e,t)?o.Qe(t,1):o.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),i&&(this.je=this.je.insert(t,i))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new wc,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new me(Z),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new me(Z),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||F("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new wc),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ji(){return new le($.comparator)}function Rc(){return new le($.comparator)}const NR={asc:"ASCENDING",desc:"DESCENDING"},kR={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},xR={and:"AND",or:"OR"};class VR{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function fr(n,e){return n.useProto3Json||$o(e)?e:{value:e}}function Ro(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Xf(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function LR(n,e){return Ro(n,e.toTimestamp())}function We(n){return ne(!!n,49232),W.fromTimestamp((function(t){const i=Rt(t);return new re(i.seconds,i.nanos)})(n))}function Jr(n,e){return hr(n,e).canonicalString()}function hr(n,e){const t=(function(o){return new ae(["projects",o.projectId,"databases",o.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Zf(n){const e=ae.fromString(n);return ne(ih(e),10190,{key:e.toString()}),e}function pr(n,e){return Jr(n.databaseId,e.path)}function bs(n,e){const t=Zf(e);if(t.get(1)!==n.databaseId.projectId)throw new G(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new G(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new $(eh(t))}function jf(n,e){return Jr(n.databaseId,e)}function bR(n){const e=Zf(n);return e.length===4?ae.emptyPath():eh(e)}function mr(n){return new ae(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function eh(n){return ne(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Pc(n,e,t){return{name:pr(n,e),fields:t.value.mapValue.fields}}function UR(n,e){let t;if("targetChange"in e){e.targetChange;const i=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:z(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),o=e.targetChange.targetIds||[],s=(function(d,h){return d.useProto3Json?(ne(h===void 0||typeof h=="string",58123),Ce.fromBase64String(h||"")):(ne(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),Ce.fromUint8Array(h||new Uint8Array))})(n,e.targetChange.resumeToken),l=e.targetChange.cause,u=l&&(function(d){const h=d.code===void 0?x.UNKNOWN:Kf(d.code);return new G(h,d.message||"")})(l);t=new Qf(i,o,s,u||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const o=bs(n,i.document.name),s=We(i.document.updateTime),l=i.document.createTime?We(i.document.createTime):W.min(),u=new Ve({mapValue:{fields:i.document.fields}}),f=Re.newFoundDocument(o,s,l,u),d=i.targetIds||[],h=i.removedTargetIds||[];t=new lo(d,h,f.key,f)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const o=bs(n,i.document),s=i.readTime?We(i.readTime):W.min(),l=Re.newNoDocument(o,s),u=i.removedTargetIds||[];t=new lo([],u,l.key,l)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const o=bs(n,i.document),s=i.removedTargetIds||[];t=new lo([],s,o,null)}else{if(!("filter"in e))return z(11601,{Rt:e});{e.filter;const i=e.filter;i.targetId;const{count:o=0,unchangedNames:s}=i,l=new wR(o,s),u=i.targetId;t=new Yf(u,l)}}return t}function FR(n,e){let t;if(e instanceof wi)t={update:Pc(n,e.key,e.value)};else if(e instanceof Wf)t={delete:pr(n,e.key)};else if(e instanceof Zt)t={update:Pc(n,e.key,e.data),updateMask:WR(e.fieldMask)};else{if(!(e instanceof CR))return z(16599,{Vt:e.type});t={verify:pr(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((i=>(function(s,l){const u=l.transform;if(u instanceof Ao)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof _i)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Ti)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof wo)return{fieldPath:l.field.canonicalString(),increment:u.Ae};throw z(20930,{transform:l.transform})})(0,i)))),e.precondition.isNone||(t.currentDocument=(function(o,s){return s.updateTime!==void 0?{updateTime:LR(o,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:z(27497)})(n,e.precondition)),t}function BR(n,e){return n&&n.length>0?(ne(e!==void 0,14353),n.map((t=>(function(o,s){let l=o.updateTime?We(o.updateTime):We(s);return l.isEqual(W.min())&&(l=We(s)),new ER(l,o.transformResults||[])})(t,e)))):[]}function OR(n,e){return{documents:[jf(n,e.path)]}}function qR(n,e){const t={structuredQuery:{}},i=e.path;let o;e.collectionGroup!==null?(o=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(o=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=jf(n,o);const s=(function(d){if(d.length!==0)return nh(Ze.create(d,"and"))})(e.filters);s&&(t.structuredQuery.where=s);const l=(function(d){if(d.length!==0)return d.map((h=>(function(g){return{field:an(g.field),direction:HR(g.dir)}})(h)))})(e.orderBy);l&&(t.structuredQuery.orderBy=l);const u=fr(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:o}}function GR(n){let e=bR(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let o=null;if(i>0){ne(i===1,65062);const h=t.from[0];h.allDescendants?o=h.collectionId:e=e.child(h.collectionId)}let s=[];t.where&&(s=(function(m){const g=th(m);return g instanceof Ze&&Nf(g)?g.getFilters():[g]})(t.where));let l=[];t.orderBy&&(l=(function(m){return m.map((g=>(function(w){return new So(ln(w.field),(function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(w.direction))})(g)))})(t.orderBy));let u=null;t.limit&&(u=(function(m){let g;return g=typeof m=="object"?m.value:m,$o(g)?null:g})(t.limit));let f=null;t.startAt&&(f=(function(m){const g=!!m.before,T=m.values||[];return new Co(T,g)})(t.startAt));let d=null;return t.endAt&&(d=(function(m){const g=!m.before,T=m.values||[];return new Co(T,g)})(t.endAt)),rR(e,o,l,s,u,"F",f,d)}function $R(n,e){const t=(function(o){switch(o){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return z(28987,{purpose:o})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function th(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=ln(t.unaryFilter.field);return pe.create(i,"==",{doubleValue:NaN});case"IS_NULL":const o=ln(t.unaryFilter.field);return pe.create(o,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=ln(t.unaryFilter.field);return pe.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=ln(t.unaryFilter.field);return pe.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return z(61313);default:return z(60726)}})(n):n.fieldFilter!==void 0?(function(t){return pe.create(ln(t.fieldFilter.field),(function(o){switch(o){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return z(58110);default:return z(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Ze.create(t.compositeFilter.filters.map((i=>th(i))),(function(o){switch(o){case"AND":return"and";case"OR":return"or";default:return z(1026)}})(t.compositeFilter.op))})(n):z(30097,{filter:n})}function HR(n){return NR[n]}function zR(n){return kR[n]}function JR(n){return xR[n]}function an(n){return{fieldPath:n.canonicalString()}}function ln(n){return Ie.fromServerFormat(n.fieldPath)}function nh(n){return n instanceof pe?(function(t){if(t.op==="=="){if(mc(t.value))return{unaryFilter:{field:an(t.field),op:"IS_NAN"}};if(pc(t.value))return{unaryFilter:{field:an(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(mc(t.value))return{unaryFilter:{field:an(t.field),op:"IS_NOT_NAN"}};if(pc(t.value))return{unaryFilter:{field:an(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:an(t.field),op:zR(t.op),value:t.value}}})(n):n instanceof Ze?(function(t){const i=t.getFilters().map((o=>nh(o)));return i.length===1?i[0]:{compositeFilter:{op:JR(t.op),filters:i}}})(n):z(54877,{filter:n})}function WR(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function ih(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Et{constructor(e,t,i,o,s=W.min(),l=W.min(),u=Ce.EMPTY_BYTE_STRING,f=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=o,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=u,this.expectedCount=f}withSequenceNumber(e){return new Et(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Et(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Et(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Et(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KR{constructor(e){this.yt=e}}function YR(n){const e=GR({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?dr(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QR{constructor(){this.Cn=new XR}addToCollectionParentIndex(e,t){return this.Cn.add(t),k.resolve()}getCollectionParents(e,t){return k.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return k.resolve()}deleteFieldIndex(e,t){return k.resolve()}deleteAllFieldIndexes(e){return k.resolve()}createTargetIndexes(e,t){return k.resolve()}getDocumentsMatchingTarget(e,t){return k.resolve(null)}getIndexType(e,t){return k.resolve(0)}getFieldIndexes(e,t){return k.resolve([])}getNextCollectionGroupToUpdate(e){return k.resolve(null)}getMinOffset(e,t){return k.resolve(wt.min())}getMinOffsetFromCollectionGroup(e,t){return k.resolve(wt.min())}updateCollectionGroup(e,t,i){return k.resolve()}updateIndexEntries(e,t){return k.resolve()}}class XR{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),o=this.index[t]||new me(ae.comparator),s=!o.has(i);return this.index[t]=o.add(i),s}has(e){const t=e.lastSegment(),i=e.popLast(),o=this.index[t];return o&&o.has(i)}getEntries(e){return(this.index[e]||new me(ae.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},oh=41943040;class ke{static withCacheSize(e){return new ke(e,ke.DEFAULT_COLLECTION_PERCENTILE,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ke.DEFAULT_COLLECTION_PERCENTILE=10,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ke.DEFAULT=new ke(oh,ke.DEFAULT_COLLECTION_PERCENTILE,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ke.DISABLED=new ke(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class In{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new In(0)}static cr(){return new In(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dc="LruGarbageCollector",ZR=1048576;function Nc([n,e],[t,i]){const o=Z(n,t);return o===0?Z(e,i):o}class jR{constructor(e){this.Ir=e,this.buffer=new me(Nc),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();Nc(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class eP{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){F(Dc,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){xn(t)?F(Dc,"Ignoring IndexedDB error during garbage collection: ",t):await kn(t)}await this.Vr(3e5)}))}}class tP{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((i=>Math.floor(t/100*i)))}nthSequenceNumber(e,t){if(t===0)return k.resolve(Go.ce);const i=new jR(t);return this.mr.forEachTarget(e,(o=>i.Ar(o.sequenceNumber))).next((()=>this.mr.pr(e,(o=>i.Ar(o))))).next((()=>i.maxValue))}removeTargets(e,t,i){return this.mr.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(F("LruGarbageCollector","Garbage collection skipped; disabled"),k.resolve(Mc)):this.getCacheSize(e).next((i=>i<this.params.cacheSizeCollectionThreshold?(F("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Mc):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let i,o,s,l,u,f,d;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((m=>(m>this.params.maximumSequenceNumbersToCollect?(F("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),o=this.params.maximumSequenceNumbersToCollect):o=m,l=Date.now(),this.nthSequenceNumber(e,o)))).next((m=>(i=m,u=Date.now(),this.removeTargets(e,i,t)))).next((m=>(s=m,f=Date.now(),this.removeOrphanedDocuments(e,i)))).next((m=>(d=Date.now(),sn()<=X.DEBUG&&F("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-h}ms
	Determined least recently used ${o} in `+(u-l)+`ms
	Removed ${s} targets in `+(f-u)+`ms
	Removed ${m} documents in `+(d-f)+`ms
Total Duration: ${d-h}ms`),k.resolve({didRun:!0,sequenceNumbersCollected:o,targetsRemoved:s,documentsRemoved:m}))))}}function nP(n,e){return new tP(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iP{constructor(){this.changes=new Xt((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Re.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?k.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oP{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sP{constructor(e,t,i,o){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=o}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next((o=>(i=o,this.remoteDocumentCache.getEntry(e,t)))).next((o=>(i!==null&&ui(i.mutation,o,Be.empty(),re.now()),o)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.getLocalViewOfDocuments(e,i,j()).next((()=>i))))}getLocalViewOfDocuments(e,t,i=j()){const o=Ft();return this.populateOverlays(e,o,t).next((()=>this.computeViews(e,t,o,i).next((s=>{let l=ti();return s.forEach(((u,f)=>{l=l.insert(u,f.overlayedDocument)})),l}))))}getOverlayedDocuments(e,t){const i=Ft();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,j())))}populateOverlays(e,t,i){const o=[];return i.forEach((s=>{t.has(s)||o.push(s)})),this.documentOverlayCache.getOverlays(e,o).next((s=>{s.forEach(((l,u)=>{t.set(l,u)}))}))}computeViews(e,t,i,o){let s=rt();const l=li(),u=(function(){return li()})();return t.forEach(((f,d)=>{const h=i.get(d.key);o.has(d.key)&&(h===void 0||h.mutation instanceof Zt)?s=s.insert(d.key,d):h!==void 0?(l.set(d.key,h.mutation.getFieldMask()),ui(h.mutation,d,h.mutation.getFieldMask(),re.now())):l.set(d.key,Be.empty())})),this.recalculateAndSaveOverlays(e,s).next((f=>(f.forEach(((d,h)=>l.set(d,h))),t.forEach(((d,h)=>u.set(d,new oP(h,l.get(d)??null)))),u)))}recalculateAndSaveOverlays(e,t){const i=li();let o=new le(((l,u)=>l-u)),s=j();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((l=>{for(const u of l)u.keys().forEach((f=>{const d=t.get(f);if(d===null)return;let h=i.get(f)||Be.empty();h=u.applyToLocalView(d,h),i.set(f,h);const m=(o.get(u.batchId)||j()).add(f);o=o.insert(u.batchId,m)}))})).next((()=>{const l=[],u=o.getReverseIterator();for(;u.hasNext();){const f=u.getNext(),d=f.key,h=f.value,m=Bf();h.forEach((g=>{if(!s.has(g)){const T=zf(t.get(g),i.get(g));T!==null&&m.set(g,T),s=s.add(g)}})),l.push(this.documentOverlayCache.saveOverlays(e,d,m))}return k.waitFor(l)})).next((()=>i))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.recalculateAndSaveOverlays(e,i)))}getDocumentsMatchingQuery(e,t,i,o){return(function(l){return $.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):aR(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,o):this.getDocumentsMatchingCollectionQuery(e,t,i,o)}getNextDocuments(e,t,i,o){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,o).next((s=>{const l=o-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,o-s.size):k.resolve(Ft());let u=pi,f=s;return l.next((d=>k.forEach(d,((h,m)=>(u<m.largestBatchId&&(u=m.largestBatchId),s.get(h)?k.resolve():this.remoteDocumentCache.getEntry(e,h).next((g=>{f=f.insert(h,g)}))))).next((()=>this.populateOverlays(e,d,s))).next((()=>this.computeViews(e,f,d,j()))).next((h=>({batchId:u,changes:Ff(h)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new $(t)).next((i=>{let o=ti();return i.isFoundDocument()&&(o=o.insert(i.key,i)),o}))}getDocumentsMatchingCollectionGroupQuery(e,t,i,o){const s=t.collectionGroup;let l=ti();return this.indexManager.getCollectionParents(e,s).next((u=>k.forEach(u,(f=>{const d=(function(m,g){return new zo(g,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(t,f.child(s));return this.getDocumentsMatchingCollectionQuery(e,d,i,o).next((h=>{h.forEach(((m,g)=>{l=l.insert(m,g)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,t,i,o){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next((l=>(s=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s,o)))).next((l=>{s.forEach(((f,d)=>{const h=d.getKey();l.get(h)===null&&(l=l.insert(h,Re.newInvalidDocument(h)))}));let u=ti();return l.forEach(((f,d)=>{const h=s.get(f);h!==void 0&&ui(h.mutation,d,Be.empty(),re.now()),Wo(t,d)&&(u=u.insert(f,d))})),u}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rP{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return k.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(o){return{id:o.id,version:o.version,createTime:We(o.createTime)}})(t)),k.resolve()}getNamedQuery(e,t){return k.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(o){return{name:o.name,query:YR(o.bundledQuery),readTime:We(o.readTime)}})(t)),k.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aP{constructor(){this.overlays=new le($.comparator),this.qr=new Map}getOverlay(e,t){return k.resolve(this.overlays.get(t))}getOverlays(e,t){const i=Ft();return k.forEach(t,(o=>this.getOverlay(e,o).next((s=>{s!==null&&i.set(o,s)})))).next((()=>i))}saveOverlays(e,t,i){return i.forEach(((o,s)=>{this.St(e,t,s)})),k.resolve()}removeOverlaysForBatchId(e,t,i){const o=this.qr.get(i);return o!==void 0&&(o.forEach((s=>this.overlays=this.overlays.remove(s))),this.qr.delete(i)),k.resolve()}getOverlaysForCollection(e,t,i){const o=Ft(),s=t.length+1,l=new $(t.child("")),u=this.overlays.getIteratorFrom(l);for(;u.hasNext();){const f=u.getNext().value,d=f.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===s&&f.largestBatchId>i&&o.set(f.getKey(),f)}return k.resolve(o)}getOverlaysForCollectionGroup(e,t,i,o){let s=new le(((d,h)=>d-h));const l=this.overlays.getIterator();for(;l.hasNext();){const d=l.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>i){let h=s.get(d.largestBatchId);h===null&&(h=Ft(),s=s.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const u=Ft(),f=s.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach(((d,h)=>u.set(d,h))),!(u.size()>=o)););return k.resolve(u)}St(e,t,i){const o=this.overlays.get(i.key);if(o!==null){const l=this.qr.get(o.largestBatchId).delete(i.key);this.qr.set(o.largestBatchId,l)}this.overlays=this.overlays.insert(i.key,new AR(t,i));let s=this.qr.get(t);s===void 0&&(s=j(),this.qr.set(t,s)),this.qr.set(t,s.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lP{constructor(){this.sessionToken=Ce.EMPTY_BYTE_STRING}getSessionToken(e){return k.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,k.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wr{constructor(){this.Qr=new me(ye.$r),this.Ur=new me(ye.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const i=new ye(e,t);this.Qr=this.Qr.add(i),this.Ur=this.Ur.add(i)}Wr(e,t){e.forEach((i=>this.addReference(i,t)))}removeReference(e,t){this.Gr(new ye(e,t))}zr(e,t){e.forEach((i=>this.removeReference(i,t)))}jr(e){const t=new $(new ae([])),i=new ye(t,e),o=new ye(t,e+1),s=[];return this.Ur.forEachInRange([i,o],(l=>{this.Gr(l),s.push(l.key)})),s}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new $(new ae([])),i=new ye(t,e),o=new ye(t,e+1);let s=j();return this.Ur.forEachInRange([i,o],(l=>{s=s.add(l.key)})),s}containsKey(e){const t=new ye(e,0),i=this.Qr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class ye{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return $.comparator(e.key,t.key)||Z(e.Yr,t.Yr)}static Kr(e,t){return Z(e.Yr,t.Yr)||$.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uP{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new me(ye.$r)}checkEmpty(e){return k.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,o){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new SR(s,t,i,o);this.mutationQueue.push(l);for(const u of o)this.Zr=this.Zr.add(new ye(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return k.resolve(l)}lookupMutationBatch(e,t){return k.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,o=this.ei(i),s=o<0?0:o;return k.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return k.resolve(this.mutationQueue.length===0?Ur:this.tr-1)}getAllMutationBatches(e){return k.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new ye(t,0),o=new ye(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([i,o],(l=>{const u=this.Xr(l.Yr);s.push(u)})),k.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new me(Z);return t.forEach((o=>{const s=new ye(o,0),l=new ye(o,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,l],(u=>{i=i.add(u.Yr)}))})),k.resolve(this.ti(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,o=i.length+1;let s=i;$.isDocumentKey(s)||(s=s.child(""));const l=new ye(new $(s),0);let u=new me(Z);return this.Zr.forEachWhile((f=>{const d=f.key.path;return!!i.isPrefixOf(d)&&(d.length===o&&(u=u.add(f.Yr)),!0)}),l),k.resolve(this.ti(u))}ti(e){const t=[];return e.forEach((i=>{const o=this.Xr(i);o!==null&&t.push(o)})),t}removeMutationBatch(e,t){ne(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Zr;return k.forEach(t.mutations,(o=>{const s=new ye(o.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,o.key)})).next((()=>{this.Zr=i}))}ir(e){}containsKey(e,t){const i=new ye(t,0),o=this.Zr.firstAfterOrEqual(i);return k.resolve(t.isEqual(o&&o.key))}performConsistencyCheck(e){return this.mutationQueue.length,k.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cP{constructor(e){this.ri=e,this.docs=(function(){return new le($.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,o=this.docs.get(i),s=o?o.size:0,l=this.ri(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:l}),this.size+=l-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return k.resolve(i?i.document.mutableCopy():Re.newInvalidDocument(t))}getEntries(e,t){let i=rt();return t.forEach((o=>{const s=this.docs.get(o);i=i.insert(o,s?s.document.mutableCopy():Re.newInvalidDocument(o))})),k.resolve(i)}getDocumentsMatchingQuery(e,t,i,o){let s=rt();const l=t.path,u=new $(l.child("__id-9223372036854775808__")),f=this.docs.getIteratorFrom(u);for(;f.hasNext();){const{key:d,value:{document:h}}=f.getNext();if(!l.isPrefixOf(d.path))break;d.path.length>l.length+1||Fw(Uw(h),i)<=0||(o.has(h.key)||Wo(t,h))&&(s=s.insert(h.key,h.mutableCopy()))}return k.resolve(s)}getAllFromCollectionGroup(e,t,i,o){z(9500)}ii(e,t){return k.forEach(this.docs,(i=>t(i)))}newChangeBuffer(e){return new dP(this)}getSize(e){return k.resolve(this.size)}}class dP extends iP{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((i,o)=>{o.isValidDocument()?t.push(this.Nr.addEntry(e,o)):this.Nr.removeEntry(i)})),k.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fP{constructor(e){this.persistence=e,this.si=new Xt((t=>Or(t)),qr),this.lastRemoteSnapshotVersion=W.min(),this.highestTargetId=0,this.oi=0,this._i=new Wr,this.targetCount=0,this.ai=In.ur()}forEachTarget(e,t){return this.si.forEach(((i,o)=>t(o))),k.resolve()}getLastRemoteSnapshotVersion(e){return k.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return k.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),k.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.oi&&(this.oi=t),k.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new In(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,k.resolve()}updateTargetData(e,t){return this.Pr(t),k.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,k.resolve()}removeTargets(e,t,i){let o=0;const s=[];return this.si.forEach(((l,u)=>{u.sequenceNumber<=t&&i.get(u.targetId)===null&&(this.si.delete(l),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),o++)})),k.waitFor(s).next((()=>o))}getTargetCount(e){return k.resolve(this.targetCount)}getTargetData(e,t){const i=this.si.get(t)||null;return k.resolve(i)}addMatchingKeys(e,t,i){return this._i.Wr(t,i),k.resolve()}removeMatchingKeys(e,t,i){this._i.zr(t,i);const o=this.persistence.referenceDelegate,s=[];return o&&t.forEach((l=>{s.push(o.markPotentiallyOrphaned(e,l))})),k.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),k.resolve()}getMatchingKeysForTargetId(e,t){const i=this._i.Hr(t);return k.resolve(i)}containsKey(e,t){return k.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sh{constructor(e,t){this.ui={},this.overlays={},this.ci=new Go(0),this.li=!1,this.li=!0,this.hi=new lP,this.referenceDelegate=e(this),this.Pi=new fP(this),this.indexManager=new QR,this.remoteDocumentCache=(function(o){return new cP(o)})((i=>this.referenceDelegate.Ti(i))),this.serializer=new KR(t),this.Ii=new rP(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new aP,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.ui[e.toKey()];return i||(i=new uP(t,this.referenceDelegate),this.ui[e.toKey()]=i),i}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,i){F("MemoryPersistence","Starting transaction:",e);const o=new hP(this.ci.next());return this.referenceDelegate.Ei(),i(o).next((s=>this.referenceDelegate.di(o).next((()=>s)))).toPromise().then((s=>(o.raiseOnCommittedEvent(),s)))}Ai(e,t){return k.or(Object.values(this.ui).map((i=>()=>i.containsKey(e,t))))}}class hP extends Ow{constructor(e){super(),this.currentSequenceNumber=e}}class Kr{constructor(e){this.persistence=e,this.Ri=new Wr,this.Vi=null}static mi(e){return new Kr(e)}get fi(){if(this.Vi)return this.Vi;throw z(60996)}addReference(e,t,i){return this.Ri.addReference(i,t),this.fi.delete(i.toString()),k.resolve()}removeReference(e,t,i){return this.Ri.removeReference(i,t),this.fi.add(i.toString()),k.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),k.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((o=>this.fi.add(o.toString())));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next((o=>{o.forEach((s=>this.fi.add(s.toString())))})).next((()=>i.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return k.forEach(this.fi,(i=>{const o=$.fromPath(i);return this.gi(e,o).next((s=>{s||t.removeEntry(o,W.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((i=>{i?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return k.or([()=>k.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Po{constructor(e,t){this.persistence=e,this.pi=new Xt((i=>$w(i.path)),((i,o)=>i.isEqual(o))),this.garbageCollector=nP(this,t)}static mi(e,t){return new Po(e,t)}Ei(){}di(e){return k.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((i=>t.next((o=>i+o))))}wr(e){let t=0;return this.pr(e,(i=>{t++})).next((()=>t))}pr(e,t){return k.forEach(this.pi,((i,o)=>this.br(e,i,o).next((s=>s?k.resolve():t(o)))))}removeTargets(e,t,i){return this.persistence.getTargetCache().removeTargets(e,t,i)}removeOrphanedDocuments(e,t){let i=0;const o=this.persistence.getRemoteDocumentCache(),s=o.newChangeBuffer();return o.ii(e,(l=>this.br(e,l,t).next((u=>{u||(i++,s.removeEntry(l,W.min()))})))).next((()=>s.apply(e))).next((()=>i))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),k.resolve()}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,t,i){return this.pi.set(i,e.currentSequenceNumber),k.resolve()}removeReference(e,t,i){return this.pi.set(i,e.currentSequenceNumber),k.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),k.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=so(e.data.value)),t}br(e,t,i){return k.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const o=this.pi.get(t);return k.resolve(o!==void 0&&o>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yr{constructor(e,t,i,o){this.targetId=e,this.fromCache=t,this.Es=i,this.ds=o}static As(e,t){let i=j(),o=j();for(const s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:o=o.add(s.doc.key)}return new Yr(e,t.fromCache,i,o)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pP{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mP{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return oA()?8:qw(Me())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,i,o){const s={result:null};return this.ys(e,t).next((l=>{s.result=l})).next((()=>{if(!s.result)return this.ws(e,t,o,i).next((l=>{s.result=l}))})).next((()=>{if(s.result)return;const l=new pP;return this.Ss(e,t,l).next((u=>{if(s.result=u,this.Vs)return this.bs(e,t,l,u.size)}))})).next((()=>s.result))}bs(e,t,i,o){return i.documentReadCount<this.fs?(sn()<=X.DEBUG&&F("QueryEngine","SDK will not create cache indexes for query:",rn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),k.resolve()):(sn()<=X.DEBUG&&F("QueryEngine","Query:",rn(t),"scans",i.documentReadCount,"local documents and returns",o,"documents as results."),i.documentReadCount>this.gs*o?(sn()<=X.DEBUG&&F("QueryEngine","The SDK decides to create cache indexes for query:",rn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Je(t))):k.resolve())}ys(e,t){if(Tc(t))return k.resolve(null);let i=Je(t);return this.indexManager.getIndexType(e,i).next((o=>o===0?null:(t.limit!==null&&o===1&&(t=dr(t,null,"F"),i=Je(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next((s=>{const l=j(...s);return this.ps.getDocuments(e,l).next((u=>this.indexManager.getMinOffset(e,i).next((f=>{const d=this.Ds(t,u);return this.Cs(t,d,l,f.readTime)?this.ys(e,dr(t,null,"F")):this.vs(e,d,t,f)}))))})))))}ws(e,t,i,o){return Tc(t)||o.isEqual(W.min())?k.resolve(null):this.ps.getDocuments(e,i).next((s=>{const l=this.Ds(t,s);return this.Cs(t,l,i,o)?k.resolve(null):(sn()<=X.DEBUG&&F("QueryEngine","Re-using previous result from %s to execute query: %s",o.toString(),rn(t)),this.vs(e,l,t,bw(o,pi)).next((u=>u)))}))}Ds(e,t){let i=new me(bf(e));return t.forEach(((o,s)=>{Wo(e,s)&&(i=i.add(s))})),i}Cs(e,t,i,o){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(o)>0)}Ss(e,t,i){return sn()<=X.DEBUG&&F("QueryEngine","Using full collection scan to execute query:",rn(t)),this.ps.getDocumentsMatchingQuery(e,t,wt.min(),i)}vs(e,t,i,o){return this.ps.getDocumentsMatchingQuery(e,i,o).next((s=>(t.forEach((l=>{s=s.insert(l.key,l)})),s)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qr="LocalStore",gP=3e8;class yP{constructor(e,t,i,o){this.persistence=e,this.Fs=t,this.serializer=o,this.Ms=new le(Z),this.xs=new Xt((s=>Or(s)),qr),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(i)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sP(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function _P(n,e,t,i){return new yP(n,e,t,i)}async function rh(n,e){const t=K(n);return await t.persistence.runTransaction("Handle user change","readonly",(i=>{let o;return t.mutationQueue.getAllMutationBatches(i).next((s=>(o=s,t.Bs(e),t.mutationQueue.getAllMutationBatches(i)))).next((s=>{const l=[],u=[];let f=j();for(const d of o){l.push(d.batchId);for(const h of d.mutations)f=f.add(h.key)}for(const d of s){u.push(d.batchId);for(const h of d.mutations)f=f.add(h.key)}return t.localDocuments.getDocuments(i,f).next((d=>({Ls:d,removedBatchIds:l,addedBatchIds:u})))}))}))}function TP(n,e){const t=K(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(i=>{const o=e.batch.keys(),s=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,f,d,h){const m=d.batch,g=m.keys();let T=k.resolve();return g.forEach((w=>{T=T.next((()=>h.getEntry(f,w))).next((M=>{const N=d.docVersions.get(w);ne(N!==null,48541),M.version.compareTo(N)<0&&(m.applyToRemoteDocument(M,d),M.isValidDocument()&&(M.setReadTime(d.commitVersion),h.addEntry(M)))}))})),T.next((()=>u.mutationQueue.removeMutationBatch(f,m)))})(t,i,e,s).next((()=>s.apply(i))).next((()=>t.mutationQueue.performConsistencyCheck(i))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(i,o,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,(function(u){let f=j();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(f=f.add(u.batch.mutations[d].key));return f})(e)))).next((()=>t.localDocuments.getDocuments(i,o)))}))}function ah(n){const e=K(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function EP(n,e){const t=K(n),i=e.snapshotVersion;let o=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(s=>{const l=t.Ns.newChangeBuffer({trackRemovals:!0});o=t.Ms;const u=[];e.targetChanges.forEach(((h,m)=>{const g=o.get(m);if(!g)return;u.push(t.Pi.removeMatchingKeys(s,h.removedDocuments,m).next((()=>t.Pi.addMatchingKeys(s,h.addedDocuments,m))));let T=g.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?T=T.withResumeToken(Ce.EMPTY_BYTE_STRING,W.min()).withLastLimboFreeSnapshotVersion(W.min()):h.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(h.resumeToken,i)),o=o.insert(m,T),(function(M,N,L){return M.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-M.snapshotVersion.toMicroseconds()>=gP?!0:L.addedDocuments.size+L.modifiedDocuments.size+L.removedDocuments.size>0})(g,T,h)&&u.push(t.Pi.updateTargetData(s,T))}));let f=rt(),d=j();if(e.documentUpdates.forEach((h=>{e.resolvedLimboDocuments.has(h)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,h))})),u.push(vP(s,l,e.documentUpdates).next((h=>{f=h.ks,d=h.qs}))),!i.isEqual(W.min())){const h=t.Pi.getLastRemoteSnapshotVersion(s).next((m=>t.Pi.setTargetsMetadata(s,s.currentSequenceNumber,i)));u.push(h)}return k.waitFor(u).next((()=>l.apply(s))).next((()=>t.localDocuments.getLocalViewOfDocuments(s,f,d))).next((()=>f))})).then((s=>(t.Ms=o,s)))}function vP(n,e,t){let i=j(),o=j();return t.forEach((s=>i=i.add(s))),e.getEntries(n,i).next((s=>{let l=rt();return t.forEach(((u,f)=>{const d=s.get(u);f.isFoundDocument()!==d.isFoundDocument()&&(o=o.add(u)),f.isNoDocument()&&f.version.isEqual(W.min())?(e.removeEntry(u,f.readTime),l=l.insert(u,f)):!d.isValidDocument()||f.version.compareTo(d.version)>0||f.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(f),l=l.insert(u,f)):F(Qr,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",f.version)})),{ks:l,qs:o}}))}function IP(n,e){const t=K(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(i=>(e===void 0&&(e=Ur),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e))))}function CP(n,e){const t=K(n);return t.persistence.runTransaction("Allocate target","readwrite",(i=>{let o;return t.Pi.getTargetData(i,e).next((s=>s?(o=s,k.resolve(o)):t.Pi.allocateTargetId(i).next((l=>(o=new Et(e,l,"TargetPurposeListen",i.currentSequenceNumber),t.Pi.addTargetData(i,o).next((()=>o)))))))})).then((i=>{const o=t.Ms.get(i.targetId);return(o===null||i.snapshotVersion.compareTo(o.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(i.targetId,i),t.xs.set(e,i.targetId)),i}))}async function gr(n,e,t){const i=K(n),o=i.Ms.get(e),s=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",s,(l=>i.persistence.referenceDelegate.removeTarget(l,o)))}catch(l){if(!xn(l))throw l;F(Qr,`Failed to update sequence numbers for target ${e}: ${l}`)}i.Ms=i.Ms.remove(e),i.xs.delete(o.target)}function kc(n,e,t){const i=K(n);let o=W.min(),s=j();return i.persistence.runTransaction("Execute query","readwrite",(l=>(function(f,d,h){const m=K(f),g=m.xs.get(h);return g!==void 0?k.resolve(m.Ms.get(g)):m.Pi.getTargetData(d,h)})(i,l,Je(e)).next((u=>{if(u)return o=u.lastLimboFreeSnapshotVersion,i.Pi.getMatchingKeysForTargetId(l,u.targetId).next((f=>{s=f}))})).next((()=>i.Fs.getDocumentsMatchingQuery(l,e,t?o:W.min(),t?s:j()))).next((u=>(SP(i,uR(e),u),{documents:u,Qs:s})))))}function SP(n,e,t){let i=n.Os.get(e)||W.min();t.forEach(((o,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)})),n.Os.set(e,i)}class xc{constructor(){this.activeTargetIds=mR()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class AP{constructor(){this.Mo=new xc,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,i){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new xc,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wP{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vc="ConnectivityMonitor";class Lc{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){F(Vc,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){F(Vc,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eo=null;function yr(){return eo===null?eo=(function(){return 268435456+Math.round(2147483648*Math.random())})():eo++,"0x"+eo.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Us="RestConnection",RP={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class PP{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${i}/databases/${o}`,this.Wo=this.databaseId.database===vo?`project_id=${i}`:`project_id=${i}&database_id=${o}`}Go(e,t,i,o,s){const l=yr(),u=this.zo(e,t.toUriEncodedString());F(Us,`Sending RPC '${e}' ${l}:`,u,i);const f={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(f,o,s);const{host:d}=new URL(u),h=Mn(d);return this.Jo(e,u,f,i,h).then((m=>(F(Us,`Received RPC '${e}' ${l}: `,m),m)),(m=>{throw _n(Us,`RPC '${e}' ${l} failed with error: `,m,"url: ",u,"request:",i),m}))}Ho(e,t,i,o,s,l){return this.Go(e,t,i,o,s)}jo(e,t,i){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Nn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((o,s)=>e[s]=o)),i&&i.headers.forEach(((o,s)=>e[s]=o))}zo(e,t){const i=RP[e];return`${this.Uo}/v1/${t}:${i}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MP{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ae="WebChannelConnection";class DP extends PP{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,i,o,s){const l=yr();return new Promise(((u,f)=>{const d=new df;d.setWithCredentials(!0),d.listenOnce(ff.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case oo.NO_ERROR:const m=d.getResponseJson();F(Ae,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(m)),u(m);break;case oo.TIMEOUT:F(Ae,`RPC '${e}' ${l} timed out`),f(new G(x.DEADLINE_EXCEEDED,"Request time out"));break;case oo.HTTP_ERROR:const g=d.getStatus();if(F(Ae,`RPC '${e}' ${l} failed with status:`,g,"response text:",d.getResponseText()),g>0){let T=d.getResponseJson();Array.isArray(T)&&(T=T[0]);const w=T==null?void 0:T.error;if(w&&w.status&&w.message){const M=(function(L){const V=L.toLowerCase().replace(/_/g,"-");return Object.values(x).indexOf(V)>=0?V:x.UNKNOWN})(w.status);f(new G(M,w.message))}else f(new G(x.UNKNOWN,"Server responded with status "+d.getStatus()))}else f(new G(x.UNAVAILABLE,"Connection failed."));break;default:z(9055,{l_:e,streamId:l,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{F(Ae,`RPC '${e}' ${l} completed.`)}}));const h=JSON.stringify(o);F(Ae,`RPC '${e}' ${l} sending request:`,o),d.send(t,"POST",h,i,15)}))}T_(e,t,i){const o=yr(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=mf(),u=pf(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(f.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(f.useFetchStreams=!0),this.jo(f.initMessageHeaders,t,i),f.encodeInitMessageHeaders=!0;const h=s.join("");F(Ae,`Creating RPC '${e}' stream ${o}: ${h}`,f);const m=l.createWebChannel(h,f);this.I_(m);let g=!1,T=!1;const w=new MP({Yo:N=>{T?F(Ae,`Not sending because RPC '${e}' stream ${o} is closed:`,N):(g||(F(Ae,`Opening RPC '${e}' stream ${o} transport.`),m.open(),g=!0),F(Ae,`RPC '${e}' stream ${o} sending:`,N),m.send(N))},Zo:()=>m.close()}),M=(N,L,V)=>{N.listen(L,(b=>{try{V(b)}catch(B){setTimeout((()=>{throw B}),0)}}))};return M(m,ei.EventType.OPEN,(()=>{T||(F(Ae,`RPC '${e}' stream ${o} transport opened.`),w.o_())})),M(m,ei.EventType.CLOSE,(()=>{T||(T=!0,F(Ae,`RPC '${e}' stream ${o} transport closed`),w.a_(),this.E_(m))})),M(m,ei.EventType.ERROR,(N=>{T||(T=!0,_n(Ae,`RPC '${e}' stream ${o} transport errored. Name:`,N.name,"Message:",N.message),w.a_(new G(x.UNAVAILABLE,"The operation could not be completed")))})),M(m,ei.EventType.MESSAGE,(N=>{var L;if(!T){const V=N.data[0];ne(!!V,16349);const b=V,B=(b==null?void 0:b.error)||((L=b[0])==null?void 0:L.error);if(B){F(Ae,`RPC '${e}' stream ${o} received error:`,B);const q=B.status;let H=(function(E){const A=de[E];if(A!==void 0)return Kf(A)})(q),S=B.message;H===void 0&&(H=x.INTERNAL,S="Unknown error status: "+q+" with message "+B.message),T=!0,w.a_(new G(H,S)),m.close()}else F(Ae,`RPC '${e}' stream ${o} received:`,V),w.u_(V)}})),M(u,hf.STAT_EVENT,(N=>{N.stat===sr.PROXY?F(Ae,`RPC '${e}' stream ${o} detected buffering proxy`):N.stat===sr.NOPROXY&&F(Ae,`RPC '${e}' stream ${o} detected no buffering proxy`)})),setTimeout((()=>{w.__()}),0),w}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function Fs(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xo(n){return new VR(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lh{constructor(e,t,i=1e3,o=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=i,this.A_=o,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),i=Math.max(0,Date.now()-this.f_),o=Math.max(0,t-i);o>0&&F("ExponentialBackoff",`Backing off for ${o} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,o,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bc="PersistentStream";class uh{constructor(e,t,i,o,s,l,u,f){this.Mi=e,this.S_=i,this.b_=o,this.connection=s,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=u,this.listener=f,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new lh(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===x.RESOURCE_EXHAUSTED?(st(t.toString()),st("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===x.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([i,o])=>{this.D_===t&&this.G_(i,o)}),(i=>{e((()=>{const o=new G(x.UNKNOWN,"Fetching auth token failed: "+i.message);return this.z_(o)}))}))}G_(e,t){const i=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{i((()=>this.listener.Xo()))})),this.stream.t_((()=>{i((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((o=>{i((()=>this.z_(o)))})),this.stream.onMessage((o=>{i((()=>++this.F_==1?this.J_(o):this.onNext(o)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return F(bc,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(F(bc,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class NP extends uh{constructor(e,t,i,o,s,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,o,l),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=UR(this.serializer,e),i=(function(s){if(!("targetChange"in s))return W.min();const l=s.targetChange;return l.targetIds&&l.targetIds.length?W.min():l.readTime?We(l.readTime):W.min()})(e);return this.listener.H_(t,i)}Y_(e){const t={};t.database=mr(this.serializer),t.addTarget=(function(s,l){let u;const f=l.target;if(u=cr(f)?{documents:OR(s,f)}:{query:qR(s,f).ft},u.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){u.resumeToken=Xf(s,l.resumeToken);const d=fr(s,l.expectedCount);d!==null&&(u.expectedCount=d)}else if(l.snapshotVersion.compareTo(W.min())>0){u.readTime=Ro(s,l.snapshotVersion.toTimestamp());const d=fr(s,l.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,e);const i=$R(this.serializer,e);i&&(t.labels=i),this.q_(t)}Z_(e){const t={};t.database=mr(this.serializer),t.removeTarget=e,this.q_(t)}}class kP extends uh{constructor(e,t,i,o,s,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,o,l),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return ne(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ne(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ne(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=BR(e.writeResults,e.commitTime),i=We(e.commitTime);return this.listener.na(i,t)}ra(){const e={};e.database=mr(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((i=>FR(this.serializer,i)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xP{}class VP extends xP{constructor(e,t,i,o){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=o,this.ia=!1}sa(){if(this.ia)throw new G(x.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,l])=>this.connection.Go(e,hr(t,i),o,s,l))).catch((s=>{throw s.name==="FirebaseError"?(s.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new G(x.UNKNOWN,s.toString())}))}Ho(e,t,i,o,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,u])=>this.connection.Ho(e,hr(t,i),o,l,u,s))).catch((l=>{throw l.name==="FirebaseError"?(l.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new G(x.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class LP{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(st(t),this.aa=!1):F("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jt="RemoteStore";class bP{constructor(e,t,i,o,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo((l=>{i.enqueueAndForget((async()=>{jt(this)&&(F(Jt,"Restarting streams for network reachability change."),await(async function(f){const d=K(f);d.Ea.add(4),await Pi(d),d.Ra.set("Unknown"),d.Ea.delete(4),await Zo(d)})(this))}))})),this.Ra=new LP(i,o)}}async function Zo(n){if(jt(n))for(const e of n.da)await e(!0)}async function Pi(n){for(const e of n.da)await e(!1)}function ch(n,e){const t=K(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),ea(t)?jr(t):Vn(t).O_()&&Zr(t,e))}function Xr(n,e){const t=K(n),i=Vn(t);t.Ia.delete(e),i.O_()&&dh(t,e),t.Ia.size===0&&(i.O_()?i.L_():jt(t)&&t.Ra.set("Unknown"))}function Zr(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(W.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Vn(n).Y_(e)}function dh(n,e){n.Va.Ue(e),Vn(n).Z_(e)}function jr(n){n.Va=new DR({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Vn(n).start(),n.Ra.ua()}function ea(n){return jt(n)&&!Vn(n).x_()&&n.Ia.size>0}function jt(n){return K(n).Ea.size===0}function fh(n){n.Va=void 0}async function UP(n){n.Ra.set("Online")}async function FP(n){n.Ia.forEach(((e,t)=>{Zr(n,e)}))}async function BP(n,e){fh(n),ea(n)?(n.Ra.ha(e),jr(n)):n.Ra.set("Unknown")}async function OP(n,e,t){if(n.Ra.set("Online"),e instanceof Qf&&e.state===2&&e.cause)try{await(async function(o,s){const l=s.cause;for(const u of s.targetIds)o.Ia.has(u)&&(await o.remoteSyncer.rejectListen(u,l),o.Ia.delete(u),o.Va.removeTarget(u))})(n,e)}catch(i){F(Jt,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),await Mo(n,i)}else if(e instanceof lo?n.Va.Ze(e):e instanceof Yf?n.Va.st(e):n.Va.tt(e),!t.isEqual(W.min()))try{const i=await ah(n.localStore);t.compareTo(i)>=0&&await(function(s,l){const u=s.Va.Tt(l);return u.targetChanges.forEach(((f,d)=>{if(f.resumeToken.approximateByteSize()>0){const h=s.Ia.get(d);h&&s.Ia.set(d,h.withResumeToken(f.resumeToken,l))}})),u.targetMismatches.forEach(((f,d)=>{const h=s.Ia.get(f);if(!h)return;s.Ia.set(f,h.withResumeToken(Ce.EMPTY_BYTE_STRING,h.snapshotVersion)),dh(s,f);const m=new Et(h.target,f,d,h.sequenceNumber);Zr(s,m)})),s.remoteSyncer.applyRemoteEvent(u)})(n,t)}catch(i){F(Jt,"Failed to raise snapshot:",i),await Mo(n,i)}}async function Mo(n,e,t){if(!xn(e))throw e;n.Ea.add(1),await Pi(n),n.Ra.set("Offline"),t||(t=()=>ah(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{F(Jt,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Zo(n)}))}function hh(n,e){return e().catch((t=>Mo(n,t,e)))}async function jo(n){const e=K(n),t=Dt(e);let i=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Ur;for(;qP(e);)try{const o=await IP(e.localStore,i);if(o===null){e.Ta.length===0&&t.L_();break}i=o.batchId,GP(e,o)}catch(o){await Mo(e,o)}ph(e)&&mh(e)}function qP(n){return jt(n)&&n.Ta.length<10}function GP(n,e){n.Ta.push(e);const t=Dt(n);t.O_()&&t.X_&&t.ea(e.mutations)}function ph(n){return jt(n)&&!Dt(n).x_()&&n.Ta.length>0}function mh(n){Dt(n).start()}async function $P(n){Dt(n).ra()}async function HP(n){const e=Dt(n);for(const t of n.Ta)e.ea(t.mutations)}async function zP(n,e,t){const i=n.Ta.shift(),o=Hr.from(i,e,t);await hh(n,(()=>n.remoteSyncer.applySuccessfulWrite(o))),await jo(n)}async function JP(n,e){e&&Dt(n).X_&&await(async function(i,o){if((function(l){return RR(l)&&l!==x.ABORTED})(o.code)){const s=i.Ta.shift();Dt(i).B_(),await hh(i,(()=>i.remoteSyncer.rejectFailedWrite(s.batchId,o))),await jo(i)}})(n,e),ph(n)&&mh(n)}async function Uc(n,e){const t=K(n);t.asyncQueue.verifyOperationInProgress(),F(Jt,"RemoteStore received new credentials");const i=jt(t);t.Ea.add(3),await Pi(t),i&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Zo(t)}async function WP(n,e){const t=K(n);e?(t.Ea.delete(2),await Zo(t)):e||(t.Ea.add(2),await Pi(t),t.Ra.set("Unknown"))}function Vn(n){return n.ma||(n.ma=(function(t,i,o){const s=K(t);return s.sa(),new NP(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,o)})(n.datastore,n.asyncQueue,{Xo:UP.bind(null,n),t_:FP.bind(null,n),r_:BP.bind(null,n),H_:OP.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),ea(n)?jr(n):n.Ra.set("Unknown")):(await n.ma.stop(),fh(n))}))),n.ma}function Dt(n){return n.fa||(n.fa=(function(t,i,o){const s=K(t);return s.sa(),new kP(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,o)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:$P.bind(null,n),r_:JP.bind(null,n),ta:HP.bind(null,n),na:zP.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await jo(n)):(await n.fa.stop(),n.Ta.length>0&&(F(Jt,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta{constructor(e,t,i,o,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=o,this.removalCallback=s,this.deferred=new At,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,o,s){const l=Date.now()+i,u=new ta(e,t,l,o,s);return u.start(i),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new G(x.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function na(n,e){if(st("AsyncQueue",`${e}: ${n}`),xn(n))return new G(x.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{static emptySet(e){return new hn(e.comparator)}constructor(e){this.comparator=e?(t,i)=>e(t,i)||$.comparator(t.key,i.key):(t,i)=>$.comparator(t.key,i.key),this.keyedMap=ti(),this.sortedSet=new le(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,i)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof hn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const o=t.getNext().key,s=i.getNext().key;if(!o.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new hn;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(){this.ga=new le($.comparator)}track(e){const t=e.doc.key,i=this.ga.get(t);i?e.type!==0&&i.type===3?this.ga=this.ga.insert(t,e):e.type===3&&i.type!==1?this.ga=this.ga.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.ga=this.ga.remove(t):e.type===1&&i.type===2?this.ga=this.ga.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):z(63341,{Rt:e,pa:i}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,i)=>{e.push(i)})),e}}class Cn{constructor(e,t,i,o,s,l,u,f,d){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=o,this.mutatedKeys=s,this.fromCache=l,this.syncStateChanged=u,this.excludesMetadataChanges=f,this.hasCachedResults=d}static fromInitialDocuments(e,t,i,o,s){const l=[];return t.forEach((u=>{l.push({type:0,doc:u})})),new Cn(e,t,hn.emptySet(t),l,i,o,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Jo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let o=0;o<t.length;o++)if(t[o].type!==i[o].type||!t[o].doc.isEqual(i[o].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KP{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class YP{constructor(){this.queries=Bc(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,i){const o=K(t),s=o.queries;o.queries=Bc(),s.forEach(((l,u)=>{for(const f of u.Sa)f.onError(i)}))})(this,new G(x.ABORTED,"Firestore shutting down"))}}function Bc(){return new Xt((n=>Lf(n)),Jo)}async function QP(n,e){const t=K(n);let i=3;const o=e.query;let s=t.queries.get(o);s?!s.ba()&&e.Da()&&(i=2):(s=new KP,i=e.Da()?0:1);try{switch(i){case 0:s.wa=await t.onListen(o,!0);break;case 1:s.wa=await t.onListen(o,!1);break;case 2:await t.onFirstRemoteStoreListen(o)}}catch(l){const u=na(l,`Initialization of query '${rn(e.query)}' failed`);return void e.onError(u)}t.queries.set(o,s),s.Sa.push(e),e.va(t.onlineState),s.wa&&e.Fa(s.wa)&&ia(t)}async function XP(n,e){const t=K(n),i=e.query;let o=3;const s=t.queries.get(i);if(s){const l=s.Sa.indexOf(e);l>=0&&(s.Sa.splice(l,1),s.Sa.length===0?o=e.Da()?0:1:!s.ba()&&e.Da()&&(o=2))}switch(o){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}}function ZP(n,e){const t=K(n);let i=!1;for(const o of e){const s=o.query,l=t.queries.get(s);if(l){for(const u of l.Sa)u.Fa(o)&&(i=!0);l.wa=o}}i&&ia(t)}function jP(n,e,t){const i=K(n),o=i.queries.get(e);if(o)for(const s of o.Sa)s.onError(t);i.queries.delete(e)}function ia(n){n.Ca.forEach((e=>{e.next()}))}var _r,Oc;(Oc=_r||(_r={})).Ma="default",Oc.Cache="cache";class eM{constructor(e,t,i){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=i||{}}Fa(e){if(!this.options.includeMetadataChanges){const i=[];for(const o of e.docChanges)o.type!==3&&i.push(o);e=new Cn(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const i=t!=="Offline";return(!this.options.qa||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Cn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==_r.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gh{constructor(e){this.key=e}}class yh{constructor(e){this.key=e}}class tM{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=j(),this.mutatedKeys=j(),this.eu=bf(e),this.tu=new hn(this.eu)}get nu(){return this.Ya}ru(e,t){const i=t?t.iu:new Fc,o=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,l=o,u=!1;const f=this.query.limitType==="F"&&o.size===this.query.limit?o.last():null,d=this.query.limitType==="L"&&o.size===this.query.limit?o.first():null;if(e.inorderTraversal(((h,m)=>{const g=o.get(h),T=Wo(this.query,m)?m:null,w=!!g&&this.mutatedKeys.has(g.key),M=!!T&&(T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations);let N=!1;g&&T?g.data.isEqual(T.data)?w!==M&&(i.track({type:3,doc:T}),N=!0):this.su(g,T)||(i.track({type:2,doc:T}),N=!0,(f&&this.eu(T,f)>0||d&&this.eu(T,d)<0)&&(u=!0)):!g&&T?(i.track({type:0,doc:T}),N=!0):g&&!T&&(i.track({type:1,doc:g}),N=!0,(f||d)&&(u=!0)),N&&(T?(l=l.add(T),s=M?s.add(h):s.delete(h)):(l=l.delete(h),s=s.delete(h)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const h=this.query.limitType==="F"?l.last():l.first();l=l.delete(h.key),s=s.delete(h.key),i.track({type:1,doc:h})}return{tu:l,iu:i,Cs:u,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,o){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((h,m)=>(function(T,w){const M=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return z(20277,{Rt:N})}};return M(T)-M(w)})(h.type,m.type)||this.eu(h.doc,m.doc))),this.ou(i),o=o??!1;const u=t&&!o?this._u():[],f=this.Xa.size===0&&this.current&&!o?1:0,d=f!==this.Za;return this.Za=f,l.length!==0||d?{snapshot:new Cn(this.query,e.tu,s,l,e.mutatedKeys,f===0,d,!1,!!i&&i.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Fc,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=j(),this.tu.forEach((i=>{this.uu(i.key)&&(this.Xa=this.Xa.add(i.key))}));const t=[];return e.forEach((i=>{this.Xa.has(i)||t.push(new yh(i))})),this.Xa.forEach((i=>{e.has(i)||t.push(new gh(i))})),t}cu(e){this.Ya=e.Qs,this.Xa=j();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Cn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const oa="SyncEngine";class nM{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class iM{constructor(e){this.key=e,this.hu=!1}}class oM{constructor(e,t,i,o,s,l){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=o,this.currentUser=s,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new Xt((u=>Lf(u)),Jo),this.Iu=new Map,this.Eu=new Set,this.du=new le($.comparator),this.Au=new Map,this.Ru=new Wr,this.Vu={},this.mu=new Map,this.fu=In.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function sM(n,e,t=!0){const i=Ch(n);let o;const s=i.Tu.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),o=s.view.lu()):o=await _h(i,e,t,!0),o}async function rM(n,e){const t=Ch(n);await _h(t,e,!0,!1)}async function _h(n,e,t,i){const o=await CP(n.localStore,Je(e)),s=o.targetId,l=n.sharedClientState.addLocalQueryTarget(s,t);let u;return i&&(u=await aM(n,e,s,l==="current",o.resumeToken)),n.isPrimaryClient&&t&&ch(n.remoteStore,o),u}async function aM(n,e,t,i,o){n.pu=(m,g,T)=>(async function(M,N,L,V){let b=N.view.ru(L);b.Cs&&(b=await kc(M.localStore,N.query,!1).then((({documents:S})=>N.view.ru(S,b))));const B=V&&V.targetChanges.get(N.targetId),q=V&&V.targetMismatches.get(N.targetId)!=null,H=N.view.applyChanges(b,M.isPrimaryClient,B,q);return Gc(M,N.targetId,H.au),H.snapshot})(n,m,g,T);const s=await kc(n.localStore,e,!0),l=new tM(e,s.Qs),u=l.ru(s.documents),f=Ri.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",o),d=l.applyChanges(u,n.isPrimaryClient,f);Gc(n,t,d.au);const h=new nM(e,t,l);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function lM(n,e,t){const i=K(n),o=i.Tu.get(e),s=i.Iu.get(o.targetId);if(s.length>1)return i.Iu.set(o.targetId,s.filter((l=>!Jo(l,e)))),void i.Tu.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(o.targetId),i.sharedClientState.isActiveQueryTarget(o.targetId)||await gr(i.localStore,o.targetId,!1).then((()=>{i.sharedClientState.clearQueryState(o.targetId),t&&Xr(i.remoteStore,o.targetId),Tr(i,o.targetId)})).catch(kn)):(Tr(i,o.targetId),await gr(i.localStore,o.targetId,!0))}async function uM(n,e){const t=K(n),i=t.Tu.get(e),o=t.Iu.get(i.targetId);t.isPrimaryClient&&o.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),Xr(t.remoteStore,i.targetId))}async function cM(n,e,t){const i=yM(n);try{const o=await(function(l,u){const f=K(l),d=re.now(),h=u.reduce(((T,w)=>T.add(w.key)),j());let m,g;return f.persistence.runTransaction("Locally write mutations","readwrite",(T=>{let w=rt(),M=j();return f.Ns.getEntries(T,h).next((N=>{w=N,w.forEach(((L,V)=>{V.isValidDocument()||(M=M.add(L))}))})).next((()=>f.localDocuments.getOverlayedDocuments(T,w))).next((N=>{m=N;const L=[];for(const V of u){const b=IR(V,m.get(V.key).overlayedDocument);b!=null&&L.push(new Zt(V.key,b,Pf(b.value.mapValue),it.exists(!0)))}return f.mutationQueue.addMutationBatch(T,d,L,u)})).next((N=>{g=N;const L=N.applyToLocalDocumentSet(m,M);return f.documentOverlayCache.saveOverlays(T,N.batchId,L)}))})).then((()=>({batchId:g.batchId,changes:Ff(m)})))})(i.localStore,e);i.sharedClientState.addPendingMutation(o.batchId),(function(l,u,f){let d=l.Vu[l.currentUser.toKey()];d||(d=new le(Z)),d=d.insert(u,f),l.Vu[l.currentUser.toKey()]=d})(i,o.batchId,t),await Mi(i,o.changes),await jo(i.remoteStore)}catch(o){const s=na(o,"Failed to persist write");t.reject(s)}}async function Th(n,e){const t=K(n);try{const i=await EP(t.localStore,e);e.targetChanges.forEach(((o,s)=>{const l=t.Au.get(s);l&&(ne(o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size<=1,22616),o.addedDocuments.size>0?l.hu=!0:o.modifiedDocuments.size>0?ne(l.hu,14607):o.removedDocuments.size>0&&(ne(l.hu,42227),l.hu=!1))})),await Mi(t,i,e)}catch(i){await kn(i)}}function qc(n,e,t){const i=K(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const o=[];i.Tu.forEach(((s,l)=>{const u=l.view.va(e);u.snapshot&&o.push(u.snapshot)})),(function(l,u){const f=K(l);f.onlineState=u;let d=!1;f.queries.forEach(((h,m)=>{for(const g of m.Sa)g.va(u)&&(d=!0)})),d&&ia(f)})(i.eventManager,e),o.length&&i.Pu.H_(o),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function dM(n,e,t){const i=K(n);i.sharedClientState.updateQueryState(e,"rejected",t);const o=i.Au.get(e),s=o&&o.key;if(s){let l=new le($.comparator);l=l.insert(s,Re.newNoDocument(s,W.min()));const u=j().add(s),f=new Qo(W.min(),new Map,new le(Z),l,u);await Th(i,f),i.du=i.du.remove(s),i.Au.delete(e),sa(i)}else await gr(i.localStore,e,!1).then((()=>Tr(i,e,t))).catch(kn)}async function fM(n,e){const t=K(n),i=e.batch.batchId;try{const o=await TP(t.localStore,e);vh(t,i,null),Eh(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await Mi(t,o)}catch(o){await kn(o)}}async function hM(n,e,t){const i=K(n);try{const o=await(function(l,u){const f=K(l);return f.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let h;return f.mutationQueue.lookupMutationBatch(d,u).next((m=>(ne(m!==null,37113),h=m.keys(),f.mutationQueue.removeMutationBatch(d,m)))).next((()=>f.mutationQueue.performConsistencyCheck(d))).next((()=>f.documentOverlayCache.removeOverlaysForBatchId(d,h,u))).next((()=>f.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h))).next((()=>f.localDocuments.getDocuments(d,h)))}))})(i.localStore,e);vh(i,e,t),Eh(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await Mi(i,o)}catch(o){await kn(o)}}function Eh(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function vh(n,e,t){const i=K(n);let o=i.Vu[i.currentUser.toKey()];if(o){const s=o.get(e);s&&(t?s.reject(t):s.resolve(),o=o.remove(e)),i.Vu[i.currentUser.toKey()]=o}}function Tr(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.Iu.get(e))n.Tu.delete(i),t&&n.Pu.yu(i,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((i=>{n.Ru.containsKey(i)||Ih(n,i)}))}function Ih(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Xr(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),sa(n))}function Gc(n,e,t){for(const i of t)i instanceof gh?(n.Ru.addReference(i.key,e),pM(n,i)):i instanceof yh?(F(oa,"Document no longer in limbo: "+i.key),n.Ru.removeReference(i.key,e),n.Ru.containsKey(i.key)||Ih(n,i.key)):z(19791,{wu:i})}function pM(n,e){const t=e.key,i=t.path.canonicalString();n.du.get(t)||n.Eu.has(i)||(F(oa,"New document in limbo: "+t),n.Eu.add(i),sa(n))}function sa(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new $(ae.fromString(e)),i=n.fu.next();n.Au.set(i,new iM(t)),n.du=n.du.insert(t,i),ch(n.remoteStore,new Et(Je(Gr(t.path)),i,"TargetPurposeLimboResolution",Go.ce))}}async function Mi(n,e,t){const i=K(n),o=[],s=[],l=[];i.Tu.isEmpty()||(i.Tu.forEach(((u,f)=>{l.push(i.pu(f,e,t).then((d=>{var h;if((d||t)&&i.isPrimaryClient){const m=d?!d.fromCache:(h=t==null?void 0:t.targetChanges.get(f.targetId))==null?void 0:h.current;i.sharedClientState.updateQueryState(f.targetId,m?"current":"not-current")}if(d){o.push(d);const m=Yr.As(f.targetId,d);s.push(m)}})))})),await Promise.all(l),i.Pu.H_(o),await(async function(f,d){const h=K(f);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",(m=>k.forEach(d,(g=>k.forEach(g.Es,(T=>h.persistence.referenceDelegate.addReference(m,g.targetId,T))).next((()=>k.forEach(g.ds,(T=>h.persistence.referenceDelegate.removeReference(m,g.targetId,T)))))))))}catch(m){if(!xn(m))throw m;F(Qr,"Failed to update sequence numbers: "+m)}for(const m of d){const g=m.targetId;if(!m.fromCache){const T=h.Ms.get(g),w=T.snapshotVersion,M=T.withLastLimboFreeSnapshotVersion(w);h.Ms=h.Ms.insert(g,M)}}})(i.localStore,s))}async function mM(n,e){const t=K(n);if(!t.currentUser.isEqual(e)){F(oa,"User change. New user:",e.toKey());const i=await rh(t.localStore,e);t.currentUser=e,(function(s,l){s.mu.forEach((u=>{u.forEach((f=>{f.reject(new G(x.CANCELLED,l))}))})),s.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await Mi(t,i.Ls)}}function gM(n,e){const t=K(n),i=t.Au.get(e);if(i&&i.hu)return j().add(i.key);{let o=j();const s=t.Iu.get(e);if(!s)return o;for(const l of s){const u=t.Tu.get(l);o=o.unionWith(u.view.nu)}return o}}function Ch(n){const e=K(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Th.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=gM.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=dM.bind(null,e),e.Pu.H_=ZP.bind(null,e.eventManager),e.Pu.yu=jP.bind(null,e.eventManager),e}function yM(n){const e=K(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=fM.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=hM.bind(null,e),e}class Do{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Xo(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return _P(this.persistence,new mP,e.initialUser,this.serializer)}Cu(e){return new sh(Kr.mi,this.serializer)}Du(e){return new AP}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Do.provider={build:()=>new Do};class _M extends Do{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ne(this.persistence.referenceDelegate instanceof Po,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new eP(i,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?ke.withCacheSize(this.cacheSizeBytes):ke.DEFAULT;return new sh((i=>Po.mi(i,t)),this.serializer)}}class Er{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>qc(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=mM.bind(null,this.syncEngine),await WP(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new YP})()}createDatastore(e){const t=Xo(e.databaseInfo.databaseId),i=(function(s){return new DP(s)})(e.databaseInfo);return(function(s,l,u,f){return new VP(s,l,u,f)})(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return(function(i,o,s,l,u){return new bP(i,o,s,l,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>qc(this.syncEngine,t,0)),(function(){return Lc.v()?new Lc:new wP})())}createSyncEngine(e,t){return(function(o,s,l,u,f,d,h){const m=new oM(o,s,l,u,f,d);return h&&(m.gu=!0),m})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(o){const s=K(o);F(Jt,"RemoteStore shutting down."),s.Ea.add(5),await Pi(s),s.Aa.shutdown(),s.Ra.set("Unknown")})(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Er.provider={build:()=>new Er};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TM{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):st("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nt="FirestoreClient";class EM{constructor(e,t,i,o,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=o,this.user=we.UNAUTHENTICATED,this.clientId=Lr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(i,(async l=>{F(Nt,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(i,(l=>(F(Nt,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new At;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=na(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}}async function Bs(n,e){n.asyncQueue.verifyOperationInProgress(),F(Nt,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener((async o=>{i.isEqual(o)||(await rh(e.localStore,o),i=o)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function $c(n,e){n.asyncQueue.verifyOperationInProgress();const t=await vM(n);F(Nt,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((i=>Uc(e.remoteStore,i))),n.setAppCheckTokenChangeListener(((i,o)=>Uc(e.remoteStore,o))),n._onlineComponents=e}async function vM(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){F(Nt,"Using user provided OfflineComponentProvider");try{await Bs(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(o){return o.name==="FirebaseError"?o.code===x.FAILED_PRECONDITION||o.code===x.UNIMPLEMENTED:!(typeof DOMException<"u"&&o instanceof DOMException)||o.code===22||o.code===20||o.code===11})(t))throw t;_n("Error using user provided cache. Falling back to memory cache: "+t),await Bs(n,new Do)}}else F(Nt,"Using default OfflineComponentProvider"),await Bs(n,new _M(void 0));return n._offlineComponents}async function Sh(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(F(Nt,"Using user provided OnlineComponentProvider"),await $c(n,n._uninitializedComponentsProvider._online)):(F(Nt,"Using default OnlineComponentProvider"),await $c(n,new Er))),n._onlineComponents}function IM(n){return Sh(n).then((e=>e.syncEngine))}async function CM(n){const e=await Sh(n),t=e.eventManager;return t.onListen=sM.bind(null,e.syncEngine),t.onUnlisten=lM.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=rM.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=uM.bind(null,e.syncEngine),t}function SM(n,e,t={}){const i=new At;return n.asyncQueue.enqueueAndForget((async()=>(function(s,l,u,f,d){const h=new TM({next:g=>{h.Nu(),l.enqueueAndForget((()=>XP(s,m)));const T=g.docs.has(u);!T&&g.fromCache?d.reject(new G(x.UNAVAILABLE,"Failed to get document because the client is offline.")):T&&g.fromCache&&f&&f.source==="server"?d.reject(new G(x.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(g)},error:g=>d.reject(g)}),m=new eM(Gr(u.path),h,{includeMetadataChanges:!0,qa:!0});return QP(s,m)})(await CM(n),n.asyncQueue,e,t,i))),i.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ah(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hc=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wh="firestore.googleapis.com",zc=!0;class Jc{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new G(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=wh,this.ssl=zc}else this.host=e.host,this.ssl=e.ssl??zc;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=oh;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<ZR)throw new G(x.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Lw("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ah(e.experimentalLongPollingOptions??{}),(function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new G(x.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new G(x.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new G(x.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(i,o){return i.timeoutSeconds===o.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ra{constructor(e,t,i,o){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=o,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new G(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new G(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jc(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(i){if(!i)return new Sw;switch(i.type){case"firstParty":return new Pw(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new G(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const i=Hc.get(t);i&&(F("ComponentProvider","Removing Datastore"),Hc.delete(t),i.terminate())})(this),Promise.resolve()}}function AM(n,e,t,i={}){var d;n=hi(n,ra);const o=Mn(e),s=n._getSettings(),l={...s,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;o&&(tf(`https://${u}`),nf("Firestore",!0)),s.host!==wh&&s.host!==u&&_n("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const f={...s,host:u,ssl:o,emulatorOptions:i};if(!$t(f,l)&&(n._setSettings(f),i.mockUserToken)){let h,m;if(typeof i.mockUserToken=="string")h=i.mockUserToken,m=we.MOCK_USER;else{h=YS(i.mockUserToken,(d=n._app)==null?void 0:d.options.projectId);const g=i.mockUserToken.sub||i.mockUserToken.user_id;if(!g)throw new G(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new we(g)}n._authCredentials=new Aw(new yf(h,m))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new aa(this.firestore,e,this._query)}}class _e{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ei(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new _e(this.firestore,e,this._key)}toJSON(){return{type:_e._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,i){if(Ai(t,_e._jsonSchema))return new _e(e,i||null,new $(ae.fromString(t.referencePath)))}}_e._jsonSchemaVersion="firestore/documentReference/1.0",_e._jsonSchema={type:fe("string",_e._jsonSchemaVersion),referencePath:fe("string")};class Ei extends aa{constructor(e,t,i){super(e,t,Gr(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new _e(this.firestore,null,new $(e))}withConverter(e){return new Ei(this.firestore,e,this._path)}}function Os(n,e,...t){if(n=Ue(n),arguments.length===1&&(e=Lr.newId()),Vw("doc","path",e),n instanceof ra){const i=ae.fromString(e,...t);return rc(i),new _e(n,null,new $(i))}{if(!(n instanceof _e||n instanceof Ei))throw new G(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(ae.fromString(e,...t));return rc(i),new _e(n.firestore,n instanceof Ei?n.converter:null,new $(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wc="AsyncQueue";class Kc{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new lh(this,"async_queue_retry"),this._c=()=>{const i=Fs();i&&F(Wc,"Visibility state changed to "+i.visibilityState),this.M_.w_()},this.ac=e;const t=Fs();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Fs();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new At;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!xn(e))throw e;F(Wc,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((i=>{throw this.nc=i,this.rc=!1,st("INTERNAL UNHANDLED ERROR: ",Yc(i)),i})).then((i=>(this.rc=!1,i))))));return this.ac=t,t}enqueueAfterDelay(e,t,i){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const o=ta.createAndSchedule(this,e,t,i,(s=>this.hc(s)));return this.tc.push(o),o}uc(){this.nc&&z(47125,{Pc:Yc(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,i)=>t.targetTimeMs-i.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Yc(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class la extends ra{constructor(e,t,i,o){super(e,t,i,o),this.type="firestore",this._queue=new Kc,this._persistenceKey=(o==null?void 0:o.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Kc(e),this._firestoreClient=void 0,await e}}}function wM(n,e){const t=typeof n=="object"?n:af(),i=typeof n=="string"?n:vo,o=xr(t,"firestore").getImmediate({identifier:i});if(!o._initialized){const s=WS("firestore");s&&AM(o,...s)}return o}function Rh(n){if(n._terminated)throw new G(x.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||RM(n),n._firestoreClient}function RM(n){var i,o,s;const e=n._freezeSettings(),t=(function(u,f,d,h){return new Jw(u,f,d,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,Ah(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)})(n._databaseId,((i=n._app)==null?void 0:i.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(o=e.localCache)!=null&&o._offlineComponentProvider&&((s=e.localCache)!=null&&s._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new EM(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(u){const f=u==null?void 0:u._online.build();return{_offline:u==null?void 0:u._offline.build(f),_online:f}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Le{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Le(Ce.fromBase64String(e))}catch(t){throw new G(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Le(Ce.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Le._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ai(e,Le._jsonSchema))return Le.fromBase64String(e.bytes)}}Le._jsonSchemaVersion="firestore/bytes/1.0",Le._jsonSchema={type:fe("string",Le._jsonSchemaVersion),bytes:fe("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new G(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ie(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ph{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ke{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new G(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new G(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Z(this._lat,e._lat)||Z(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ke._jsonSchemaVersion}}static fromJSON(e){if(Ai(e,Ke._jsonSchema))return new Ke(e.latitude,e.longitude)}}Ke._jsonSchemaVersion="firestore/geoPoint/1.0",Ke._jsonSchema={type:fe("string",Ke._jsonSchemaVersion),latitude:fe("number"),longitude:fe("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ye{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(i,o){if(i.length!==o.length)return!1;for(let s=0;s<i.length;++s)if(i[s]!==o[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Ye._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ai(e,Ye._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Ye(e.vectorValues);throw new G(x.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ye._jsonSchemaVersion="firestore/vectorValue/1.0",Ye._jsonSchema={type:fe("string",Ye._jsonSchemaVersion),vectorValues:fe("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PM=/^__.*__$/;class MM{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new Zt(e,this.data,this.fieldMask,t,this.fieldTransforms):new wi(e,this.data,t,this.fieldTransforms)}}function Mh(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw z(40011,{Ac:n})}}class ca{constructor(e,t,i,o,s,l){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=o,s===void 0&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new ca({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var o;const t=(o=this.path)==null?void 0:o.child(e),i=this.Vc({path:t,fc:!1});return i.gc(e),i}yc(e){var o;const t=(o=this.path)==null?void 0:o.child(e),i=this.Vc({path:t,fc:!1});return i.Rc(),i}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return No(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Mh(this.Ac)&&PM.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class DM{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||Xo(e)}Cc(e,t,i,o=!1){return new ca({Ac:e,methodName:t,Dc:i,path:Ie.emptyPath(),fc:!1,bc:o},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function NM(n){const e=n._freezeSettings(),t=Xo(n._databaseId);return new DM(n._databaseId,!!e.ignoreUndefinedProperties,t)}function kM(n,e,t,i,o,s={}){const l=n.Cc(s.merge||s.mergeFields?2:0,e,t,o);xh("Data must be an object, but it was:",l,i);const u=Nh(i,l);let f,d;if(s.merge)f=new Be(l.fieldMask),d=l.fieldTransforms;else if(s.mergeFields){const h=[];for(const m of s.mergeFields){const g=xM(e,m,t);if(!l.contains(g))throw new G(x.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);LM(h,g)||h.push(g)}f=new Be(h),d=l.fieldTransforms.filter((m=>f.covers(m.field)))}else f=null,d=l.fieldTransforms;return new MM(new Ve(u),f,d)}function Dh(n,e){if(kh(n=Ue(n)))return xh("Unsupported field value:",e,n),Nh(n,e);if(n instanceof Ph)return(function(i,o){if(!Mh(o.Ac))throw o.Sc(`${i._methodName}() can only be used with update() and set()`);if(!o.path)throw o.Sc(`${i._methodName}() is not currently supported inside arrays`);const s=i._toFieldTransform(o);s&&o.fieldTransforms.push(s)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(i,o){const s=[];let l=0;for(const u of i){let f=Dh(u,o.wc(l));f==null&&(f={nullValue:"NULL_VALUE"}),s.push(f),l++}return{arrayValue:{values:s}}})(n,e)}return(function(i,o){if((i=Ue(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return gR(o.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const s=re.fromDate(i);return{timestampValue:Ro(o.serializer,s)}}if(i instanceof re){const s=new re(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:Ro(o.serializer,s)}}if(i instanceof Ke)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof Le)return{bytesValue:Xf(o.serializer,i._byteString)};if(i instanceof _e){const s=o.databaseId,l=i.firestore._databaseId;if(!l.isEqual(s))throw o.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Jr(i.firestore._databaseId||o.databaseId,i._key.path)}}if(i instanceof Ye)return(function(l,u){return{mapValue:{fields:{[wf]:{stringValue:Rf},[Io]:{arrayValue:{values:l.toArray().map((d=>{if(typeof d!="number")throw u.Sc("VectorValues must only contain numeric values.");return $r(u.serializer,d)}))}}}}}})(i,o);throw o.Sc(`Unsupported field value: ${br(i)}`)})(n,e)}function Nh(n,e){const t={};return Ef(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Qt(n,((i,o)=>{const s=Dh(o,e.mc(i));s!=null&&(t[i]=s)})),{mapValue:{fields:t}}}function kh(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof re||n instanceof Ke||n instanceof Le||n instanceof _e||n instanceof Ph||n instanceof Ye)}function xh(n,e,t){if(!kh(t)||!_f(t)){const i=br(t);throw i==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+i)}}function xM(n,e,t){if((e=Ue(e))instanceof ua)return e._internalPath;if(typeof e=="string")return Vh(n,e);throw No("Field path arguments must be of type string or ",n,!1,void 0,t)}const VM=new RegExp("[~\\*/\\[\\]]");function Vh(n,e,t){if(e.search(VM)>=0)throw No(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ua(...e.split("."))._internalPath}catch{throw No(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function No(n,e,t,i,o){const s=i&&!i.isEmpty(),l=o!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let f="";return(s||l)&&(f+=" (found",s&&(f+=` in field ${i}`),l&&(f+=` in document ${o}`),f+=")"),new G(x.INVALID_ARGUMENT,u+n+f)}function LM(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lh{constructor(e,t,i,o,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=o,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new _e(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new bM(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(bh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class bM extends Lh{data(){return super.data()}}function bh(n,e){return typeof e=="string"?Vh(n,e):e instanceof ua?e._internalPath:e._delegate._internalPath}class UM{convertValue(e,t="none"){switch(Mt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ce(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Pt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw z(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const i={};return Qt(e,((o,s)=>{i[o]=this.convertValue(s,t)})),i}convertVectorValue(e){var i,o,s;const t=(s=(o=(i=e.fields)==null?void 0:i[Io].arrayValue)==null?void 0:o.values)==null?void 0:s.map((l=>ce(l.doubleValue)));return new Ye(t)}convertGeoPoint(e){return new Ke(ce(e.latitude),ce(e.longitude))}convertArray(e,t){return(e.values||[]).map((i=>this.convertValue(i,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const i=Ho(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(mi(e));default:return null}}convertTimestamp(e){const t=Rt(e);return new re(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=ae.fromString(e);ne(ih(i),9688,{name:e});const o=new gi(i.get(1),i.get(3)),s=new $(i.popFirst(5));return o.isEqual(t)||st(`Document ${s} contains a document reference within a different database (${o.projectId}/${o.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FM(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}class ii{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ot extends Lh{constructor(e,t,i,o,s,l){super(e,t,i,o,l),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new uo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(bh("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new G(x.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Ot._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Ot._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ot._jsonSchema={type:fe("string",Ot._jsonSchemaVersion),bundleSource:fe("string","DocumentSnapshot"),bundleName:fe("string"),bundle:fe("string")};class uo extends Ot{data(e={}){return super.data(e)}}class ci{constructor(e,t,i,o){this._firestore=e,this._userDataWriter=t,this._snapshot=o,this.metadata=new ii(o.hasPendingWrites,o.fromCache),this.query=i}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((i=>{e.call(t,new uo(this._firestore,this._userDataWriter,i.key,i,new ii(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new G(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(o,s){if(o._snapshot.oldDocs.isEmpty()){let l=0;return o._snapshot.docChanges.map((u=>{const f=new uo(o._firestore,o._userDataWriter,u.doc.key,u.doc,new ii(o._snapshot.mutatedKeys.has(u.doc.key),o._snapshot.fromCache),o.query.converter);return u.doc,{type:"added",doc:f,oldIndex:-1,newIndex:l++}}))}{let l=o._snapshot.oldDocs;return o._snapshot.docChanges.filter((u=>s||u.type!==3)).map((u=>{const f=new uo(o._firestore,o._userDataWriter,u.doc.key,u.doc,new ii(o._snapshot.mutatedKeys.has(u.doc.key),o._snapshot.fromCache),o.query.converter);let d=-1,h=-1;return u.type!==0&&(d=l.indexOf(u.doc.key),l=l.delete(u.doc.key)),u.type!==1&&(l=l.add(u.doc),h=l.indexOf(u.doc.key)),{type:BM(u.type),doc:f,oldIndex:d,newIndex:h}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new G(x.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ci._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Lr.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],i=[],o=[];return this.docs.forEach((s=>{s._document!==null&&(t.push(s._document),i.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),o.push(s.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function BM(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return z(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qc(n){n=hi(n,_e);const e=hi(n.firestore,la);return SM(Rh(e),n._key).then((t=>GM(e,n,t)))}ci._jsonSchemaVersion="firestore/querySnapshot/1.0",ci._jsonSchema={type:fe("string",ci._jsonSchemaVersion),bundleSource:fe("string","QuerySnapshot"),bundleName:fe("string"),bundle:fe("string")};class OM extends UM{constructor(e){super(),this.firestore=e}convertBytes(e){return new Le(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new _e(this.firestore,null,t)}}function Xc(n,e,t){n=hi(n,_e);const i=hi(n.firestore,la),o=FM(n.converter,e,t);return qM(i,[kM(NM(i),"setDoc",n._key,o,n.converter!==null,t).toMutation(n._key,it.none())])}function qM(n,e){return(function(i,o){const s=new At;return i.asyncQueue.enqueueAndForget((async()=>cM(await IM(i),o,s))),s.promise})(Rh(n),e)}function GM(n,e,t){const i=t.docs.get(e._key),o=new OM(n);return new Ot(n,o,e._key,i,new ii(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(o){Nn=o})(Dn),yn(new Ht("firestore",((i,{instanceIdentifier:o,options:s})=>{const l=i.getProvider("app").getImmediate(),u=new la(new ww(i.getProvider("auth-internal")),new Mw(l,i.getProvider("app-check-internal")),(function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new G(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new gi(d.options.projectId,h)})(l,o),l);return s={useFetchStreams:t,...s},u._setSettings(s),u}),"PUBLIC").setMultipleInstances(!0)),Ct(nc,ic,e),Ct(nc,ic,"esm2020")})();function Uh(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const $M=Uh,Fh=new Ci("auth","Firebase",Uh());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ko=new Nr("@firebase/auth");function HM(n,...e){ko.logLevel<=X.WARN&&ko.warn(`Auth (${Dn}): ${n}`,...e)}function co(n,...e){ko.logLevel<=X.ERROR&&ko.error(`Auth (${Dn}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function je(n,...e){throw fa(n,...e)}function qe(n,...e){return fa(n,...e)}function da(n,e,t){const i={...$M(),[e]:t};return new Ci("auth","Firebase",i).create(e,{appName:n.name})}function qt(n){return da(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function zM(n,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&je(n,"argument-error"),da(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function fa(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return Fh.create(n,...e)}function J(n,e,...t){if(!n)throw fa(e,...t)}function tt(n){const e="INTERNAL ASSERTION FAILED: "+n;throw co(e),new Error(e)}function at(n,e){n||tt(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vr(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function JM(){return Zc()==="http:"||Zc()==="https:"}function Zc(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WM(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(JM()||tA()||"connection"in navigator)?navigator.onLine:!0}function KM(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di{constructor(e,t){this.shortDelay=e,this.longDelay=t,at(t>e,"Short delay should be less than long delay!"),this.isMobile=ZS()||nA()}get(){return WM()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ha(n,e){at(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bh{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;tt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;tt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;tt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YM={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QM=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],XM=new Di(3e4,6e4);function pa(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Ln(n,e,t,i,o={}){return Oh(n,o,async()=>{let s={},l={};i&&(e==="GET"?l=i:s={body:JSON.stringify(i)});const u=Si({key:n.config.apiKey,...l}).slice(1),f=await n._getAdditionalHeaders();f["Content-Type"]="application/json",n.languageCode&&(f["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:f,...s};return eA()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&Mn(n.emulatorConfig.host)&&(d.credentials="include"),Bh.fetch()(await qh(n,n.config.apiHost,t,u),d)})}async function Oh(n,e,t){n._canInitEmulator=!1;const i={...YM,...e};try{const o=new jM(n),s=await Promise.race([t(),o.promise]);o.clearNetworkTimeout();const l=await s.json();if("needConfirmation"in l)throw to(n,"account-exists-with-different-credential",l);if(s.ok&&!("errorMessage"in l))return l;{const u=s.ok?l.errorMessage:l.error.message,[f,d]=u.split(" : ");if(f==="FEDERATED_USER_ID_ALREADY_LINKED")throw to(n,"credential-already-in-use",l);if(f==="EMAIL_EXISTS")throw to(n,"email-already-in-use",l);if(f==="USER_DISABLED")throw to(n,"user-disabled",l);const h=i[f]||f.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw da(n,h,d);je(n,h)}}catch(o){if(o instanceof ut)throw o;je(n,"network-request-failed",{message:String(o)})}}async function ZM(n,e,t,i,o={}){const s=await Ln(n,e,t,i,o);return"mfaPendingCredential"in s&&je(n,"multi-factor-auth-required",{_serverResponse:s}),s}async function qh(n,e,t,i){const o=`${e}${t}?${i}`,s=n,l=s.config.emulator?ha(n.config,o):`${n.config.apiScheme}://${o}`;return QM.includes(t)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(l).toString():l}class jM{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(qe(this.auth,"network-request-failed")),XM.get())})}}function to(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const o=qe(n,e,i);return o.customData._tokenResponse=t,o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e0(n,e){return Ln(n,"POST","/v1/accounts:delete",e)}async function xo(n,e){return Ln(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function di(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function t0(n,e=!1){const t=Ue(n),i=await t.getIdToken(e),o=ma(i);J(o&&o.exp&&o.auth_time&&o.iat,t.auth,"internal-error");const s=typeof o.firebase=="object"?o.firebase:void 0,l=s==null?void 0:s.sign_in_provider;return{claims:o,token:i,authTime:di(qs(o.auth_time)),issuedAtTime:di(qs(o.iat)),expirationTime:di(qs(o.exp)),signInProvider:l||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function qs(n){return Number(n)*1e3}function ma(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return co("JWT malformed, contained fewer than 3 sections"),null;try{const o=Xd(t);return o?JSON.parse(o):(co("Failed to decode base64 JWT payload"),null)}catch(o){return co("Caught error parsing JWT payload as JSON",o==null?void 0:o.toString()),null}}function jc(n){const e=ma(n);return J(e,"internal-error"),J(typeof e.exp<"u","internal-error"),J(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vi(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof ut&&n0(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function n0({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const i=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ir{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=di(this.lastLoginAt),this.creationTime=di(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vo(n){var m;const e=n.auth,t=await n.getIdToken(),i=await vi(n,xo(e,{idToken:t}));J(i==null?void 0:i.users.length,e,"internal-error");const o=i.users[0];n._notifyReloadListener(o);const s=(m=o.providerUserInfo)!=null&&m.length?Gh(o.providerUserInfo):[],l=s0(n.providerData,s),u=n.isAnonymous,f=!(n.email&&o.passwordHash)&&!(l!=null&&l.length),d=u?f:!1,h={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:l,metadata:new Ir(o.createdAt,o.lastLoginAt),isAnonymous:d};Object.assign(n,h)}async function o0(n){const e=Ue(n);await Vo(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function s0(n,e){return[...n.filter(i=>!e.some(o=>o.providerId===i.providerId)),...e]}function Gh(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r0(n,e){const t=await Oh(n,{},async()=>{const i=Si({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:o,apiKey:s}=n.config,l=await qh(n,o,"/v1/token",`key=${s}`),u=await n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";const f={method:"POST",headers:u,body:i};return n.emulatorConfig&&Mn(n.emulatorConfig.host)&&(f.credentials="include"),Bh.fetch()(l,f)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function a0(n,e){return Ln(n,"POST","/v2/accounts:revokeToken",pa(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){J(e.idToken,"internal-error"),J(typeof e.idToken<"u","internal-error"),J(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):jc(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){J(e.length!==0,"internal-error");const t=jc(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(J(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:o,expiresIn:s}=await r0(e,t);this.updateTokensAndExpiration(i,o,Number(s))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:o,expirationTime:s}=t,l=new pn;return i&&(J(typeof i=="string","internal-error",{appName:e}),l.refreshToken=i),o&&(J(typeof o=="string","internal-error",{appName:e}),l.accessToken=o),s&&(J(typeof s=="number","internal-error",{appName:e}),l.expirationTime=s),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new pn,this.toJSON())}_performRefresh(){return tt("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gt(n,e){J(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Oe{constructor({uid:e,auth:t,stsTokenManager:i,...o}){this.providerId="firebase",this.proactiveRefresh=new i0(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new Ir(o.createdAt||void 0,o.lastLoginAt||void 0)}async getIdToken(e){const t=await vi(this,this.stsTokenManager.getToken(this.auth,e));return J(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return t0(this,e)}reload(){return o0(this)}_assign(e){this!==e&&(J(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Oe({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){J(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await Vo(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Fe(this.auth.app))return Promise.reject(qt(this.auth));const e=await this.getIdToken();return await vi(this,e0(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const i=t.displayName??void 0,o=t.email??void 0,s=t.phoneNumber??void 0,l=t.photoURL??void 0,u=t.tenantId??void 0,f=t._redirectEventId??void 0,d=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:m,emailVerified:g,isAnonymous:T,providerData:w,stsTokenManager:M}=t;J(m&&M,e,"internal-error");const N=pn.fromJSON(this.name,M);J(typeof m=="string",e,"internal-error"),gt(i,e.name),gt(o,e.name),J(typeof g=="boolean",e,"internal-error"),J(typeof T=="boolean",e,"internal-error"),gt(s,e.name),gt(l,e.name),gt(u,e.name),gt(f,e.name),gt(d,e.name),gt(h,e.name);const L=new Oe({uid:m,auth:e,email:o,emailVerified:g,displayName:i,isAnonymous:T,photoURL:l,phoneNumber:s,tenantId:u,stsTokenManager:N,createdAt:d,lastLoginAt:h});return w&&Array.isArray(w)&&(L.providerData=w.map(V=>({...V}))),f&&(L._redirectEventId=f),L}static async _fromIdTokenResponse(e,t,i=!1){const o=new pn;o.updateFromServerResponse(t);const s=new Oe({uid:t.localId,auth:e,stsTokenManager:o,isAnonymous:i});return await Vo(s),s}static async _fromGetAccountInfoResponse(e,t,i){const o=t.users[0];J(o.localId!==void 0,"internal-error");const s=o.providerUserInfo!==void 0?Gh(o.providerUserInfo):[],l=!(o.email&&o.passwordHash)&&!(s!=null&&s.length),u=new pn;u.updateFromIdToken(i);const f=new Oe({uid:o.localId,auth:e,stsTokenManager:u,isAnonymous:l}),d={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:s,metadata:new Ir(o.createdAt,o.lastLoginAt),isAnonymous:!(o.email&&o.passwordHash)&&!(s!=null&&s.length)};return Object.assign(f,d),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ed=new Map;function nt(n){at(n instanceof Function,"Expected a class definition");let e=ed.get(n);return e?(at(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,ed.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $h{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}$h.type="NONE";const td=$h;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fo(n,e,t){return`firebase:${n}:${e}:${t}`}class mn{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:o,name:s}=this.auth;this.fullUserKey=fo(this.userKey,o.apiKey,s),this.fullPersistenceKey=fo("persistence",o.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await xo(this.auth,{idToken:e}).catch(()=>{});return t?Oe._fromGetAccountInfoResponse(this.auth,t,e):null}return Oe._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new mn(nt(td),e,i);const o=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let s=o[0]||nt(td);const l=fo(i,e.config.apiKey,e.name);let u=null;for(const d of t)try{const h=await d._get(l);if(h){let m;if(typeof h=="string"){const g=await xo(e,{idToken:h}).catch(()=>{});if(!g)break;m=await Oe._fromGetAccountInfoResponse(e,g,h)}else m=Oe._fromJSON(e,h);d!==s&&(u=m),s=d;break}}catch{}const f=o.filter(d=>d._shouldAllowMigration);return!s._shouldAllowMigration||!f.length?new mn(s,e,i):(s=f[0],u&&await s._set(l,u.toJSON()),await Promise.all(t.map(async d=>{if(d!==s)try{await d._remove(l)}catch{}})),new mn(s,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nd(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Wh(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Hh(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Yh(e))return"Blackberry";if(Qh(e))return"Webos";if(zh(e))return"Safari";if((e.includes("chrome/")||Jh(e))&&!e.includes("edge/"))return"Chrome";if(Kh(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function Hh(n=Me()){return/firefox\//i.test(n)}function zh(n=Me()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Jh(n=Me()){return/crios\//i.test(n)}function Wh(n=Me()){return/iemobile/i.test(n)}function Kh(n=Me()){return/android/i.test(n)}function Yh(n=Me()){return/blackberry/i.test(n)}function Qh(n=Me()){return/webos/i.test(n)}function ga(n=Me()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function l0(n=Me()){var e;return ga(n)&&!!((e=window.navigator)!=null&&e.standalone)}function u0(){return iA()&&document.documentMode===10}function Xh(n=Me()){return ga(n)||Kh(n)||Qh(n)||Yh(n)||/windows phone/i.test(n)||Wh(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zh(n,e=[]){let t;switch(n){case"Browser":t=nd(Me());break;case"Worker":t=`${nd(Me())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Dn}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=s=>new Promise((l,u)=>{try{const f=e(s);l(f)}catch(f){u(f)}});i.onAbort=t,this.queue.push(i);const o=this.queue.length-1;return()=>{this.queue[o]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const o of t)try{o()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d0(n,e={}){return Ln(n,"GET","/v2/passwordPolicy",pa(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f0=6;class h0{constructor(e){var i;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??f0,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((i=e.allowedNonAlphanumericCharacters)==null?void 0:i.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,o=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),o&&(t.meetsMaxPasswordLength=e.length<=o)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let o=0;o<e.length;o++)i=e.charAt(o),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,o,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=o)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p0{constructor(e,t,i,o){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=o,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new id(this),this.idTokenSubscription=new id(this),this.beforeStateQueue=new c0(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Fh,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=o.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=nt(t)),this._initializationPromise=this.queue(async()=>{var i,o,s;if(!this._deleted&&(this.persistenceManager=await mn.create(this,e),(i=this._resolvePersistenceManagerAvailable)==null||i.call(this),!this._deleted)){if((o=this._popupRedirectResolver)!=null&&o._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)==null?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await xo(this,{idToken:e}),i=await Oe._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var s;if(Fe(this.app)){const l=this.app.settings.authIdToken;return l?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(l).then(u,u))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let i=t,o=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const l=(s=this.redirectUser)==null?void 0:s._redirectEventId,u=i==null?void 0:i._redirectEventId,f=await this.tryRedirectSignIn(e);(!l||l===u)&&(f!=null&&f.user)&&(i=f.user,o=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(o)try{await this.beforeStateQueue.runMiddleware(i)}catch(l){i=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(l))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return J(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Vo(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=KM()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Fe(this.app))return Promise.reject(qt(this));const t=e?Ue(e):null;return t&&J(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&J(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Fe(this.app)?Promise.reject(qt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Fe(this.app)?Promise.reject(qt(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(nt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await d0(this),t=new h0(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ci("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await a0(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&nt(e)||this._popupRedirectResolver;J(t,this,"argument-error"),this.redirectPersistenceManager=await mn.create(this,[nt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)==null?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,o){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let l=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(J(u,this,"internal-error"),u.then(()=>{l||s(this.currentUser)}),typeof t=="function"){const f=e.addObserver(t,i,o);return()=>{l=!0,f()}}else{const f=e.addObserver(t);return()=>{l=!0,f()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return J(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Zh(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var o;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((o=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:o.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const i=await this._getAppCheckToken();return i&&(e["X-Firebase-AppCheck"]=i),e}async _getAppCheckToken(){var t;if(Fe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&HM(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function es(n){return Ue(n)}class id{constructor(e){this.auth=e,this.observer=null,this.addObserver=dA(t=>this.observer=t)}get next(){return J(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ya={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function m0(n){ya=n}function g0(n){return ya.loadJS(n)}function y0(){return ya.gapiScript}function _0(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T0(n,e){const t=xr(n,"auth");if(t.isInitialized()){const o=t.getImmediate(),s=t.getOptions();if($t(s,e??{}))return o;je(o,"already-initialized")}return t.initialize({options:e})}function E0(n,e){const t=(e==null?void 0:e.persistence)||[],i=(Array.isArray(t)?t:[t]).map(nt);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e==null?void 0:e.popupRedirectResolver)}function v0(n,e,t){const i=es(n);J(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const o=!1,s=jh(e),{host:l,port:u}=I0(e),f=u===null?"":`:${u}`,d={url:`${s}//${l}${f}/`},h=Object.freeze({host:l,port:u,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:o})});if(!i._canInitEmulator){J(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),J($t(d,i.config.emulator)&&$t(h,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=d,i.emulatorConfig=h,i.settings.appVerificationDisabledForTesting=!0,Mn(l)?(tf(`${s}//${l}${f}`),nf("Auth",!0)):C0()}function jh(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function I0(n){const e=jh(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",o=/^(\[[^\]]+\])(:|$)/.exec(i);if(o){const s=o[1];return{host:s,port:od(i.substr(s.length+1))}}else{const[s,l]=i.split(":");return{host:s,port:od(l)}}}function od(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function C0(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return tt("not implemented")}_getIdTokenResponse(e){return tt("not implemented")}_linkToIdToken(e,t){return tt("not implemented")}_getReauthenticationResolver(e){return tt("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gn(n,e){return ZM(n,"POST","/v1/accounts:signInWithIdp",pa(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S0="http://localhost";class Wt extends ep{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Wt(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):je("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:o,...s}=t;if(!i||!o)return null;const l=new Wt(i,o);return l.idToken=s.idToken||void 0,l.accessToken=s.accessToken||void 0,l.secret=s.secret,l.nonce=s.nonce,l.pendingToken=s.pendingToken||null,l}_getIdTokenResponse(e){const t=this.buildRequest();return gn(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,gn(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,gn(e,t)}buildRequest(){const e={requestUri:S0,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Si(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ni extends _a{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt extends Ni{constructor(){super("facebook.com")}static credential(e){return Wt._fromParams({providerId:yt.PROVIDER_ID,signInMethod:yt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return yt.credentialFromTaggedObject(e)}static credentialFromError(e){return yt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return yt.credential(e.oauthAccessToken)}catch{return null}}}yt.FACEBOOK_SIGN_IN_METHOD="facebook.com";yt.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class et extends Ni{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Wt._fromParams({providerId:et.PROVIDER_ID,signInMethod:et.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return et.credentialFromTaggedObject(e)}static credentialFromError(e){return et.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return et.credential(t,i)}catch{return null}}}et.GOOGLE_SIGN_IN_METHOD="google.com";et.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _t extends Ni{constructor(){super("github.com")}static credential(e){return Wt._fromParams({providerId:_t.PROVIDER_ID,signInMethod:_t.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _t.credentialFromTaggedObject(e)}static credentialFromError(e){return _t.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return _t.credential(e.oauthAccessToken)}catch{return null}}}_t.GITHUB_SIGN_IN_METHOD="github.com";_t.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt extends Ni{constructor(){super("twitter.com")}static credential(e,t){return Wt._fromParams({providerId:Tt.PROVIDER_ID,signInMethod:Tt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Tt.credentialFromTaggedObject(e)}static credentialFromError(e){return Tt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return Tt.credential(t,i)}catch{return null}}}Tt.TWITTER_SIGN_IN_METHOD="twitter.com";Tt.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,o=!1){const s=await Oe._fromIdTokenResponse(e,i,o),l=sd(i);return new Sn({user:s,providerId:l,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const o=sd(i);return new Sn({user:e,providerId:o,_tokenResponse:i,operationType:t})}}function sd(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lo extends ut{constructor(e,t,i,o){super(t.code,t.message),this.operationType=i,this.user=o,Object.setPrototypeOf(this,Lo.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,o){return new Lo(e,t,i,o)}}function tp(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Lo._fromErrorAndOperation(n,s,e,i):s})}async function A0(n,e,t=!1){const i=await vi(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Sn._forOperation(n,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w0(n,e,t=!1){const{auth:i}=n;if(Fe(i.app))return Promise.reject(qt(i));const o="reauthenticate";try{const s=await vi(n,tp(i,o,e,n),t);J(s.idToken,i,"internal-error");const l=ma(s.idToken);J(l,i,"internal-error");const{sub:u}=l;return J(n.uid===u,i,"user-mismatch"),Sn._forOperation(n,o,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&je(i,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R0(n,e,t=!1){if(Fe(n.app))return Promise.reject(qt(n));const i="signIn",o=await tp(n,i,e),s=await Sn._fromIdTokenResponse(n,i,o);return t||await n._updateCurrentUser(s.user),s}function P0(n,e,t,i){return Ue(n).onIdTokenChanged(e,t,i)}function M0(n,e,t){return Ue(n).beforeAuthStateChanged(e,t)}function D0(n,e,t,i){return Ue(n).onAuthStateChanged(e,t,i)}function N0(n){return Ue(n).signOut()}const bo="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class np{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(bo,"1"),this.storage.removeItem(bo),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k0=1e3,x0=10;class ip extends np{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Xh(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),o=this.localCache[t];i!==o&&e(t,o,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((l,u,f)=>{this.notifyListeners(l,f)});return}const i=e.key;t?this.detachListener():this.stopPolling();const o=()=>{const l=this.storage.getItem(i);!t&&this.localCache[i]===l||this.notifyListeners(i,l)},s=this.storage.getItem(i);u0()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(o,x0):o()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const o of Array.from(i))o(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},k0)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ip.type="LOCAL";const V0=ip;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class op extends np{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}op.type="SESSION";const sp=op;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L0(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(o=>o.isListeningto(e));if(t)return t;const i=new ts(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:o,data:s}=t.data,l=this.handlersMap[o];if(!(l!=null&&l.size))return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:o});const u=Array.from(l).map(async d=>d(t.origin,s)),f=await L0(u);t.ports[0].postMessage({status:"done",eventId:i,eventType:o,response:f})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ts.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ta(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b0{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const o=typeof MessageChannel<"u"?new MessageChannel:null;if(!o)throw new Error("connection_unavailable");let s,l;return new Promise((u,f)=>{const d=Ta("",20);o.port1.start();const h=setTimeout(()=>{f(new Error("unsupported_event"))},i);l={messageChannel:o,onMessage(m){const g=m;if(g.data.eventId===d)switch(g.data.status){case"ack":clearTimeout(h),s=setTimeout(()=>{f(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),u(g.data.response);break;default:clearTimeout(h),clearTimeout(s),f(new Error("invalid_response"));break}}},this.handlers.add(l),o.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[o.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qe(){return window}function U0(n){Qe().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rp(){return typeof Qe().WorkerGlobalScope<"u"&&typeof Qe().importScripts=="function"}async function F0(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function B0(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function O0(){return rp()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ap="firebaseLocalStorageDb",q0=1,Uo="firebaseLocalStorage",lp="fbase_key";class ki{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ns(n,e){return n.transaction([Uo],e?"readwrite":"readonly").objectStore(Uo)}function G0(){const n=indexedDB.deleteDatabase(ap);return new ki(n).toPromise()}function Cr(){const n=indexedDB.open(ap,q0);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(Uo,{keyPath:lp})}catch(o){t(o)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(Uo)?e(i):(i.close(),await G0(),e(await Cr()))})})}async function rd(n,e,t){const i=ns(n,!0).put({[lp]:e,value:t});return new ki(i).toPromise()}async function $0(n,e){const t=ns(n,!1).get(e),i=await new ki(t).toPromise();return i===void 0?null:i.value}function ad(n,e){const t=ns(n,!0).delete(e);return new ki(t).toPromise()}const H0=800,z0=3;class up{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Cr(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>z0)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return rp()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ts._getInstance(O0()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,i;if(this.activeServiceWorker=await F0(),!this.activeServiceWorker)return;this.sender=new b0(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(i=e[0])!=null&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||B0()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Cr();return await rd(e,bo,"1"),await ad(e,bo),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>rd(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>$0(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>ad(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(o=>{const s=ns(o,!1).getAll();return new ki(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:o,value:s}of e)i.add(o),JSON.stringify(this.localCache[o])!==JSON.stringify(s)&&(this.notifyListeners(o,s),t.push(o));for(const o of Object.keys(this.localCache))this.localCache[o]&&!i.has(o)&&(this.notifyListeners(o,null),t.push(o));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const o of Array.from(i))o(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),H0)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}up.type="LOCAL";const J0=up;new Di(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cp(n,e){return e?nt(e):(J(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea extends ep{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return gn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return gn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return gn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function W0(n){return R0(n.auth,new Ea(n),n.bypassAuthState)}function K0(n){const{auth:e,user:t}=n;return J(t,e,"internal-error"),w0(t,new Ea(n),n.bypassAuthState)}async function Y0(n){const{auth:e,user:t}=n;return J(t,e,"internal-error"),A0(t,new Ea(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dp{constructor(e,t,i,o,s=!1){this.auth=e,this.resolver=i,this.user=o,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:o,tenantId:s,error:l,type:u}=e;if(l){this.reject(l);return}const f={auth:this.auth,requestUri:t,sessionId:i,tenantId:s||void 0,postBody:o||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(f))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return W0;case"linkViaPopup":case"linkViaRedirect":return Y0;case"reauthViaPopup":case"reauthViaRedirect":return K0;default:je(this.auth,"internal-error")}}resolve(e){at(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){at(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q0=new Di(2e3,1e4);async function X0(n,e,t){if(Fe(n.app))return Promise.reject(qe(n,"operation-not-supported-in-this-environment"));const i=es(n);zM(n,e,_a);const o=cp(i,t);return new Bt(i,"signInViaPopup",e,o).executeNotNull()}class Bt extends dp{constructor(e,t,i,o,s){super(e,t,o,s),this.provider=i,this.authWindow=null,this.pollId=null,Bt.currentPopupAction&&Bt.currentPopupAction.cancel(),Bt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return J(e,this.auth,"internal-error"),e}async onExecution(){at(this.filter.length===1,"Popup operations only handle one event");const e=Ta();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(qe(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(qe(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Bt.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if((i=(t=this.authWindow)==null?void 0:t.window)!=null&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(qe(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Q0.get())};e()}}Bt.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z0="pendingRedirect",ho=new Map;class j0 extends dp{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=ho.get(this.auth._key());if(!e){try{const i=await eD(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}ho.set(this.auth._key(),e)}return this.bypassAuthState||ho.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function eD(n,e){const t=iD(e),i=nD(n);if(!await i._isAvailable())return!1;const o=await i._get(t)==="true";return await i._remove(t),o}function tD(n,e){ho.set(n._key(),e)}function nD(n){return nt(n._redirectPersistence)}function iD(n){return fo(Z0,n.config.apiKey,n.name)}async function oD(n,e,t=!1){if(Fe(n.app))return Promise.reject(qt(n));const i=es(n),o=cp(i,e),l=await new j0(i,o,t).execute();return l&&!t&&(delete l.user._redirectEventId,await i._persistUserIfCurrent(l.user),await i._setRedirectUser(null,e)),l}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sD=600*1e3;class rD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!aD(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!fp(e)){const o=((i=e.error.code)==null?void 0:i.split("auth/")[1])||"internal-error";t.onError(qe(this.auth,o))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=sD&&this.cachedEventUids.clear(),this.cachedEventUids.has(ld(e))}saveEventToCache(e){this.cachedEventUids.add(ld(e)),this.lastProcessedEventTime=Date.now()}}function ld(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function fp({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function aD(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return fp(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lD(n,e={}){return Ln(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uD=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,cD=/^https?/;async function dD(n){if(n.config.emulator)return;const{authorizedDomains:e}=await lD(n);for(const t of e)try{if(fD(t))return}catch{}je(n,"unauthorized-domain")}function fD(n){const e=vr(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const l=new URL(n);return l.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&l.hostname===i}if(!cD.test(t))return!1;if(uD.test(n))return i===n;const o=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+o+"|"+o+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hD=new Di(3e4,6e4);function ud(){const n=Qe().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function pD(n){return new Promise((e,t)=>{var o,s,l;function i(){ud(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{ud(),t(qe(n,"network-request-failed"))},timeout:hD.get()})}if((s=(o=Qe().gapi)==null?void 0:o.iframes)!=null&&s.Iframe)e(gapi.iframes.getContext());else if((l=Qe().gapi)!=null&&l.load)i();else{const u=_0("iframefcb");return Qe()[u]=()=>{gapi.load?i():t(qe(n,"network-request-failed"))},g0(`${y0()}?onload=${u}`).catch(f=>t(f))}}).catch(e=>{throw po=null,e})}let po=null;function mD(n){return po=po||pD(n),po}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gD=new Di(5e3,15e3),yD="__/auth/iframe",_D="emulator/auth/iframe",TD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ED=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function vD(n){const e=n.config;J(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?ha(e,_D):`https://${n.config.authDomain}/${yD}`,i={apiKey:e.apiKey,appName:n.name,v:Dn},o=ED.get(n.config.apiHost);o&&(i.eid=o);const s=n._getFrameworks();return s.length&&(i.fw=s.join(",")),`${t}?${Si(i).slice(1)}`}async function ID(n){const e=await mD(n),t=Qe().gapi;return J(t,n,"internal-error"),e.open({where:document.body,url:vD(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:TD,dontclear:!0},i=>new Promise(async(o,s)=>{await i.restyle({setHideOnLeave:!1});const l=qe(n,"network-request-failed"),u=Qe().setTimeout(()=>{s(l)},gD.get());function f(){Qe().clearTimeout(u),o(i)}i.ping(f).then(f,()=>{s(l)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CD={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},SD=500,AD=600,wD="_blank",RD="http://localhost";class cd{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function PD(n,e,t,i=SD,o=AD){const s=Math.max((window.screen.availHeight-o)/2,0).toString(),l=Math.max((window.screen.availWidth-i)/2,0).toString();let u="";const f={...CD,width:i.toString(),height:o.toString(),top:s,left:l},d=Me().toLowerCase();t&&(u=Jh(d)?wD:t),Hh(d)&&(e=e||RD,f.scrollbars="yes");const h=Object.entries(f).reduce((g,[T,w])=>`${g}${T}=${w},`,"");if(l0(d)&&u!=="_self")return MD(e||"",u),new cd(null);const m=window.open(e||"",u,h);J(m,n,"popup-blocked");try{m.focus()}catch{}return new cd(m)}function MD(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DD="__/auth/handler",ND="emulator/auth/handler",kD=encodeURIComponent("fac");async function dd(n,e,t,i,o,s){J(n.config.authDomain,n,"auth-domain-config-required"),J(n.config.apiKey,n,"invalid-api-key");const l={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:Dn,eventId:o};if(e instanceof _a){e.setDefaultLanguage(n.languageCode),l.providerId=e.providerId||"",cA(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,m]of Object.entries({}))l[h]=m}if(e instanceof Ni){const h=e.getScopes().filter(m=>m!=="");h.length>0&&(l.scopes=h.join(","))}n.tenantId&&(l.tid=n.tenantId);const u=l;for(const h of Object.keys(u))u[h]===void 0&&delete u[h];const f=await n._getAppCheckToken(),d=f?`#${kD}=${encodeURIComponent(f)}`:"";return`${xD(n)}?${Si(u).slice(1)}${d}`}function xD({config:n}){return n.emulator?ha(n,ND):`https://${n.authDomain}/${DD}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gs="webStorageSupport";class VD{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=sp,this._completeRedirectFn=oD,this._overrideRedirectResult=tD}async _openPopup(e,t,i,o){var l;at((l=this.eventManagers[e._key()])==null?void 0:l.manager,"_initialize() not called before _openPopup()");const s=await dd(e,t,i,vr(),o);return PD(e,s,Ta())}async _openRedirect(e,t,i,o){await this._originValidation(e);const s=await dd(e,t,i,vr(),o);return U0(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:o,promise:s}=this.eventManagers[t];return o?Promise.resolve(o):(at(s,"If manager is not set, promise should be"),s)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await ID(e),i=new rD(e);return t.register("authEvent",o=>(J(o==null?void 0:o.authEvent,e,"invalid-auth-event"),{status:i.onEvent(o.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Gs,{type:Gs},o=>{var l;const s=(l=o==null?void 0:o[0])==null?void 0:l[Gs];s!==void 0&&t(!!s),je(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=dD(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Xh()||zh()||ga()}}const LD=VD;var fd="@firebase/auth",hd="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bD{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){J(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UD(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function FD(n){yn(new Ht("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),o=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:l,authDomain:u}=i.options;J(l&&!l.includes(":"),"invalid-api-key",{appName:i.name});const f={apiKey:l,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Zh(n)},d=new p0(i,o,s,f);return E0(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),yn(new Ht("auth-internal",e=>{const t=es(e.getProvider("auth").getImmediate());return(i=>new bD(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ct(fd,hd,UD(n)),Ct(fd,hd,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BD=300,OD=ef("authIdTokenMaxAge")||BD;let pd=null;const qD=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>OD)return;const o=t==null?void 0:t.token;pd!==o&&(pd=o,await fetch(n,{method:o?"POST":"DELETE",headers:o?{Authorization:`Bearer ${o}`}:{}}))};function GD(n=af()){const e=xr(n,"auth");if(e.isInitialized())return e.getImmediate();const t=T0(n,{popupRedirectResolver:LD,persistence:[J0,V0,sp]}),i=ef("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(i,location.origin);if(location.origin===s.origin){const l=qD(s.toString());M0(t,l,()=>l(t.currentUser)),P0(t,u=>l(u))}}const o=Zd("auth");return o&&v0(t,`http://${o}`),t}function $D(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}m0({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=o=>{const s=qe("internal-error");s.customData=o,t(s)},i.type="text/javascript",i.charset="UTF-8",$D().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});FD("Browser");const HD={apiKey:void 0,authDomain:void 0,projectId:void 0,storageBucket:void 0,messagingSenderId:void 0,appId:void 0,measurementId:void 0},hp=rf(HD),$s=wM(hp),zD=GD(hp),JD={version:"1.4.0",changelog:{"1.4.0":['Улучшена синхронизация: добавлена кнопка "Поделиться" для отправки данных через мессенджеры.',"Добавлена история изменений приложения, чтобы вы всегда были в курсе новшеств.","Интерфейс настроек стал более информативным и удобным."],"1.3.0":["Добавлен экран предпросмотра меню перед финальным сохранением.","Полностью переработана и исправлена логика перегенерации отдельных блюд и дней.","Заменена иконка перегенерации на более современную.","В список покупок добавлено отображение остатка, необходимого к покупке.",'При отметке блюда как "приготовленное" ингредиенты списываются из запасов.',"На экран бюджета добавлена диаграмма для визуализации трат за последние 7 дней."],"1.2.0":["Добавлена информация об авторе и версии приложения.","При перегенерации меню теперь учитываются уже купленные продукты.","Улучшена логика обработки остатков блюд в меню, добавлена кнопка регенерации.","Обновлен дизайн кнопки полной перегенерации.","Улучшена проверка API ключа при запуске приложения."],"1.1.0":["Добавлена анимированная заставка-презентация.","Реализованы расширенные настройки (кухня, сложность, время).",'Улучшен ИИ для генерации списка покупок с учетом "магазинных" единиц.',"В шагах рецепта теперь отображается количество ингредиентов.",'Добавлена функция "Попросить купить" недостающие продукты.'],"1.0.0":["Первоначальный выпуск."]},state:{settings:{apiKey:null,family:[],preferences:"Без рыбы, без грибов",menuDuration:7,totalBudget:1e4,cuisine:"Любая",difficulty:"Любая"},menu:[],recipes:{},shoppingList:[],cookedMeals:{},timestamp:null,currentDayIndex:0},tempState:null,dom:{},wizard:{currentStep:1,totalSteps:3},currentRecipe:{id:null,step:0},timer:{interval:null,timeLeft:0,initialTime:0,isRunning:!1},currentUser:null,ai:null,init(){this.cacheDom(),this.addEventListeners(),window.firebaseServices={auth:zD,provider:new et,firestore:$s,signInWithPopup:X0,onAuthStateChanged:D0,signOut:N0,doc:Os,setDoc:Xc,getDoc:Qc},this.loadState().then(()=>{this.setupAuthListener()})},cacheDom(){this.dom={splashScreen:document.getElementById("splash-screen"),startAppBtn:document.getElementById("start-app-btn"),screens:document.querySelectorAll(".screen"),welcomeScreen:document.getElementById("welcome-screen"),googleSigninBtn:document.getElementById("google-signin-btn"),setupScreen:document.getElementById("setup-screen"),mainScreen:document.getElementById("main-screen"),recipeScreen:document.getElementById("recipe-screen"),settingsScreen:document.getElementById("settings-screen"),previewScreen:document.getElementById("preview-screen"),setupWizard:document.getElementById("setup-wizard"),wizardSteps:document.querySelectorAll(".wizard-step"),wizardNav:document.getElementById("wizard-nav"),wizardBackBtn:document.getElementById("wizard-back-btn"),wizardNextBtn:document.getElementById("wizard-next-btn"),wizardStepCounter:document.getElementById("wizard-step-counter"),wizardFamilyContainer:document.getElementById("wizard-family-members-container"),wizardAddMemberBtn:document.getElementById("wizard-add-family-member-btn"),wizardDuration:document.getElementById("wizard-menu-duration"),wizardBudget:document.getElementById("wizard-total-budget"),wizardPreferences:document.getElementById("wizard-preferences"),wizardCuisine:document.getElementById("wizard-cuisine"),wizardDifficulty:document.getElementById("wizard-difficulty"),generationProgress:document.getElementById("generation-progress"),progressBar:document.getElementById("progress-bar"),progressStatus:document.getElementById("progress-status"),progressDetails:document.getElementById("progress-details"),previewMenuContainer:document.getElementById("preview-menu-container"),previewRegenerateAllBtn:document.getElementById("preview-regenerate-all-btn"),previewAcceptBtn:document.getElementById("preview-accept-btn"),mainHeaderTitle:document.getElementById("main-header-title"),openSettingsBtn:document.getElementById("open-settings-btn"),closeSettingsBtn:document.getElementById("close-settings-btn"),bottomNav:document.querySelector(".bottom-nav"),mainContents:document.querySelectorAll(".main-content"),dateSelector:document.getElementById("date-selector"),prevDayBtn:document.getElementById("prev-day-btn"),currentDateDisplay:document.getElementById("current-date-display"),nextDayBtn:document.getElementById("next-day-btn"),dailyMenuContainer:document.getElementById("daily-menu-container"),shoppingListContainer:document.getElementById("shopping-list-container"),shoppingProgressText:document.getElementById("shopping-progress-text"),shoppingProgress:document.getElementById("shopping-progress"),shoppingListTotal:document.getElementById("shopping-list-total"),backToMenuBtn:document.getElementById("back-to-menu-btn"),recipeTitle:document.getElementById("recipe-title"),stepIndicator:document.getElementById("step-indicator"),stepImage:document.getElementById("step-image"),stepDescription:document.getElementById("step-description"),timerSection:document.getElementById("timer-section"),timerDisplay:document.getElementById("timer-display"),startTimerBtn:document.getElementById("start-timer-btn"),pauseTimerBtn:document.getElementById("pause-timer-btn"),resetTimerBtn:document.getElementById("reset-timer-btn"),stepIngredientsList:document.getElementById("step-ingredients"),stepIngredientsTitle:document.getElementById("step-ingredients-title"),prevStepBtn:document.getElementById("prev-step-btn"),nextStepBtn:document.getElementById("next-step-btn"),budget:{pieProducts:document.getElementById("pie-products"),spentTotal:document.getElementById("budget-spent-total"),total:document.getElementById("budget-total"),remaining:document.getElementById("budget-remaining"),barChart:document.getElementById("bar-chart")},settings:{content:document.getElementById("settings-content"),duration:document.getElementById("settings-menu-duration"),budget:document.getElementById("settings-total-budget"),preferences:document.getElementById("settings-preferences"),cuisine:document.getElementById("settings-cuisine"),difficulty:document.getElementById("settings-difficulty"),saveBtn:document.getElementById("save-settings-btn"),familyContainer:document.getElementById("family-members-container"),addMemberBtn:document.getElementById("add-family-member-btn"),regenerateAllBtn:document.getElementById("regenerate-all-btn"),apiKeyInput:document.getElementById("settings-api-key"),saveApiKeyBtn:document.getElementById("save-api-key-btn"),runWizardBtn:document.getElementById("run-wizard-btn"),appVersionInfo:document.getElementById("app-version-info"),showChangelogBtn:document.getElementById("show-changelog-btn")},exportBtn:document.getElementById("export-btn"),importBtn:document.getElementById("import-btn"),importFileInput:document.getElementById("import-file-input"),devConsole:document.getElementById("dev-console"),logOutput:document.getElementById("log-output"),commandInput:document.getElementById("command-input"),notification:document.getElementById("notification"),notificationSound:document.getElementById("notification-sound"),modalOverlay:document.getElementById("modal-overlay"),modalTitle:document.getElementById("modal-title"),modalBody:document.getElementById("modal-body"),modalButtons:document.getElementById("modal-buttons")}},addEventListeners(){this.dom.startAppBtn.addEventListener("click",()=>{localStorage.setItem("hasSeenSplash","true"),this.showScreen("welcome-screen")}),this.dom.googleSigninBtn.addEventListener("click",()=>this.signInWithGoogle()),this.dom.wizardNextBtn.addEventListener("click",()=>this.navigateWizard(1)),this.dom.wizardBackBtn.addEventListener("click",()=>this.navigateWizard(-1)),this.dom.previewAcceptBtn.addEventListener("click",()=>this.acceptPreview()),this.dom.previewRegenerateAllBtn.addEventListener("click",()=>this.startGenerationProcess(!0)),this.dom.bottomNav.addEventListener("click",e=>this.handleNav(e)),this.dom.backToMenuBtn.addEventListener("click",()=>this.showScreen("main-screen")),this.dom.prevStepBtn.addEventListener("click",()=>this.navigateRecipeStep(-1)),this.dom.nextStepBtn.addEventListener("click",()=>this.navigateRecipeStep(1)),this.dom.prevDayBtn.addEventListener("click",()=>this.navigateMenuDay(-1)),this.dom.nextDayBtn.addEventListener("click",()=>this.navigateMenuDay(1)),this.dom.startTimerBtn.addEventListener("click",()=>this.startTimer()),this.dom.pauseTimerBtn.addEventListener("click",()=>this.pauseTimer()),this.dom.resetTimerBtn.addEventListener("click",()=>this.resetTimer()),this.dom.openSettingsBtn.addEventListener("click",()=>this.showSettingsPanel()),this.dom.closeSettingsBtn.addEventListener("click",()=>this.hideSettingsPanel()),this.dom.settings.saveBtn.addEventListener("click",()=>this.saveSettings()),this.dom.settings.addMemberBtn.addEventListener("click",()=>this.openFamilyMemberModal()),this.dom.settings.regenerateAllBtn.addEventListener("click",()=>this.confirmRegenerateAll()),this.dom.settings.saveApiKeyBtn.addEventListener("click",()=>this.saveApiKey()),this.dom.wizardAddMemberBtn.addEventListener("click",()=>this.openFamilyMemberModal(!0)),this.dom.settings.runWizardBtn.addEventListener("click",()=>{this.hideSettingsPanel(),this.showWizard()}),this.dom.settings.showChangelogBtn.addEventListener("click",()=>this.showChangelogModal()),this.dom.exportBtn.addEventListener("click",()=>this.exportData()),this.dom.importBtn.addEventListener("click",()=>this.dom.importFileInput.click()),this.dom.importFileInput.addEventListener("change",e=>this.importData(e));let n;document.body.addEventListener("touchstart",e=>{e.touches.length===3&&(n=setTimeout(()=>this.toggleDevConsole(),1e3))}),document.body.addEventListener("touchend",()=>clearTimeout(n)),this.dom.commandInput.addEventListener("keydown",e=>{e.key==="Enter"&&this.executeCommand(e.target.value)}),this.dom.modalOverlay.addEventListener("click",e=>{e.target===this.dom.modalOverlay&&this.hideModal()})},setupAuthListener(){const{auth:n,onAuthStateChanged:e}=window.firebaseServices;e(n,async t=>{if(t)this.currentUser=t,this.dom.openSettingsBtn.innerHTML=`<img src="${t.photoURL}" style="width: 32px; height: 32px; border-radius: 50%;" alt="User avatar">`,await this.loadState(),this.state.menu&&this.state.menu.length>0?this.showScreen("main-screen"):this.showWizard();else{this.currentUser=null,this.dom.openSettingsBtn.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>';const i=localStorage.getItem("hasSeenSplash")==="true";this.showScreen(i?"welcome-screen":"splash-screen")}})},async signInWithGoogle(){this.showNotification("Открываю окно входа...","loading");const{auth:n,provider:e,signInWithPopup:t}=window.firebaseServices;try{await t(n,e),this.hideNotification()}catch(i){console.error("Google Sign-in failed:",i),this.showNotification(`Ошибка входа: ${i.message}`,"error")}},async saveState(){try{await Xc(Os($s,"user-data","main-config"),this.state)}catch(n){console.error("Error saving state to Firestore:",n),this.showNotification("Ошибка сохранения данных.","error")}},async loadState(){try{const n=Os($s,"user-data","main-config"),e=await Qc(n);if(e.exists()){const t=e.data();t.settings&&(this.state=t,this.state.settings.family||(this.state.settings.family=[]),this.state.settings.menuDuration||(this.state.settings.menuDuration=7),this.state.cookedMeals||(this.state.cookedMeals={}),this.state.settings.cuisine||(this.state.settings.cuisine="Любая"),this.state.settings.difficulty||(this.state.settings.difficulty="Любая"),this.state.currentDayIndex===void 0&&(this.state.currentDayIndex=0),(this.state.shoppingList||[]).forEach(i=>{(i.items||[]).forEach(o=>{var s;o.purchases===void 0&&(o.purchases=o.completed?[{qty:((s=o.shoppingSuggestion)==null?void 0:s.qty)||1,price:o.price,date:new Date().toISOString()}]:[]),o.purchases.forEach(l=>{l.date||(l.date=new Date().toISOString())}),o.consumedQty===void 0&&(o.consumedQty=0)})}))}else console.log("No saved state found in Firestore.")}catch(n){console.error("Error loading state from Firestore:",n),this.showNotification("Ошибка загрузки данных.","error")}this.hideNotification()},resetState(){const{signOut:n,auth:e}=window.firebaseServices;n(e).catch(t=>console.error("Sign out failed",t))},showScreen(n){this.dom.screens.forEach(e=>{const t=e.id===n;e.classList.toggle("hidden",!t),["recipe-screen","splash-screen","settings-screen"].includes(e.id)&&e.classList.toggle("active",t)}),n==="main-screen"?(document.getElementById("main-screen").classList.remove("hidden"),this.renderAll()):["setup-screen","welcome-screen","preview-screen"].includes(n)&&document.getElementById(n).classList.remove("hidden")},showWizard(){this.showScreen("setup-screen"),this.wizard.currentStep=1,this.updateWizardView()},updateWizardView(){const{currentStep:n,totalSteps:e}=this.wizard;this.dom.wizardDuration.value=this.state.settings.menuDuration,this.dom.wizardBudget.value=this.state.settings.totalBudget,this.dom.wizardPreferences.value=this.state.settings.preferences,this.dom.wizardCuisine.value=this.state.settings.cuisine,this.dom.wizardDifficulty.value=this.state.settings.difficulty,this.dom.wizardNav.classList.remove("hidden"),this.dom.generationProgress.classList.add("hidden"),this.dom.setupWizard.classList.remove("hidden"),this.dom.wizardStepCounter.classList.remove("hidden"),this.dom.wizardStepCounter.textContent=`Шаг ${n} из ${e}`,this.dom.wizardSteps.forEach(i=>{i.classList.toggle("active",parseInt(i.dataset.step)===n)}),this.dom.wizardBackBtn.classList.toggle("hidden",n===1),this.dom.wizardNextBtn.textContent=n===e?"Начать генерацию":"Далее";let t=!1;switch(n){case 1:t=this.state.settings.family.length>0;break;default:t=!0}this.dom.wizardNextBtn.disabled=!t,n===1&&this.renderFamilyMembers(!0)},async navigateWizard(n){const{currentStep:e,totalSteps:t}=this.wizard;if(n>0){if(e===2)this.state.settings.menuDuration=parseInt(this.dom.wizardDuration.value)||7,this.state.settings.totalBudget=parseInt(this.dom.wizardBudget.value)||1e4,this.state.settings.preferences=this.dom.wizardPreferences.value,this.state.settings.cuisine=this.dom.wizardCuisine.value,this.state.settings.difficulty=this.dom.wizardDifficulty.value;else if(e===t){await this.saveState(),await this.startGenerationProcess();return}}this.wizard.currentStep+=n,this.updateWizardView()},async startGenerationProcess(n=!1,e="",t=""){if(!this.state.settings.apiKey){alert("API ключ не найден."),this.showWizard();return}this.dom.setupWizard.classList.add("hidden"),this.dom.wizardNav.classList.add("hidden"),this.dom.wizardStepCounter.classList.add("hidden"),this.dom.generationProgress.classList.remove("hidden"),this.showScreen("setup-screen");try{this.ai=new $u({apiKey:this.state.settings.apiKey}),await this.updateProgress(1,2,"Подключение к Google Gemini…","Проверка ключа..."),await this.ai.models.generateContent({model:"gemini-2.5-flash",contents:"test"}),this.logToConsole("✅ API KEY VALIDATED"),this.dom.progressDetails.innerHTML+="<br>✅ Ключ активен. Доступ к Gemini получен.",await this.updateProgress(2,2,"Магия ИИ в действии…","Создаем меню, рецепты и список покупок...");const i=await this.generateComprehensiveData(e,t);if(!i||!i.menu||i.menu.length===0)throw new Error("Menu generation failed or returned empty data. Please check your prompt and settings.");this.tempState=i,this.renderPreview(),this.showScreen("preview-screen")}catch(i){console.error("Generation failed:",i),this.updateProgress(0,2,"Ошибка!",`Не удалось сгенерировать меню. ${i.message}`),this.dom.generationProgress.innerHTML+='<button class="primary-button" onclick="window.location.reload()" style="margin-top: 20px;">Назад к настройкам</button>',n||(this.state.settings.apiKey=null,this.saveState())}},async updateProgress(n,e,t,i){return new Promise(o=>{const s=n/e*100;this.dom.progressBar.style.width=`${s}%`,this.dom.progressStatus.textContent=`Шаг ${n}/${e}: ${t}`,this.dom.progressDetails.innerHTML=i,setTimeout(o,300)})},async makeGeminiRequest(n,e){this.logToConsole(`🟡 REQUEST: ${n.substring(0,50)}...`);let t=3;for(;t>0;)try{const o=(await this.ai.models.generateContent({model:"gemini-2.5-flash",contents:n,config:{responseMimeType:"application/json",responseSchema:e}})).text.trim(),s=JSON.parse(o);return this.logToConsole("✅ RESPONSE RECEIVED"),s}catch(i){if(t--,this.logToConsole(`🔴 ERROR: ${i}. Retrying... (${t} left)`),t===0)throw i;await new Promise(o=>setTimeout(o,1e3))}},async generateComprehensiveData(n="",e=""){const{family:t,menuDuration:i,preferences:o,cuisine:s,difficulty:l,totalBudget:u}=this.state.settings,f=t.map(w=>`- ${w.name}: Вес ${w.weight}кг, Рост ${w.height}см. Цель: ${{lose:"постепенное снижение веса",maintain:"поддержание текущего веса",gain:"набор мышечной массы"}[w.goal]}.`).join(`
`);let d=`Сгенерируй одним JSON-ответом полный план питания. Ответ должен содержать три ключа верхнего уровня: "menu", "recipes", "shoppingList".

1.  **menu**: Разнообразное меню на ${i} дней (с воскресенья по субботу) для семьи:
${f}.
    *   Учти их потребности в калориях.
    *   Общие предпочтения: ${o}.
    *   Предпочитаемая кухня: ${s}.
    *   Желаемая сложность блюд: ${l}.
    *   Каждый день должен включать: Завтрак, Перекус, Обед, Полдник, Ужин.
    *   Иногда используй остатки от ужина на обед следующего дня (помечай их как "Название блюда (остатки)").

2.  **recipes**: Массив с детальными рецептами для КАЖДОГО уникального блюда из сгенерированного меню (кроме блюд с пометкой "остатки").
    *   Каждый рецепт должен иметь уникальный 'id' (например, 'borsch-s-govyadinoy').
    *   Название 'name' рецепта должно ТОЧНО соответствовать названию в меню.
    *   Включи полный список ингредиентов с количеством для семьи из ${t.length} человек.
    *   Предоставь пошаговые инструкции 'steps'. В каждом шаге укажи используемые ингредиенты и их количество.

3.  **shoppingList**: Сводный список покупок, сгруппированный по категориям.
    *   Суммируй ВСЕ ингредиенты из ВСЕХ сгенерированных рецептов.
    *   Категории: "Мясо и птица", "Молочные и яйца", "Овощи и зелень", "Фрукты и орехи", "Бакалея", "Хлеб и выпечка", "Напитки", "Прочее".
    *   Для каждого продукта укажи общее необходимое количество 'totalNeeded', а затем предложи 'shoppingSuggestion' — разумное количество для покупки в магазине, округляя в большую сторону до стандартной упаковки (например, для 750г муки предложи купить 1кг).
    *   Укажи примерную цену 'price' в рублях для 'shoppingSuggestion'. Общая стоимость всех продуктов не должна превышать бюджет ${u} рублей.
`;n&&(d+=`
ВАЖНО: При составлении меню отдай приоритет блюдам, в которых используются уже купленные продукты. Список купленных продуктов: ${n}.`),e&&(d+=`
ОСОБОЕ УКАЗАНИЕ: ${e}`);const h={type:Y.ARRAY,items:{type:Y.OBJECT,properties:{name:{type:Y.STRING},quantity:{type:Y.STRING,description:"Количество и единица измерения, например '200 г' или '1 шт'"}},required:["name","quantity"]}},m={type:Y.OBJECT,properties:{menu:{type:Y.ARRAY,description:"Меню на неделю.",items:{type:Y.OBJECT,properties:{day:{type:Y.STRING},meals:{type:Y.OBJECT,properties:{breakfast:{type:Y.STRING},snack1:{type:Y.STRING},lunch:{type:Y.STRING},snack2:{type:Y.STRING},dinner:{type:Y.STRING}},required:["breakfast","snack1","lunch","snack2","dinner"]}},required:["day","meals"]}},recipes:{type:Y.ARRAY,description:"Рецепты для уникальных блюд из меню.",items:{type:Y.OBJECT,properties:{id:{type:Y.STRING,description:"Уникальный идентификатор рецепта"},name:{type:Y.STRING,description:"Название, соответствующее меню"},ingredients:h,steps:{type:Y.ARRAY,items:{type:Y.OBJECT,properties:{description:{type:Y.STRING},time:{type:Y.NUMBER,description:"Время в минутах. 0 если таймер не нужен."},ingredients:h},required:["description","time","ingredients"]}}},required:["id","name","ingredients","steps"]}},shoppingList:{type:Y.ARRAY,description:"Список покупок, сгруппированный по категориям.",items:{type:Y.OBJECT,properties:{category:{type:Y.STRING},items:{type:Y.ARRAY,items:{type:Y.OBJECT,properties:{name:{type:Y.STRING},totalNeeded:{type:Y.OBJECT,properties:{qty:{type:Y.NUMBER},unit:{type:Y.STRING}}},shoppingSuggestion:{type:Y.OBJECT,properties:{qty:{type:Y.NUMBER},unit:{type:Y.STRING}}},price:{type:Y.NUMBER}},required:["name","totalNeeded","shoppingSuggestion","price"]}}},required:["category","items"]}}},required:["menu","recipes","shoppingList"]},g=await this.makeGeminiRequest(d,m),T={};return g.recipes&&g.recipes.forEach(w=>{T[w.id]=w}),g.shoppingList&&g.shoppingList.forEach(w=>{(w.items||[]).forEach(M=>{M.purchases=[],M.consumedQty=0})}),{menu:g.menu||[],recipes:T,shoppingList:g.shoppingList||[]}},renderAll(){this.renderMenu(),this.renderShoppingList(),this.renderBudget()},getRegenerateIcon(){return'<svg class="regenerate-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.868 2.884c.321-.772 1.415-.772 1.736 0l1.681 4.06c.064.155.19.284.348.348l4.06 1.68c.772.321.772 1.415 0 1.736l-4.06 1.68a.5.5 0 00-.348.349l-1.68 4.06c-.321-.772-1.415-.772-1.736 0l-1.681-4.06a.5.5 0 00-.348-.348l-4.06-1.68c-.772-.321-.772-1.415 0-1.736l4.06-1.68a.5.5 0 00.348-.348l1.68-4.06z" clip-rule="evenodd" /></svg>'},getSortedMenu(){const n=["ВОСКРЕСЕНЬЕ","ПОНЕДЕЛЬНИК","ВТОРНИК","СРЕДА","ЧЕТВЕРГ","ПЯТНИЦА","СУББОТА"];return JSON.parse(JSON.stringify(this.state.menu||[])).sort((t,i)=>n.indexOf(t.day.toUpperCase())-n.indexOf(i.day.toUpperCase()))},renderMenu(){if(!this.state.menu||this.state.menu.length===0){this.dom.dailyMenuContainer.innerHTML='<p style="text-align: center; color: var(--soft-text); margin-top: 30px;">Меню еще не создано. Перейдите в настройки для генерации.</p>',this.dom.currentDateDisplay.textContent="Нет меню";return}const n=this.getSortedMenu();(this.state.currentDayIndex>=n.length||this.state.currentDayIndex<0)&&(this.state.currentDayIndex=0);const e=n[this.state.currentDayIndex];if(!e){console.error("No day data found for index:",this.state.currentDayIndex);return}this.dom.currentDateDisplay.textContent=e.day;const t=(i,o,s,l)=>{const u=(o||"Не указано").replace(/\s*\(остатки\)/i,""),f=(o||"").includes("(остатки)"),d=o&&o.trim()!==""&&o.trim()!=="Не указано",h=!f&&d,m=this.state.cookedMeals[l]&&this.state.cookedMeals[l].includes(s);return`
            <div class="meal ${h?"clickable":""} ${m?"cooked":""}" data-meal-name="${o||""}" data-meal-key="${s}" data-day-name="${l}">
                <button class="cooked-toggle" data-day-name="${l}" data-meal-key="${s}" aria-label="Отметить как приготовленное">
                    <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                </button>
                <span class="meal-icon">${i}</span>
                <span class="meal-name">${u}</span>
                ${f?'<span class="leftover-icon">🔄</span>':""}
                ${d?`<button class="regenerate-btn" title="Перегенерировать блюдо">${this.getRegenerateIcon()}</button>`:""}
            </div>`};this.dom.dailyMenuContainer.innerHTML=`
            ${t("☀️",e.meals.breakfast,"breakfast",e.day)}
            ${t("🍎",e.meals.snack1,"snack1",e.day)}
            ${t("🍲",e.meals.lunch,"lunch",e.day)}
            ${t("🥛",e.meals.snack2,"snack2",e.day)}
            ${t("🌙",e.meals.dinner,"dinner",e.day)}
        `,this.dom.dailyMenuContainer.querySelectorAll(".meal.clickable").forEach(i=>{i.addEventListener("click",o=>{if(o.target.closest(".regenerate-btn")||o.target.closest(".cooked-toggle"))return;const s=o.currentTarget.dataset.mealName.replace(/\s*\(остатки\)/i,"").trim(),l=Object.values(this.state.recipes).find(u=>u.name===s);l?this.checkIngredientsForRecipe(l.id):s&&this.showNotification('Рецепт для "'+s+'" не найден.',"error")})}),this.dom.dailyMenuContainer.querySelectorAll(".cooked-toggle").forEach(i=>{i.addEventListener("click",o=>{o.stopPropagation();const{dayName:s,mealKey:l}=o.currentTarget.dataset;this.toggleCookedStatus(s,l)})}),this.dom.dailyMenuContainer.querySelectorAll(".regenerate-btn").forEach(i=>{i.addEventListener("click",o=>{o.stopPropagation();const l=o.currentTarget.closest(".meal"),{dayName:u,mealKey:f}=l.dataset;this.openRegenerateModal("meal",{dayName:u,mealKey:f})})})},navigateMenuDay(n){if(!this.state.menu||this.state.menu.length===0)return;const e=this.state.menu.length;let t=this.state.currentDayIndex+n;t<0?t=e-1:t>=e&&(t=0),this.state.currentDayIndex=t,this.saveState(),this.renderMenu()},toggleCookedStatus(n,e){var u;this.state.cookedMeals[n]||(this.state.cookedMeals[n]=[]);const t=!this.state.cookedMeals[n].includes(e),i=t?1:-1,o=(((u=this.state.menu.find(f=>f.day===n))==null?void 0:u.meals[e])||"").replace(/\s*\(остатки\)/i,"").trim(),s=Object.values(this.state.recipes).find(f=>f.name===o);s&&s.ingredients&&s.ingredients.forEach(f=>{const d=this.findShopItemByName(f.name),h=this.parseQuantity(f.quantity);d&&h&&(d.consumedQty===void 0&&(d.consumedQty=0),d.consumedQty+=i*h.qty,d.consumedQty=Math.max(0,d.consumedQty))});const l=this.state.cookedMeals[n].indexOf(e);l>-1?this.state.cookedMeals[n].splice(l,1):this.state.cookedMeals[n].push(e),this.saveState(),this.renderMenu(),this.showNotification(t?"Блюдо отмечено как приготовленное!":"Отметка о приготовлении снята.","success")},findShopItemByName(n){if(!n)return null;const e=n.toLowerCase().trim().replace(/ё/g,"е");for(const t of this.state.shoppingList)for(const i of t.items){const o=i.name.toLowerCase().trim().replace(/ё/g,"е");if(o.includes(e)||e.includes(o))return i}return null},parseQuantity(n){if(typeof n!="string")return null;const e=n.match(/(\d+[\.,]?\d*)\s*([а-яА-Яa-zA-Z]+)?/);return e?{qty:parseFloat(e[1].replace(",",".")),unit:(e[2]||"").toLowerCase()}:null},renderShoppingList(){if(!this.state.shoppingList)return;this.dom.shoppingListContainer.innerHTML="",this.state.shoppingList.forEach((e,t)=>{const i=document.createElement("div");i.className="category-group";const o=e.items.map((s,l)=>{const u=(s.purchases||[]).reduce((w,M)=>w+M.qty,0),f=Math.max(0,s.shoppingSuggestion.qty-u),d=f<=0,h=s.shoppingSuggestion.qty>0?Math.min(u/s.shoppingSuggestion.qty*100,100):0,m=10,g=2*Math.PI*m,T=g-h/100*g;return`
                <li class="shopping-item ${d?"completed":""}" data-cat-index="${t}" data-item-index="${l}">
                    <div class="item-checkbox-progress">
                        <svg viewBox="0 0 24 24">
                          <circle class="bg" cx="12" cy="12" r="${m}"></circle>
                          <circle class="progress" cx="12" cy="12" r="${m}" stroke-dasharray="${g}" stroke-dashoffset="${T}"></circle>
                        </svg>
                        <span class="checkmark">✔</span>
                    </div>
                    <div class="item-details">
                        <span class="item-name">${s.name}</span>
                        <div class="item-quantity">
                           Нужно: ${s.shoppingSuggestion.qty.toLocaleString("ru-RU")} ${s.shoppingSuggestion.unit} <br>
                           <span style="font-weight: bold; color: ${f>0?"var(--warning-color)":"var(--success-color)"};">Осталось купить: ${f.toLocaleString("ru-RU")} ${s.shoppingSuggestion.unit}</span>
                        </div>
                    </div>
                    <span class="item-price">${s.price} ₽</span>
                </li>
            `}).join("");i.innerHTML=`
                <button class="category-toggle">${e.category} ▼</button>
                <ul class="category-items">${o}</ul>
            `,this.dom.shoppingListContainer.appendChild(i)}),this.dom.shoppingListContainer.querySelectorAll(".shopping-item").forEach(e=>{e.addEventListener("click",t=>{const{catIndex:i,itemIndex:o}=t.currentTarget.dataset;this.openPurchaseModal(parseInt(i),parseInt(o))})}),this.dom.shoppingListContainer.querySelectorAll(".category-toggle").forEach(e=>{e.addEventListener("click",t=>{const i=t.target.nextElementSibling;i.classList.toggle("collapsed"),t.target.innerHTML=i.classList.contains("collapsed")?t.target.innerHTML.replace("▼","▶"):t.target.innerHTML.replace("▶","▼")})}),this.updateShoppingProgress();const n=this.state.shoppingList.flatMap(e=>e.items).reduce((e,t)=>e+(t.price||0),0);this.dom.shoppingListTotal.innerHTML=`<span>Примерная сумма:</span> ${n.toLocaleString("ru-RU")} ₽`},updateShoppingProgress(){if(!this.state.shoppingList)return;const n=this.state.shoppingList.flatMap(o=>o.items||[]);if(n.length===0)return;const e=n.length,t=n.filter(o=>(o.purchases||[]).reduce((l,u)=>l+u.qty,0)>=o.shoppingSuggestion.qty).length,i=e>0?t/e*100:0;this.dom.shoppingProgress.style.width=`${i}%`,this.dom.shoppingProgressText.textContent=`${t}/${e} куплено`},renderBudget(){const n=this.state.settings.totalBudget,e=this.state.shoppingList.flatMap(o=>o.items||[]).flatMap(o=>o.purchases||[]).reduce((o,s)=>o+s.price,0),t=n-e,i=n>0?Math.min(e/n*100,100):0;this.dom.budget.pieProducts.style.strokeDasharray=`${i} 100`,this.dom.budget.spentTotal.innerHTML=`${e.toLocaleString("ru-RU")} ₽ <span>потрачено</span>`,this.dom.budget.total.textContent=`${n.toLocaleString("ru-RU")} ₽`,this.dom.budget.remaining.textContent=`${t.toLocaleString("ru-RU")} ₽`,this.dom.budget.remaining.className=`amount ${t>=0?"ok":"warning"}`,this.renderBudgetChart()},renderBudgetChart(){const n=this.state.shoppingList.flatMap(o=>o.items||[]).flatMap(o=>o.purchases||[]),e={};for(let o=6;o>=0;o--){const s=new Date;s.setDate(s.getDate()-o);const l=s.toISOString().split("T")[0];e[l]={amount:0,label:s.toLocaleDateString("ru-RU",{weekday:"short"})}}n.forEach(o=>{const s=new Date(o.date).toISOString().split("T")[0];e[s]&&(e[s].amount+=o.price)});const t=Object.values(e).map(o=>o.amount),i=Math.max(...t,1);this.dom.budget.barChart.innerHTML=Object.values(e).map(o=>`
                <div class="bar-chart-item">
                    <div class="bar" style="height: ${o.amount/i*100}%;">
                        ${o.amount>0?`<div class="bar-value">${Math.round(o.amount)}</div>`:""}
                    </div>
                    <div class="bar-label">${o.label}</div>
                </div>
            `).join("")},checkIngredientsForRecipe(n){const e=this.state.recipes[n];if(!e||!e.ingredients){this.showRecipe(n);return}const t=[];e.ingredients.forEach(i=>{const o=this.findShopItemByName(i.name),s=this.parseQuantity(i.quantity);o&&s?(o.purchases||[]).reduce((f,d)=>f+d.qty,0)-(o.consumedQty||0)<s.qty&&t.push(o):t.push({name:i.name,shoppingSuggestion:{qty:(s==null?void 0:s.qty)||1,unit:(s==null?void 0:s.unit)||"шт"}})}),t.length>0?this.showMissingIngredientsWarning(t,n):this.showRecipe(n)},showRecipe(n){if(this.currentRecipe.id=n,this.currentRecipe.step=0,!this.state.recipes[n]){this.showNotification(`Не удалось найти рецепт с ID: ${n}.`,"error");return}this.showScreen("recipe-screen"),this.renderRecipeStep()},renderRecipeStep(){const{id:n,step:e}=this.currentRecipe,t=this.state.recipes[n];if(!t||!t.steps||!t.steps[e]){console.error("Invalid recipe or step:",n,e),this.showNotification("Ошибка при загрузке рецепта.","error"),this.showScreen("main-screen");return}const i=t.steps[e];this.dom.recipeTitle.textContent=t.name,this.dom.stepIndicator.textContent=`Шаг ${e+1}/${t.steps.length}`,this.dom.stepDescription.textContent=i.description,this.dom.stepImage.style.opacity="0.5",i.imageUrl?(this.dom.stepImage.src=i.imageUrl,this.dom.stepImage.alt=i.description,this.dom.stepImage.style.opacity="1"):(this.dom.stepImage.src="",this.dom.stepImage.alt="Генерация изображения...",this.generateStepImage(n,e)),this.stopTimer(),i.time&&i.time>0?(this.timer.initialTime=i.time*60,this.resetTimer(),this.dom.timerSection.classList.remove("hidden")):this.dom.timerSection.classList.add("hidden"),this.dom.stepIngredientsList.innerHTML="",i.ingredients&&i.ingredients.length>0?(this.dom.stepIngredientsTitle.classList.remove("hidden"),i.ingredients.forEach(o=>{const s=document.createElement("li"),l=this.findShopItemByName(o.name),u=this.parseQuantity(o.quantity);let f="unknown",d="❔";l&&u&&((l.purchases||[]).reduce((g,T)=>g+T.qty,0)-(l.consumedQty||0)>=u.qty?(f="completed",d="✅"):(f="missing",d="⚠️")),s.innerHTML=`<span><span class="ingredient-status ${f}">${d}</span> ${o.name}</span> <span class="ingredient-quantity">${o.quantity}</span>`,this.dom.stepIngredientsList.appendChild(s)})):this.dom.stepIngredientsTitle.classList.add("hidden"),this.dom.prevStepBtn.disabled=e===0,this.dom.nextStepBtn.textContent=e===t.steps.length-1?"Завершить ✅":"Далее →"},async generateStepImage(n,e){if(!this.ai)if(this.state.settings.apiKey)this.ai=new $u({apiKey:this.state.settings.apiKey});else return;try{const o=`Food photography, realistic, high-detail photo of a cooking step: "${this.state.recipes[n].steps[e].description}"`,u=`data:image/jpeg;base64,${(await this.ai.models.generateImages({model:"imagen-4.0-generate-001",prompt:o,config:{numberOfImages:1,outputMimeType:"image/jpeg",aspectRatio:"4:3"}})).generatedImages[0].image.imageBytes}`;this.currentRecipe.id===n&&this.currentRecipe.step===e&&(this.dom.stepImage.src=u,this.dom.stepImage.style.opacity="1"),this.state.recipes[n].steps[e].imageUrl=u,this.saveState()}catch(t){console.error("Image generation failed:",t),this.currentRecipe.id===n&&this.currentRecipe.step===e&&(this.dom.stepImage.alt="Не удалось загрузить изображение")}},navigateRecipeStep(n){const{id:e,step:t}=this.currentRecipe,i=this.state.recipes[e];if(n>0&&t===i.steps.length-1){this.finishCooking();return}const o=t+n;o>=0&&o<i.steps.length&&(this.currentRecipe.step=o,this.renderRecipeStep())},finishCooking(){const{id:n}=this.currentRecipe,e=this.state.recipes[n];let t=null;for(const i of this.state.menu){for(const o in i.meals)if((i.meals[o]||"").replace(/\s*\(остатки\)/i,"").trim()===e.name){t={dayName:i.day,mealKey:o};break}if(t)break}t&&this.toggleCookedStatus(t.dayName,t.mealKey),this.showNotification(`"${e.name}" приготовлено!`,"success"),this.showScreen("main-screen")},startTimer(){this.timer.isRunning||this.timer.timeLeft<=0||(this.timer.isRunning=!0,this.timer.interval=setInterval(()=>{this.timer.timeLeft--,this.updateTimerDisplay(),this.timer.timeLeft<=0&&this.stopTimer(!0)},1e3))},pauseTimer(){this.timer.isRunning=!1,clearInterval(this.timer.interval)},stopTimer(n=!1){this.pauseTimer(),n&&(this.dom.timerDisplay.textContent="Готово!",this.showNotification("Таймер завершен!","success"),this.dom.notificationSound.play().catch(e=>console.log("Audio play failed",e)))},resetTimer(){this.stopTimer(),this.timer.timeLeft=this.timer.initialTime,this.updateTimerDisplay()},updateTimerDisplay(){const n=Math.floor(this.timer.timeLeft/60),e=this.timer.timeLeft%60;this.dom.timerDisplay.textContent=`${String(n).padStart(2,"0")}:${String(e).padStart(2,"0")}`},handleNav(n){const e=n.target.closest(".nav-button");if(!e)return;this.dom.bottomNav.querySelectorAll(".nav-button").forEach(i=>i.classList.remove("active")),e.classList.add("active");const t=e.dataset.content;this.dom.mainHeaderTitle.textContent=e.dataset.title,this.dom.mainContents.forEach(i=>{i.classList.toggle("active",i.id===t)}),t==="budget-content"&&this.renderBudget()},showNotification(n,e="success"){this.dom.notification.textContent=n,this.dom.notification.className=e,this.dom.notification.classList.add("show"),e!=="loading"&&setTimeout(()=>{this.dom.notification.classList.remove("show")},3e3)},hideNotification(){this.dom.notification.classList.remove("show")},showModal(n,e,t){this.dom.modalTitle.textContent=n,this.dom.modalBody.innerHTML=e,this.dom.modalButtons.innerHTML="",t.forEach(i=>{const o=document.createElement("button");o.textContent=i.text,o.className=`modal-button ${i.class}`,o.addEventListener("click",()=>{i.action(),i.closes!==!1&&this.hideModal()}),this.dom.modalButtons.appendChild(o)}),this.dom.modalOverlay.classList.add("visible")},hideModal(){this.dom.modalOverlay.classList.remove("visible")},showApiKeyHelpModal(){this.showModal("Как получить API ключ?","...",[{text:"Понятно",class:"primary",action:()=>{}}])},openPurchaseModal(n,e){},async shareMissingItems(n){},showMissingIngredientsWarning(n,e){},showSettingsPanel(){this.renderSettings(),this.dom.settingsScreen.classList.remove("hidden"),setTimeout(()=>this.dom.settingsScreen.classList.add("active"),10)},hideSettingsPanel(){this.dom.settingsScreen.classList.remove("active"),setTimeout(()=>{this.dom.settingsScreen.classList.add("hidden")},500)},renderSettings(){},saveSettings(){},async saveApiKey(){},renderFamilyMembers(n=!1){},openFamilyMemberModal(n=!1,e=null,t=-1){},confirmRegenerateAll(){},showChangelogModal(){},openRegenerateModal(n,e){},async handleRegeneration(n,e,t=!1,i=""){},renderPreview(){},acceptPreview(){},async exportData(){},importData(n){},toggleDevConsole(){this.dom.devConsole.classList.toggle("visible")},logToConsole(n){const e=document.createElement("p");e.textContent=`[${new Date().toLocaleTimeString()}] ${n}`,this.dom.logOutput.appendChild(e),this.dom.logOutput.scrollTop=this.dom.logOutput.scrollHeight},executeCommand(n){}};document.addEventListener("DOMContentLoaded",()=>JD.init());
